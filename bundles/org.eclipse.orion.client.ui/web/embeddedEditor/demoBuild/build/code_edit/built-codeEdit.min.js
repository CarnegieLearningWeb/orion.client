/*

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
 RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/text for details

 Copyright (c) 2012, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).


 Copyright (c) 2012, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 program and the accompanying materials are made available under the terms of
 the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 and the Eclipse Distribution License v1.0
 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation
 Adrian Aichner - regular expression capture group support in replace

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
     Andy Clement (vmware) - bug 344614

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: Anton McConville - IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 


 Copyright (c) 2011,2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 program and the accompanying materials are made available under the terms of
 the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 and the Eclipse Distribution License v1.0
 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2014 IBM Corporation and others. All rights reserved. This
 program and the accompanying materials are made available under the terms of
 the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 and the Eclipse Distribution License v1.0
 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 Pivotal Software Inc. and others
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: Pivotal Software Inc. - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others. All rights reserved. This
 program and the accompanying materials are made available under the terms of
 the Eclipse Public License v1.0 (http://www.eclipse.org/legal/epl-v10.html),
 and the Eclipse Distribution License v1.0
 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation
*/
(function(S,y){"function"===typeof define&&define.amd?define([],y):(S.orion=S.orion||{},S.orion.codeEdit=y())})(this,function(){var S,y;(function(l){function r(a,f){var u,s,n,g,q,x,w,b,t,v=f&&f.split("/"),c=d.map,m=c&&c["*"]||{};if(a&&"."===a.charAt(0))if(f){v=v.slice(0,v.length-1);a=v.concat(a.split("/"));for(b=0;b<a.length;b+=1)if(u=a[b],"."===u)a.splice(b,1),b-=1;else if(".."===u)if(1===b&&(".."===a[2]||".."===a[0]))break;else 0<b&&(a.splice(b-1,2),b-=2);a=a.join("/")}else 0===a.indexOf("./")&&
(a=a.substring(2));if((v||m)&&c){u=a.split("/");for(b=u.length;0<b;b-=1){s=u.slice(0,b).join("/");if(v)for(t=v.length;0<t;t-=1)if(n=c[v.slice(0,t).join("/")])if(n=n[s]){g=n;q=b;break}if(g)break;!x&&(m&&m[s])&&(x=m[s],w=b)}!g&&x&&(g=x,q=w);g&&(u.splice(0,q,g),a=u.join("/"))}return a}function p(d,a){return function(){return g.apply(l,v.call(arguments,0).concat([d,a]))}}function h(d){return function(a){return r(a,d)}}function e(d){return function(a){f[d]=a}}function c(d){if(s.call(n,d)){var a=n[d];delete n[d];
u[d]=!0;m.apply(l,a)}if(!s.call(f,d)&&!s.call(u,d))throw Error("No "+d);return f[d]}function b(d){var a,f=d?d.indexOf("!"):-1;-1<f&&(a=d.substring(0,f),d=d.substring(f+1,d.length));return[a,d]}function k(a){return function(){return d&&d.config&&d.config[a]||{}}}var m,g,a,t,f={},n={},d={},u={},s=Object.prototype.hasOwnProperty,v=[].slice;a=function(d,a){var f,u=b(d),s=u[0];d=u[1];s&&(s=r(s,a),f=c(s));s?d=f&&f.normalize?f.normalize(d,h(a)):r(d,a):(d=r(d,a),u=b(d),s=u[0],d=u[1],s&&(f=c(s)));return{f:s?
s+"!"+d:d,n:d,pr:s,p:f}};t={require:function(d){return p(d)},exports:function(d){var a=f[d];return"undefined"!==typeof a?a:f[d]={}},module:function(d){return{id:d,uri:"",exports:f[d],config:k(d)}}};m=function(d,b,g,v){var m,k,q,x,w=[],E;v=v||d;if("function"===typeof g){b=!b.length&&g.length?["require","exports","module"]:b;for(x=0;x<b.length;x+=1)if(q=a(b[x],v),k=q.f,"require"===k)w[x]=t.require(d);else if("exports"===k)w[x]=t.exports(d),E=!0;else if("module"===k)m=w[x]=t.module(d);else if(s.call(f,
k)||s.call(n,k)||s.call(u,k))w[x]=c(k);else if(q.p)q.p.load(q.n,p(v,!0),e(k),{}),w[x]=f[k];else throw Error(d+" missing "+k);b=g.apply(f[d],w);if(d)if(m&&m.exports!==l&&m.exports!==f[d])f[d]=m.exports;else if(b!==l||!E)f[d]=b}else d&&(f[d]=g)};S=g=function(f,u,s,b,n){if("string"===typeof f)return t[f]?t[f](u):c(a(f,u).f);f.splice||(d=f,u.splice?(f=u,u=s,s=null):f=l);u=u||function(){};"function"===typeof s&&(s=b,b=n);b?m(l,f,u,s):setTimeout(function(){m(l,f,u,s)},4);return g};g.config=function(a){d=
a;return g};y=function(d,a,u){a.splice||(u=a,a=[]);!s.call(f,d)&&!s.call(n,d)&&(n[d]=[d,a,u])};y.amd={jQuery:!0}})();y("almond",function(){});(function(l,r){"function"===typeof y&&y.amd?y("orion/Deferred",r):"object"===typeof exports?module.exports=r():(l.orion=l.orion||{},l.orion.Deferred=r())})(this,function(){function l(){for(var b;b=e.shift();)b();c=!1}function r(k){e.push(k);c||(c=!0,b())}function p(b){return function(c){b(c)}}function h(){function b(){for(var d;d=n.shift();){var a=d.deferred,
g="fulfilled"===f?"resolve":"reject";d=d[g];if("function"===typeof d)try{var c=d(t),m=c&&("object"===typeof c||"function"===typeof c)&&c.then;if("function"===typeof m)if(c===a.promise)a.reject(new TypeError);else{var k=c.cancel;"function"===typeof k?a._parentCancel=k.bind(c):delete a._parentCancel;m.call(c,p(a.resolve),p(a.reject),p(a.progress))}else a.resolve(c)}catch(e){a.reject(e)}else a[g](t)}}function c(a){delete d._parentCancel;f="rejected";t=a;n.length&&r(b)}function g(a){function s(d){return function(a){(!f||
"assumed"===f)&&d(a)}}delete d._parentCancel;try{var v=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===typeof v)if(a===d)c(new TypeError);else{f="assumed";var e=a&&a.cancel;if("function"!==typeof e){var F=new h;a=F.promise;try{v(F.resolve,F.reject,F.progress)}catch(z){F.reject(z)}e=a.cancel;v=a.then}t=a;v.call(a,s(g),s(c));d._parentCancel=e.bind(a)}else f="fulfilled",t=a,n.length&&r(b)}catch(l){s(c)(l)}}function a(){var a=d._parentCancel;a?(delete d._parentCancel,a()):f||(a=
Error("Cancel"),a.name="Cancel",c(a))}var t,f,n=[],d=this;this.resolve=function(a){f||g(a);return d};this.reject=function(a){f||c(a);return d};this.progress=function(a){f||n.forEach(function(d){if(d.progress)try{d.progress(a)}catch(f){}});return d.promise};this.cancel=function(){d._parentCancel?setTimeout(a,0):a();return d};this.then=function(a,s,g){var t=new h;t._parentCancel=d.promise.cancel;n.push({resolve:a,reject:s,progress:g,deferred:t});("fulfilled"===f||"rejected"===f)&&r(b);return t.promise};
this.promise={then:d.then,cancel:d.cancel}}var e=[],c=!1,b=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var b=process.nextTick;return function(){b(l)}}if("function"===typeof MutationObserver){var c=document.createElement("div");(new MutationObserver(l)).observe(c,{attributes:!0});return function(){c.setAttribute("class","_tick")}}return function(){setTimeout(l,0)}}();h.all=function(b,c){function g(a,b){n||(f[a]=b,0===--t&&d.resolve(f))}function a(a,f){if(!n){if(c)try{g(a,
c(f));return}catch(b){f=b}d.reject(f)}}var t=b.length,f=[],n=!1,d=new h;d.then(void 0,function(){n=!0;b.forEach(function(d){d.cancel&&d.cancel()})});0===t?d.resolve(f):b.forEach(function(d,f){d.then(g.bind(void 0,f),a.bind(void 0,f))});return d.promise};h.when=function(b,c,g,a){var t;b&&"function"===typeof b.then||(t=new h,t.resolve(b),b=t.promise);return b.then(c,g,a)};return h});(function(l){function r(){Error.apply(this,arguments)}function p(e,c){var b=e||"utf-8";if("utf-8"!==b&&"utf8"!==b&&"unicode-1-1-utf-8"!==
b)throw new TypeError("only utf-8 supported");Object.defineProperties(this,{encoding:{value:b,enumerable:!0},_fatal:{value:c&&c.fatal},_saved:{value:[],writable:!0},_checkBOM:{value:!0,writable:!0}})}function h(e){e=e||"utf-8";if("utf-8"!==e&&"utf8"!==e&&"unicode-1-1-utf-8"!==e)throw new TypeError("only utf-8 supported");Object.defineProperties(this,{encoding:{value:e,enumerable:!0},_saved:{value:null,writable:!0}})}r.prototype=Error();r.prototype.constructor=r;r.prototype.name="EncodingError";p.prototype.decode=
function(e,c){function b(){if(this._fatal)throw this._saved.length=f=0,u=d,this._checkBOM=this._checkBOM||!t,new r;s[v++]=65533}e=e instanceof Uint8Array?e:new Uint8Array(e);var k,m,g,a,t=c&&c.stream,f=this._saved.length,n=e.length,d=0,u=0,s=new Uint16Array(n+f),v=0;if(this._checkBOM&&n)if(2<f+n){for(k=f;3>k;k++)this._saved.push(e[d++]);239!==this._saved[0]||187!==this._saved[1]||191!==this._saved[2]?(d=0,this._saved.length=f):f=this._saved.length-=3;this._checkBOM=!1}else if(t)for(;d<n;)this._saved.push(e[d++]);
for(;d<n;){k=0<f?this._saved[0]:e[d++];if(128>k)s[v++]=k;else if(194<=k&&223>=k){if(d===n)break;m=1<f?this._saved[1]:e[d++];if(!(128<=m&&191>=m)){b();continue}s[v++]=(k&31)<<6|m&63}else if(224<=k&&239>=k){if(d===n)break;m=1<f?this._saved[1]:e[d++];if(224===k&&!(160<=m&&191>=m)||237===k&&!(128<=m&&159>=m)||!(128<=m&&191>=m)){b();continue}if(d===n)break;g=2<f?this._saved[2]:e[d++];if(!(128<=g&&191>=g)){b();continue}s[v++]=(k&15)<<12|(m&63)<<6|g&63}else if(240<=k&&244>=k){if(d===n)break;m=1<f?this._saved[1]:
e[d++];if(240===k&&!(144<=m&&191>=m)||244===k&&!(128<=m&&143>=m)||!(128<=m&&191>=m)){b();continue}if(d===n)break;g=2<f?this._saved[2]:e[d++];if(!(128<=g&&191>=g)){b();continue}if(d===n)break;a=e[d++];if(!(128<=a&&191>=a)){b();continue}k=((k&7)<<18|(m&63)<<12|(g&63)<<6|a&63)&65535;s[v++]=k>>10|55296;s[v++]=k&1023|56320}else b();u=d;f&&(this._saved.length=f=0)}for(;u!==d;)this._saved.push(e[u++]);this._checkBOM=this._checkBOM||!t;if(!t&&0!==this._saved.length)throw new r;n=[];for(k=0;k<v;k+=65536)n.push(String.fromCharCode.apply(null,
s.subarray(k,Math.min(v,k+65536))));return n.join("")};h.prototype.encode=function(e,c){e=String(void 0!==e?e:"");for(var b,k,m=c&&c.stream,g=e.length,a=0,t=new Uint8Array(3*(g+(null===this._saved?0:1))),f=0;a<g;)if(null===this._saved?b=e.charCodeAt(a++):(b=this._saved,this._saved=null),128>b)t[f++]=b;else{if(2048>b)t[f++]=192|b>>6;else{if(55296>b||56319<b)t[f++]=224|b>>12;else{if(a<g)k=e.charCodeAt(a++);else if(m){this._saved=b;break}else throw new r;if(!(56320<=k&&57343>=k))throw new r;b=65536|
(b&1023)<<10|k&1023;t[f++]=240|b>>18;t[f++]=128|b>>12&63}t[f++]=128|b>>6&63}t[f++]=128|b&63}if(!m&&null!==this._saved)throw new r;return t.buffer.slice?new Uint8Array(t.buffer.slice(0,f)):t.subarray(0,f)};l.TextDecoder=l.TextDecoder||p;l.TextEncoder=l.TextEncoder||h})("undefined"===typeof global?this||self:global);y("orion/encoding-shim",function(){});(function(){function l(q){if("string"!==typeof q)throw new TypeError;}function r(q){return q?q.split("\x26"):[]}function p(q){return 0===q.length?"":
q.join("\x26")}function h(q){var d=/([^=]*)(?:=?)(.*)/.exec(q);q=d[1]?decodeURIComponent(d[1]):"";d=d[2]?decodeURIComponent(d[2]):"";return[q,d]}function e(q){var d=encodeURIComponent(q[0]);q[1]&&(d+="\x3d"+encodeURIComponent(q[1]));return d}function c(d,a){var f="",u=[],x=0;return{next:function(){f!==d.query&&(f=d.query,u=r(f));if(x<u.length){var b=h(u[x++]);switch(a){case "keys":return b[0];case "values":return b[1];case "keys+values":return[b[0],b[1]];default:throw new TypeError;}}throw q;}}}function b(q){Object.defineProperty(this,
"_url",{get:function(){return q._url}})}function k(q){return q?/[1-9]\d*$/.exec(q)[0]:""}function m(q){var d=[];q.split("/").forEach(function(q){".."===q?d.pop():"."!==q&&d.push(q)});return d.join("/")}function g(q){return q.replace(/\s/g,function(q){return"%"+q.charCodeAt(0).toString(16)})}function a(q,a){if("string"!==typeof q)throw new TypeError;q=g(q);var f=d.exec(q);if(!f)return null;var b={};b.scheme=f[1]||"";if(b.scheme&&!s.test(b.scheme))return null;var x=f[2];if(x&&(x=u.exec(x),b.userinfo=
x[1],b.host=x[2],b.port=x[3],b.port&&!v.test(b.port)))return null;b.path=f[3];b.query=f[4];b.fragment=f[5];!b.scheme&&a&&(b.scheme=a.scheme,!b.host&&a.host&&(b.userinfo=a.userinfo,b.host=a.host,b.port=a.port,b.pathRelative=!0));b.pathRelative&&(b.path?"/"!==b.path[0]&&(f=/^(.*\/)[^\/]*$/.exec(a.path)[1]||"/",b.path=f+b.path):b.path=a.path);b.scheme&&(b.scheme=b.scheme.toLowerCase());b.port&&(b.port=k(b.port));b.host&&b.path&&(b.path=m(b.path));return b}function t(q,d){var f;if(d){d=d.href||d;f=a(d);
if(!f||!f.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:f})}f=a(q,f);if(!f)throw new SyntaxError;Object.defineProperty(this,"_input",{value:q,writable:!0});Object.defineProperty(this,"_url",{value:f,writable:!0});var u=new b(this);Object.defineProperty(this,"query",{get:function(){return this._url?u:null},enumerable:!0})}try{var f;if("function"===typeof self.URL&&0!==self.URL.length&&"http:"===(f=new self.URL("http://www.w3.org?q")).protocol&&f.query)return}catch(n){}var d=
/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,u=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,s=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,v=/^\d*$/,A=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,F=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,z=/^([^?#\s]*)$/,D=/^([^\s]*)$/,B=/^\S*$/,C=/([^:]*):?(.*)/,q="undefined"!==typeof StopIteration?StopIteration:Error("Stop Iteration"),x={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(b.prototype,
{get:{value:function(q){l(q);var d;r(this._url.query).some(function(a){a=h(a);if(a[0]===q)return d=a[1],!0});return d},enumerable:!0},set:{value:function(q,d){l(q);l(d);var a=r(this._url.query);a.some(function(f,u){var b=h(f);if(b[0]===q)return b[1]=d,a[u]=e(b),!0})||a.push(e([q,d]));this._url.query=p(a)},enumerable:!0},has:{value:function(q){l(q);return r(this._url.query).some(function(d){if(h(d)[0]===q)return!0})},enumerable:!0},"delete":{value:function(q){l(q);var d=r(this._url.query),a=d.filter(function(d){return h(d)[0]!==
q});return a.length!==d.length?(this._url.query=p(a),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(d,a){if("function"!==typeof d)throw new TypeError;var f=c(this._url,"keys+values");try{for(;;){var u=f.next();d.call(a,u[1],u[0],this)}}catch(b){if(b!==q)throw b;}},enumerable:!0},keys:{value:function(){return c(this._url,"keys")},enumerable:!0},values:{value:function(){return c(this._url,"values")},enumerable:!0},items:{value:function(){return c(this._url,
"keys+values")}},size:{get:function(){return r(this._url.query).length},enumerable:!0},getAll:{value:function(q){l(q);var d=[];r(this._url.query).forEach(function(a){a=h(a);a[0]===q&&d.push(a[1])});return d},enumerable:!0},append:{value:function(q,d){l(q);l(d);var a=r(this._url.query);a.push(e([q,d]));this._url.query=p(a)},enumerable:!0}});Object.defineProperties(t.prototype,{href:{get:function(){var q;if(this._url){q=this._url;var d=q.scheme?q.scheme+":":"";q.host&&(d+="//",q.userinfo&&(d+=q.userinfo+
"@"),d+=q.host,q.port&&(d+=":"+q.port));d+=q.path;q.query&&(d+="?"+q.query);q.fragment&&(d+="#"+q.fragment);q=d}else q=this._input;return q},set:function(q){l(q);this._input=q;this._url=a(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(q){l(q);if(this._url&&(q=":"===q.slice(-1)?q.substring(0,q.length-1):q,""===q||s.test(q)))this._url.scheme=
q.toLowerCase()},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(q){l(q);this._url&&(this._url.userinfo=q)}},username:{get:function(){if(!this._url)return"";var q=C.exec(this._userinfo);return decodeURIComponent(q[1]||"")},set:function(q){l(q);if(this._url){var d=C.exec(this._userinfo);q=[encodeURIComponent(q||"")];d[2]&&q.push(d[2]);this._userinfo=q.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var q=C.exec(this._userinfo);
return decodeURIComponent(q[2]||"")},set:function(q){l(q);if(this._url){var d=[C.exec(this._userinfo)[1]||""];q&&d.push(encodeURIComponent(q));this._userinfo=d.join(":")}},enumerable:!0},host:{get:function(){var q="";this._url&&this._url.host&&(q+=this._url.host,this._url.port&&(q+=":"+this._url.port));return q},set:function(q){l(q);if(this._url&&(q=F.exec(q)))this._url.host=q[1],this._url.port=k(q[2])},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(q){l(q);
this._url&&A.exec(q)&&(this._url.host=q)},enumerable:!0},port:{get:function(){var q=this._url?this._url.port||"":"";q&&q===x[this.protocol]&&(q="");return q},set:function(q){l(q);this._url&&v.exec(q)&&(this._url.port=k(q))},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(q){l(q);this._url&&z.exec(q)&&(this._url.host&&(q&&"/"!==q[0])&&(q="/"+q),this._url.path=q?m(q):"")},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:
""},set:function(q){l(q);this._url&&(q&&"?"===q[0]&&(q=q.substring(1)),D.exec(q)&&(this._url.query=q))},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(q){l(q);this._url&&(q&&"#"===q[0]&&(q=q.substring(1)),B.exec(q)&&(this._url.fragment=q))},enumerable:!0}});if((f=self.URL||self.webkitURL)&&f.createObjectURL)Object.defineProperty(t,"createObjectURL",{value:f.createObjectURL.bind(f),enumerable:!1}),Object.defineProperty(t,"revokeObjectURL",
{value:f.revokeObjectURL.bind(f),enumerable:!1});self.URL=t})();y("orion/URL-shim",function(){});y("embeddedEditor/helper/embeddedFileImpl",["orion/Deferred","orion/encoding-shim","orion/URL-shim"],function(l){function r(l){this.fileBase=l;this.fileRoot={}}r.prototype={fetchChildren:function(){return(new l).resolve([])},loadWorkspaces:function(){return(new l).resolve([])},loadWorkspace:function(){return(new l).resolve([])},createProject:function(){throw Error("Not supported");},createFolder:function(){throw Error("Not supported");
},createFile:function(){throw Error("Not supported");},moveFile:function(){throw Error("Not supported");},copyFile:function(){throw Error("Not supported");},remoteImport:function(){throw Error("Not supported");},remoteExport:function(){throw Error("Not supported");},writeBlob:function(){throw Error("Not supported");},read:function(p,h){if(h){var e=p.split("/"),e={Directory:!1,Length:123,LocaltimeStamp:123,Location:p,Name:e[e.length-1],Parents:[]};return(new l).resolve(e)}return(new l).resolve(this.fileRoot[p])},
write:function(p,h,e){"string"===typeof h&&(this.fileRoot[p]=h);return(new l).resolve(h)},deleteFile:function(p){this.fileRoot[p]=void 0;return(new l).resolve([])}};return r.prototype.constructor=r});y("orion/EventTarget",[],function(){function l(){this._namedListeners={}}l.prototype={dispatchEvent:function(l){if(!l.type)throw Error("unspecified type");var p=this._namedListeners[l.type];p&&p.forEach(function(h){try{"function"===typeof h?h(l):h.handleEvent(l)}catch(e){"undefined"!==typeof console&&
console.log(e)}});return!l.defaultPrevented},addEventListener:function(l,p){if("function"===typeof p||p.handleEvent)this._namedListeners[l]=this._namedListeners[l]||[],this._namedListeners[l].push(p)},removeEventListener:function(l,p){var h=this._namedListeners[l];if(h)for(var e=0;e<h.length;e++)if(h[e]===p){1===h.length?delete this._namedListeners[l]:h.splice(e,1);break}}};l.prototype.constructor=l;l.attach=function(r){var p=new l;r.dispatchEvent=p.dispatchEvent.bind(p);r.addEventListener=p.addEventListener.bind(p);
r.removeEventListener=p.removeEventListener.bind(p)};return l});y("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(l,r){function p(b,c,g){this._properties=g||{};this._properties["service.id"]=b;this._properties.objectClass=c;this._properties["service.names"]=c}function h(b,c,g){this._serviceId=b;this._serviceReference=c;this._internalRegistry=g}function e(b,c){function g(a){return function(){var f;try{if(!c())throw Error("Service was unregistered");var g=b[a].apply(b,Array.prototype.slice.call(arguments));
if(g&&"function"===typeof g.then)return g;f=new l;f.resolve(g)}catch(d){f=new l,f.reject(d)}return f.promise}}for(var a in b)"function"===typeof b[a]&&(this[a]=g(a))}function c(b,c){this.type=b;this.serviceReference=c}function b(){this._entries=[];this._namedReferences={};this._serviceEventTarget=new r;var b=this;this._internalRegistry={isRegistered:function(c){return b._entries[c]?!0:!1},unregisterService:function(m){var g=b._entries[m];if(!g)throw Error("Service has already been unregistered: "+
m);var a=g.reference;b._serviceEventTarget.dispatchEvent(new c("unregistering",a));b._entries[m]=null;a.getProperty("objectClass").forEach(function(g){for(var f=b._namedReferences[g],n=0;n<f.length;n++)if(f[n]===a){1===f.length?delete b._namedReferences[g]:f.splice(n,1);break}})},modifyService:function(m){var g=b._entries[m];if(!g)throw Error("Service not found while trying to send modified event: "+m);b._serviceEventTarget.dispatchEvent(new c("modified",g.reference))}}}p.prototype={getPropertyKeys:function(){var b=
[],c;for(c in this._properties)this._properties.hasOwnProperty(c)&&b.push(c);return b},getProperty:function(b){return this._properties[b]}};p.prototype.constructor=p;h.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw Error("Service has already been unregistered: "+this._serviceId);return this._serviceReference},setProperties:function(b){var c=this._serviceReference._properties;
this._serviceReference._properties=b||{};b["service.id"]=this._serviceId;b.objectClass=c.objectClass;b["service.names"]=c["service.names"];this._internalRegistry.modifyService(this._serviceId)}};h.prototype.constructor=h;b.prototype={getService:function(b){var c;if("string"===typeof b)(b=this._namedReferences[b])&&b.some(function(b){c=this._entries[b.getProperty("service.id")].service;return!!c},this);else if(b=this._entries[b.getProperty("service.id")])c=b.service;return c||null},getServiceReferences:function(b){if(b)return this._namedReferences[b]?
this._namedReferences[b]:[];var c=[];this._entries.forEach(function(b){b&&c.push(b.reference)});return c},registerService:function(b,m,g){if("undefined"===typeof m||null===m)throw Error("invalid service");"string"===typeof b?b=[b]:Array.isArray(b)||(b=[]);var a=this._entries.length,t=new p(a,b,g),f=this._namedReferences;b.forEach(function(a){f[a]=f[a]||[];f[a].push(t)});b=new e(m,this._internalRegistry.isRegistered.bind(null,a));this._entries.push({reference:t,service:b});b=this._internalRegistry;
this._serviceEventTarget.dispatchEvent(new c("registered",t));return new h(a,t,b)},addEventListener:function(b,c){this._serviceEventTarget.addEventListener(b,c)},removeEventListener:function(b,c){this._serviceEventTarget.removeEventListener(b,c)}};b.prototype.constructor=b;return{ServiceRegistry:b}});y("orion/util",[],function(){var l=navigator.userAgent,r=-1!==l.indexOf("MSIE")||-1!==l.indexOf("Trident")?document.documentMode:void 0,p=parseFloat(l.split("Firefox/")[1]||l.split("Minefield/")[1])||
void 0,h=-1!==l.indexOf("Opera")?parseFloat(l.split("Version/")[1]):void 0,e=parseFloat(l.split("Chrome/")[1])||void 0,c=-1!==l.indexOf("Safari")&&!e,b=parseFloat(l.split("WebKit/")[1])||void 0,k=-1!==l.indexOf("Android"),m=-1!==l.indexOf("iPad"),l=-1!==l.indexOf("iPhone"),g=m||l,a=-1!==navigator.platform.indexOf("Mac"),t=-1!==navigator.platform.indexOf("Win"),f=-1!==navigator.platform.indexOf("Linux"),n="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(d){var a=
arguments;return d.replace(/\$\{([^\}]+)\}/g,function(d,f){return a[(f<<0)+1]})},createElement:function(d,a){return d.createElementNS?d.createElementNS("http://www.w3.org/1999/xhtml",a):d.createElement(a)},isIE:r,isFirefox:p,isOpera:h,isChrome:e,isSafari:c,isWebkit:b,isAndroid:k,isIPad:m,isIPhone:l,isIOS:g,isMac:a,isWindows:t,isLinux:f,isTouch:n,platformDelimiter:t?"\r\n":"\n"}});y("orion/webui/littlelib",["orion/util"],function(l){function r(a,b){b||(b=document);return b.querySelectorAll(a)}function p(a){var b=
a.tabIndex;0===b&&l.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function h(a){if(0<=p(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var f=h(a.childNodes[b]);if(f)return f}return null}function e(a){if(0<=p(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var f=e(a.childNodes[b]);if(f)return f}return null}function c(a,
g){if(3===a.nodeType){var f=b.exec(a.nodeValue);f&&1<f.length&&g(a,f)}if(a.hasChildNodes())for(f=0;f<a.childNodes.length;f++)c(a.childNodes[f],g)}var b=/\$\{([^\}]+)\}/,k=null,m={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},g=Object.create(null);Object.keys(m).forEach(function(a){g[m[a]]=a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:r,$$array:function(a,b){return Array.prototype.slice.call(r(a,
b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var f=a.compareDocumentPosition(b);return Boolean(f&16)},bounds:function(a){a=a.getBoundingClientRect();var b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),f=Math.max(document.documentElement.scrollTop,document.body.scrollTop);return{left:a.left+b,top:a.top+f,width:a.width,height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},
firstTabbable:h,lastTabbable:e,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){c(a,function(a,g){a.parentNode.replaceChild(document.createTextNode(b[g[1]]||g[1]),a)})},processDOMNodes:function(a,b){c(a,function(a,g){var d=b[g[1]];if(d){var u=document.createRange(),s=g.index;u.setStart(a,s);u.setEnd(a,s+g[0].length);u.deleteContents();u.insertNode(d)}})},addAutoDismiss:function(a,b){function f(a){k.forEach(function(d){var f=
!1,b=d.excludeNodes.some(function(d){return document.body.contains(d)?(f=!0,d.contains(a.target)):!1});if(f&&!b)try{d.dismiss(a)}catch(g){"undefined"!==typeof console&&console&&console.error(g&&g.message)}});k=k.filter(function(d){return d.excludeNodes.some(function(d){return document.body.contains(d)})})}null===k&&(k=[],document.addEventListener("click",f,!0),l.isIOS&&document.addEventListener("touchend",function(a){function d(){a.target.removeEventListener("click",d)}0===a.touches.length&&a.target.addEventListener("click",
d)},!1));k.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),f=0;f<b.length;f++)b[f].parentNode.style.pointerEvents=a?"":"none"},getOffsetParent:function(a){a=a.parentNode;for(var b=document.documentElement;a&&a!==b;){var f=window.getComputedStyle(a,null);if(!f)break;f=f.getPropertyValue("overflow-y");if("auto"===f||"scroll"===f)break;a=a.parentNode}return a},removeAutoDismiss:function(a){k=k.filter(function(b){return a!==b.dismiss})},
keyName:function(a){return g[a]||null},KEY:m,createNodes:function(a,b){var f=b,g=null;void 0===f&&(f=document.createElement("div"));f.innerHTML=a;return g=1<f.children.length?f.children:f.firstChild}}});y("orion/splash",["orion/webui/littlelib"],function(l){return{progress:function(r){var p=l.node("splashProgress");p&&(p.innerHTML=r)},takeDown:function(){var r=l.node("splash");r&&r.classList.remove("splashShown")}}});y("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/splash","orion/URL-shim"],
function(l,r,p){function h(d,a){var f=Object.keys(d),b=Object.keys(a);if(f.length!==b.length)return!1;f.sort();b.sort();for(var g=0,n=f.length;g<n;g++){var c=f[g];if(c!==b[g])return!1;var t=d[c],c=a[c];if(t!==c&&JSON.stringify(t)!==JSON.stringify(c))return!1}return!0}function e(d){if(-1===d.indexOf("://"))try{return(new URL(d,location.href)).href}catch(a){}return d}function c(d){var a=null,f={key:function(f){return(a=a||Object.keys(d))[f]},getItem:function(a){return d[a]},setItem:function(f,b){d[f]=
b;a=null},removeItem:function(f){delete d[f];a=null},clear:function(){(a=a||Object.keys(d)).forEach(function(a){delete d[a]}.bind(this));a=null}};Object.defineProperty(f,"length",{get:function(){return(a=a||Object.keys(d)).length}});return f}function b(d,a){if(a&&a instanceof XMLHttpRequest){var f,b;try{f=a.status,b=a.statusText}catch(g){f=0,b=""}return{status:f||0,statusText:b}}return a}function k(d){var a=d?JSON.parse(JSON.stringify(d,b)):d;d instanceof Error&&(a.__isError=!0,a.message=a.message||
d.message,a.name=a.name||d.name);return a}function m(d,a){this.type=d;this.plugin=a}function g(d,a){this.__objectId=d;this.__methods=a}function a(d,a,f){function b(q){P&&f.postMessage(q,P)}function n(q){if(!P)return(new l).reject(Error("plugin not connected"));q.id=String(W++);var d=new l;X[q.id]=d;d.then(null,function(d){"active"===G&&(d instanceof Error&&"Cancel"===d.name)&&b({requestId:q.id,method:"cancel",params:d.message?[d.message]:[]})});var a=Object.prototype.toString;q.params.forEach(function(f,
b){if("[object Object]"===a.call(f)&&!(f instanceof g)){var x,u;for(x in f)"[object Function]"===a.call(f[x])&&(u=u||[],u.push(x));if(u){var w=aa++;Y[w]=f;x=function(){delete Y[w]};d.then(x,x);q.params[b]=new g(w,u)}}});f.postMessage(q,P);return d.promise}function c(q,d){q||0===q?b({id:q,result:null,error:d}):console.log(d)}function t(q,d,a,f){f.forEach(function(q,d){if(q&&"undefined"!==typeof q.__objectId){var a={};q.__methods.forEach(function(d){a[d]=function(){return n({objectId:q.__objectId,method:d,
params:Array.prototype.slice.call(arguments)})}});f[d]=a}});var x="undefined"===typeof q?null:{id:q,result:null,error:null};try{var u=a.apply(d,f);x&&(u&&"function"===typeof u.then?(y[q]=u,u.then(function(d){delete y[q];x.result=d;b(x)},function(d){y[q]&&(delete y[q],x.error=k(d),b(x))},function(){b({responseId:q,method:"progress",params:Array.prototype.slice.call(arguments)})})):(x.result=u,b(x)))}catch(g){x&&(x.error=k(g),b(x))}}function e(q){try{if(q.method){var d=q.method,a=q.params||[];if("serviceId"in
q){var b=ba[q.serviceId];b||c(q.id,"service not found");d in b?t(q.id,b,b[d],a):c(q.id,"method not found")}else if("objectId"in q){var x=Y[q.objectId];x||c(q.id,"object not found");d in x?t(q.id,x,x[d],a):c(q.id,"method not found")}else if("requestId"in q){var u=y[q.requestId];u&&("cancel"===d&&u.cancel)&&u.cancel.apply(u,a)}else if("responseId"in q){var g=X[q.responseId];g&&("progress"===d&&g.progress)&&g.progress.apply(g,a)}else if("loading"===q.method)P.loading();else if("plugin"===q.method){P.connected();
var n=q.params[0];Z({headers:n.headers,services:n.services}).then(function(){Q&&Q.resolve(w)})}else if("timeout"===q.method)Q&&Q.reject(q.error);else throw Error("Bad method: "+q.method);}else{var v=X[String(q.id)];delete X[String(q.id)];if(q.error){var m=f.handleServiceError(w,q.error);v.reject(m)}else v.resolve(q.result)}}catch(E){console.log("Plugin._messageHandler "+E)}}function p(q){var d={};if(q.methods&&(q.methods.forEach(function(a){d[a]=function(){var d={serviceId:q.serviceId,method:a,params:Array.prototype.slice.call(arguments)};
return"active"===G?n(d):w.start({"transient":!0}).then(function(){return n(d)})}}),d.addEventListener&&d.removeEventListener)){var a=new r,f=aa++;Y[f]={handleEvent:a.dispatchEvent.bind(a)};var b=new g(f,["handleEvent"]),x=d.addEventListener;d.addEventListener=function(q,d){a._namedListeners[q]||x(q,b);a.addEventListener(q,d)};var u=d.removeEventListener;d.removeEventListener=function(q,d){a.removeEventListener(q,d);a._namedListeners[q]||u(q,b)}}return d}function C(q){var a=JSON.parse(JSON.stringify(q.properties));
a.__plugin__=d;q=q.names||q.type||[];Array.isArray(q)||(q=[q]);a.objectClass=q;return a}function q(q){var d=p(q),a=C(q),a=f.registerService(q.names||q.type,d,a);L[q.serviceId]={registration:a,proxy:d}}function x(){f.persist(d,{created:E,headers:K,services:O,autostart:H,lastModified:I})}var w=this;a=a||{};var E=a.created||(new Date).getTime(),K=a.headers||{},O=a.services||[],H=a.autostart,I=a.lastModified||0,G="installed",M,Q,P,T,L={},W=0,aa=0,y={},X={},Y={},ba={},Z;this._default=!1;this._persist=
x;this._resolve=function(){G="resolved";f.dispatchEvent(new m("resolved",w))};this._getAutostart=function(){return H};this._getCreated=function(){return E};this.getLocation=function(){return d};this.getHeaders=function(){return JSON.parse(JSON.stringify(K))};this.getName=function(){var q=this.getHeaders();return q?q.name||"":null};this.getVersion=function(){var q=this.getHeaders();return q?q.version||"0.0.0":null};this.getLastModified=function(){return I};this.getServiceReferences=function(){var q=
[];Object.keys(L).forEach(function(d){q.push(L[d].registration.getReference())});return q};this.setParent=function(q){return T!==q?(T=q,w.stop({"transient":!0}).then(function(){if("started"===H)return w.start({"transient":!0});if("lazy"===H)return w.start({lazy:!0,"transient":!0})})):(new l).resolve()};this.getState=function(){return G};this.getProblemLoading=function(){return w._problemLoading?!0:!1};this.start=function(a){if("uninstalled"===G)return(new l).reject(Error("Plugin is uninstalled"));
if(M)return M.promise.then(this.start.bind(this,a));if("active"===G)return(new l).resolve();if(!a||!a.transient){var b=a&&a.lazy?"lazy":"started";b!==H&&(H=b,x())}b=f.getState();if("starting"!==b&&"active"!==b)return a.transient?(new l).reject(Error("start transient error")):(new l).resolve();if("installed"===G)try{this._resolve()}catch(u){return(new l).reject(u)}"resolved"===G&&O.forEach(function(d){q(d)});if(a&&a.lazy)return"starting"!==G&&(G="starting",f.dispatchEvent(new m("lazy activation",w))),
(new l).resolve();var g=new l;M=g;G="starting";w._problemLoading=null;f.dispatchEvent(new m("starting",w));Q=new l;P=f.connect(d,e,T);Q.then(function(){Q=null;G="active";f.dispatchEvent(new m("started",w));M=null;g.resolve()},function(){Q=null;G="stopping";f.dispatchEvent(new m("stopping",w));Object.keys(L).forEach(function(q){L[q].registration.unregister();delete L[q]});f.disconnect(P);P=null;G="resolved";M=null;f.dispatchEvent(new m("stopped",w));w._problemLoading=!0;g.reject(Error("Failed to load plugin: "+
d));w._default&&(I=0,x())});return g.promise};this.stop=function(q){if("uninstalled"===G)return(new l).reject(Error("Plugin is uninstalled"));if(M)return M.promise.then(this.stop.bind(this,q));if((!q||!q.transient)&&"stopped"!==H)H="stopped",x();if("active"!==G&&"starting"!==G)return(new l).resolve();M=q=new l;G="stopping";f.dispatchEvent(new m("stopping",w));Object.keys(L).forEach(function(q){L[q].registration.unregister();delete L[q]});P&&(f.disconnect(P),P=null);G="resolved";M=null;f.dispatchEvent(new m("stopped",
w));q.resolve();return q.promise};Z=function(a){w.problemLoading=null;if("uninstalled"===G)return(new l).reject(Error("Plugin is uninstalled"));if(!a)return 0===I&&(I=(new Date).getTime(),x()),f.loadManifest(d).then(Z,function(){w._problemLoading=!0;w._default&&(I=0,x());console.log("Failed to load plugin: "+d)});var b=K,u=O,g=H;K=a.headers||{};O=a.services||[];H=a.autostart||H;a.lastModified?I=a.lastModified:(I=(new Date).getTime(),x());if(h(K,b)&&h(O,u)&&H===g)return(new l).resolve();if("active"===
G||"starting"===G){var n=[];Object.keys(O).forEach(function(d){var a=O[d];n.push(d);var f=L[d];if(f){if(h(a.methods,Object.keys(f.proxy))){d=C(a);var b=f.registration.getReference(),x={};b.getPropertyKeys().forEach(function(q){x[q]=b.getProperty(q)});h(d,x)||f.registration.setProperties(d);return}f.registration.unregister();delete L[d]}q(a)});Object.keys(L).forEach(function(q){-1===n.indexOf(q)&&(L[q].registration.unregister(),delete L[q])})}"active"===G&&(f.disconnect(P),Q=new l,P=f.connect(d,e,
T),Q.then(function(){Q=null},function(){Q=null;G="stopping";f.dispatchEvent(new m("stopping"),w);Object.keys(L).forEach(function(q){L[q].registration.unregister();delete L[q]});f.disconnect(P);P=null;G="resolved";f.dispatchEvent(new m("stopped",w))}));return(new l).resolve()};this.update=function(q){return Z(q).then(function(){f.dispatchEvent(new m("updated",w))})};this.uninstall=function(){if("uninstalled"===G)return(new l).reject(Error("Plugin is uninstalled"));if("active"===G||"starting"===G||
"stopping"===G)return this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this));f.removePlugin(this);G="uninstalled";f.dispatchEvent(new m("uninstalled",w));return(new l).resolve()}}var t=/^http[s]?/i,f=/Worker\.js$/,n=/SharedWorker\.js$/;return{Plugin:a,PluginRegistry:function(d,b){function g(q,d){try{var a;if("undefined"===typeof q.useStructuredClone){var f="string"!==typeof d.data;a=f?d.data:JSON.parse(d.data);q.useStructuredClone=f}else a=q.useStructuredClone?d.data:JSON.parse(d.data);
q.handler(a)}catch(b){}}function v(q){var d=q.source;C.some(function(a){if(d===a.target)return g(a,q),!0})}b=b||{};var k=b.storage||localStorage;k.getItem||(k=c(k));var h=parseInt(k.getItem("pluginregistry.default.timeout"),10)||void 0,z="installed",D,B=[],C=[],q=new r,x={},w={registerService:d.registerService.bind(d),connect:function(q,d,a,b){function x(d){localStorage.pluginLogging&&console.log(d+"("+((new Date).getTime()-w._startTime)+"ms)\x3d"+q)}function u(q){x("timeout");q=Error(q);q.name="timeout";
d({method:"timeout",error:q})}var w={handler:d,url:q};b=b||h;w._updateTimeout=function(){var d,a;if(!this._connected&&!this._closed)if(this._handshake){var f=0;C.forEach(function(q){!q._connected&&!q._closed&&(f+=1E3)});d="Plugin handshake timeout for: "+q;a=(this._loading?6E4:b||5E3)+f}else d="Plugin load timeout for: "+q,a=b||15E3;this._loadTimeout&&clearTimeout(this._loadTimeout);this._loadTimeout=0;a&&(this._loadTimeout=setTimeout(u.bind(null,d),a))};var c=!!(q.match(f)&&"undefined"!==typeof Worker),
t=!!(q.match(n)&&"undefined"!==typeof SharedWorker);if((!localStorage.useSharedWorkers||!t)&&q.match(n))q=q.replace(n,"Worker.js"),t=!1;if((!localStorage.useWorkers||!c)&&q.match(f))q=q.replace(f,"Plugin.html"),c=t=!1;w.url=q;w._updateTimeout();w._startTime=(new Date).getTime();if(c){var v;t?(v=new SharedWorker(q),w.target=v.port,v.port.start(),w._close=function(){v.port.close()}):(v=new Worker(q),w.target=v,w._close=function(){v.terminate()});w.postMessage=function(q){this.target.postMessage(this.useStructuredClone?
q:JSON.stringify(q),[])};w.target.addEventListener("message",function(q){g(w,q)})}else{var m=document.createElement("iframe");m.name=q+"_"+w._startTime;m.src=q;m.onload=function(){p.progress("Loading "+q);x("handshake");w._handshake=!0;w._updateTimeout()};m.sandbox="allow-scripts allow-same-origin allow-forms allow-popups";m.style.width=m.style.height="100%";m.frameBorder=0;(a||D).appendChild(m);w.target=m.contentWindow;w.postMessage=function(q){this.target.postMessage(this.useStructuredClone?q:JSON.stringify(q),
this.url)};w._close=function(){if(m){var q=m.parentNode;q&&q.removeChild(m);m=null}}}w.connected=function(){x("connected");this._connected=!0;this._updateTimeout();p.progress("Loaded "+q)};w.loading=function(){x("loading");this._loading=!0;this._updateTimeout()};w.close=function(){x("closed");this._closed=!0;this._updateTimeout();this._close()};C.push(w);return w},disconnect:function(q){for(var d=0;d<C.length;d++)if(q===C[d]){C.splice(d,1);try{q.close()}catch(a){}break}},removePlugin:function(q){for(var d=
0;d<B.length;d++)if(q===B[d]){B.splice(d,1);break}k.removeItem("plugin."+q.getLocation())},persist:function(q,d){k.setItem("plugin."+q,JSON.stringify(d))},postMessage:function(q,d){d.postMessage(q)},dispatchEvent:function(d){try{q.dispatchEvent(d)}catch(a){console&&console.log("PluginRegistry.dispatchEvent "+a)}},loadManifest:function(q){var d=new l,a=w.connect(q,function(q){a&&q.method&&("manifest"===q.method||"plugin"===q.method?(q=q.params[0],w.disconnect(a),a=null,d.resolve(q)):"timeout"===q.method?
(w.disconnect(a),a=null,d.reject(q.error)):"loading"===q.method&&a.loading())});return d.promise},getState:function(){return z},handleServiceError:function(q,d){if(d&&401===d.status){var a=q.getHeaders(),f=q.getName()||q.getLocation(),b=document.createElement("span");b.appendChild(document.createTextNode("Authentication required for: "+f+"."));a.login&&(b.appendChild(document.createTextNode(" ")),f=document.createElement("a"),f.target="_blank",f.textContent="Login",f.href=a.login,t.test(f.href)?(b.appendChild(f),
b.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+a.login));return{Severity:"Error",HTML:!0,Message:(new XMLSerializer).serializeToString(b)}}if(d.__isError){var x=d;d=Error(x.message);Object.keys(x).forEach(function(q){d[q]=x[q]});delete d.__isError}return d}};this.getLocation=function(){return"System"};this.getHeaders=function(){return{}};this.getName=function(){return"System"};this.getVersion=function(){return"0.0.0"};this.getLastModified=function(){return 0};
this.getState=w.getState;this.init=function(){if(!("starting"===z||"active"===z||"stopping"===z)){addEventListener("message",v,!1);for(var q=[],d=0,f=k.length;d<f;d++)q.push(k.key(d));q.forEach(function(q){if(0===q.indexOf("plugin.")){var d=q.substring(7);q=JSON.parse(k.getItem(q));q.created&&B.push(new a(d,q,w))}});B.sort(function(q,d){return q._getCreated()<d._getCreated()?-1:1});b.parent?D=b.parent:(D=document.createElement("div"),b.visible||(D.style.display="none",D.style.visibility="hidden"),
document.body.appendChild(D));b.plugins&&Object.keys(b.plugins).forEach(function(q){q=e(q);var d=this.getPlugin(q);d?d._default=!0:(d=b.plugins[q],"object"!==typeof d&&(d={}),d.autostart=d.autostart||b.defaultAutostart||"lazy",d=new a(q,d,w),d._default=!0,B.push(d))}.bind(this));z="starting"}};this.start=function(){"starting"!==z&&this.init();if("starting"!==z)return(new l).reject("Cannot start framework. Framework is already "+z+".");var q=[],d=(new Date).getTime();B.forEach(function(a){var f=a._getAutostart();
0===a.getLastModified()?q.push(a.update().then(function(){if("started"===f)return a.start({"transient":!0});if("lazy"===f)return a.start({lazy:!0,"transient":!0});a._resolve()})):"started"===f?q.push(a.start({"transient":!0})):"lazy"===f?(q.push(a.start({lazy:!0,"transient":!0})),d>a.getLastModified()+864E5&&a.update()):a._resolve()});return l.all(q,function(q){console.log("PluginRegistry.stop "+q)}).then(function(){z="active"})};this.stop=function(){if("starting"!==z&&"active"!==z)return(new l).reject("Cannot stop registry. Registry is already "+
z+".");z="stopping";var q=[];B.forEach(function(d){q.push(d.stop({"transient":!0}))});return l.all(q,function(q){console.log("PluginRegistry.stop "+q)}).then(function(){if(!b.parent){var q=D.parentNode;q&&q.removeChild(D)}D=null;removeEventListener("message",v);z="resolved"})};this.update=function(){this.stop().then(this.start.bind(this))};this.uninstall=function(){return(new l).reject("Cannot uninstall registry")};this.installPlugin=function(q,d){q=e(q);var f=this.getPlugin(q);if(f)return(new l).resolve(f);
if(x[q])return x[q];if(d)return f=new a(q,d,w),B.push(f),f._persist(),w.dispatchEvent(new m("installed",f)),(new l).resolve(f);var b=w.loadManifest(q).then(function(d){f=new a(q,d,w);B.push(f);f._persist();delete x[q];w.dispatchEvent(new m("installed",f));return f},function(d){delete x[q];throw d;});return x[q]=b};this.getPlugins=function(){return B.slice()};this.getPlugin=function(q){var d=null;q=e(q);B.some(function(a){if(q===a.getLocation())return d=a,!0});return d};this.addEventListener=q.addEventListener.bind(q);
this.removeEventListener=q.removeEventListener.bind(q);this.resolvePlugins=function(){var q=!0;B.forEach(function(d){q=q&&d._resolve()});return q}}}});var V=null,N=document.getElementsByTagName("script");if(N&&N.length&&0<N.length){for(var $=0;2>$;$++){for(var U=0;U<N.length;U++)if(0===$){if("orion.codeEdit"===N[U].id){V=N[U].src;break}}else{var ca=/.*built-codeEdit.*.js/;if(N[U].src&&ca.exec(N[U].src)){V=N[U].src;break}}if(V)break}V||(V=N[N.length-1].src)}y("embeddedEditor/helper/bootstrap",["embeddedEditor/helper/embeddedFileImpl",
"orion/serviceregistry","orion/pluginregistry","orion/Deferred","orion/URL-shim"],function(l,r,p,h){var e,c=["../javascript/plugins/javascriptPlugin.html","../webtools/plugins/webToolsPlugin.html","../plugins/embeddedToolingPlugin.html"];return{startup:function(){if(e)return e;var b=document.createElement("div");b.id="_orion_hidden_actions";document.body.appendChild(b);b.style.display="none";e=new h;var k=new r.ServiceRegistry,b=new l("/__embed/");k.registerService("orion.core.file",b,{Name:"Embedded File System",
top:"/__embed/",pattern:"/__embed/"});var m={};c.forEach(function(a){a=new URL(a,V);m[a.href]={autostart:"lazy"}});var g=new p.PluginRegistry(k,{storage:{},plugins:m});return g.start().then(function(){var a={serviceRegistry:k,pluginRegistry:g};e.resolve(a);return a})}}});y("orion/editor/eventTarget",[],function(){function l(){}l.addMixin=function(r){var p=l.prototype,h;for(h in p)p.hasOwnProperty(h)&&(r[h]=p[h])};l.prototype={addEventListener:function(l,p,h){this._eventTypes||(this._eventTypes={});
var e=this._eventTypes[l];e||(e=this._eventTypes[l]={level:0,listeners:[]});e.listeners.push({listener:p,useCapture:h})},dispatchEvent:function(l){var p=l.type;this._dispatchEvent("pre"+p,l);this._dispatchEvent(p,l);this._dispatchEvent("post"+p,l)},_dispatchEvent:function(l,p){var h=this._eventTypes?this._eventTypes[l]:null;if(h){var e=h.listeners;try{if(h.level++,e)for(var c=0,b=e.length;c<b;c++)if(e[c]){var k=e[c].listener;"function"===typeof k?k.call(this,p):k.handleEvent&&"function"===typeof k.handleEvent&&
k.handleEvent(p)}}finally{if(h.level--,h.compact&&0===h.level){for(c=e.length-1;0<=c;c--)e[c]||e.splice(c,1);0===e.length&&delete this._eventTypes[l];h.compact=!1}}}},isListening:function(l){return!this._eventTypes?!1:void 0!==this._eventTypes[l]},removeEventListener:function(l,p,h){if(this._eventTypes){var e=this._eventTypes[l];if(e){for(var c=e.listeners,b=0,k=c.length;b<k;b++){var m=c[b];if(m&&m.listener===p&&m.useCapture===h){0!==e.level?(c[b]=null,e.compact=!0):c.splice(b,1);break}}0===c.length&&
delete this._eventTypes[l]}}}};return{EventTarget:l}});y("orion/regex",[],function(){return{escape:function(l){return l.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(l){return(l=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(l))?{pattern:l[1],flags:l[2]}:null}}});y("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(l,r,p){function h(e,c){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(e);this.setLineDelimiter(c)}h.prototype=
{destroy:function(){},find:function(e){1<this._text.length&&(this._text=[this._text.join("")]);var c=e.string,b=e.regex,k=c,m="",g=e.caseInsensitive;if(k)if(b){if(c=r.parse(k))k=c.pattern,m=c.flags}else k=c.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),g&&(k=k.replace(/[iI\u0130\u0131]/g,"[Ii\u0130\u0131]"));var a=null,t;if(k){var c=e.reverse,f=e.wrap,b=e.wholeWord,n=e.start||0;e=e.end;var d=null!==e&&void 0!==e;-1===m.indexOf("g")&&(m+="g");-1===m.indexOf("m")&&(m+="m");g&&-1===m.indexOf("i")&&
(m+="i");b&&(k="\\b"+k+"\\b");var u=this._text[0],s,v,A=0;d&&(g=n<e?n:e,u=u.substring(g,n<e?e:n),A=g);var h=RegExp(k,m);c?t=function(){var d=null;for(h.lastIndex=0;;){v=h.lastIndex;s=h.exec(u);if(v===h.lastIndex)return null;if(s){if(!(s.index+A<n)){if(!f||d)break;n=u.length+A}d={start:s.index+A,end:h.lastIndex+A}}else break}d&&(n=d.start);return d}:(d||(h.lastIndex=n),t=function(){for(;;){v=h.lastIndex;s=h.exec(u);if(v===h.lastIndex)break;if(s)return{start:s.index+A,end:h.lastIndex+A};if(!(0!==v&&
f))break}return null});a=t()}return{next:function(){var d=a;d&&(a=t());return d},hasNext:function(){return null!==a}}},getCharCount:function(){for(var e=0,c=0;c<this._text.length;c++)e+=this._text[c].length;return e},getLine:function(e,c){var b=this.getLineCount();if(!(0<=e&&e<b))return null;var k=this._lineOffsets[e];if(e+1<b){b=this.getText(k,this._lineOffsets[e+1]);if(c)return b;for(var k=b.length,m;10===(m=b.charCodeAt(k-1))||13===m;)k--;return b.substring(0,k)}return this.getText(k)},getLineAtOffset:function(e){var c=
this.getCharCount();if(!(0<=e&&e<=c))return-1;var b=this.getLineCount();if(e===c)return b-1;var k,m,g=this._lastLineIndex;if(0<=g&&g<b&&(k=this._lineOffsets[g],m=g+1<b?this._lineOffsets[g+1]:c,k<=e&&e<m))return g;for(var a=b,t=-1;1<a-t;)if(g=Math.floor((a+t)/2),k=this._lineOffsets[g],m=g+1<b?this._lineOffsets[g+1]:c,e<=k)a=g;else if(e<m){a=g;break}else t=g;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},
getLineEnd:function(e,c){var b=this.getLineCount();if(!(0<=e&&e<b))return-1;if(e+1<b){b=this._lineOffsets[e+1];if(c)return b;for(var k=this.getText(Math.max(this._lineOffsets[e],b-2),b),m=k.length,g;10===(g=k.charCodeAt(m-1))||13===g;)m--;return b-(k.length-m)}return this.getCharCount()},getLineStart:function(e){return!(0<=e&&e<this.getLineCount())?-1:this._lineOffsets[e]},getText:function(e,c){void 0===e&&(e=0);void 0===c&&(c=this.getCharCount());if(e===c)return"";for(var b=0,k=0,m;k<this._text.length;){m=
this._text[k].length;if(e<=b+m)break;b+=m;k++}for(var g=b,a=k;k<this._text.length;){m=this._text[k].length;if(c<=b+m)break;b+=m;k++}if(a===k)return this._text[a].substring(e-g,c-b);g=this._text[a].substring(e-g);b=this._text[k].substring(0,c-b);return g+this._text.slice(a+1,k).join("")+b},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,c){"auto"===e&&(e=void 0,1<this.getLineCount()&&(e=this.getText(this.getLineEnd(0),
this.getLineEnd(0,!0))));this._lineDelimiter=e?e:p.platformDelimiter;if(c){var b=this.getLineCount();if(1<b){for(var k=Array(b),m=0;m<b;m++)k[m]=this.getLine(m);this.setText(k.join(this._lineDelimiter))}}},setText:function(e,c,b){void 0===e&&(e="");void 0===c&&(c=0);void 0===b&&(b=this.getCharCount());if(!(c===b&&""===e)){for(var k=this.getLineAtOffset(c),m=this.getLineAtOffset(b),g=c,a=b-c,t=m-k,f=e.length,n=0,d=this.getLineCount(),u=0,s=0,v=0,A=[];;){-1!==u&&u<=v&&(u=e.indexOf("\r",v));-1!==s&&
s<=v&&(s=e.indexOf("\n",v));if(-1===s&&-1===u)break;v=-1!==u&&-1!==s?u+1===s?s+1:(u<s?u:s)+1:-1!==u?u+1:s+1;A.push(c+v);n++}this.onChanging({type:"Changing",text:e,start:g,removedCharCount:a,addedCharCount:f,removedLineCount:t,addedLineCount:n});0===A.length&&(v=this.getLineStart(k),m=m+1<d?this.getLineStart(m+1):this.getCharCount(),c!==v&&(e=this.getText(v,c)+e,c=v),b!==m&&(e+=this.getText(b,m),b=m));v=f-a;for(m=k+t+1;m<d;m++)this._lineOffsets[m]+=v;if(5E4>A.length)k=[k+1,t].concat(A),Array.prototype.splice.apply(this._lineOffsets,
k);else{v=k+1;this._lineOffsets.splice(v,t);for(d=0;d<A.length;d+=5E4)k=[v,0].concat(A.slice(d,Math.min(A.length,d+5E4))),Array.prototype.splice.apply(this._lineOffsets,k),v+=5E4}for(v=d=0;v<this._text.length;){m=this._text[v].length;if(c<=d+m)break;d+=m;v++}k=d;for(A=v;v<this._text.length;){m=this._text[v].length;if(b<=d+m)break;d+=m;v++}m=this._text[v];c=this._text[A].substring(0,c-k);b=m.substring(b-d);A=[A,v-A+1];c&&A.push(c);e&&A.push(e);b&&A.push(b);Array.prototype.splice.apply(this._text,A);
0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:g,removedCharCount:a,addedCharCount:f,removedLineCount:t,addedLineCount:n})}}};l.EventTarget.addMixin(h.prototype);return{TextModel:h}});y("orion/editor/undoStack",[],function(){function l(h,e,c,b,k){this.model=h;this.offset=e;this.text=c;this.previousText=b;this.type=k}function r(h){this.owner=h;this.changes=[]}function p(h,e){this.size=void 0!==e?e:100;this.reset();var c=this;this._listener={onChanging:function(b){c._onChanging(b)},
onDestroy:function(b){c._onDestroy(b)}};if(h.getModel){var b=h.getModel();b.getBaseModel&&(b=b.getBaseModel());this.model=b;this.setView(h)}else this.shared=!0,this.model=h;this.model.addEventListener("Changing",this._listener.onChanging)}l.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(h,e){this._doUndoRedo(this.offset,
this.previousText,this.text,h,e);return!0},redo:function(h,e){this._doUndoRedo(this.offset,this.text,this.previousText,h,e);return!0},merge:function(h,e,c,b,k){if(b===this.type){if(1===b&&h===this.offset+this.text.length)return this.text+=e,!0;if(-1===b&&k===this.offset)return this.offset=h,this.previousText=c+this.previousText,!0;if(-1===b&&h===this.offset)return this.previousText+=c,!0}return!1},_doUndoRedo:function(h,e,c,b,k){this.model.setText(e,h,h+c.length);k&&b&&(c=b.getModel(),c!==this.model&&
(h=c.mapOffset(h,!0)),b.setSelection(h,h+e.length))}};r.prototype={getRedoChanges:function(){for(var h=[],e=0;e<this.changes.length;e++)h=h.concat(this.changes[e].getRedoChanges());return h},getUndoChanges:function(){for(var h=[],e=this.changes.length-1;0<=e;e--)h=h.concat(this.changes[e].getUndoChanges());return h},add:function(h){this.changes.push(h)},end:function(h){h&&(this.endSelection=h.getSelections());(h=this.owner)&&h.end&&h.end()},undo:function(h,e){1<this.changes.length&&h&&h.setRedraw(!1);
for(var c=this.changes.length-1;0<=c;c--)this.changes[c].undo(h,!1);e&&h&&h.setSelections(this.startSelection);1<this.changes.length&&h&&h.setRedraw(!0);(c=this.owner)&&c.undo&&c.undo();return 0<this.changes.length},redo:function(h,e){1<this.changes.length&&h&&h.setRedraw(!1);for(var c=0;c<this.changes.length;c++)this.changes[c].redo(h,!1);e&&h&&h.setSelections(this.endSelection);(1<this.changes.length,h)&&h.setRedraw(!0);(c=this.owner)&&c.redo&&c.redo();return 0<this.changes.length},merge:function(h,
e,c,b,k,m){var g=this.changes.length;return 0<g&&this===m?this.changes[g-1].merge(h,e,c,b,k):!1},start:function(h){h&&(this.startSelection=h.getSelections());(h=this.owner)&&h.start&&h.start()}};p.prototype={destroy:function(){this._onDestroy()},add:function(h){this.compoundChange?this.compoundChange.add(h):(this.stack.splice(this.index,this.stack.length-this.index,h),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=
this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var h=[],e=this.index;e<this.stack.length;e++)h=
h.concat(this.stack[e].getRedoChanges());return h},getUndoChanges:function(){this._commitUndo();for(var h=[],e=this.index;0<=e;e--)h=h.concat(this.stack[e].getUndoChanges());return h},undo:function(){this._commitUndo();var h;h=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;h=this.stack[--this.index]}while(!(h=h.undo(this.view,!0)));this._ignoreUndo=!1;return h},redo:function(){this._commitUndo();var h;h=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;h=this.stack[this.index++]}while(!(h=
h.redo(this.view,!0)));this._ignoreUndo=!1;return h},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(h){this.view!==h&&(this.view&&h.removeEventListener("Destroy",this._listener.onDestroy),(this.view=h)&&h.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(h){this._commitUndo();h=new r(h);this.add(h);this.compoundChange=h;this.compoundChange.start(this.view);return this.compoundChange},
_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(h){(!h||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_trackUnsavedChanges:function(h){if(this._unsavedChanges){var e=this._unsavedChanges.length,c=h.removedCharCount,b=h.start,k=h.start+c,m=0;0===h.addedCharCount?m=-1:0===c&&(m=1);if(0<e&&m===this._previousChangeType){e=this._unsavedChanges[e-1];if(0===
c&&b===e.end+e.text.length){e.text+=h.text;return}if(0===h.addedCharCount&&k===e.start){e.start=b;return}}this._previousChangeType=m;this._unsavedChanges.push({start:b,end:k,text:h.text})}},_onChanging:function(h){this._trackUnsavedChanges(h);if(!this._ignoreUndo){var e=h.text,c=h.start,b=h.addedCharCount,k=h.removedCharCount;h=c+k;var m=0;0===b&&1===k?m=-1:1===b&&0===k&&(m=1);b=this.stack.length;k=this.model.getText(c,h);(!(0<b&&this.index===b)||!this.stack[b-1].merge(c,e,k,m,h,this.compoundChange))&&
this.add(new l(this.model,c,e,k,m))}}};return{UndoStack:p}});y("orion/commandsProxy",["orion/util","orion/webui/littlelib"],function(l,r){function p(e,c){e=e||window.event;if(function(b){if(l.isMac){if(b.metaKey&&!b.altKey)return!b.shiftKey&&!b.ctrlKey&&(65===b.keyCode||67===b.keyCode||86===b.keyCode||88===b.keyCode||90===b.keyCode)?!0:!1;if(b.ctrlKey)return!1}else{if(b.ctrlKey&&!b.altKey)return!b.shiftKey&&(65===b.keyCode||67===b.keyCode||86===b.keyCode||88===b.keyCode||90===b.keyCode)?!0:!1;if(b.altKey&&
!b.ctrlKey||b.ctrlKey&&b.altKey)return!1}if(b["char"])return 0<b["char"].length;if(b.charCode||b.keyCode)switch(b=b.charCode||b.keyCode,b){case 8:case 9:case 13:case 46:return!0;default:return 32<=b&&112>b||123<b}return!1}(e)){if("true"===e.target.contentEditable)return;var b=e.target.nodeName.toLowerCase();if("input"===b)switch(e.target.type.toLowerCase()){case "text":case "password":case "search":case "color":case "date":case "datetime":case "datetime-local":case "email":case "month":case "number":case "range":case "tel":case "time":case "url":case "week":return}else if("textarea"===
b)return}c(e)}function h(){this._init()}h.prototype={destroy:function(){this._listener&&(document.removeEventListener("keydown",this._listener),this._listener=null)},setProxy:function(e){this.proxy=e},setKeyBindings:function(e){this.bindings=e},_init:function(){var e=this;document.addEventListener("keydown",this._listener=function(c){return p(c,function(b){var c=e.proxy,m=e.bindings;if(m&&c)for(var g=0;g<m.length;g++)m[g].match(b)&&(c.processKey({type:b.type,keyCode:b.keyCode,altKey:b.altKey,ctrlKey:b.ctrlKey,
metaKey:b.metaKey,shiftKey:b.shiftKey}),r.stop(b))})})}};return{handleKeyEvent:p,CommandsProxy:h}});y("orion/webui/dropdown",["orion/webui/littlelib","orion/EventTarget"],function(l,r){function p(c){r.attach(this);this._init(c)}function h(c,b){var e=document.createElement(void 0===b?"span":b);e.tabIndex=0;e.className="dropdownMenuItem";e.role="menuitem";if(c){var m=document.createElement("span");m.appendChild(document.createTextNode(c));m.classList.add("dropdownCommandName");e.appendChild(m)}m=document.createElement("li");
m.appendChild(e);return m}function e(){var c=document.createElement("li");c.classList.add("dropdownSeparator");return c}p.prototype={_init:function(c){this._dropdownNode=l.node(c.dropdown);if(!this._dropdownNode)throw"no dom node for dropdown found";this._populate=c.populate;this._selectionClass=c.selectionClass;this._parentDropdown=c.parentDropdown;this._positioningNode=c.positioningNode;if(!this._parentDropdown)for(var b=this._dropdownNode.parentNode;b&&document!==b;){if(b.classList&&b.classList.contains("dropdownMenu")){this._parentDropdown=
b.dropdown;break}b=b.parentNode}this._dropdownNode.tabIndex=0;this._triggerNode=c.triggerNode?c.triggerNode:l.$(".dropdownTrigger",this._dropdownNode.parentNode);if(!this._triggerNode)throw"no dom node for dropdown trigger found";var e=function(b){var g=!1;(g=this._triggerNode.classList.contains("dropdownMenuItem")?this.open(b):this.toggle(b))&&l.stop(b)}.bind(this);c.skipTriggerEventListeners||(this._triggerNode.addEventListener("click",e,!1),"span"===this._triggerNode.tagName.toLowerCase()&&this._triggerNode.addEventListener("keydown",
function(b){(b.keyCode===l.KEY.ENTER||b.keyCode===l.KEY.SPACE)&&e(b)}.bind(this),!1));this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},addTriggerNode:function(c){var b=this;c.addEventListener("click",function(c){b.toggle(c)&&l.stop(c)},!1)},toggle:function(c){return this.isVisible()?this.close():this.open(c)},isVisible:function(){return this._isVisible},open:function(c){var b=!1;this.isVisible()||(this.dispatchEvent({type:"triggered",dropdown:this,event:c}),l.setFramesEnabled(!1),
this._populate&&(this.empty(),this._populate(this._dropdownNode)),0<this.getItems().length&&(this._boundAutoDismiss&&l.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=this._autoDismiss.bind(this),b=l.$$array(".dropdownSubMenu",this._dropdownNode),l.addAutoDismiss([this._triggerNode].concat(b),this._boundAutoDismiss),this._triggerNode.classList.add("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.add(this._selectionClass),this._dropdownNode.classList.add("dropdownMenuOpen"),
this._isVisible=!0,this._positionDropdown(c),this._focusDropdownNode(),b=!0,this._parentDropdown&&this._parentDropdown.submenuOpen(this)));return b},_focusDropdownNode:function(){this._dropdownNode.focus()},_autoDismiss:function(c){if(this.close(!1)&&this._dropdownNode.contains(c.target))for(c=this._parentDropdown;c;)c.close(!1),c=c._parentDropdown},_positionDropdown:function(c){this._dropdownNode.style.left="";this._dropdownNode.style.top="";if(this._positioningNode)this._dropdownNode.style.left=
this._positioningNode.offsetLeft+"px";else{c=l.bounds(this._dropdownNode);var b=l.bounds(document.body);if(c.left+c.width>b.left+b.width)if(this._triggerNode.classList.contains("dropdownMenuItem"))this._dropdownNode.style.left=-c.width+"px";else{var e=l.bounds(this._boundingNode(this._triggerNode)),m=l.bounds(this._triggerNode);this._dropdownNode.style.left=m.left-e.left-c.width+m.width+"px"}c=c.top+c.height-(b.top+b.height);0<c&&(this._dropdownNode.style.top=Math.floor(this._dropdownNode.style.top-
c)+"px")}},_boundingNode:function(c){var b=window.getComputedStyle(c,null);return null===b||"absolute"===b.getPropertyValue("position")||!c.parentNode||c===document.body?c:this._boundingNode(c.parentNode)},close:function(c){var b=!1;this.isVisible()&&(this._triggerNode.classList.remove("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.remove(this._selectionClass),this._dropdownNode.classList.remove("dropdownMenuOpen"),l.setFramesEnabled(!0),c&&this._triggerNode.focus(),this._isVisible=
!1,this._selectedItem&&(this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=null),this._boundAutoDismiss&&(l.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=null),b=!0);return b},getItems:function(){var c=[],b=this;l.$$array("li:not(.dropdownSeparator) \x3e .dropdownMenuItem",this._dropdownNode,!0).forEach(function(e){e.parentNode.parentNode===b._dropdownNode&&c.push(e)});c.forEach(function(c){c._hasDropdownMouseover||(c.addEventListener("mouseover",
function(e){c.dropdown?c.dropdown.open(e):(b._closeSelectedSubmenu(),l.stop(e));b._selectItem(c)}),c._hasDropdownMouseover=!0)});return c},empty:function(){var c=this;l.$$array("li",this._dropdownNode).forEach(function(b){b.parentNode===c._dropdownNode&&b.parentNode.removeChild(b)})},_dropdownKeyDown:function(c){if(c.keyCode===l.KEY.UP||c.keyCode===l.KEY.DOWN||c.keyCode===l.KEY.RIGHT||c.keyCode===l.KEY.ENTER||c.keyCode===l.KEY.LEFT){var b=this.getItems();if(b.length&&0<b.length){if(this._selectedItem){var e=
b.indexOf(this._selectedItem);0>e&&(e=b.indexOf(this._selectedItem.parentNode));0<=e&&(c.keyCode===l.KEY.UP&&0<e?(e--,this._selectItem(b[e])):c.keyCode===l.KEY.DOWN&&e<b.length-1?(e++,this._selectItem(b[e])):c.keyCode===l.KEY.ENTER||c.keyCode===l.KEY.RIGHT?this._selectedItem.classList.contains("dropdownTrigger")&&this._selectedItem.dropdown?(this._selectedItem.dropdown.open(),this._selectedItem.dropdown._selectItem()):c.keyCode===l.KEY.ENTER&&this._selectedItem.click():c.keyCode===l.KEY.LEFT&&this._selectedItem.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&
(this.close(!0),this._parentDropdown&&this._parentDropdown._dropdownNode.focus()))}else this._selectItem(b[0]);l.stop(c)}}else c.keyCode===l.KEY.ESCAPE&&(this.close(!0),l.stop(c))},_selectItem:function(c){if(c=c||this.getItems()[0])this._selectedItem&&this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=c,this._selectedItem.classList.add("dropdownMenuItemSelected");document.activeElement!==this._dropdownNode&&this._dropdownNode.focus()},submenuOpen:function(c){c!==this._selectedSubmenu&&
(this._closeSelectedSubmenu(),this._selectedSubmenu=c)},_closeSelectedSubmenu:function(){for(var c=this._selectedSubmenu;c;)c.close(),c=c._selectedSubmenu},destroy:function(){this.empty();this._boundAutoDismiss&&(l.removeAutoDismiss(this._boundAutoDismiss),this._boundAutoDismiss=null)},appendMenuItem:function(c,b){var e=h(c,b);this._dropdownNode.appendChild(e);return e},appendSeparator:function(){var c=e();this._dropdownNode.appendChild(c);return c}};p.prototype.constructor=p;return{Dropdown:p,appendKeyBindingString:function(c,
b){var e=document.createElement("span");e.classList.add("dropdownKeyBinding");e.appendChild(document.createTextNode(b));c.appendChild(e)},createMenuItem:h,createSeparator:e}});y("text",["module"],function(l){var r,p,h,e,c,b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],k=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,m=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,g="undefined"!==typeof location&&location.href,a=g&&location.protocol&&location.protocol.replace(/\:/,""),t=g&&location.hostname,
f=g&&(location.port||void 0),n={},d=l.config&&l.config()||{};r={version:"2.0.12",strip:function(d){if(d){d=d.replace(k,"");var a=d.match(m);a&&(d=a[1])}else d="";return d},jsEscape:function(d){return d.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var d,a,f;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;
if("undefined"!==typeof ActiveXObject)for(a=0;3>a;a+=1){f=b[a];try{d=new ActiveXObject(f)}catch(g){}if(d){b=[f];break}}return d},parseName:function(d){var a,b,f=!1,g=d.indexOf(".");a=0===d.indexOf("./")||0===d.indexOf("../");-1!==g&&(!a||1<g)?(a=d.substring(0,g),b=d.substring(g+1,d.length)):a=d;d=b||a;g=d.indexOf("!");-1!==g&&(f="strip"===d.substring(g+1),d=d.substring(0,g),b?b=d:a=d);return{moduleName:a,ext:b,strip:f}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(d,a,b,f){var g,n;g=r.xdRegExp.exec(d);
if(!g)return!0;d=g[2];g=g[3];g=g.split(":");n=g[1];g=g[0];return(!d||d===a)&&(!g||g.toLowerCase()===b.toLowerCase())&&(!n&&!g||n===f)},finishLoad:function(a,b,f,g){f=b?r.strip(f):f;d.isBuild&&(n[a]=f);g(f)},load:function(b,n,c,e){if(e&&e.isBuild&&!e.inlineText)c();else{d.isBuild=e&&e.isBuild;var m=r.parseName(b);e=m.moduleName+(m.ext?"."+m.ext:"");var k=n.toUrl(e),h=d.useXhr||r.useXhr;0===k.indexOf("empty:")?c():!g||h(k,a,t,f)?r.get(k,function(d){r.finishLoad(b,m.strip,d,c)},function(d){c.error&&
c.error(d)}):n([e],function(d){r.finishLoad(m.moduleName+"."+m.ext,m.strip,d,c)})}},write:function(d,a,b,f){n.hasOwnProperty(a)&&(f=r.jsEscape(n[a]),b.asModule(d+"!"+a,"define(function () { return '"+f+"';});\n"))},writeFile:function(d,a,b,f,g){a=r.parseName(a);var n=a.ext?"."+a.ext:"",c=a.moduleName+n,t=b.toUrl(a.moduleName+n)+".js";r.load(c,b,function(a){a=function(q){return f(t,q)};a.asModule=function(q,d){return f.asModule(q,t,d)};r.write(d,c,a,g)},g)}};if("node"===d.env||!d.env&&"undefined"!==
typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"])p=S.nodeRequire("fs"),r.get=function(d,a,b){try{var f=p.readFileSync(d,"utf8");0===f.indexOf("\ufeff")&&(f=f.substring(1));a(f)}catch(g){b&&b(g)}};else if("xhr"===d.env||!d.env&&r.createXhr())r.get=function(a,f,b,g){var n=r.createXhr(),c;n.open("GET",a,!0);if(g)for(c in g)g.hasOwnProperty(c)&&n.setRequestHeader(c.toLowerCase(),g[c]);if(d.onXhr)d.onXhr(n,a);n.onreadystatechange=function(g){if(4===n.readyState&&
(g=n.status||0,399<g&&600>g?(g=Error(a+" HTTP status: "+g),g.xhr=n,b&&b(g)):f(n.responseText),d.onXhrComplete))d.onXhrComplete(n,a)};n.send(null)};else if("rhino"===d.env||!d.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)r.get=function(d,a){var b,f,g=new java.io.File(d),n=java.lang.System.getProperty("line.separator"),g=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(g),"utf-8")),c="";try{b=new java.lang.StringBuffer;(f=g.readLine())&&(f.length()&&
65279===f.charAt(0))&&(f=f.substring(1));for(null!==f&&b.append(f);null!==(f=g.readLine());)b.append(n),b.append(f);c=String(b.toString())}finally{g.close()}a(c)};else if("xpconnect"===d.env||!d.env&&"undefined"!==typeof Components&&Components.classes&&Components.interfaces)h=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),c="@mozilla.org/windows-registry-key;1"in h,r.get=function(d,a){var f,b,g,n={};c&&(d=d.replace(/\//g,"\\"));g=new FileUtils.File(d);
try{f=h["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),f.init(g,1,0,!1),b=h["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),b.init(f,"utf-8",f.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),b.readString(f.available(),n),b.close(),f.close(),a(n.value)}catch(t){throw Error((g&&g.path||"")+": "+t);}};return r});y("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'\x3cbutton class\x3d"dropdownTrigger"\x3e${ButtonText}\x3c!--span class\x3d"dropdownArrowDown core-sprite-openarrow"\x3e\x3c/span--\x3e\x3c/button\x3e\x3cul class\x3d"dropdownMenu"\x3e\x3c/ul\x3e'});
y("text!orion/webui/dropdowntriggerbuttonwitharrow.html",[],function(){return'\x3cbutton class\x3d"dropdownTrigger dropdownDefaultButton"\x3e${ButtonText}\x3cspan class\x3d"dropdownArrowDown core-sprite-openarrow"\x3e\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdownMenu"\x3e\x3c/ul\x3e'});y("text!orion/webui/checkedmenuitem.html",[],function(){return'\x3cli\x3e\x3clabel class\x3d"dropdownMenuItem"\x3e\x3cinput class\x3d"checkedMenuItem" role\x3d"menuitem" type\x3d"checkbox" /\x3e${ItemText}\x3c/label\x3e\x3c/li\x3e'});
y("orion/webui/tooltip",["orion/webui/littlelib"],function(l){function r(l){this._init(l)}r.prototype={_init:function(p){this._node=l.node(p.node);if(!this._node)throw"no dom node for tooltip found";this._position=p.position||["right","above","below","left"];this._text=p.text;this._hideDelay=void 0===p.hideDelay?200:p.hideDelay;this._tailSize=p.tailSize||10;this._trigger=p.trigger||"mouseover";this._afterShowing=p.afterShowing;this._afterHiding=p.afterHiding;var h=this;if("click"===this._trigger)this._showDelay=
0,this._node.addEventListener("click",this._clickHandler=function(c){c.target===h._node&&(h.show(),l.stop(c))},!1);else if("mouseover"===this._trigger){this._showDelay=void 0===p.showDelay?500:p.showDelay;p=["mouseout","click"];this._node.addEventListener("mouseover",this._mouseoverHandler=function(c){l.contains(h._node,c.target)&&(h.show(),l.stop(c))},!1);this._leaveHandler=function(c){l.contains(h._node,c.target)&&h.hide()};for(var e=0;e<p.length;e++)this._node.addEventListener(p[e],this._leaveHandler,
!1)}else"focus"===this._trigger&&(this._showDelay=void 0===p.showDelay?0:p.showDelay,this._hideDelay=void 0===p.hideDelay?0:p.hideDelay,this._node.addEventListener("focus",this._focusHandler=function(c){l.contains(h._node,c.target)&&h.show()},!1),this._blurHandler=function(c){l.contains(h._node,c.target)&&h.hide()},this._node.addEventListener("blur",this._blurHandler,!1))},_makeTipNode:function(){if(!this._tip){this._tip=document.createElement("span");this._tip.classList.add("tooltipContainer");this._tipInner=
document.createElement("div");this._tipInner.classList.add("tooltip");if(this._text){this._tipTextContent=document.createElement("div");this._tipTextContent.classList.add("textContent");this._tipInner.appendChild(this._tipTextContent);var p=document.createTextNode(this._text);this._tipTextContent.appendChild(p)}this._tip.appendChild(this._tipInner);document.body.appendChild(this._tip);var h=this;l.addAutoDismiss([this._tip,this._node],function(){h.hide()});"mouseover"===this._trigger&&(this._tipInner.role=
"tooltip",this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(e){h._timeout&&(window.clearTimeout(h._timeout),h._timeout=null);h._tip.addEventListener("mouseout",function(c){l.contains(h._tip,c.target)&&(h.hide(),l.stop(c))},!1)},!1))}return this._tip},_positionTip:function(p,h){this._makeTipNode();this._tip.classList.add("tooltipShowing");"left"===p?this._tipInner.classList.add("left"):
this._tipInner.classList.remove("left");var e=this._node,c;for(c=l.bounds(e);e&&!c.width&&!c.height;e=e.parentNode)c=l.bounds(e);var e=l.bounds(this._tipInner),b;switch(p){case "above":b=c.top-e.height-this._tailSize-1;c=c.left-this._tailSize;break;case "below":b=c.top+c.height+this._tailSize+1;c=c.left-this._tailSize;break;case "left":b=c.top-this._tailSize/2;c=c.left-e.width-this._tailSize-1;break;default:b=c.top-this._tailSize/2,c=c.left+c.width+this._tailSize+1}var k=document.body,m=document.documentElement,
g=Math.max(m.scrollLeft,k.scrollLeft),k=Math.max(m.scrollTop,k.scrollTop),a=g+m.clientWidth,m=k+m.clientHeight;if(b+e.height>m)if(h)b=m-e.height-1;else return!1;if(c+e.width>a)if(h)c=a-e.width-1;else return!1;if(c<g)if(h)c=g+4;else return!1;if(b<k)if(h)b=k+4;else return!1;this._tail&&this._tail.previousPosition!==p&&(this._tip.removeChild(this._tail),this._tail=null);this._tail||(this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+p),"above"===p||"left"===p?this._tip.appendChild(this._tail):
this._tip.insertBefore(this._tail,this._tipInner),this._tail.previousPosition=p);this._tip.style.top=b+"px";this._tip.style.left=c+"px";return!0},contentContainer:function(){this._makeTipNode();return this._tipInner},isShowing:function(){return this._tip&&this._tip.classList.contains("tooltipShowing")},show:function(){this.isShowing()||(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._showDelay?this._timeout=window.setTimeout(this._showImmediately.bind(this),this._showDelay):
this._showImmediately())},_showImmediately:function(){for(var l=!1,h=0;!l&&h<this._position.length;)l=this._positionTip(this._position[h]),h++;l||this._positionTip(this._position[0],!0);this._afterShowing&&this._afterShowing()},hide:function(l){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);if(this.isShowing()){void 0===l&&(l=this._hideDelay);var h=this;this._timeout=window.setTimeout(function(){h._tip.classList.remove("tooltipShowing");h._tip.removeAttribute("style");h._afterHiding&&
h._afterHiding()},l)}},destroy:function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);this._tip&&(document.body.removeChild(this._tip),this._tail=this._tipTextContent=this._tipInner=this._tip=null);if(this._node){this._node.removeEventListener("click",this._clickHandler,!1);this._node.removeEventListener("mouseover",this._mouseoverHandler,!1);this._node.removeEventListener("focus",this._focusHandler,!1);this._node.removeEventListener("blur",this._blurHandler,!1);for(var l=
["mouseout","click"],h=0;h<l.length;h++)this._node.removeEventListener(l[h],this._leaveHandler,!1)}}};r.prototype.constructor=r;return{Tooltip:r}});y("orion/metrics",[],function(){function l(h,e){var c=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search,b=window.location.pathname+window.location.search,k=document.title;p=h;p.forEach(function(m){m.pageLoad(c,b,k,e)})}function r(h,e,c,b){p.forEach(function(k){k.logTiming(h,e,c,b)})}var p=[];return{init:l,
initFromRegistry:function(h,e){var c=[];h.getServiceReferences("orion.metrics").forEach(function(b){c.push(h.getService(b))});l(c,e)},logEvent:function(h,e,c,b){p.forEach(function(k){k.logEvent(h,e,c,b)})},logPageLoadTiming:function(h,e){window.performance&&(window.performance.getEntriesByName&&window.performance.mark&&!window.performance.getEntriesByName(h).length)&&(window.performance.mark(h),r("page",h,window.performance.now(),e))},logTiming:r}});y("orion/commands","orion/webui/littlelib orion/commandsProxy orion/webui/dropdown text!orion/webui/dropdowntriggerbutton.html text!orion/webui/dropdowntriggerbuttonwitharrow.html text!orion/webui/checkedmenuitem.html orion/webui/tooltip orion/metrics".split(" "),
function(l,r,p,h,e,c,b,k){function m(d){var a=d.invocation;if(a){var f=d.command;if(f.hrefCallback)return d=f.hrefCallback.call(a.handler||window,a),d.then?d.then(function(d){window.open(d)}):window.open(d),!0;if(a.commandRegistry)return a.commandRegistry._invoke(a),!0;if(f.onClick||f.callback)return window.setTimeout(function(){(f.onClick||f.callback).call(a.handler||window,a)},0),!0}return!1}function g(d,a){for(var f in a)if(a[f]&&(a[f].keyBinding&&a[f].command)&&a[f].keyBinding.match(d)){var b=
a[f],g=b.keyBinding;if((!g.domScope||l.contains(l.node(g.domScope),d.target))&&m(b)){l.stop(d);break}}}function a(){var d={};if(u){var a,f,b;f=Object.keys(s);for(a=0;a<f.length;a++)b=f[a],d[b]=s[b];var g=u();f=Object.keys(g);for(a=0;a<f.length;a++)b=f[a],d[b]=g[b]}else d=s;return d}function t(d){g(d,a())}function f(d,a,f){a.classList.add("commandImage");var b;d.imageClass?d.addImageClassToElement?a.classList.add(d.imageClass):(b=document.createElement("span"),a.appendChild(b),b.classList.add(d.spriteClass),
b.classList.add(d.imageClass)):(b=new Image,b.alt=d.name,b.name=f,b.id=f,b.src=d.image,a.appendChild(b));return b}function n(d,a,f,b,g){this.commandRegistry=g;this.handler=d;this.items=a;this.userData=f;this.command=b;b.parameters&&(this.parameters=b.parameters.makeCopy());this.id=b.id}function d(d){this._init(d)}var u=null,s={};window.document.addEventListener("keydown",function(d){return r.handleKeyEvent(d,t)},!1);n.prototype={collectsParameters:function(){return this.commandRegistry&&this.commandRegistry.collectsParameters()},
makeCopy:function(d){var a=new n(this.handler,this.items,this.userData,this.command,this.commandRegistry);a.domNode=this.domNode;a.domParent=this.domParent;d?a.parameters=d.makeCopy():this.parameters&&(a.parameters=this.parameters.makeCopy());return a}};n.prototype.constructor=n;d.prototype={_init:function(d){this.id=d.id;this.name=d.name;this.tooltip=d.tooltip;this.callback=d.callback;this.preCallback=d.preCallback;this.hrefCallback=d.hrefCallback;this.choiceCallback=d.choiceCallback;this.positioningNode=
d.positioningNode;this.image=d.image||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC";this.imageClass=d.imageClass;this.addImageClassToElement=d.addImageClassToElement;this.extraClass=d.extraClass;this.selectionClass=d.selectionClass;this.spriteClass=d.spriteClass||"commandSprite";this.visibleWhen=d.visibleWhen;this.parameters=d.parameters;this.isEditor=d.isEditor;this.type=d.type;this.checked=
d.checked;this.track=d.track},populateChoicesMenu:function(d,a,f,b,g){f=this.getChoices(a,f,b);var n=f.some(function(d){return d.checked});f.forEach(function(f){if(f.name){var q=document.createElement("li");d.appendChild(q);var b=document.createElement("span");b.tabIndex=0;b.role="menuitem";b.classList.add("dropdownMenuItem");if(n){var w=document.createElement("span");w.classList.add("check");w.appendChild(document.createTextNode(f.checked?"\u25cf":""));b.appendChild(w)}f.imageClass&&(w=document.createElement("span"),
w.classList.add(f.imageClass),b.appendChild(w));var w=document.createElement("span"),u=document.createTextNode(f.name);w.appendChild(u);b.appendChild(w);q.appendChild(b);b.choice=f;b.addEventListener("click",function(q){k.logEvent("command","invoke",this.id+"\x3e"+f.name);f.callback.call(f,a)}.bind(this),!1);b.addEventListener("keydown",function(q){if(q.keyCode===l.KEY.ENTER||q.keyCode===l.KEY.SPACE)k.logEvent("command","invoke",this.id+"\x3e"+f.name),f.callback.call(f,a)}.bind(this),!1)}else g._generateMenuSeparator(d)}.bind(this))},
getChoices:function(d,a,f){return this.choiceCallback?this.choiceCallback.call(a,d,f):null},makeChoiceCallback:function(d,a){return function(f){d.callback&&d.callback.call(d,a,f)}},hasImage:function(){return this.imageClass||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC"!==this.image}};d.prototype.constructor=d;return{Command:d,CommandInvocation:n,createDropdownMenu:function(d,a,b,g,n,u,c,q,x,
w){d=l.node(d);if(!d)throw"no parent node was specified";var s=document.createRange();s.selectNode(d);s=x?s.createContextualFragment(e):s.createContextualFragment(h);l.processTextNodes(s,{ButtonText:a});d.appendChild(s);d=d.lastChild;var t;x?(x=d.previousSibling,t=x.lastChild):x=d.previousSibling;g?x.classList.add(g):(x.classList.add("orionButton"),x.classList.add("commandButton"));w&&w.split(" ").forEach(x.classList.add.bind(x.classList));n&&(u||(x.textContent="",x.setAttribute("aria-label",a)),
f({spriteClass:"commandSprite",imageClass:n},x,a),x.classList.add("orionButton"));x.dropdown=new p.Dropdown({dropdown:d,populate:b,selectionClass:c,skipTriggerEventListeners:!!t,positioningNode:q});d.dropdown=x.dropdown;return{menuButton:x,menu:d,dropdown:x.dropdown,dropdownArrow:t}},createCheckedMenuItem:function(d,a,f,b){d=l.node(d);if(!d)throw"no parent node was specified";var g=document.createRange();g.selectNode(d);g=g.createContextualFragment(c);l.processTextNodes(g,{ItemText:a});d.appendChild(g);
d=l.$(".checkedMenuItem",d.lastChild);d.checked=f;d.addEventListener("change",b,!1);return d},createCommandItem:function(d,a,g,n,u,c,t){var q,x;c=c||!a.name&&a.hasImage();var w=function(){if(c)a.hasImage()?(f(a,q,n),a.name&&q.setAttribute("aria-label",a.name)):(q.classList.add("commandButton"),q.classList.add("commandMissingImageButton"),q.appendChild(document.createTextNode(a.name)));else{q.classList.add("commandButton");var d=document.createTextNode(a.name);q.appendChild(d)}};if(a.hrefCallback)q=
x=document.createElement("a"),q.id=n,c&&a.hasImage()?f(a,q,n):(q.className="commandLink",q.appendChild(document.createTextNode(a.name))),t=a.hrefCallback.call(g.handler,g),t.then?t.then(function(d){q.href=d}):q.href=t?t:"#";else{if("switch"===a.type){q=document.createElement("div");q.tabIndex=0;q.className="orionSwitch";var e=x=document.createElement("input");e.type="checkbox";e.className="orionSwitchCheck";e.id="orionSwitchCheck"+a.id;d.id&&(e.id+=d.id);q.appendChild(e);w=document.createElement("label");
w.className="orionSwitchLabel";w.setAttribute("for",e.id);var m=document.createElement("span");m.className="orionSwitchInner";var k=document.createElement("span");k.className="orionSwitchSwitch";w.appendChild(m);w.appendChild(k);q.appendChild(w);q.addEventListener("keydown",function(q){(q.keyCode===l.KEY.ENTER||q.keyCode===l.KEY.SPACE)&&e.click()},!1);e.checked=a.checked;m.classList.add(a.imageClass)}else"toggle"===a.type?(q=x=document.createElement("button"),q.className="orionButton",q.classList.add(a.checked?
"orionToggleOn":"orionToggleOff"),q.id="orionToggle"+a.id,d.id&&(q.id+=d.id)):(q=x=document.createElement("button"),q.className="orionButton",a.extraClass&&q.classList.add(a.extraClass)),w();var h=t||a.callback;if(h){var p=function(){h.call(g.handler,g)};a.onClick=h;x.addEventListener("click",function(d){var f;f="switch"===a.type||"toggle"===a.type?function(d){"toggle"===a.type?(d&&(a.checked=!a.checked),a.checked?(q.classList.remove("orionToggleOff"),q.classList.add("orionToggleOn")):(q.classList.remove("orionToggleOn"),
q.classList.add("orionToggleOff")),q.classList.add("orionToggleAnimate")):d?a.checked=e.checked:e.checked=!e.checked;d&&window.setTimeout(p,250)}:function(q){q&&p()};a.preCallback?a.preCallback(g).then(function(q){f(q)}):f(!0);d.stopPropagation()},!1)}}"ul"===d.nodeName.toLowerCase()?(t=document.createElement("li"),d.appendChild(t),d=t):q.classList.add("commandMargins");d.appendChild(q);a.tooltip&&(q.commandTooltip=new b.Tooltip({node:q,text:a.tooltip,position:["above","below","right","left"]}));
u&&(s[a.id]={keyBinding:u,command:a,invocation:g});return q},createCommandMenuItem:function(d,a,f,g,n,u){var c,q,x=d.dropdown;if(a.hrefCallback)q=p.createMenuItem(a.name,"a"),c=q.firstElementChild,n=a.hrefCallback.call(f.handler,f),n.then?n.then(function(q){c.href=q}):c.href=n?n:"#",c.addEventListener("keydown",function(q){(q.keyCode===l.KEY.ENTER||q.keyCode===l.KEY.SPACE)&&c.click()},!1);else{q=p.createMenuItem(a.name);c=q.firstElementChild;var w=n||a.callback;w&&(a.onClick=w,c.addEventListener("click",
function(q){x&&x.close(!0);w.call(f.handler,f)},!1),c.addEventListener("keydown",function(q){if(q.keyCode===l.KEY.ENTER||q.keyCode===l.KEY.SPACE)q.preventDefault(),c.click()},!1))}a.tooltip&&(c.commandTooltip=new b.Tooltip({node:c,text:a.tooltip,position:["above","below","right","left"]}));u&&p.appendKeyBindingString(c,u);d.appendChild(q);g&&(s[a.id]={keyBinding:g,command:a,invocation:f});return c},executeBinding:m,setKeyBindingProvider:function(d){u=d},localKeyBindings:s,getKeyBindings:a,processKey:t,
NO_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC",_testMethodProcessKey:g}});y("orion/explorers/navigationUtils",[],function(){function l(l,h,e,c){!r&&l&&(l.push({domNode:h}),h.style.outline="none")}var r=-1!==navigator.userAgent.indexOf("iPad");return{addNavGrid:function(p,h,e){p&&(p=p.getGridNavHolder(h,!0))&&l(p,e)},generateNavGrid:l,removeNavGrid:function(l,h){if(l)for(var e=0;e<l.length;e++)if(l[e].domNode===
h){l.splice(e,1);break}}}});y("orion/PageUtil",[],function(){var l=/^http[s]?/i;return{hash:function(){var l=window.location.href.split("#")[1];return l?"#"+l:""},matchResourceParameters:function(l){l=l||window.location.toString();var p={resource:""},h=l.indexOf("#");if(-1!==h&&(l=l.substring(h+1),0!==l.length)){l=l.split(",");p.resource=decodeURIComponent(l[0]);for(h=1;h<l.length;h++){var e=/([^=]*)(=?)(.*)/.exec(l[h]),c=decodeURIComponent(e[1]||""),e=decodeURIComponent(e[3]||"");""!==c&&"resource"!==
c&&(p[c]=e)}}return p},validateURLScheme:function(r,p){var h=r;if(-1===r.indexOf("://")){var e=document.createElement("a");e.href=r;h=e.href}e=!1;if(e=p?p.some(function(c){return RegExp("^"+c+":","i").test(h)}):l.test(h))return r;console.log("Illegal URL Scheme: '"+r+"'");return""}}});(function(){function l(e,c,b,k,m,g){c[e]&&(b.push(e),(!0===c[e]||1===c[e])&&k.push(m+e+"/"+g))}function r(e,c,b,k,m){c=k+c+"/"+m;S._fileExists(e.toUrl(c+".js"))&&b.push(c)}function p(e,c,b){for(var k in c)c.hasOwnProperty(k)&&
(!e.hasOwnProperty(k)||b)?e[k]=c[k]:"object"===typeof c[k]&&(!e[k]&&c[k]&&(e[k]={}),p(e[k],c[k],b))}var h=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;y("i18n",["module"],function(e){var c=e.config?e.config():{};return{version:"2.0.4",load:function(b,e,m,g){g=g||{};g.locale&&(c.locale=g.locale);var a=h.exec(b),t=a[1],f=a[4],n=a[5],d=f.split("-"),u=[],s={},v,A="";a[5]?(t=a[1],b=t+n):(n=a[4],f=c.locale,f||(f=c.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),
d=f.split("-"));if(g.isBuild){u.push(b);r(e,"root",u,t,n);for(v=0;v<d.length;v++)f=d[v],A+=(A?"-":"")+f,r(e,A,u,t,n);if(g.locales)for(a=0;a<g.locales.length;a++){f=g.locales[a];d=f.split("-");A="";for(b=0;b<d.length;b++)f=d[b],A+=(A?"-":"")+f,r(e,A,u,t,n)}e(u,function(){m()})}else e([b],function(a){var f=[],b;l("root",a,f,u,t,n);for(v=0;v<d.length;v++)b=d[v],A+=(A?"-":"")+b,l(A,a,f,u,t,n);e(u,function(){var d,b,q;for(d=f.length-1;-1<d&&f[d];d--){q=f[d];b=a[q];if(!0===b||1===b)b=e(t+q+"/"+n);p(s,b)}m(s)})})}}})})();
y("orion/nls/messages",{root:!0});y("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Shell:"Shell",ShellLinkWorkspace:"Shell","Get Plugins":"Get Plugins",Global:"Global",Editor:"Editor",EditorRelatedLink:"Show Current Folder",EditorRelatedLinkParent:"Show Enclosing Folder",EditorLinkWorkspace:"Edit",EditorRelatedLinkProj:"Show Project","Filter bindings":"Filter bindings",orionClientLabel:"Orion client repository","Orion Editor":"Orion Editor","Orion Image Viewer":"Orion Image Viewer",
"Orion Markdown Editor":"Orion Markdown Editor","Orion Markdown Viewer":"Orion Markdown Viewer","Orion JSON Editor":"Orion JSON Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion.",ShowAllKeyBindings:"Show a list of all the keybindings on this page","Show Keys":"Show Keys",HideShowBannerFooter:"Hide or show the page banner","Toggle banner and footer":"Toggle banner",ChooseFileOpenEditor:"Choose a file by name and open an editor on it",
FindFile:"Find File Named...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown","Unknown item":"Unknown item",NoSearchAvailableErr:"Can't search: no search service is available",Related:"Related",Options:"Options","LOG: ":"LOG: ",View:"View",
"no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ",Operations:"Operations","Operations running":"Operations running",SomeOpWarning:"Some operations finished with warning",SomeOpErr:"Some operations finished with error","no service registry":"no service registry",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",
More:"More","Recent searches":"Recent searches","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification",OpPressSpaceMsg:"Operations - Press spacebar to show current operations","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Sidebar":"Toggle Sidebar","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.",
"Sample Orion Plugin":"Sample Orion Plugin","Generate a sample plugin for integrating with Orion.":"Generate a sample plugin for integrating with Orion.",Browser:"Web Browser",OutlineProgress:"Getting outline for ${0} from ${1}",outlineTimeout:"Outline service timed out. Try reloading the page and opening the outline again.",UnknownError:"An unknown error occurred.",Filter:"Filter (* \x3d any string, ? \x3d any character)",TemplateExplorerLabel:"Templates",OpenTemplateExplorer:"Open Template Explorer",
Edit:"Edit",CentralNavTooltip:"Toggle Navigation Menu","Wrote: ${0}":"Wrote: ${0}",GenerateHTML:"Generate HTML file",GenerateHTMLTooltip:"Write an HTML file generated from the current Markdown editor content","alt text":"alt text",blockquote:"blockquote",code:"code","code (block)":"code (block)","code (span)":"code (span)",emphasis:"emphasis","fenced code (${0})":"fenced code (${0})","header (${0})":"header (${0})","horizontal rule":"horizontal rule",label:"label","link (auto)":"link (auto)","link (image)":"link (image)",
"link (inline)":"link (inline)","link label":"link label","link label (optional)":"link label (optional)","link (ref)":"link (ref)","list item (bullet)":"list item (bullet)","list item (numbered)":"list item (numbered)","strikethrough (${0})":"strikethrough (${0})",strong:"strong","table (${0})":"table (${0})",text:"text","title (optional)":"title (optional)",url:"url",TogglePaneOrientationTooltip:"Toggle split pane orientation",WarningDuplicateLinkId:"Duplicate link ID: ${0} (link IDs are not case-sensitive)",
WarningHeaderTooDeep:"Header level cannot exceed 6",WarningLinkHasNoText:"Link has no text",WarningLinkHasNoURL:"Link has no URL",WarningOrderedListItem:"Ordered list item within unordered list",WarningOrderedListShouldStartAt1:"The first item in an ordered list should have index 1",WarningUndefinedLinkId:"Undefined link ID: ${0}",WarningUnorderedListItem:"Unordered list item within ordered list",PageTitleFormat:"${0} - ${1}",KeyCTRL:"Ctrl",KeySHIFT:"Shift",KeyALT:"Alt",KeyBKSPC:"Backspace",KeyDEL:"Del",
KeyEND:"End",KeyENTER:"Enter",KeyESCAPE:"Esc",KeyHOME:"Home",KeyINSERT:"Ins",KeyPAGEDOWN:"Page Down",KeyPAGEUP:"Page Up",KeySPACE:"Space",KeyTAB:"Tab","a year":"a year",years:"${0} years","a month":"a month",months:"${0} months","a day":"a day",days:"${0} days","an hour":"an hour",hours:"${0} hours","a minute":"a minute",minutes:"${0} minutes",timeAgo:"${0} ago",justNow:"just now"});y("orion/i18nUtil",[],function(){return{formatMessage:function(l){var r=/\$\{([^\}]+)\}/g,p=arguments;return 2===p.length&&
p[1]&&"object"===typeof p[1]?l.replace(r,function(h,e){return p[1][e]}):l.replace(r,function(h,e){return p[(e<<0)+1]})}}});y("orion/uiUtils",["i18n!orion/nls/messages","orion/webui/littlelib","orion/i18nUtil"],function(l,r,p){function h(a){var b="";m?(a.mod4&&(b+="\u2303"),a.mod3&&(b+="\u2325"),a.mod2&&(b+="\u21e7"),a.mod1&&(b+="\u2318")):(a.mod1&&(b+=l.KeyCTRL+"+"),a.mod2&&(b+=l.KeySHIFT+"+"),a.mod3&&(b+=l.KeyALT+"+"));if(a.alphaKey)return b+a.alphaKey;if("keypress"===a.type)return b+a.keyCode;var f=
a.keyCode,n=g[f];if(n)return b+n;if(f=r.keyName(f))return f=l["Key"+f]||f,b+f;var d;switch(a.keyCode){case 59:d=a.mod2?":":";";break;case 61:d=a.mod2?"+":"\x3d";break;case 188:d=a.mod2?"\x3c":",";break;case 190:d=a.mod2?"\x3e":".";break;case 191:d=a.mod2?"?":"/";break;case 192:d=a.mod2?"~":"`";break;case 219:d=a.mod2?"{":"[";break;case 220:d=a.mod2?"|":"\\";break;case 221:d=a.mod2?"}":"]";break;case 222:d=a.mod2?'"':"'"}return d?b+d:112<=a.keyCode&&123>=a.keyCode?b+"F"+(a.keyCode-111):b+String.fromCharCode(a.keyCode)}
function e(a){var b=-1!==window.navigator.platform.indexOf("Mac");return b&&a.metaKey||!b&&a.ctrlKey}function c(a,b){if(!a||!a.tagName)return!1;switch(a.tagName.toLowerCase()){case "button":case "fieldset":case "form":case "input":case "keygen":case "label":case "legend":case "meter":case "optgroup":case "output":case "progress":case "select":case "textarea":return!0}return a.parentNode===b?!1:a.parentNode&&c(a.parentNode,b)}function b(a,b,f){return 0<a?1===a?l[b]:p.formatMessage(l[f],a):""}function k(a){a=
new Date(a);var g=(new Date).getTime()-a.getTime();a=Math.floor(g/1E3/60/60/24/365);var g=g-31536E6*a,f=Math.floor(g/1E3/60/60/24/30),g=g-2592E6*f,n=Math.floor(g/1E3/60/60/24),g=g-864E5*n,d=Math.floor(g/1E3/60/60),u=Math.floor((g-36E5*d)/1E3/60),g=b(a,"a year","years"),c=b(f,"a month","months"),e=b(n,"a day","days"),m=b(d,"an hour","hours"),u=b(u,"a minute","minutes"),k="";g?k=0<a?g:g+c:c?k=0<f?c:c+e:e?k=0<n?e:e+m:m?k=0<d?m:m+u:u&&(k=u);return k}var m=-1!==navigator.platform.indexOf("Mac"),g=Object.create(null);
g[r.KEY.DOWN]="\u2193";g[r.KEY.UP]="\u2191";g[r.KEY.RIGHT]="\u2192";g[r.KEY.LEFT]="\u2190";m&&(g[r.KEY.BKSPC]="\u232b",g[r.KEY.DEL]="\u2326",g[r.KEY.END]="\u21f2",g[r.KEY.ENTER]="\u23ce",g[r.KEY.ESCAPE]="\u238b",g[r.KEY.HOME]="\u21f1",g[r.KEY.PAGEDOWN]="\u21df",g[r.KEY.PAGEUP]="\u21de",g[r.KEY.SPACE]="\u2423",g[r.KEY.TAB]="\u21e5");return{getUserKeyString:function(a){var b="";a=a.getKeys();for(var f=0;f<a.length;f++)0!==f&&(b+=" "),b+=h(a[f]);return b},getUserText:function(a){var b=a.id,f=a.refNode,
g=a.hideRefNode,d=a.initialText,u=a.onComplete,c=a.onEditDestroy,e=a.selectTo,m=a.isInitialValid;a=a.insertAsChild;var k=!1,h=function(a){return function(e){if(!k){var q=r.node(b),x=q.value;q&&(a&&e.keyCode===r.KEY.ESCAPE?(g&&(f.style.display="inline"),k=!0,q.parentNode.removeChild(q),c&&c()):a&&e.keyCode!==r.KEY.ENTER||(0===x.length||!m&&x===d?g&&(f.style.display="inline"):(u(x),g&&f.parentNode&&(f.style.display="inline")),k=!0,q.parentNode&&q.parentNode.removeChild(q),c&&c()))}}},l=document.createElement("input");
l.id=b;l.value=d||"";a?f.appendChild(l):f.parentNode.insertBefore(l,f.nextSibling);l.classList.add("userEditBoxPrompt");g&&(f.style.display="none");l.addEventListener("keydown",h(!0),!1);l.addEventListener("blur",h(!1),!1);window.setTimeout(function(){l.focus();if(d){var a=r.node(b),f=e?d.indexOf(e):-1;0<f?a.createTextRange?(a=a.createTextRange(),a.collapse(!0),a.moveStart("character",0),a.moveEnd("character",f),a.select()):a.setSelectionRange?a.setSelectionRange(0,f):void 0!==a.selectionStart&&(a.selectionStart=
0,a.selectionEnd=f):a.select()}},0)},openInNewWindow:e,followLink:function(a,b){b&&e(b)?window.open(a):window.location=a},createButton:function(a,b){var f=document.createElement("button");f.className="orionButton commandButton commandMargins";f.addEventListener("click",function(a){b();r.stop(a)},!1);a&&f.appendChild(document.createTextNode(a));return f},createDropdownButton:function(a,b,f){},isFormElement:c,path2FolderName:function(a,b,f){return a.substring(0,a.length-encodeURIComponent(b).length-
(f?0:1))},timeElapsed:k,displayableTimeElapsed:function(a){return(a=k(a))?p.formatMessage(l.timeAgo,a):l.justNow}}});y("text!orion/webui/submenutriggerbutton.html",[],function(){return'\x3cli class\x3d"dropdownSubMenu"\x3e\x3cspan class\x3d"dropdownTrigger dropdownMenuItem" role\x3d"menuitem" tabindex\x3d"0"\x3e\x3cspan class\x3d"dropdownCommandName"\x3e${ButtonText}\x3c/span\x3e\x3cspan class\x3d"dropdownArrowRight core-sprite-closedarrow"\x3e\x3c/span\x3e\x3c/span\x3e\x3cul class\x3d"dropdownMenu"\x3e\x3c/ul\x3e\x3c/li\x3e'});
y("orion/commandRegistry","orion/commands orion/explorers/navigationUtils orion/PageUtil orion/uiUtils orion/webui/littlelib orion/webui/dropdown orion/webui/tooltip text!orion/webui/submenutriggerbutton.html orion/metrics".split(" "),function(l,r,p,h,e,c,b,k,m){function g(d){this._commandList={};this._contributionsByScopeId={};this._activeBindings={};this._urlBindings={};this._pendingBindings={};this._init(d||{});this._parameterCollector=null}function a(d,a){this.token=d;this.parameterName=a}function t(d,
a,b){this.event=d;this.handler=a;this.capture=b||!1}function f(d,a,b,f,g,n,c){this.name=d;this.type=a;this.label=b;this.value=f;this.lines=g||1;this.validator=c;this.eventListeners=Array.isArray(n)?n:n?[n]:[]}function n(d,a,b){this._storeParameters(d);this._hasOptionalParameters=a&&a.hasOptionalParameters;this._options=a;this.optionsRequested=!1;this.getParameters=b;this.clientCollect=a&&a.clientCollect;this.getParameterElement=a&&a.getParameterElement;this.getSubmitName=a&&a.getSubmitName;this.getCancelName=
a&&a.getCancelName;this.message=a&&a.message}g.prototype={_init:function(d){this._selectionService=d.selection;var a=this;l.setKeyBindingProvider(function(){return a._activeBindings})},processURL:function(d){for(var a in this._urlBindings)if(this._urlBindings[a]&&this._urlBindings[a].urlBinding&&this._urlBindings[a].command){var b=this._urlBindings[a].urlBinding.match(d);if(b){var f=this._urlBindings[a],g=f.command,n=f.invocation;if(n&&n.parameters&&g.callback){n.parameters.setValue(b.parameterName,
b.parameterValue);var c=this;window.setTimeout(function(){c._invoke(n)},0);break}}}},findCommand:function(d){return this._commandList[d]},runCommand:function(d,a,b,f,g,n){if(a){if((d=this._commandList[d])&&(d.visibleWhen?d.visibleWhen(a):1)&&d.callback)return a=new l.CommandInvocation(b,a,g,d,this),a.domParent=n,this._invoke(a,f)}else if((n=this._urlBindings[d])&&n.command&&n.command.callback)return this._invoke(n.invocation,f)},getSelectionService:function(){return this._selectionService},setParameterCollector:function(d){this._parameterCollector=
d},openParameterCollector:function(d,a,b){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(d,a,b))},confirm:function(d,a,f,g,n,c){var t=!1;if(this._parameterCollector&&!n){var e=this,m=function(){e._parameterCollector.close()};n=function(q,d){var b=document.createElement("span");b.classList.add("parameterPrompt");b.textContent=a;q.appendChild(b);b=document.createElement("button");b.addEventListener("click",function(q){t=!0;c(t);m()},!1);d.appendChild(b);b.appendChild(document.createTextNode(f));
b.className="dismissButton";var x=document.createElement("button");x.addEventListener("click",function(q){t=!1;m()},!1);d.appendChild(x);x.appendChild(document.createTextNode(g));x.className="dismissButton";return b};this._parameterCollector.close();if(!this._parameterCollector.open(d,n,function(){})){var k=new b.Tooltip({node:d,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above","left"]});d=k.contentContainer();d.classList.add("parameterPopup");var q=window.document.activeElement,
m=function(){q&&q.focus();k.destroy()},x=document.createElement("div");x.classList.add("parameterMessage");d.appendChild(x);var w=document.createElement("div");d.appendChild(w);w.classList.add("layoutRight");w.classList.add("parametersDismiss");var E=n(x,w);k.show();E&&window.setTimeout(function(){E.focus();E.select&&E.select()},0)}}else t=window.confirm(a),c(t)},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},
_invoke:function(d,a){return this._collectAndInvoke(d.makeCopy(a),!1)},_collectAndInvoke:function(d,a,f){if(d)if(this._parameterCollector&&d.parameters&&d.parameters.hasParameters()&&(a||d.parameters.shouldCollectParameters())){a=!1;d.parameters.updateParameters(d);if(d.parameters.shouldCollectParameters()&&(a=this._parameterCollector.collectParameters(d,f),!a)){var g=new b.Tooltip({node:d.domNode||d.domParent,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above",
"left"]});a=g.contentContainer();a.classList.add("parameterPopup");var n=window.document.activeElement,c=this._parameterCollector.getFillFunction(d,function(){n&&n.focus();g.destroy()},f)(a);g.show();c&&window.setTimeout(function(){c.focus();c.select&&c.select()},0);a=!0}if(!a)return m.logEvent("command","invoke",d.command.id),d.command.callback.call(d.handler||window,d)}else return m.logEvent("command","invoke",d.command.id),d.command.callback.call(d.handler||window,d);else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},
collectParameters:function(d,a){this._collectAndInvoke(d,!0,a)},showKeyBindings:function(d){function a(d){return function(){l.executeBinding(d)}}var b={},f,g,n=[],c;for(c in this._activeBindings)(g=this._activeBindings[c])&&(g.keyBinding&&g.command&&(g.command.name||g.command.tooltip))&&n.push(g);n.sort(function(d,a){return(d.command.name||d.command.tooltip).localeCompare(a.command.name||a.command.tooltip)});for(c=0;c<n.length;c++)g=n[c],g.keyBinding.scopeName?(b[g.keyBinding.scopeName]||(b[g.keyBinding.scopeName]=
[]),b[g.keyBinding.scopeName].push(g)):(f=h.getUserKeyString(g.keyBinding),d.createItem(f,g.command.name||g.command.tooltip,a(g)));for(var t in b)b[t].length&&0<b[t].length&&(d.createHeader(t),b[t].forEach(function(b){f=h.getUserKeyString(b.keyBinding);d.createItem(f,b.command.name||b.command.tooltip,a(b))}))},addCommand:function(d){this._commandList[d.id]=d;var a=this._pendingBindings[d.id];if(a){var b=this;a.forEach(function(a){b._addBinding(d,a.type,a.binding,a.bindingOnly)});delete this._pendingBindings[d.id]}},
addCommandGroup:function(d,a,b,f,g,n,c,t,e,m,q){this._contributionsByScopeId[d]||(this._contributionsByScopeId[d]={});d=this._contributionsByScopeId[d];g&&(d=this._createEntryForPath(d,g));d[a]?(f&&(d[a].title=f),b&&(d[a].position=b),c&&(d[a].imageClass=c),t&&(d[a].tooltip=t),e&&(d[a].selectionClass=e),q&&(d[a].extraClass=q),!0===m?d[a].pretendDefaultActionId=!0:d[a].defaultActionId=m,d[a].emptyGroupMessage=n):(d[a]={title:f,position:b,emptyGroupMessage:n,imageClass:c,tooltip:t,selectionClass:e,defaultActionId:!0===
m?null:m,pretendDefaultActionId:!0===m,children:{},extraClasses:q},d.sortedContributions=null)},_createEntryForPath:function(d,a){a&&a.split("/").forEach(function(a){1<a.length&&(d[a]||(d[a]={position:0,children:{}},d.sortedContributions=null),d=d[a].children)});return d},registerSelectionService:function(a,b){this._contributionsByScopeId[a]||(this._contributionsByScopeId[a]={});this._contributionsByScopeId[a].localSelectionService=b},registerCommandContribution:function(a,b,f,g,n,c,t,e){this._contributionsByScopeId[a]||
(this._contributionsByScopeId[a]={});a=this._contributionsByScopeId[a];g&&(a=this._createEntryForPath(a,g));a[b]={position:f,handler:e};c&&((f=this._commandList[b])?this._addBinding(f,"key",c,n):this._addPendingBinding(b,"key",c,n));t&&((f=this._commandList[b])?this._addBinding(f,"url",t,n):this._addPendingBinding(b,"url",t,n));a.sortedContributions=null},unregisterCommandContribution:function(a,b,f){if(this._contributionsByScopeId[a]){delete this._commandList[b];delete this._activeBindings[b];delete this._urlBindings[b];
delete this._pendingBindings[b];var g=this._contributionsByScopeId[a];f&&f.split("/").forEach(function(a){1<a.length&&g[a]&&(g=g[a].children)});delete g[b];g.sortedContributions=null}},_addBinding:function(a,b,f,g){if(!a.id)throw Error("No command id: "+a);"key"===b?this._activeBindings[a.id]={command:a,keyBinding:f,bindingOnly:g}:"url"===b&&(this._urlBindings[a.id]={command:a,urlBinding:f,bindingOnly:g})},_addPendingBinding:function(a,b,f,g){this._pendingBindings[a]=this._pendingBindings[a]||[];
this._pendingBindings[a].push({type:b,binding:f,bindingOnly:g})},_checkForTrailingSeparator:function(a,b,f){var g;if("tool"===b||"button"===b)if((g=0<a.childNodes.length?a.childNodes[a.childNodes.length-1]:null)&&g.classList.contains("commandSeparator"))return f?(a.removeChild(g),!1):!0;if("menu"===b&&(a=e.$$array("li \x3e *",a),0<a.length&&a[a.length-1].classList.contains("dropdownSeparator")))if(g=a[a.length-1],f)g.parentNode.parentNode.removeChild(g.parentNode);else return!0;return!1},renderCommands:function(a,
b,f,g,n,c,t){if("string"!==typeof a)throw"a scope id for rendering must be specified";b=e.node(b);if(!b)throw"no parent";var m=this._contributionsByScopeId[a];if(!f&&m){f=m.localSelectionService||this._selectionService;var k=this;f&&f.getSelections(function(f){k.renderCommands(a,b,f,g,n,c)})}else m&&(this._render(m,b,f,g,n||"button",c,t),this._checkForTrailingSeparator(b,n,!0))},destroy:function(a){a=e.node(a);if(!a)throw"no parent";for(;a.hasChildNodes();){var b=a.firstChild;b.commandTooltip&&b.commandTooltip.destroy();
b.emptyGroupTooltip&&b.emptyGroupTooltip.destroy();this.destroy(b);a.removeChild(b)}},_render:function(a,f,g,n,c,t,e,m){m=a.sortedContributions;if(!m){m=[];var k=!1,p;for(p in a)if(Object.prototype.hasOwnProperty.call(a,p)){var q=a[p];q&&"number"===typeof q.position&&(q.id=p,m.push(q),k=!0)}k&&(m.sort(function(q,a){return q.position-a.position}),a.sortedContributions=m)}var x=0,w=this;m.forEach(function(q){var a,d;q.imageClass||(q.imageClass=null);if(q.children&&0<Object.getOwnPropertyNames(q.children).length)if(a=
q.children,"tool"===c||"button"===c)if(q.title){var m;q.defaultActionId&&(q.pretendDefaultActionId=!0===q.defaultActionId,(a=w._commandList[q.defaultActionId])&&(a.visibleWhen?a.visibleWhen(g):1)?(m=new l.CommandInvocation(n,g,t,a,w),m.domParent=f):q.pretendDefaultActionId=!0);a=w._createDropdownMenu(f,q.title,null,null,q.imageClass,q.tooltip,q.selectionClass,null,m,q.pretendDefaultActionId,q.extraClasses);e&&r.generateNavGrid(e,a.menuButton);a&&(w._render(q.children,a.menu,g,n,"menu",t,e),w._checkForTrailingSeparator(a.menu,
"menu",!0),0===a.menu.childNodes.length?q.emptyGroupMessage?a.menuButton.emptyGroupTooltip||(a.menuButton.emptyGroupTooltip=new b.Tooltip({node:a.menuButton,text:q.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})):(e&&r.removeNavGrid(e,a.menuButton),q=function(q){q&&q.parentNode&&q.parentNode.removeChild(q)},q(a.menu),q(a.menuButton),q(a.destroyButton)):a.menuButton.style.visibility="visible")}else{var k;0<f.childNodes.length&&!w._checkForTrailingSeparator(f,c)&&(k=w.generateSeparatorImage(f));
w._render(a,f,g,n,c,t,e);0<f.childNodes.length&&f.childNodes[f.childNodes.length-1]!==k&&(k=w.generateSeparatorImage(f))}else if(q.title){if(q=w._createDropdownMenu(f,q.title,!0,null,null,q.imageClass))w._render(a,q.menu,g,n,"menu",t,e),w._checkForTrailingSeparator(q.menu,"menu",!0),0===q.menu.childNodes.length&&q.destroyButton&&f.removeChild(q.destroyButton)}else 0<f.childNodes.length&&w._generateMenuSeparator(f),w._render(a,f,g,n,c,t,e),0<f.childNodes.length&&w._generateMenuSeparator(f);else{var p=
w._commandList[q.id];m=p?!0:!1;k=a=null;if(p){d=new l.CommandInvocation(q.handler||n,g,t,p,w);d.domParent=f;q=!1;try{q=m&&(p.visibleWhen?p.visibleWhen(g,d):!0)}catch(D){throw console.log(D),D;}w._activeBindings[p.id]&&w._activeBindings[p.id].keyBinding&&(a=w._activeBindings[p.id],a.invocation=q?d:null,a.bindingOnly&&(m=!1));w._urlBindings[p.id]&&w._urlBindings[p.id].urlBinding&&(k=w._urlBindings[p.id],k.invocation=q?d:null,k.bindingOnly&&(m=!1));m=m&&q}m&&(p.choiceCallback?("tool"===c||"button"===
c?(q=f,a=!1,"ul"===f.nodeName.toLowerCase()&&(q=document.createElement("li"),f.appendChild(q))):(q=f,a=!0),w._createDropdownMenu(q,p.name,a,function(q){p.populateChoicesMenu(q,g,n,t,w)}.bind(p),p.imageClass,p.tooltip||p.title,p.selectionClass,p.positioningNode)):(d.handler=d.handler||this,d.domParent=f,q=function(q){w._invoke(d)},"menu"===c?(m=null,a&&a.keyBinding&&(m=h.getUserKeyString(a.keyBinding)),q=l.createCommandMenuItem(f,p,d,null,q,m)):"quickfix"===c?(a=c+p.id+x,m=document.createElement("div"),
f.appendChild(m),q=l.createCommandItem(m,p,d,a,null,"button"===c,q)):(a=c+p.id+x,q=l.createCommandItem(f,p,d,a,null,"tool"===c,q)),r.generateNavGrid(e,q),d.domNode=q,x++))}})},_createDropdownMenu:function(a,f,g,n,t,m,h,p,r,C,q){a=e.node(a);if(!a||!e.contains(document.body,a))return null;var x,w,E=a;if(g)w=document.createRange(),w.selectNode(a),w=w.createContextualFragment(k),e.processTextNodes(w,{ButtonText:f}),a.appendChild(w),w=a.lastChild,t=w.lastChild,f=t.previousSibling,f.dropdown=new c.Dropdown({dropdown:t,
populate:n,parentDropdown:a.dropdown}),t.dropdown=f.dropdown;else{"ul"===a.nodeName.toLowerCase()&&(E=document.createElement("li"),a.appendChild(E),w=E);a=null;t&&(a="dropdownButtonWithIcon",m=m||f);m=t?m||f:m;var K=l.createDropdownMenu(E,f,n,a,t,!1,h,p,r||C,q);x=K.dropdownArrow;f=K.menuButton;if(x){r&&(r.domNode=K.menuButton);var O=this;f.onclick=function(q){var a=e.bounds(x);(q.clientX>=a.left||!0===C)&&K.dropdown?K.dropdown.toggle(q):O._invoke(r)};K.dropdown&&(f.onkeydown=function(q){e.KEY.DOWN===
q.keyCode&&(K.dropdown.toggle(q),e.stop(q))})}t=K.menu;if(n=r&&r.command&&(r.command.tooltip||r.command.name)?r.command.tooltip||r.command.name:m)f.commandTooltip=new b.Tooltip({node:f,text:n,position:["above","below","right","left"]})}return{menuButton:f,menu:t,dropdown:f.dropdown,destroyButton:w,dropdownArrow:x}},_generateMenuSeparator:function(a){if(!this._checkForTrailingSeparator(a,"menu")){var b=document.createElement("li");b.classList.add("dropdownSeparator");var f=document.createElement("span");
f.classList.add("dropdownSeparator");b.appendChild(f);a.appendChild(b)}},generateSeparatorImage:function(a){var b;b="ul"===a.nodeName.toLowerCase()?document.createElement("li"):document.createElement("span");a.appendChild(b);b.classList.add("core-sprite-sep");b.classList.add("imageSprite");b.classList.add("commandSeparator");return b}};g.prototype.constructor=g;a.prototype={match:function(a){a=p.matchResourceParameters(a);return"undefined"!==typeof a[this.token]?(this.parameterValue=a[this.token],
this):null}};a.prototype.constructor=a;t.prototype.constructor=t;f.prototype={optionsRequested:function(){return this.optionsRequested}};f.prototype.constructor=f;n.prototype={_storeParameters:function(a){this.parameterTable=null;if(a){var b=this.parameterTable={};a.forEach(function(a){b[a.name]=a})}},updateParameters:function(a){"function"===typeof this.getParameters&&this._storeParameters(this.getParameters(a))},hasParameters:function(){return null!==this.parameterTable},shouldCollectParameters:function(){return!this.clientCollect&&
this.hasParameters()},parameterNamed:function(a){return this.parameterTable[a]},valueFor:function(a){return(a=this.parameterTable[a])?a.value:null},setValue:function(a,b){var f=this.parameterTable[a];f&&(f.value=b)},forEach:function(a){for(var b in this.parameterTable)this.parameterTable[b].type&&this.parameterTable[b].name&&a(this.parameterTable[b])},validate:function(a,b){var f=this.parameterTable[a];return f&&f.validator?f.validator(b):!0},makeCopy:function(){var a=[];this.forEach(function(b){b=
new f(b.name,b.type,b.label,b.value,b.lines,b.eventListeners,b.validator);a.push(b)});var b=new n(a,this._options,this.getParameters);b.clientCollect=this.clientCollect;b.message=this.message;return b},hasOptionalParameters:function(){return this._hasOptionalParameters}};n.prototype.constructor=n;return{CommandRegistry:g,URLBinding:a,ParametersDescription:n,CommandParameter:f,CommandEventListener:t}});y("orion/edit/nls/messages",{root:!0});y("orion/edit/nls/root/messages",{Editor:"Editor",switchEditor:"Switch Editor",
Fetching:"Fetching: ${0}",confirmUnsavedChanges:"There are unsaved changes. Do you still want to navigate away?",searchFiles:"Quick Search...",searchTerm:"Enter search term:",unsavedChanges:"There are unsaved changes.",unsavedAutoSaveChanges:"Please stay on the page until Auto Save is complete.",Save:"Save",Saved:"Saved",Blame:"Blame",BlameTooltip:"Show blame annotations",Diff:"Diff",DiffTooltip:"Show diff annotations",saveOutOfSync:"Resource is out of sync with the server. Do you want to save it anyway?",
loadOutOfSync:"Resource is out of sync with the server. Do you want to load it anyway? This will overwrite your local changes.",ReadingMetadata:"Reading metadata of ${0}",ReadingMetadataError:"Cannot get metadata of ${0}",Reading:"Reading ${0}",readonly:"Read Only.",saveFile:"Save this file",toggleZoomRuler:"Toggle Zoom Ruler",gotoLine:"Go to line...",gotoLineTooltip:"Go to specified line number",gotoLinePrompt:"Go to line:",Undo:"Undo",Redo:"Redo",Find:"Find...",noResponse:"No response from server. Check your internet connection and try again.",
savingFile:"Saving file ${0}",running:"Running ${0}","Saving...":"Saving...",View:"View",SplitSinglePage:"Single Page",SplitVertical:"Split Vertical",SplitHorizontal:"Split Horizontal",SplitPipInPip:"Picture in Picture",SplitModeTooltip:"Change split editor mode",SidePanel:"Side Panel",SidePanelTooltip:"Choose what to show in the side panel.",Slideout:"Slideout",Actions:"Actions",Navigator:"Navigator",FolderNavigator:"Folder Navigator",Project:"Project",New:"New",File:"File",Edit:"Edit",Tools:"Tools",
Add:"Add",noActions:"There are no actions for the current selection.",NoFile:"Use the ${0} to create new files and folders. Click a file to start coding.",LocalEditorSettings:"Local Editor Settings",NoProject:"${0} is not a project. To convert it to a project use ${1}.",NoProjects:"There are no projects in your workspace. Use the ${0} menu to create projects.",Disconnected:"${0} (disconnected)",ChooseFS:"Choose Filesystem",ChooseFSTooltip:"Choose the filesystem you want to view.",FSTitle:"${0} (${1})",
Deploy:"Deploy","Deploy As":"Deploy As",Import:"Import",Export:"Export",OpenWith:"Open with",OpenRelated:"Open related",Dependency:"Dependency",UnnamedCommand:"Unnamed",searchInFolder:"Search in folder...","Global Search":"Global Search...",ClickEditLabel:"Click to edit",ProjectInfo:"Project Information",Name:"Name",Description:"Description",Site:"Site",projectsSectionTitle:"Projects",listingProjects:"Listing projects...",gettingWorkspaceInfo:"Getting workspace information...",showProblems:"Show problems...",
showTooltip:"Show Tooltip",showTooltipTooltip:"Shows the tooltip immediately based on the caret position",emptyDeploymentInfoMessage:"Use the Launch Configurations dropdown to deploy this project"});y("orion/explorers/navigatorRenderer",[],function(){return{getClickedItem:function(){return null}}});y("orion/objects",[],function(){function l(l){for(var p=Object.prototype.hasOwnProperty,h=1,e=arguments.length;h<e;h++){var c=arguments[h],b;for(b in c)p.call(c,b)&&(l[b]=c[b])}return l}return{clone:function(r){if(Array.isArray(r))return Array.prototype.slice.call(r);
var p=Object.create(Object.getPrototypeOf(r));l(p,r);return p},mixin:l,toArray:function(l){return Array.isArray(l)?l:[l]}}});y("orion/inputManager","i18n!orion/edit/nls/messages orion/explorers/navigatorRenderer orion/i18nUtil orion/Deferred orion/EventTarget orion/objects orion/PageUtil orion/metrics".split(" "),function(l,r,p,h,e,c,b,k){function m(a){this._document=a.document||document;this._timeout=a.timeout;a=["mousedown","keypress","keydown","keyup"];for(var b=function(a){this._resetTimer()}.bind(this),
g=0;g<a.length;g++)this._document.addEventListener(a[g],b,!0);e.attach(this)}function g(a,b){if(a){if(!b.Severity){var g=b,d={Severity:"Error",Message:l.noResponse};if("Cancel"===g.name)b={Severity:"Warning",Message:g.name,Cancel:!0};else{if(0===g.status)d.Cancel=!0;else if(g.responseText){g=g.responseText;try{var c=JSON.parse(g);d.Severity=c.Severity||d.Severity;d.Message=c.Message||d.Message}catch(s){d.Message=g}}else try{d.Message=JSON.stringify(g)}catch(e){}b=d}}a.setProgressResult(b);return b}window.console.log(b)}
function a(a){e.attach(this);this.serviceRegistry=a.serviceRegistry;this.statusService=a.statusService;this.fileClient=a.fileClient;this.progressService=a.progressService;this.contentTypeRegistry=a.contentTypeRegistry;this.selection=a.selection;this._input=this._title=""}m.prototype={_resetTimer:function(){var a=this._document.defaultView||this._document.parentWindow;this._timer&&(a.clearTimeout(this._timer),this._timer=null);-1!==this._timeout&&(this._timer=a.setTimeout(function(){this.onIdle({type:"Idle"});
this._timer=null;this._resetTimer()}.bind(this),this._timeout))},onIdle:function(a){return this.dispatchEvent(a)},setTimeout:function(a){this._timeout=a;this._resetTimer()}};c.mixin(a.prototype,{_maybeLoadWorkspace:function(a){var b=this.fileClient,g=a;g.indexOf("?")&&(g=g.split("?")[0]);return g===b.fileServiceRootURL(g)?b.loadWorkspace(g).then(function(a){return a.Location}):(new h).resolve(a)},_read:function(a){var b=this.cachedMetadata||r.getClickedItem();if(b&&b.Location===a&&b.Parents&&b.Attributes&&
b.ETag)return(new h).resolve(b);var g=this.fileClient,d=Array.prototype.slice.call(arguments,1);return this._maybeLoadWorkspace(a).then(function(a){return g.read.apply(g,[a].concat(d))})},load:function(){var a=this.getInput();if(a){var b=this.fileClient,n=this._parsedLocation.resource,d=this.progressService,u=function(a,b,f){return!d?a:d.progress(a,p.formatMessage(b,f))},s=this.getEditor();if(this._fileMetadata)!this._fileMetadata._saving&&(!this._fileMetadata.Directory&&!this.getReadOnly())&&u(b.read(n,
!0),l.ReadingMetadata,a).then(function(d){this._fileMetadata&&(this._fileMetadata.Location===d.Location&&this._fileMetadata.ETag!==d.ETag)&&(this._fileMetadata=c.mixin(this._fileMetadata,d),(!s.isDirty()||window.confirm(l.loadOutOfSync))&&u(b.read(n),l.Reading,a).then(function(d){s.setInput(a,null,d);this._clearUnsavedChanges()}.bind(this)))}.bind(this));else{var e=window.setTimeout(function(){e=null;this.reportStatus(p.formatMessage(l.Fetching,a))}.bind(this),800),m=function(){this.reportStatus("");
e&&window.clearTimeout(e)}.bind(this),k=function(a){m();var d=null;this.serviceRegistry?d=this.serviceRegistry.getService("orion.page.message"):this.statusService&&(d=this.statusService);g(d,a);this._setNoInput()}.bind(this);this._acceptPatch=null;u(this._read(n+(localStorage.useFullCompressed?"?full\x3dcompressed":localStorage.useFull?"?full\x3dtrue":localStorage.useFullDecorate?"?full\x3ddecorate":""),!0),l.ReadingMetadata,n).then(function(d){d?d.Directory?h.when(d.Children||u(b.fetchChildren(d.ChildrenLocation),
l.Reading,a),function(b){m();d.Children=b;this._setInputContents(this._parsedLocation,a,b,d)}.bind(this),k):this._isText(d)?u(b.read(n,!1,!0),l.Reading,a).then(function(b){m();"string"!==typeof b&&(this._acceptPatch=b.acceptPatch,b=b.result);this._setInputContents(this._parsedLocation,a,b,d)}.bind(this),k):u(b._getService(n).readBlob(n),l.Reading,a).then(function(b){m();this._setInputContents(this._parsedLocation,a,b,d)}.bind(this),k):k({responseText:p.formatMessage(l.ReadingMetadataError,n)})}.bind(this),
k)}}},processParameters:function(a){var b=this.getEditor();return b&&b.processParameters?b.processParameters(a):!1},getAutoLoadEnabled:function(){return this._autoLoadEnabled},getAutoSaveEnabled:function(){return this._autoSaveEnabled},getEditor:function(){return this.editor},getInput:function(){return this._input},getLocation:function(){return this._location},getTitle:function(){return this._title},getFileMetadata:function(){return this._fileMetadata},isSaveEnabled:function(){return!this.getReadOnly()},
getReadOnly:function(){var a=this._fileMetadata;return this._readonly||!a||a.Attributes&&a.Attributes.ReadOnly},getContentType:function(){return this._contentType},onFocus:function(a){this._autoSaveEnabled&&this._errorSaving?this.save():this._autoLoadEnabled&&this._fileMetadata&&this.load()},reportStatus:function(a){this.statusReporter?this.statusReporter(a):this.editor&&this.editor.reportStatus(a)},save:function(a){function b(a){var q=c._savingDeferred;q.resolve(a);c._savingDeferred=null;c._saving=
!1;return q}function n(q){F===s.getInput()&&(c.ETag=q.ETag,e.setInput(F,null,z,!0));s.reportStatus("");m&&E&&E.setProgressResult({Message:l.Saved,Severity:"Normal"});s.postSave&&s.postSave(a);return b(q)}function d(a){s.reportStatus("");a=g(E,a);k.logEvent("status","exception",(s._autoSaveActive?"Auto-save: ":"Save: ")+a.Message);s._errorSaving=!0;return b()}var c=this.getFileMetadata();if(!c)return(new h).reject();if(c._saving)return c._savingDeferred;var s=this;c._savingDeferred=new h;c._saving=
!0;var e=this.getEditor();if(!e||!e.isDirty()||this.getReadOnly())return b();var m=this._errorSaving,F=this.getInput();this.reportStatus(l["Saving..."]);this._saveEventLogged||(this._logMetrics("save"),this._saveEventLogged=!0);this.dispatchEvent({type:"Saving",inputManager:this});e.markClean();var z=e.getText(),r=z;if(this._getSaveDiffsEnabled()&&!this._errorSaving){var B=this._getUnsavedChanges();if(B){for(var C=0,q=0;q<B.length;q++)C+=B[q].text.length;z.length>C&&(r={diff:B})}}this._clearUnsavedChanges();
this._errorSaving=!1;var x=this._parsedLocation.resource,r=this.fileClient.write(x,r,{ETag:c.ETag}),w=this.progressService,E=null;this.serviceRegistry&&(E=this.serviceRegistry.getService("orion.page.message"));w&&(r=w.progress(r,p.formatMessage(l.savingFile,F)));r.then(n,function(a){if(412===a.status)if(window.confirm(l.saveOutOfSync))a=s.fileClient.write(x,z),w&&(a=w.progress(a,p.formatMessage(l.savingFile,F))),a.then(n,d);else return b();else d(a)});return c._savingDeferred},setAutoLoadEnabled:function(a){this._autoLoadEnabled=
a},setAutoSaveTimeout:function(a){this._autoSaveEnabled=-1!==a;this._autoSaveActive=!1;this._idle?this._idle.setTimeout(a):(this._idle=new m({document:document,timeout:a}),this._idle.addEventListener("Idle",function(){this._errorSaving||(this._autoSaveActive=!0,this.save().then(function(){this._autoSaveActive=!1}))}.bind(this)))},setContentType:function(a){this._contentType=a},setInput:function(a){if(!this._ignoreInput&&(a||(a=b.hash()),"string"===typeof a)){var f=this.getEditor();a&&"#"!==a[0]&&
(a="#"+a);var g=b.matchResourceParameters(a),d=this._parsedLocation||{};if(f&&f.isDirty()){var c=this._location;if(d.resource!==g.resource)if(this._autoSaveEnabled)this.save();else if(!window.confirm(l.confirmUnsavedChanges)){window.location.hash=c;return}}f=f&&d.editor!==g.editor;this._location=a;this._parsedLocation=g;this._ignoreInput=!0;this.selection&&this.selection.setSelections(a);this._ignoreInput=!1;a={type:"InputChanging",input:g};this.dispatchEvent(a);d=g.resource;a.metadata?(this.reportStatus(""),
this._input=d,this._setInputContents(g,d,null,a.metadata)):d?d===this._input?f?(this.reportStatus(""),this._setInputContents(g,d,null,this._fileMetadata,this._isText(this._fileMetadata))):this.processParameters(g):(this._input=d,this._readonly=!1,this._fileMetadata=null,this.load()):this._setNoInput(!0)}},setTitle:function(a){var b=a.lastIndexOf("/");-1!==b&&(a=a.substring(b+1));this._title=a},setSaveDiffsEnabled:function(a){this._saveDiffsEnabled=a;(a=this.editor)&&!a.isDirty()&&this._clearUnsavedChanges()},
_getSaveDiffsEnabled:function(){return this._saveDiffsEnabled&&this._acceptPatch&&-1!==this._acceptPatch.indexOf("application/json-patch")},_logMetrics:function(a){var b="(none)",g=this.getContentType(),d=this.getFileMetadata();if(g)b=g.id;else if(d)if(g=d.Name,d=g.lastIndexOf("."),0<=d)b="unregistered: "+g.substring(d);else switch(g){case "AUTHORS":case "config":case "LICENSE":case "make":case "Makefile":b="unregistered: "+g}k.logEvent("editor",a,b)},_unknownContentTypeAsText:function(){return!0},
_isText:function(a){a=this.contentTypeRegistry.getFileContentType(a);if(!a)return this._unknownContentTypeAsText();var b=this.contentTypeRegistry.getContentType("text/plain");return this.contentTypeRegistry.isExtensionOf(a,b)},_setNoInput:function(a){a?this.fileClient.loadWorkspace("").then(function(a){this._input=a.ChildrenLocation;this._setInputContents(a.ChildrenLocation,null,a,a)}.bind(this)):(this._input=this._title=this._fileMetadata=null,this.setContentType(null),this.dispatchEvent({type:"InputChanged",
input:null}))},_setInputContents:function(a,b,g,d,c){var s,e=!1;d?(this._fileMetadata=d,this.setTitle(d.Location||String(d)),this.setContentType(this.contentTypeRegistry.getFileContentType(d)),s=d.Name,e=d.Directory):(this._fileMetadata=null,this.setTitle(b),this.setContentType(this.contentTypeRegistry.getFilenameContentType(this.getTitle())),s=this.getTitle());var m=this.getEditor();this._focusListener&&(m&&(m.getTextView&&m.getTextView())&&m.getTextView().removeEventListener("Focus",this._focusListener),
this._focusListener=null);d={type:"InputChanged",input:a,name:s,title:b,contentType:this.getContentType(),metadata:d,location:window.location,contents:g};this._logMetrics("open");this.dispatchEvent(d);this.editor=m=d.editor;e||(c||m.setInput(b,null,g),m&&(m.getTextView&&m.getTextView())&&m.getTextView().addEventListener("Focus",this._focusListener=this.onFocus.bind(this)),this._clearUnsavedChanges(),this.processParameters(a)||d.session&&d.session.apply());this._saveEventLogged=!1;k.logPageLoadTiming("interactive",
window.location.pathname)},_getUnsavedChanges:function(){var a=this.editor;return a&&a.getUndoStack&&a.getUndoStack()?a.getUndoStack()._unsavedChanges:null},_clearUnsavedChanges:function(){var a=this.editor;a&&(a.getUndoStack&&a.getUndoStack())&&(a.getUndoStack()._unsavedChanges=this._getSaveDiffsEnabled()?[]:null)}});return{handleError:g,InputManager:a}});y("orion/navigate/nls/messages",{root:!0});y("orion/navigate/nls/root/messages",{Navigator:"Navigator","Strings Xtrnalizr":"Strings Xtrnalizr",
"Externalize strings":"Externalize strings from JavaScript files in this folder.",NotSupportFileSystem:"${0} is not supported in this file system",SrcNotSupportBinRead:"Source file service does not support binary read",TargetNotSupportBinWrite:"Target file service does not support binary write",NoFileSrv:"No matching file service for location: ${0}","Choose a Folder":"Choose a Folder","Copy of ${0}":"Copy of ${0}",EnterName:"Enter a new name for '${0}'",ChooseFolder:"Choose folder...",Rename:"Rename",
RenameFilesFolders:"Rename the selected files or folders",CompareEach:"Compare with each other","Compare 2 files":"Compare the selected 2 files with each other","Compare with...":"Compare with...",CompareFolders:"Compare the selected folder with a specified folder",Delete:"Delete","Unknown item":"Unknown item","delete item msg":"Are you sure you want to delete these ${0} items?",DeleteTrg:"Are you sure you want to delete '${0}'?",Zip:"Zip",ZipDL:"Create a zip file of the folder contents and download it",
"New File":"File","Create a new file":"Create a new file",FailedToCreateProject:"Failed to create project: ${0}",FailedToCreateFile:"Failed to create file: ${0}",CopyFailed:"Copy operation failed",MoveFailed:"Move operation failed","Name:":"Name:","New Folder":"Folder","Folder name:":"Folder name:","Create a new folder":"Create a new folder","Creating folder":"Creating folder",Folder:"Folder","Create an empty folder":"Create an empty folder",CreateEmptyMsg:"Create an empty folder on the Orion server. You can import, upload, or create content in the editor.",
"Sample HTML5 Site":"Sample HTML5 Site","Generate a sample":"Generate a sample",'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.':'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.',"Creating a folder for ${0}":"Creating a folder for ${0}","SFTP Import":"SFTP Import","Import content from SFTP":"Import content from SFTP","Imported Content":"Imported Content","Upload a Zip":"Upload a Zip","Upload content from a local zip file":"Upload content from a local zip file",
"Uploaded Content":"Uploaded Content","Clone Git Repository":"Clone Git Repository","Clone a git repository":"Clone a git repository","Link to Server":"Link to Server",LinkContent:"Link to existing content on the server",CreateLinkedFolder:"Create a folder that links to an existing folder on the server.","Server path:":"Server path:",NameLocationNotClear:"The name and server location were not specified.","Go Up":"Go Up",GoUpToParent:"Move up to the parent folder","Go Into":"Go Into",GoSelectedFolder:"Move into the selected folder",
"File or zip archive":"File or zip archive",ImportLcFile:"Import a file or zip archive from your local file system","SFTP from...":"SFTP",CpyFrmSftp:"Copy files and folders from a specified SFTP connection","Importing from ${0}":"Importing from ${0}","SFTP to...":"SFTP",CpyToSftp:"Copy files and folders to a specified SFTP location",Exporting:"Exporting to ${0}","Pasting ${0}":"Pasting ${0}","Copy to":"Copy to","Move to":"Move to","Copying ${0}":"Copying ${0}","Moving ${0}":"Moving ${0}","Renaming ${0}":"Renaming ${0}",
"Deleting ${0}":"Deleting ${0}","Creating ${0}":"Creating ${0}","Linking to ${0}":"Linking to ${0}",MvToLocation:"Move files and folders to a new location",Cut:"Cut",Copy:"Copy","Fetching children of ":"Fetching children of ",Paste:"Paste","Open With":"Open With","Loading ":"Loading ",New:"New",File:"File",Actions:"Actions","Orion Content":"Orion Content","Create new content":"Create new content","Import from HTTP...":"HTTP","File URL:":"File URL:",ImportURL:"Import a file from a URL and optionally unzip it",
"Unzip *.zip files:":"Unzip *.zip files:","Extracted from:":"Extracted from:",FolderDropNotSupported:"Did not drop ${0}. Folder drop is not supported in this browser.",CreateFolderErr:"You cannot copy files directly into the workspace. Create a folder first.","Unzip ${0}?":"Unzip ${0}?","Upload progress: ":"Upload progress: ","Uploading ":"Uploading ","Cancel upload":"Cancel upload",UploadingFileErr:"Uploading the following file failed: ","Enter project name:":"Enter project name:","Create new project":"Create new project",
"Creating project ${0}":"Creating project ${0}",NoFile:"Use the ${0} menu to create new files and folders. Click a file to start coding.",Download:"Download",Download_tooltips:"Download the file contents as the displayed name","Downloading...":"Reading file contents...","Download not supported":"Contents download is not supported in this browser.",gettingContentFrom:"Getting content from ",confirmLaunchDelete:'Delete Launch Configuration "${0}" ?',deletingLaunchConfiguration:"Deleting launch configuration...",
deployTo:"Deploy to ",deploy:"Deploy ",connect:"Connect",fetchContent:"Fetch content",fetchContentOf:"Fetch content of ",disconnectFromProject:"Disconnect from project",doNotTreatThisFolder:"Do not treat this folder as a part of the project",checkStatus:"Check status",checkApplicationStatus:"Check application status",checkApplicationState:"Check application state",stop:"Stop",start:"Start",stopApplication:"Stop the application",startApplication:"Start the application",manage:"Manage",manageThisApplicationOnRemote:"Manage this application on remote server",
deleteLaunchConfiguration:"Delete this launch configuration",editLaunchConfiguration:"Edit this launch configuration",deployThisApplication:"Deploy the application using the workspace contents",associatedFolder:"Associated Folder",associateAFolderFromThe:"Associate a folder from the workspace with this project.",convertToProject:"Convert to project",convertThisFolderIntoA:"Convert this folder into a project",thisFolderIsAProject:"This folder is a project already.",basic:"Basic","createAnEmptyProject.":"Create an empty project.",
sFTP:"SFTP",createAProjectFromAn:"Create a project from an SFTP site.",readMeCommandName:"Readme File",readMeCommandTooltip:"Create a README.md file in this project",zipArchiveCommandName:"Zip archive",zipArchiveCommandTooltip:"Create a project from a local zip archive.","Url:":"Url:",notZip:"The following files are not zip files: ${0}. Would you like to continue the import?",notZipMultiple:"There are multiple non-zip files being uploaded. Would you like to continue the import?",Cancel:"Cancel",Ok:"Ok",
missingCredentials:"Enter the ${0} authentication credentials associated with ${1} to check its status.",deploying:"deploying",starting:"restarting",stopping:"stopping",checkingStateShortMessage:"checking status"});y("orion/fileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(l,r,p){function h(b,c,e){if(!b[c])throw Error(p.formatMessage(l.NotSupportFileSystem,c));return b[c].apply(b,e)}function e(b,c,m,g){if(!b.readBlob)throw Error(l.SrcNotSupportBinRead);if(!m.writeBlob)throw Error(l.TargetNotSupportBinWrite);
if("/"!==c[c.length-1])return h(b,"readBlob",[c]).then(function(a){return h(m,"writeBlob",[g,a])});var a=g.substring(0,g.length-1),t=decodeURIComponent(a.substring(a.lastIndexOf("/")+1)),a=a.substring(0,a.lastIndexOf("/")+1);return h(m,"createFolder",[a,t]).then(function(){},function(){}).then(function(){return h(b,"fetchChildren",[c]).then(function(a){for(var c=[],d=0;d<a.length;++d){var u=a[d].Location,s=u;a[d].Directory&&(s=u.substring(0,u.length-1));s=decodeURIComponent(s.substring(s.lastIndexOf("/")+
1));s=g+encodeURIComponent(s);a[d].Directory&&(s+="/");c[d]=e(b,u,m,s)}return r.all(c)})})}function c(b,c){function e(a){var d=new r;d.reject(l["No Matching FileService for location:"]+a);return d}var g=b.getServiceReferences("orion.core.file"),a=g;if(c)for(var a=[],t=0;t<g.length;++t)c(g[t])&&a.push(g[t]);a.sort(function(a,d){var b=a.getProperty("ranking")||0,f=d.getProperty("ranking")||0;return b-f});for(var f=[],n=[],d=[],u=[],s={fetchChildren:function(){var a=new r;a.resolve(u);return a},createWorkspace:function(){var a=
new r;a.reject(l["no file service"]);return a},loadWorkspaces:function(){var a=new r;a.reject(l["no file service"]);return a},loadWorkspace:function(a){var d=new r;window.setTimeout(function(){d.resolve({Directory:!0,Length:0,LocalTimeStamp:0,Name:l["File Servers"],Location:"/",Children:u,ChildrenLocation:"/"})},100);return d},search:e,createProject:e,createFolder:e,createFile:e,deleteFile:e,moveFile:e,copyFile:e,read:e,write:e},g=0;g<a.length;++g){u[g]={Directory:!0,Length:0,LocalTimeStamp:0,Location:a[g].getProperty("top"),
ChildrenLocation:a[g].getProperty("top"),Name:a[g].getProperty("Name")||a[g].getProperty("NameKey")};t=a[g].getProperty("pattern")||a[g].getProperty("top").replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");Array.isArray(t)||(t=[t]);for(var v=[],h=0;h<t.length;h++){var F=t[h];"^"!==F[0]&&(F="^"+F);v.push(RegExp(F))}f[g]=v;n[g]=b.getService(a[g]);d[g]=a[g].getProperty("Name")||a[g].getProperty("NameKey")}this._getServiceIndex=function(a){if("/"===a)return-1;if(!a||a.length&&0===a.length)return n[0]?0:-1;
for(var d=0;d<f.length;++d)for(var b=0;b<f[d].length;b++)if(f[d][b].test(a))return d;throw Error(p.formatMessage(l.NoFileSrv,a));};this._getService=function(a){a=this._getServiceIndex(a);return-1===a?s:n[a]};this._getServiceName=function(a){a=this._getServiceIndex(a);return-1===a?s.Name:d[a]};this._getServiceRootURL=function(a){a=this._getServiceIndex(a);return-1===a?s.Location:u[a].Location}}c.prototype={getService:function(b){return this._getService(b)},fileServiceName:function(b){return this._getServiceName(b)},
fileServiceRootURL:function(b){return this._getServiceRootURL(b)},fetchChildren:function(b){return h(this._getService(b),"fetchChildren",arguments)},createWorkspace:function(b){return h(this._getService(),"createWorkspace",arguments)},loadWorkspaces:function(){return h(this._getService(),"loadWorkspaces",arguments)},loadWorkspace:function(b){return h(this._getService(b),"loadWorkspace",arguments)},createProject:function(b,c,e,g){return h(this._getService(b),"createProject",arguments)},createFolder:function(b,
c){return h(this._getService(b),"createFolder",arguments)},createFile:function(b,c){return h(this._getService(b),"createFile",arguments)},deleteFile:function(b){return h(this._getService(b),"deleteFile",arguments)},moveFile:function(b,c,m){var g=this._getService(b),a=this._getService(c);if(g===a)return h(g,"moveFile",arguments);var t="/"===b[b.length-1],f=c;"/"!==f[f.length-1]&&(f+="/");if(m)f+=encodeURIComponent(m);else{var n=b;t&&(n=n.substring(0,n.length-1));f+=n.substring(n.lastIndexOf("/")+1)}t&&
"/"!==f[f.length-1]&&(f+="/");return e(g,b,a,f).then(function(){return h(g,"deleteFile",[b])})},copyFile:function(b,c,m){var g=this._getService(b),a=this._getService(c);if(g===a)return h(g,"copyFile",arguments);var t="/"===b[b.length-1],f=c;"/"!==f[f.length-1]&&(f+="/");if(m)f+=encodeURIComponent(m);else{var n=b;t&&(n=n.substring(0,n.length-1));f+=n.substring(n.lastIndexOf("/")+1)}t&&"/"!==f[f.length-1]&&(f+="/");return e(g,b,a,f)},read:function(b,c){return h(this._getService(b),"read",arguments)},
readBlob:function(b){return h(this._getService(b),"readBlob",arguments)},write:function(b,c,e){return h(this._getService(b),"write",arguments)},remoteImport:function(b,c){return h(this._getService(b),"remoteImport",arguments)},remoteExport:function(b,c){return h(this._getService(b),"remoteExport",arguments)},search:function(b){return h(this._getService(b.resource),"search",arguments)}};c.prototype.constructor=c;return{FileClient:c}});y("orion/contentTypes",[],function(){function l(b,a){if("string"!==
typeof b)return null;var c=null,f;f=b.indexOf(".");f++;for(var n=b.substring(f).toLowerCase(),d=0;d<a.length;d++){f=a[d];if(0<=f.filename.indexOf(b)){c=f;break}-1!==f.extension.indexOf(n)&&(c=f)}if(!c)for(f=n.indexOf(".");!c&&0<=f;){f++;n=n.substring(f);for(d=0;d<a.length;d++)if(f=a[d],-1!==f.extension.indexOf(n)){c=f;break}f=n.indexOf(".")}return c}function r(b){return null===b||"undefined"===typeof b?[]:Array.isArray(b)?b:[b]}function p(b){return r(b).map(function(a){return String.prototype.toLowerCase.call(a)})}
function h(b){return{id:b.id,name:b.name,image:b.image,imageClass:b.imageClass,"extends":b["extends"],extension:p(b.extension),filename:r(b.filename)}}function e(b){var a=Object.create(null);b.map(h).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b.id)||(a[b.id]=b)});return a}function c(g){if(g&&g.registerService){this.serviceRegistry=g;for(var a=g.getServiceReferences(k).concat(g.getServiceReferences(m)),c=[],f=0;f<a.length;f++)for(var n=r(a[f].getProperty("contentTypes")),d=0;d<n.length;d++)c.push(n[d]);
this.map=e(c);g.registerService(b,this)}else if(Array.isArray(g))this.serviceRegistry=null,this.map=e(g);else throw Error("Invalid parameter");}var b="orion.core.contentTypeRegistry",k="orion.core.contenttype",m="orion.file.contenttype";c.prototype={getContentTypes:function(){var b=this.getContentTypesMap(),a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(b[c]);return a},getContentTypesMap:function(){return this.map},getFileContentType:function(b){return l(b.Name,this.getContentTypes())},
getFilenameContentType:function(b){return l(b,this.getContentTypes())},getContentType:function(b){return this.map[b]||null},isExtensionOf:function(b,a){b="string"===typeof b?this.getContentType(b):b;a="string"===typeof a?this.getContentType(a):a;if(!b||!a)return!1;if(b.id===a.id)return!0;for(var c=b,f={};c&&(c=this.getContentType(c["extends"]));){if(c.id===a.id)return!0;if(f[c.id])throw Error("Cycle: "+c.id);f[c.id]=!0}return!1},isSomeExtensionOf:function(b,a){for(var c=0;c<a.length;c++)if(this.isExtensionOf(b,
a[c]))return!0;return!1}};return{ContentTypeRegistry:c,isImage:function(b){switch(b&&b.id){case "image/jpeg":case "image/png":case "image/gif":case "image/ico":case "image/tiff":case "image/svg":return!0}return!1},isBinary:function(b){return!b?!1:"application/octet-stream"===b.id||"application/octet-stream"===b["extends"]},getFilenameContentType:l}});y("orion/editor/nls/messages",{root:!0});y("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",
bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",diffAdded:"Diff Added Lines",diffDeleted:"Diff Deleted Lines",diffModified:"Diff Modified Lines",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",
scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",
selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",
enterNoCursor:"Insert Line Delimiter",escape:"Escape",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",
Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",
indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",
addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode: Enter or ESC to exit",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Column ${1}",multiSelections:"${0} selection regions",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",
viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",
viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",
vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",
notFound:"Not found"});y("orion/keyBinding",["orion/util"],function(l){function r(h,e,c,b,k,m){this.type=m||"keydown";this.keyCode="string"===typeof h&&"keydown"===this.type?h.toUpperCase().charCodeAt(0):h;this.mod1=void 0!==e&&null!==e?e:!1;this.mod2=void 0!==c&&null!==c?c:!1;this.mod3=void 0!==b&&null!==b?b:!1;this.mod4=void 0!==k&&null!==k?k:!1}function p(h){this.keys=h}r.prototype={getKeys:function(){return[this]},match:function(h,e){if(void 0!==e){if(0!==e)return!1}else if(h instanceof Array){if(1<
h.length)return!1;h=h[0]}return h.type!==this.type?!1:this.keyCode===h.keyCode||this.keyCode===String.fromCharCode(l.isOpera?h.which:void 0!==h.charCode?h.charCode:h.keyCode)?this.mod1!==(l.isMac?h.metaKey:h.ctrlKey)||"keydown"===this.type&&this.mod2!==h.shiftKey||this.mod3!==h.altKey||l.isMac&&this.mod4!==h.ctrlKey?!1:!0:!1},equals:function(h){return!h||this.keyCode!==h.keyCode||this.mod1!==h.mod1||this.mod2!==h.mod2||this.mod3!==h.mod3||this.mod4!==h.mod4||this.type!==h.type?!1:!0}};p.prototype=
{getKeys:function(){return this.keys.slice(0)},match:function(h,e){var c=this.keys;if(void 0!==e)return e>c.length?!1:c[e].match(h)?e===c.length-1?!0:e+1:!1;h instanceof Array||(h=[h]);if(h.length>c.length)return!1;var b;for(b=0;b<h.length;b++)if(!c[b].match(h[b]))return!1;return b===c.length?!0:b},equals:function(h){if(!h.keys||h.keys.length!==this.keys.length)return!1;for(var e=0;e<h.keys.length;e++)if(!h.keys[e].equals(this.keys[e]))return!1;return!0}};return{KeyBinding:r,KeyStroke:r,KeySequence:p}});
y("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(l,r){function p(e){e&&(this._view=e,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function h(e){p.call(this,e)}p.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(e){for(var c=[],b=this._keyBindings,k=0;k<b.length;k++)b[k].actionID===e&&c.push(b[k].keyBinding);return c},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(e){if("keydown"===
e.type)switch(e.keyCode){case 16:case 17:case 18:case 91:return}for(var c=this._keyBindingIndex,b=this._matchingKeyBindings||this._keyBindings,k=[],m=0;m<b.length;m++){var g=b[m],a=g.keyBinding.match(e,c);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,g.actionID;"number"===typeof a&&k.push(g)}if(0===k.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=k,"noop"},setKeyBinding:function(e,c){for(var b=this._keyBindings,
k=0;k<b.length;k++){var m=b[k];if(m.keyBinding.equals(e)){c?m.actionID=c:m.predefined?m.actionID="noop":b.splice(k,1);return}}c&&b.push({keyBinding:e,actionID:c})},setView:function(e){this._view=e}};h.prototype=new p;h.prototype.createKeyBindings=function(){var e=l.KeyBinding,c=[];c.push({actionID:"lineUp",keyBinding:new e(38),predefined:!0});c.push({actionID:"lineDown",keyBinding:new e(40),predefined:!0});c.push({actionID:"charPrevious",keyBinding:new e(37),predefined:!0});c.push({actionID:"charNext",
keyBinding:new e(39),predefined:!0});r.isMac?(c.push({actionID:"scrollPageUp",keyBinding:new e(33),predefined:!0}),c.push({actionID:"scrollPageDown",keyBinding:new e(34),predefined:!0}),c.push({actionID:"pageUp",keyBinding:new e(33,null,null,!0),predefined:!0}),c.push({actionID:"pageDown",keyBinding:new e(34,null,null,!0),predefined:!0}),c.push({actionID:"lineStart",keyBinding:new e(37,!0),predefined:!0}),c.push({actionID:"lineEnd",keyBinding:new e(39,!0),predefined:!0}),c.push({actionID:"wordPrevious",
keyBinding:new e(37,null,null,!0),predefined:!0}),c.push({actionID:"wordNext",keyBinding:new e(39,null,null,!0),predefined:!0}),c.push({actionID:"scrollTextStart",keyBinding:new e(36),predefined:!0}),c.push({actionID:"scrollTextEnd",keyBinding:new e(35),predefined:!0}),c.push({actionID:"textStart",keyBinding:new e(38,!0),predefined:!0}),c.push({actionID:"textEnd",keyBinding:new e(40,!0),predefined:!0}),c.push({actionID:"scrollPageUp",keyBinding:new e(38,null,null,null,!0),predefined:!0}),c.push({actionID:"scrollPageDown",
keyBinding:new e(40,null,null,null,!0),predefined:!0}),c.push({actionID:"lineStart",keyBinding:new e(37,null,null,null,!0),predefined:!0}),c.push({actionID:"lineEnd",keyBinding:new e(39,null,null,null,!0),predefined:!0}),c.push({actionID:"lineStart",keyBinding:new e(38,null,null,!0),predefined:!0}),c.push({actionID:"lineEnd",keyBinding:new e(40,null,null,!0),predefined:!0})):(c.push({actionID:"pageUp",keyBinding:new e(33),predefined:!0}),c.push({actionID:"pageDown",keyBinding:new e(34),predefined:!0}),
c.push({actionID:"lineStart",keyBinding:new e(36),predefined:!0}),c.push({actionID:"lineEnd",keyBinding:new e(35),predefined:!0}),c.push({actionID:"wordPrevious",keyBinding:new e(37,!0),predefined:!0}),c.push({actionID:"wordNext",keyBinding:new e(39,!0),predefined:!0}),c.push({actionID:"textStart",keyBinding:new e(36,!0),predefined:!0}),c.push({actionID:"textEnd",keyBinding:new e(35,!0),predefined:!0}));r.isFirefox&&r.isLinux&&(c.push({actionID:"lineUp",keyBinding:new e(38,!0),predefined:!0}),c.push({actionID:"lineDown",
keyBinding:new e(40,!0),predefined:!0}));r.isWindows&&(c.push({actionID:"scrollLineUp",keyBinding:new e(38,!0),predefined:!0}),c.push({actionID:"scrollLineDown",keyBinding:new e(40,!0),predefined:!0}));c.push({actionID:"selectLineUp",keyBinding:new e(38,null,!0),predefined:!0});c.push({actionID:"selectLineDown",keyBinding:new e(40,null,!0),predefined:!0});c.push({actionID:"selectCharPrevious",keyBinding:new e(37,null,!0),predefined:!0});c.push({actionID:"selectCharNext",keyBinding:new e(39,null,!0),
predefined:!0});c.push({actionID:"selectPageUp",keyBinding:new e(33,null,!0),predefined:!0});c.push({actionID:"selectPageDown",keyBinding:new e(34,null,!0),predefined:!0});r.isMac?(c.push({actionID:"selectLineStart",keyBinding:new e(37,!0,!0),predefined:!0}),c.push({actionID:"selectLineEnd",keyBinding:new e(39,!0,!0),predefined:!0}),c.push({actionID:"selectWordPrevious",keyBinding:new e(37,null,!0,!0),predefined:!0}),c.push({actionID:"selectWordNext",keyBinding:new e(39,null,!0,!0),predefined:!0}),
c.push({actionID:"selectTextStart",keyBinding:new e(36,null,!0),predefined:!0}),c.push({actionID:"selectTextEnd",keyBinding:new e(35,null,!0),predefined:!0}),c.push({actionID:"selectTextStart",keyBinding:new e(38,!0,!0),predefined:!0}),c.push({actionID:"selectTextEnd",keyBinding:new e(40,!0,!0),predefined:!0}),c.push({actionID:"selectLineStart",keyBinding:new e(37,null,!0,null,!0),predefined:!0}),c.push({actionID:"selectLineEnd",keyBinding:new e(39,null,!0,null,!0),predefined:!0}),c.push({actionID:"selectLineStart",
keyBinding:new e(38,null,!0,!0),predefined:!0}),c.push({actionID:"selectLineEnd",keyBinding:new e(40,null,!0,!0),predefined:!0})):(r.isLinux&&(c.push({actionID:"selectWholeLineUp",keyBinding:new e(38,!0,!0),predefined:!0}),c.push({actionID:"selectWholeLineDown",keyBinding:new e(40,!0,!0),predefined:!0})),c.push({actionID:"selectLineStart",keyBinding:new e(36,null,!0),predefined:!0}),c.push({actionID:"selectLineEnd",keyBinding:new e(35,null,!0),predefined:!0}),c.push({actionID:"selectWordPrevious",
keyBinding:new e(37,!0,!0),predefined:!0}),c.push({actionID:"selectWordNext",keyBinding:new e(39,!0,!0),predefined:!0}),c.push({actionID:"selectTextStart",keyBinding:new e(36,!0,!0),predefined:!0}),c.push({actionID:"selectTextEnd",keyBinding:new e(35,!0,!0),predefined:!0}));c.push({actionID:"undo",keyBinding:new l.KeyBinding("z",!0),predefined:!0});r.isMac?c.push({actionID:"redo",keyBinding:new l.KeyBinding("z",!0,!0),predefined:!0}):c.push({actionID:"redo",keyBinding:new l.KeyBinding("y",!0),predefined:!0});
c.push({actionID:"deletePrevious",keyBinding:new e(8),predefined:!0});c.push({actionID:"deletePrevious",keyBinding:new e(8,null,!0),predefined:!0});c.push({actionID:"deleteNext",keyBinding:new e(46),predefined:!0});c.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0),predefined:!0});c.push({actionID:"deleteWordPrevious",keyBinding:new e(8,!0,!0),predefined:!0});c.push({actionID:"deleteWordNext",keyBinding:new e(46,!0),predefined:!0});c.push({actionID:"tab",keyBinding:new e(9),predefined:!0});
c.push({actionID:"shiftTab",keyBinding:new e(9,null,!0),predefined:!0});c.push({actionID:"enter",keyBinding:new e(13),predefined:!0});c.push({actionID:"enter",keyBinding:new e(13,null,!0),predefined:!0});c.push({actionID:"escape",keyBinding:new e(27),predefined:!0});c.push({actionID:"selectAll",keyBinding:new e("a",!0),predefined:!0});c.push({actionID:"toggleTabMode",keyBinding:new e("m",!0),predefined:!0});r.isMac&&(c.push({actionID:"deleteNext",keyBinding:new e(46,null,!0),predefined:!0}),c.push({actionID:"deleteWordPrevious",
keyBinding:new e(8,null,null,!0),predefined:!0}),c.push({actionID:"deleteWordNext",keyBinding:new e(46,null,null,!0),predefined:!0}));c.push({actionID:"toggleWrapMode",keyBinding:new l.KeyBinding("w",!0,!1,!0)});c.push({actionID:"toggleOverwriteMode",keyBinding:new l.KeyBinding(45)});if(!r.isFirefox){var b=r.isMac&&r.isChrome;c.push({actionID:"noop",keyBinding:new e("u",!b,!1,!1,b),predefined:!0});c.push({actionID:"noop",keyBinding:new e("i",!b,!1,!1,b),predefined:!0});c.push({actionID:"noop",keyBinding:new e("b",
!b,!1,!1,b),predefined:!0})}r.isFirefox&&(c.push({actionID:"copy",keyBinding:new e(45,!0),predefined:!0}),c.push({actionID:"paste",keyBinding:new e(45,null,!0),predefined:!0}),c.push({actionID:"cut",keyBinding:new e(46,null,!0),predefined:!0}));r.isMac&&(c.push({actionID:"lineStart",keyBinding:new e("a",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"lineEnd",keyBinding:new e("e",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"lineUp",keyBinding:new e("p",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"lineDown",
keyBinding:new e("n",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"charPrevious",keyBinding:new e("b",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"charNext",keyBinding:new e("f",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"deletePrevious",keyBinding:new e("h",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"deleteNext",keyBinding:new e("d",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"deleteLineEnd",keyBinding:new e("k",!1,!1,!1,!0),predefined:!0}),r.isFirefox?(c.push({actionID:"scrollPageDown",
keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"deleteLineStart",keyBinding:new e("u",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"deleteWordPrevious",keyBinding:new e("w",!1,!1,!1,!0),predefined:!0})):(c.push({actionID:"pageDown",keyBinding:new e("v",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"centerLine",keyBinding:new e("l",!1,!1,!1,!0),predefined:!0}),c.push({actionID:"enterNoCursor",keyBinding:new e("o",!1,!1,!1,!0),predefined:!0})));return c};return{KeyMode:p,DefaultKeyMode:h}});
y("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(l,r,p){function h(c){c=c||{};this._document=c.document||document}var e={};h.getTheme=function(c){c=c||"default";var b=e[c];b||(b=e[c]=new h);return b};h.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,b){var e=this,m=e._themeClass;e._themeClass=c;this._load(c,b,function(){e.onThemeChanged({type:"ThemeChanged",oldValue:m,newValue:e.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,b){var e=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),m=function(a,b,f,g,d){var c=[];Object.keys(a).forEach(function(s){var v=a[s];"string"===typeof v?c.push("\t"+e(s)+": "+v+";"):m(v,f===s?b:b+(g?" .":".")+s,f,!1,d)});c.length&&(d.push(b+(g?".textview":"")+" {"),d.push.apply(d,c),d.push("}"))},g=[""];m(b.styles,"."+c,b.className,!0,g);return g.join("\n")},_createStyle:function(c,b,e,m){var g=this._document;
c="orion-theme-"+c;var a=g.getElementById(c);if(a){if(m||a.firstChild.data===b)return;a.removeChild(a.firstChild);a.appendChild(g.createTextNode(b))}else m?(a=p.createElement(g,"link"),a.rel="stylesheet",a.type="text/css",a.href=b,a.addEventListener("load",function(){e()})):(a=p.createElement(g,"style"),a.appendChild(g.createTextNode(b))),a.id=c,(g.getElementsByTagName("head")[0]||g.documentElement).appendChild(a);m||e()},_load:function(c,b,e){if(c)if("string"===typeof b)this._createStyle(c,b,e);
else if(b=b.href,".css"!==b.substring(b.length-4)&&(b+=".css"),/^\//.test(b)||/[a-zA-Z0-9]+:\/\//i.test(b)||!l.toUrl)this._createStyle(c,b,e,!0);else{var m=this;l(["text!"+b],function(b){m._createStyle(c,b,e,!1)})}else e()},_capitalRegEx:/[A-Z]/g};r.EventTarget.addMixin(h.prototype);return{TextTheme:h}});y("orion/editor/util",[],function(){return{contains:function(l,r){if(!r)return!1;if(!l.compareDocumentPosition){for(var p=r;p;){if(l===p)return!0;p=p.parentNode}return!1}return l===r||0!==(l.compareDocumentPosition(r)&
16)},getNodeStyle:function(l,r,p){var h;if(l&&(h=l.style[r],!h))if(l.currentStyle){for(h=0;-1!==(h=r.indexOf("-",h));)r=r.substring(0,h)+r.substring(h+1,h+2).toUpperCase()+r.substring(h+2);h=l.currentStyle[r]}else h=(l=l.ownerDocument.defaultView.getComputedStyle(l,null))?l.getPropertyValue(r):null;return h||p},addEventListener:function(l,r,p,h){"function"===typeof l.addEventListener?l.addEventListener(r,p,!0===h):l.attachEvent("on"+r,p)},removeEventListener:function(l,r,p,h){"function"===typeof l.removeEventListener?
l.removeEventListener(r,p,!0===h):l.detachEvent("on"+r,p)},Animation:function(){function l(l){this.options=l}l.prototype.play=function(){var l="number"===typeof this.options.duration?this.options.duration:350,p=this.options.easing||this.defaultEasing,h=this.options.onAnimate||function(){},e=this.options.curve[0],c=this.options.curve[1],b=c-e,k=-1,m,g=this;this.interval=this.options.window.setInterval(function(){k=-1===k?(new Date).getTime():k;var a=((new Date).getTime()-k)/l;1>a?(a=p(a),m=e+a*b,h(m)):
(h(c),g.stop())},"number"===typeof this.options.rate?this.options.rate:20)};l.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};l.prototype.defaultEasing=function(l){return Math.sin(l*(Math.PI/2))};return l}()}});y("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util orion/metrics".split(" "),function(l,r,p,h,e,
c,b,k){function m(a,d,f){if(f){d.className="";f=d.attributes;for(var g=f.length;0<g--;)(!b.isIE||9<=b.isIE||9>b.isIE&&f[g].specified)&&d.removeAttribute(f[g].name)}if(a){a.styleClass&&(d.className=a.styleClass);if(f=a.style)for(var c in f)f.hasOwnProperty(c)&&(d.style[c]=f[c]);if(a=a.attributes)for(var n in a)a.hasOwnProperty(n)&&d.setAttribute(n,a[n])}}function g(a){return a instanceof Array?a.slice(0):a}function a(a,d){if(!a)return d;if(!d)return a;for(var b in d)d.hasOwnProperty(b)&&(a.hasOwnProperty(b)||
(a[b]=d[b]));return a}function t(a,d){if(a===d)return!0;if(a&&!d||!a&&d||a&&a.constructor===String||d&&d.constructor===String)return!1;if(a instanceof Array||d instanceof Array){if(!(a instanceof Array&&d instanceof Array)||a.length!==d.length)return!1;for(var b=0;b<a.length;b++)if(!t(a[b],d[b]))return!1;return!0}if(!(a instanceof Object)||!(d instanceof Object))return!1;for(b in a)if(a.hasOwnProperty(b)&&(!d.hasOwnProperty(b)||!t(a[b],d[b])))return!1;for(b in d)if(!a.hasOwnProperty(b))return!1;return!0}
function f(a,d,b){for(var f=0,g=0,c=0,n=a.length;c<n;){-1!==f&&f<=c&&(f=a.indexOf("\r",c));-1!==g&&g<=c&&(g=a.indexOf("\n",c));var s=c,e;if(-1===g&&-1===f){d(a.substring(c));break}-1!==f&&-1!==g?f+1===g?(e=f,c=g+1):(e=f<g?f:g,c=(f<g?f:g)+1):-1!==f?(e=f,c=f+1):(e=g,c=g+1);d(a.substring(s,e));b?b():c===n&&d("")}}function n(a){var d,b,f,g,c=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;c.getComputedStyle?(a=c.getComputedStyle(a,null),d=a.getPropertyValue("padding-left"),b=a.getPropertyValue("padding-top"),
f=a.getPropertyValue("padding-right"),g=a.getPropertyValue("padding-bottom")):a.currentStyle&&(d=a.currentStyle.paddingLeft,b=a.currentStyle.paddingTop,f=a.currentStyle.paddingRight,g=a.currentStyle.paddingBottom);return{left:parseInt(d,10)||0,top:parseInt(b,10)||0,right:parseInt(f,10)||0,bottom:parseInt(g,10)||0}}function d(a){var d,b,f,g,c=a._trim;if(!c){var c=n(a),s=a.ownerDocument.defaultView||a.ownerDocument.parentWindow;s.getComputedStyle?(g=s.getComputedStyle(a,null),d=g.getPropertyValue("border-left-width"),
b=g.getPropertyValue("border-top-width"),f=g.getPropertyValue("border-right-width"),g=g.getPropertyValue("border-bottom-width")):a.currentStyle&&(d=a.currentStyle.borderLeftWidth,b=a.currentStyle.borderTopWidth,f=a.currentStyle.borderRightWidth,g=a.currentStyle.borderBottomWidth);d=parseInt(d,10)||0;b=parseInt(b,10)||0;f=parseInt(f,10)||0;g=parseInt(g,10)||0;c.left+=d;c.top+=b;c.right+=f;c.bottom+=g;a._trim=c}return c}function u(a,d,b,f){function g(d){if(d.animationName===n){var b=d.target;"function"===
typeof b.__DOMReady&&(a.defaultView||a.parentWindow).setTimeout(function(){b.__DOMReady()},0)}}function c(a,q){for(var d=["","-webkit-","-moz-","-ms-","-o-"],b="",f="body ."+a+" {\n",g=0;g<d.length;g++)b+="@"+d[g]+"keyframes "+q+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",f+=d[g]+"animation-duration: 0.001s;\n"+d[g]+"animation-name: "+q+";\n";return b+(f+"}")}b="_"+b+"DOMReady";d.className=d.className?d.className+" "+b:b;d.__DOMReady=f;f=b+"Style";if(!a.getElementById(f)){var n=b+"Animation";
D(a,"animationstart",g,!1);D(a,"MSAnimationStart",g,!1);D(a,"webkitAnimationStart",g,!1);d=a.createElement("style");d.id=f;f=a.getElementsByTagName("head")[0]||a.documentElement;d.appendChild(a.createTextNode(c(b,n)));f.insertBefore(d,f.firstChild)}}function s(a,d,b){this.start=a;this.end=d;this.caret=b;this._columnX=-1}function v(a){this._view=a;this._divs=[];for(var d=a._clipDiv||a._rootDiv,b=0;3>b;b++){var f=a._createSelectionDiv();d.appendChild(f);this._divs.push(f)}}function A(a){this.left=a.left;
this.top=a.top;this.right=a.right;this.bottom=a.bottom}function F(a,d,b){this.view=a;this.lineIndex=d;this._lineDiv=b}function z(a){this._init(a||{})}var D=c.addEventListener,B=c.removeEventListener,C=c.Animation;s.compare=function(a,d){if(a.length!==d.length)return!1;for(var b=0;b<a.length;b++)if(!a[b].equals(d[b]))return!1;return!0};s.editing=function(a,d){var b;if(d){for(b=a.length-1;0<=b;b--)if(a[b]._editing)return a[b];return a[a.length-1]}for(b=0;b<a.length;b++)if(a[b]._editing)return a[b];
return a[0]};s.convert=function(a){return 1===a.length?a[0]:a};s.contains=function(a,d){return a.some(function(a){return a.contains(d)})};s.merge=function(a){if(1>=a.length)return a;a.sort(function(a,q){return a.start-q.start});for(var d=[],b=a[0],f=1;f<a.length;f++)a[f].start>=b.end||b._editing||a[f]._editing?(d.push(b),b=a[f]):b.end=Math.max(b.end,a[f].end);d.push(b);return d};s.prototype={clone:function(){var a=new s(this.start,this.end,this.caret);a._columnX=this._columnX;a._editing=this._editing;
a._docX=this._docX;return a},contains:function(a){return this.start<=a&&a<this.end?!0:!1},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(a){this.caret?this.start=a:this.end=a;this.start>this.end&&(a=this.start,this.start=this.end,this.end=a,this.caret=!this.caret)},setCaret:function(a){this.end=this.start=a;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},getAnchor:function(){return this.caret?this.end:this.start},getOrientedSelection:function(){return{start:this.getAnchor(),
end:this.getCaret()}},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(a){return this.caret===a.caret&&this.start===a.start&&this.end===a.end&&this._editing===a._editing}};v.prototype={destroy:function(){this._divs&&(this._divs.forEach(function(a){a.parentNode.removeChild(a)}),this._divs=null)},setPrimary:function(a){this.primary=a},update:function(){var a=this._view,
d=this.primary,f=a._hasFocus,a=a._cursorVisible,g=!this.primary&&this._selection&&this._selection.isEmpty(),c;c=g?"textviewSelectionCaret":f?"textviewSelection":"textviewSelectionUnfocused";this._divs[0].style.visibility=g&&a&&f||!g?"visible":"hidden";this._divs[0].style.zIndex=a&&g?"2":"0";this._divs.forEach(function(a){a.className=c;b.isWebkit&&d&&(a.style.background=f?"transparent":"")})},setSelection:function(a){this._selection=a;this.update();var d=this._view,b=d._model,f=b.getLineAtOffset(a.start),
g=b.getLineAtOffset(a.end),c=d._getLineNext();if(c){var n=d._getLinePrevious(),s;f<c.lineIndex?(f=c,s=b.getLineStart(c.lineIndex)):f>n.lineIndex?(f=n,s=b.getLineStart(n.lineIndex)):(f=d._getLineNode(f),s=a.start);g<c.lineIndex?(d=c,b=b.getLineStart(c.lineIndex)):g>n.lineIndex?(d=n,b=b.getLineStart(n.lineIndex)):(d=d._getLineNode(g),b=a.end);this._setDOMSelection(f,s,d,b,a.caret)}},_setDOMSelection:function(a,d,f,g,c){this._setDOMFullSelection(a,d,f,g);if(this.primary){var n=this._view;a=a._line.getNodeOffset(d);
f=f._line.getNodeOffset(g);if(a.node&&f.node)if(g=n._getWindow(),d=n._parent.ownerDocument,g.getSelection){var s=g.getSelection();g=d.createRange();g.setStart(a.node,a.offset);g.setEnd(f.node,f.offset);if(n._hasFocus&&(s.anchorNode!==a.node||s.anchorOffset!==a.offset||s.focusNode!==f.node||s.focusOffset!==f.offset||s.anchorNode!==f.node||s.anchorOffset!==f.offset||s.focusNode!==a.node||s.focusOffset!==a.offset))n._anchorNode=a.node,n._anchorOffset=a.offset,n._focusNode=f.node,n._focusOffset=f.offset,
n._ignoreSelect=!1,0<s.rangeCount&&s.removeAllRanges(),s.addRange(g),n._ignoreSelect=!0;n._cursorDiv&&(g=d.createRange(),c?(g.setStart(a.node,a.offset),g.setEnd(a.node,a.offset)):(g.setStart(f.node,f.offset),g.setEnd(f.node,f.offset)),c=g.getClientRects()[0],a=n._cursorDiv.parentNode,f=a.getBoundingClientRect(),c&&f&&(n._cursorDiv.style.top=c.top-f.top+a.scrollTop+"px",n._cursorDiv.style.left=c.left-f.left+a.scrollLeft+"px"))}else d.selection&&n._hasFocus&&(c=d.body,g=b.createElement(d,"div"),c.appendChild(g),
c.removeChild(g),g=c.createTextRange(),g.moveToElementText(a.node.parentNode),g.moveStart("character",a.offset),c=c.createTextRange(),c.moveToElementText(f.node.parentNode),c.moveStart("character",f.offset),g.setEndPoint("EndToStart",c),n._ignoreSelect=!1,g.select(),n._ignoreSelect=!0)}},_setDOMFullSelection:function(a,d,f,g){this._divs.forEach(function(a){a.style.width=a.style.height="0px"});var c=this._view;if(c._fullSelection&&!b.isIOS&&!(a===f&&d===g&&this.primary)){var n=c._getViewPadding(),
s=c._clientDiv.getBoundingClientRect(),e=c._viewDiv.getBoundingClientRect(),u=e.left+n.left,m=s.right,n=e.top+n.top,t=s.bottom,e=s=0;c._clipDiv?(e=c._clipDiv.getBoundingClientRect(),s=e.left-c._clipDiv.scrollLeft):(e=c._rootDiv.getBoundingClientRect(),s=e.left);e=e.top;c._ignoreDOMSelection=!0;var v=new F(c,a.lineIndex,a),k=v.getBoundingClientRect(d,!1),h=k.left;a===f&&d===g?(d=v,g=k):(d=new F(c,f.lineIndex,f),g=d.getBoundingClientRect(g,!1));d=g.left;c._ignoreDOMSelection=!1;var v=this._divs[0],
h=Math.min(m,Math.max(u,h)),A=Math.min(t,Math.max(n,k.top)),l=m,c=Math.min(t,Math.max(n,k.bottom));v.style.left=h-s+"px";v.style.top=A-e+"px";v.style.width=Math.max(0,l-h)+"px";v.style.height=Math.max(0,c-A)+"px";a.lineIndex===f.lineIndex?(l=Math.min(d,m),v.style.width=Math.max(this.primary?0:1,l-h)+"px"):(k=Math.min(t,Math.max(n,g.top)),d=Math.min(m,Math.max(u,d)),n=Math.min(t,Math.max(n,g.bottom)),t=this._divs[2],t.style.left=u-s+"px",t.style.top=k-e+"px",t.style.width=Math.max(0,d-u)+"px",t.style.height=
Math.max(0,n-k)+"px",1<Math.abs(a.lineIndex-f.lineIndex)&&(a=this._divs[1],a.style.left=u-s+"px",a.style.top=c-e+"px",a.style.width=Math.max(0,m-u)+"px",a.style.height=Math.max(0,k-c)+"px"))}}};A.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};F.prototype={create:function(a,d){if(!this._lineDiv){var b=this._lineDiv=this._createLine(a,d,this.lineIndex);b._line=this;return b}},_createLine:function(a,d,f){var g=this.view,c=g._model,
n=c.getLine(f),s=c.getLineStart(f),e={type:"LineStyle",textView:g,lineIndex:f,lineText:n,lineStart:s};g.onLineStyle(e);var u=a.ownerDocument,c=d||b.createElement(u,"div");if(!d||!t(d.viewStyle,e.style))m(e.style,c,d),d&&(d._trim=null),c.viewStyle=e.style,c.setAttribute("role","presentation");c.lineIndex=f;if(d&&c.viewLineText===n&&t(e.ranges,c.viewRanges))return c;c.viewRanges=e.ranges;c.viewLineText=n;f=[];this._createRanges(e.ranges,n,0,n.length,s,{tabOffset:0,ranges:f});e=" ";!g._fullSelection&&
9>b.isIE&&(e="\ufeff");g={text:e,style:g._metrics.largestFontStyle,ignoreChars:1};0===f.length||!f[f.length-1].style||"div"!==f[f.length-1].style.tagName?f.push(g):f.splice(f.length-1,0,g);var v,k,h,A=e=0;if(b.isFirefox&&2E3<n.length){d&&(c.innerHTML="",d.lineWidth=void 0);d=u.createDocumentFragment();for(n=0;n<f.length;n++)g=f[n],s=g.text,v=g.style,v=this._createSpan(c,s,v,g.ignoreChars),d.appendChild(v);c.appendChild(d)}else{var l,F;if(d){if(k=d.modelChangedEvent)0===k.removedLineCount&&0===k.addedLineCount?
(F=k.start-s,l=k.addedCharCount-k.removedCharCount):F=-1,d.modelChangedEvent=void 0;k=d.firstChild}for(n=0;n<f.length;n++){g=f[n];s=g.text;e+=s.length;v=g.style;if(k)if(h=k.firstChild.data,u=k.viewStyle,h===s&&t(v,u)){A+=h.length;k._rectsCache=void 0;v=k=k.nextSibling;continue}else for(;k;){if(-1!==F){u=e;u>=F&&(u-=l);h=(h=k.firstChild.data)?h.length:0;if(A+h>u)break;A+=h}u=k.nextSibling;c.removeChild(k);k=u}v=this._createSpan(c,s,v,g.ignoreChars);k?c.insertBefore(v,k):c.appendChild(v);d&&(d.lineWidth=
void 0)}if(d)for(l=v?v.nextSibling:null;l;)u=l.nextSibling,d.removeChild(l),l=u}c.parentNode||a.appendChild(c);return c},_createRanges:function(a,d,b,f,g,c){if(!(b>f)){if(a)for(var n=0;n<a.length;n++){var s=a[n];if(!(s.end<g+b)){var e=Math.max(g+b,s.start)-g;if(e>f)break;var u=Math.min(g+f,s.end)-g;if(e<=u){e=Math.max(b,e);u=Math.min(f,u);b<e&&this._createRange(d,b,e,null,c);if(!s.style||!s.style.unmergeable)for(;n+1<a.length&&a[n+1].start-g===u&&t(s.style,a[n+1].style);)s=a[n+1],u=Math.min(g+f,s.end)-
g,n++;this._createRange(d,e,u,s.style,c);b=u}}}b<f&&this._createRange(d,b,f,null,c)}},_createRange:function(a,d,b,f,g){if(!(d>b)){var c=this.view._customTabSize;if(c&&8!==c)for(var n=a.indexOf("\t",d);-1!==n&&n<b;){d<n&&(d={text:a.substring(d,n),style:f},g.ranges.push(d),g.tabOffset+=d.text.length);d=c-g.tabOffset%c;if(0<d){for(var s="\u00a0",e=1;e<d;e++)s+=" ";d={text:s,style:f,ignoreChars:d-1};g.ranges.push(d);g.tabOffset+=d.text.length}d=n+1;if(d===b)return;n=a.indexOf("\t",d)}d<=b&&(d={text:a.substring(d,
b),style:f},g.ranges.push(d),g.tabOffset+=d.text.length)}},_createSpan:function(a,d,f,g){var c=this.view,n="span";f&&f.tagName&&(n=f.tagName.toLowerCase());var s="a"===n;s&&(this.hasLink=!0);s&&!c._linksVisible&&(n="span");s=a.ownerDocument;a=b.createElement(a.ownerDocument,n);a.appendChild(s.createTextNode(f&&f.text?f.text:d));f&&f.html?(a.innerHTML=f.html,a.ignore=!0):f&&f.node&&(a.appendChild(f.node),a.ignore=!0);m(f,a);if("a"===n){var e=c._getWindow();D(a,"click",function(a){return c._handleLinkClick(a?
a:e.event)},!1)}a.viewStyle=f;g&&(a.ignoreChars=g);return a},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(a,d){var f=this._ensureCreated(),g=this.view;if(void 0===a)return this._getLineBoundingClientRect(f,!0);var c=g._model,n=f.ownerDocument,s=this.lineIndex,e=null;if(a<c.getLineEnd(s)){var u=c.getLineStart(s);this.forEach(function(d){var c=d.firstChild,x=this._nodeLength(d);if(u+x>a){var s=a-
u;if(1===c.length)e=new A(d.getBoundingClientRect());else if(g._isRangeRects)x=n.createRange(),x.setStart(c,s),x.setEnd(c,s+1),e=new A(x.getBoundingClientRect());else if(b.isIE)x=n.body.createTextRange(),x.moveToElementText(d),x.collapse(),(c=0===s&&8===b.isIE)&&(s=1),x.moveEnd("character",s+1),x.moveStart("character",s),e=new A(x.getBoundingClientRect()),c&&(e.left=d.getClientRects()[0].left);else{var m=c.data;d.removeChild(c);d.appendChild(n.createTextNode(m.substring(0,s)));var t=b.createElement(n,
"span");t.appendChild(n.createTextNode(m.substring(s,s+1)));d.appendChild(t);d.appendChild(n.createTextNode(m.substring(s+1)));e=new A(t.getBoundingClientRect());d.innerHTML="";d.appendChild(c);this._createdDiv||(d=g._getSelections()[0],(u<=d.start&&d.start<u+x||u<=d.end&&d.end<u+x)&&g._updateDOMSelection())}11>b.isIE&&(s=f.ownerDocument.defaultView||f.ownerDocument.parentWindow,d=s.screen.logicalXDPI/s.screen.deviceXDPI,s=s.screen.logicalYDPI/s.screen.deviceYDPI,e.left*=d,e.right*=d,e.top*=s,e.bottom*=
s);return!1}u+=x;return!0})}c=this.getBoundingClientRect();e||(g._wrapMode?(s=this.getClientRects(),e=s[s.length-1],e.left=e.right,e.left+=c.left,e.top+=c.top,e.right+=c.left,e.bottom+=c.top):(e=new A(c),e.left=e.right));if(d||void 0===d)e.left-=c.left,e.top-=c.top,e.right-=c.left,e.bottom-=c.top;return e},forEach:function(a){for(var d=this._ensureCreated().firstChild;d;){var b=d.nextSibling;if(!d.ignore&&!a.call(this,d))break;d=b}},_getClientRects:function(a,d){var b,f,g,c;if(!a._rectsCache){b=a.getClientRects();
f=Array(b.length);for(c=0;c<b.length;c++)g=f[c]=new A(b[c]),g.left-=d.left,g.top-=d.top,g.right-=d.left,g.bottom-=d.top;a._rectsCache=f}b=a._rectsCache;f=[b.length];for(c=0;c<b.length;c++)f[c]=new A(b[c]);return f},getClientRects:function(a){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var d=[],b=this._ensureCreated().getBoundingClientRect();this.forEach(function(a){a=this._getClientRects(a,b);for(var q=0;q<a.length;q++){var f=a[q],g,c;if(f.top!==f.bottom){var n=f.top+(f.bottom-f.top)/
2;for(g=0;g<d.length&&!(c=d[g],c.top<=n&&n<c.bottom);g++);g===d.length?d.push(f):(f.left<c.left&&(c.left=f.left),f.top<c.top&&(c.top=f.top),f.right>c.right&&(c.right=f.right),f.bottom>c.bottom&&(c.bottom=f.bottom))}}return!0});return void 0!==a?d[a]:d},_getLineBoundingClientRect:function(a,b){var f=new A(a.getBoundingClientRect());if(!this.view._wrapMode){f.right=f.left;for(var g=a.lastChild;g&&g.ignoreChars===g.firstChild.length;)g=g.previousSibling;g&&(g=g.getBoundingClientRect(),f.right=g.right+
d(a).right)}b&&(g=d(a),f.left+=g.left,f.right-=g.right);return f},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(a){if(!this.view._wrapMode)return 0;var d=this.getClientRects();a=this.getBoundingClientRect(a);a=a.top+(a.bottom-a.top)/2;for(var b=0;b<d.length;b++)if(d[b].top<=a&&a<d[b].bottom)return b;return d.length-1},getLineStart:function(a){if(!this.view._wrapMode||0===a)return this.view._model.getLineStart(this.lineIndex);var d=this.getClientRects();
return this.getOffset(d[a].left+1,d[a].top+1)},_nodeLength:function(a){if(!a||a.ignore)return 0;var d=a.firstChild.length;a.ignoreChars&&(d-=a.ignoreChars);return d},getModelOffset:function(a,d){if(!a)return 0;var b=0;this.forEach(function(f){var g=f.firstChild;if(g===a)return f.ignoreChars&&(b-=f.ignoreChars),b+=d,!1;f.ignoreChars&&(b-=f.ignoreChars);b+=g.data.length;return!0});return Math.max(0,b)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(a){var d=0,b,f,g=this.view._model,
c=g.getLineStart(this.lineIndex),n=a-c,s=g.getLineEnd(this.lineIndex)-c;this.forEach(function(a){var q=a.firstChild,g=this._nodeLength(a);if(g+d>n||d+g>=s)return b=q,f=n-d,a.ignoreChars&&(0<g&&f===g)&&(f+=a.ignoreChars),!1;d+=g;return!0});return{node:b,offset:f}},getText:function(a){var d="",b=0;this.forEach(function(f){var g;if(f.ignoreChars){g=f.lastChild;for(var c=0,n=[],s=-1;g;){var e=g.data;if(e)for(var u=e.length-1;0<=u;u--){var m=e.substring(u,u+1);c<f.ignoreChars&&(" "===m||"\ufeff"===m)?
c++:n.push("\u00a0"===m?"\t":m)}a===g&&(s=n.length);g=g.previousSibling}n=n.reverse().join("");-1!==s&&(b=d.length+n.length-s);d+=n}else for(g=f.firstChild;g;)a===g&&(b=d.length),d+=g.data,g=g.nextSibling;return!0});return{text:d,offset:b}},getOffset:function(a,d){function f(g,u,w){var k=g.firstChild,h=v._nodeLength(g),A=m.ownerDocument,l=A.defaultView||A.parentWindow,E=11>b.isIE?l.screen.logicalXDPI/l.screen.deviceXDPI:1,F=11>b.isIE?l.screen.logicalYDPI/l.screen.deviceYDPI:1,z,p,r,l=w.left+t.left,
D,B;if(b.isIE||c._isRangeRects){for(var A=c._isRangeRects?A.createRange():A.body.createTextRange(),C=h,G=-1;1<C-G;){var L=Math.floor((C+G)/2);w=G+1;z=L===h-1&&g.ignoreChars?k.length:L+1;D=0===w&&8===b.isIE;c._isRangeRects?(A.setStart(k,w),A.setEnd(k,z)):(D&&(w=1),A.moveToElementText(g),A.move("character",w),A.moveEnd("character",z-w));B=A.getClientRects();for(var T=!1,W=0;W<B.length;W++)if(w=B[W],z=(D?l:w.left)*E-t.left,r=w.right*E-t.left,p=w.top*F-t.top,w=w.bottom*F-t.top,z<=a&&a<r&&(!c._wrapMode||
p<=d&&d<=w)){T=!0;break}T?C=L:G=L}u+=C;w=C;z=C===h-1&&g.ignoreChars?k.length:Math.min(C+1,k.length);c._isRangeRects?(A.setStart(k,w),A.setEnd(k,z)):(A.moveToElementText(g),A.move("character",w),A.moveEnd("character",z-w));B=A.getClientRects();h=!1;0<B.length&&(w=B[0],z=(D?l:w.left)*E-t.left,r=w.right*E-t.left,h=a>z+(r-z)/2);g=u-e;k=n.getLine(s);E=k.charCodeAt(g);55296<=E&&56319>=E&&h?g<k.length&&(E=k.charCodeAt(g+1),56320<=E&&57343>=E&&(u+=1)):56320<=E&&(57343>=E&&!h)&&0<g&&(E=k.charCodeAt(g-1),55296<=
E&&56319>=E&&(u-=1));h&&u++}else{E=[];for(D=0;D<h;D++)E.push("\x3cspan\x3e"),D===h-1?E.push(k.data.substring(D)):E.push(k.data.substring(D,D+1)),E.push("\x3c/span\x3e");g.innerHTML=E.join("");for(E=g.firstChild;E;){w=E.getBoundingClientRect();z=w.left-t.left;r=w.right-t.left;if(z<=a&&a<r){a>z+(r-z)/2&&u++;break}u++;E=E.nextSibling}v._createdDiv||(g.innerHTML="",g.appendChild(k),g=c._getSelections()[0],(u<=g.start&&g.start<u+h||u<=g.end&&g.end<u+h)&&c._updateDOMSelection())}return u}function g(b){if(b.ignore)return null;
b=v._getClientRects(b,t);for(var f=0;f<b.length;f++){var n=b[f];if(n.left<=a&&a<n.right&&(!c._wrapMode||n.top<=d&&d<=n.bottom))return n}return null}var c=this.view,n=c._model,s=this.lineIndex,e=n.getLineStart(s),u=n.getLineEnd(s);if(e===u)return e;var m=this._ensureCreated(),t=this.getBoundingClientRect(),v=this,k,h;if(c._wrapMode){k=this.getClientRects();d<k[0].top&&(d=k[0].top);for(var A=0;A<k.length&&!(h=k[A],h.top<=d&&d<h.bottom);A++);a<h.left&&(a=h.left);a>h.right&&(a=h.right-1)}else 0>a&&(a=
0),a>t.right-t.left&&(a=t.right-t.left);var l,F;if(this._lastHitChild&&this._lastHitChild.parentNode){if(l=this._lastHitOffset,F=this._lastHitChild,h=g(F),!h){k=l;for(var A=l+this._nodeLength(F),z=F.previousSibling,p=F.nextSibling;z||p;){if(z){k-=this._nodeLength(z);if(h=g(z)){F=z;l=k;break}z=z.previousSibling}if(p){if(h=g(p)){F=p;l=A;break}A+=this._nodeLength(p);p=p.nextSibling}}}}else l=e,this.forEach(function(a){F=a;if(h=g(F))return!1;l+=this._nodeLength(F);return!0});F&&h&&(this._lastHitChild=
F,this._lastHitOffset=l,l=f(F,l,h));return Math.min(u,Math.max(e,l))},getNextOffset:function(a,d){if("line"===d.unit){var f=this.view._model,g=f.getLineAtOffset(a);if(0<d.count)return d.count--,f.getLineEnd(g);d.count++;return f.getLineStart(g)}return"wordend"===d.unit||"wordWS"===d.unit||"wordendWS"===d.unit?this._getNextOffset_W3C(a,d):b.isIE?this._getNextOffset_IE(a,d):this._getNextOffset_W3C(a,d)},_getNextOffset_W3C:function(a,d){function b(a){return 33<=a&&47>=a||58<=a&&64>=a||91<=a&&94>=a||
96===a||123<=a&&126>=a}function f(a){return 32===a||9===a}var g=this.view._model,c=g.getLineAtOffset(a),n=g.getLine(c),s=g.getLineStart(c),g=g.getLineEnd(c),c=n.length,e=a-s,u,m=0>d.count?-1:1;if("word"===d.unit||"wordend"===d.unit||"wordWS"===d.unit||"wordendWS"===d.unit)for(var t,v,k;0!==d.count;){if(0<d.count){if(e===c)return g;u=n.charCodeAt(e);t=b(u);v=!t&&!f(u);for(e++;e<c;){u=n.charCodeAt(e);if("wordWS"!==d.unit&&"wordendWS"!==d.unit){k=b(u);if("wordend"===d.unit){if(!k&&t)break}else if(k&&
!t)break;u=!k&&!f(u)}else u=!f(u);if("wordend"===d.unit||"wordendWS"===d.unit){if(!u&&v)break}else if(u&&!v)break;v=u;t=k;e++}}else{if(0===e)return s;e--;u=n.charCodeAt(e);t=b(u);for(v=!t&&!f(u);0<e;){u=n.charCodeAt(e-1);if("wordWS"!==d.unit&&"wordendWS"!==d.unit){k=b(u);if("wordend"===d.unit){if(k&&!t)break}else if(!k&&t)break;u=!k&&!f(u)}else u=!f(u);if("wordend"===d.unit||"wordendWS"===d.unit){if(u&&!v)break}else if(!u&&v)break;v=u;t=k;e--}}d.count-=m}else for(;0!==d.count&&0<=e+m&&e+m<=c;)e+=
m,u=n.charCodeAt(e),56320<=u&&57343>=u&&0<e&&(u=n.charCodeAt(e-1),55296<=u&&56319>=u&&(e+=m)),d.count-=m;return s+e},_getNextOffset_IE:function(a,d){var b=this._ensureCreated(),f=this.view._model,g=this.lineIndex,c=0,n;n=f.getLineStart(g);var e=f.getLine(g),s=f.getLineStart(g),u=b.ownerDocument,m=0>d.count?-1:1;if(a===f.getLineEnd(g)){for(b=b.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(!b)return n;c=u.body.createTextRange();c.moveToElementText(b);n=c.text.length;c.moveEnd(d.unit,
m);c=a+c.text.length-n}else if(a===n&&0>d.count)c=n;else for(b=b.firstChild;b;){f=this._nodeLength(b);if(n+f>a){c=u.body.createTextRange();if(a===n&&0>d.count){for(n=b.previousSibling;n&&(!n.firstChild||!n.firstChild.length);)n=n.previousSibling;c.moveToElementText(n?n:b.previousSibling)}else c.moveToElementText(b),c.collapse(),c.moveEnd("character",a-n);n=c.text.length;c.moveEnd(d.unit,m);c=a+c.text.length-n;break}n=f+n;b=b.nextSibling}n=c-s;c=e.charCodeAt(n);56320<=c&&57343>=c&&0<n&&(c=e.charCodeAt(n-
1),55296<=c&&56319>=c&&(n+=m));d.count-=m;return n+s},updateLinks:function(){var a=this._ensureCreated();if(this.hasLink){var d=this;this.forEach(function(b){var f=b.viewStyle;f&&(f.tagName&&"a"===f.tagName.toLowerCase())&&a.replaceChild(d._createSpan(a,b.firstChild.data,f),b);return!0})}},destroy:function(){var a=this._createdDiv;a&&(a.parentNode.removeChild(a),this._createdDiv=null)}};z.prototype={addKeyMode:function(a,d){var b=this._keyModes;void 0!==d?b.splice(d,0,a):b.push(a);a._modeAdded&&a._modeAdded()},
addRuler:function(a,d){var b=this._rulers;if(void 0!==d){var f,g;for(g=f=0;f<b.length&&g<d;f++)a.getLocation()===b[f].getLocation()&&g++;b.splice(g,0,a);d=g}else b.push(a);this._createRuler(a,d);a.setView(this);this._update()},computeSize:function(){var a=0,d=0,f=this._model,g=this._clientDiv;if(!g)return{width:a,height:d};var c=g.style.width;b.isWebkit&&(g.style.width="0x7fffffffpx");for(var f=f.getLineCount(),n=0;n<f;n++){var e=this._getLine(n),s=e.getBoundingClientRect(),a=Math.max(a,s.right-s.left),
d=d+(s.bottom-s.top);e.destroy()}b.isWebkit&&(g.style.width=c);g=this._getViewPadding();a+=g.right+g.left+this._metrics.scrollWidth;d+=g.bottom+g.top+this._metrics.scrollWidth;return{width:a,height:d}},convert:function(a,d,b){if(!this._clientDiv)return a;var f=this._getScroll(),g=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();"document"===d&&(void 0!==a.x&&(a.x+=-f.x+c.left+g.left),void 0!==a.y&&(a.y+=-f.y+c.top+g.top));"document"===b&&(void 0!==a.x&&(a.x+=f.x-c.left-g.left),void 0!==
a.y&&(a.y+=f.y-c.top-g.top));return a},destroy:function(){for(var a=0;a<this._rulers.length;a++)this._rulers[a].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},
getActionDescription:function(a){if(a=this._actions[a])return a.actionDescription},getActions:function(a){var d=[],b=this._actions,f;for(f in b)b.hasOwnProperty(f)&&(a||!b[f].defaultHandler)&&d.push(f);return d},getBottomIndex:function(a){return!this._clientDiv?0:this._getBottomIndex(a)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,
y:0,width:0,height:0};var a=this._getScroll();return{x:a.x,y:a.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(a){for(var d=[],b=this._keyModes,f=0;f<b.length;f++)d=d.concat(b[f].getKeyBindings(a));return d},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(a){return!this._clientDiv?0:this._getLineHeight(a)},getLineIndex:function(a){return!this._clientDiv?
0:this._getLineIndex(a)},isValidTextPosition:function(a,d){if(!this._clientDiv)return!1;var b=this._getLineIndex(d,!0);if(0>b)return!1;var b=this._getLine(b),f=this.getOffsetAtLocation(a,d),f=b.getBoundingClientRect(f);b.destroy();return a>f.right?!1:!0},getLinePixel:function(a){return!this._clientDiv?0:this._getLinePixel(a)},getLocationAtOffset:function(a){if(!this._clientDiv)return{x:0,y:0};var d=this._model;a=Math.min(Math.max(0,a),d.getCharCount());var d=d.getLineAtOffset(a),b=this._getLine(d);
a=b.getBoundingClientRect(a);b.destroy();b=a.left;d=this._getLinePixel(d)+a.top;return{x:b,y:d}},getNextOffset:function(a,d){var b=new s(a,a,!1);this._doMove(d,b);return b.getCaret()},getOptions:function(){var a;if(0===arguments.length)a=this._defaultOptions();else if(1===arguments.length){if(a=arguments[0],"string"===typeof a)return g(this["_"+a])}else{a={};for(var d in arguments)arguments.hasOwnProperty(d)&&(a[arguments[d]]=void 0)}for(var b in a)a.hasOwnProperty(b)&&(a[b]=g(this["_"+b]));return a},
getModel:function(){return this._model},getOffsetAtLocation:function(a,d){if(!this._clientDiv)return 0;var b=this._getLineIndex(d),f=this._getLine(b),b=f.getOffset(a,d-this._getLinePixel(b));f.destroy();return b},getLineAtOffset:function(a){return this.getModel().getLineAtOffset(a)},getLineStart:function(a){return this.getModel().getLineStart(a)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){return this._getSelection()},getSelections:function(){return this._getSelections()},
getSelectionText:function(a){var d=[],b=this;this._getSelections().forEach(function(a){a.isEmpty()||d.push(b._getBaseText(a.start,a.end))});return d.join(void 0!==a?a:this._model.getLineDelimiter())},getText:function(a,d){return this._model.getText(a,d)},getTopIndex:function(a){return!this._clientDiv?0:this._getTopIndex(a)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(a,d,b){if(this._clientDiv){if(a=this._actions[a]){a.actionDescription&&a.actionDescription.id&&
k.logEvent("editor","action",a.actionDescription.id);if(!d&&a.handler&&a.handler(b))return!0;if(a.defaultHandler)return"boolean"===typeof a.defaultHandler(b)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(a){return this.dispatchEvent(a)},onDragStart:function(a){return this.dispatchEvent(a)},onDrag:function(a){return this.dispatchEvent(a)},onDragEnd:function(a){return this.dispatchEvent(a)},onDragEnter:function(a){return this.dispatchEvent(a)},onDragOver:function(a){return this.dispatchEvent(a)},
onDragLeave:function(a){return this.dispatchEvent(a)},onDrop:function(a){return this.dispatchEvent(a)},onDestroy:function(a){return this.dispatchEvent(a)},onSaving:function(a){return this.dispatchEvent(a)},onInputChanged:function(a){return this.dispatchEvent(a)},onLineStyle:function(a){return this.dispatchEvent(a)},onKeyDown:function(a){return this.dispatchEvent(a)},onKeyPress:function(a){return this.dispatchEvent(a)},onKeyUp:function(a){return this.dispatchEvent(a)},onModelChanged:function(a){return this.dispatchEvent(a)},
onModelChanging:function(a){return this.dispatchEvent(a)},onModify:function(a){return this.dispatchEvent(a)},onMouseDown:function(a){return this.dispatchEvent(a)},onMouseUp:function(a){return this.dispatchEvent(a)},onMouseMove:function(a){return this.dispatchEvent(a)},onMouseOver:function(a){return this.dispatchEvent(a)},onMouseOut:function(a){return this.dispatchEvent(a)},onTouchStart:function(a){return this.dispatchEvent(a)},onTouchMove:function(a){return this.dispatchEvent(a)},onTouchEnd:function(a){return this.dispatchEvent(a)},
onOptions:function(a){return this.dispatchEvent(a)},onSelection:function(a){return this.dispatchEvent(a)},onScroll:function(a){return this.dispatchEvent(a)},onVerify:function(a){return this.dispatchEvent(a)},onFocus:function(a){return this.dispatchEvent(a)},onBlur:function(a){return this.dispatchEvent(a)},redraw:function(){if(!(0<this._redrawCount)){var a=this._model.getLineCount();this.redrawRulers(0,a);this.redrawLines(0,a)}},redrawRulers:function(a,d){if(!(0<this._redrawCount))for(var b=this.getRulers(),
f=0;f<b.length;f++)this.redrawLines(a,d,b[f])},redrawLines:function(a,d,b){if(!(0<this._redrawCount)&&(void 0===a&&(a=0),void 0===d&&(d=this._model.getLineCount()),a!==d)){var f=this._clientDiv;if(f){if(b)for(f=this._getRulerParent(b).firstChild;f&&f._ruler!==b;)f=f.nextSibling;b?f.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(a,d);if(!b||"page"===b.getOverview())for(f=f.firstChild;f;){var g=f.lineIndex;a<=g&&g<d&&(f.lineChanged=!0);f=f.nextSibling}!b&&(!this._wrapMode&&a<=this._maxLineIndex&&
this._maxLineIndex<d)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:a,endLine:d,ruler:b});this._queueUpdate()}}},redrawRange:function(a,d){if(!(0<this._redrawCount)){var b=this._model;void 0===a&&(a=0);void 0===d&&(d=b.getCharCount());var f=b.getLineAtOffset(a),b=b.getLineAtOffset(Math.max(a,d-1))+1;this.redrawLines(f,b)}},removeKeyMode:function(a){for(var d=this._keyModes,b=0;b<d.length;b++)if(d[b]===a){d.splice(b,
1);break}a._modeRemoved&&a._modeRemoved()},removeRuler:function(a){for(var d=this._rulers,b=0;b<d.length;b++)if(d[b]===a){d.splice(b,1);a.setView(null);this._destroyRuler(a);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(a,d,b){if(a){var f=this._actions,g=f[a];g||(g=f[a]={});g.handler=d;void 0!==b&&(g.actionDescription=b)}},setKeyBinding:function(a,d){this._keyModes[0].setKeyBinding(a,d)},setCaretOffset:function(a,d,b){var f=this._model.getCharCount();
a=Math.max(0,Math.min(a,f));a=new s(a,a,!1);this._setSelection(a,void 0===d||d,!0,b)},setHorizontalPixel:function(a){this._clientDiv&&(a=Math.max(0,a),this._scrollView(a-this._getScroll().x,0))},setRedraw:function(a){a?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(a){if(a!==this._model){a=a||new r.TextModel;this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var d=
this._model.getLineCount(),b=this._model.getCharCount(),f=a.getLineCount(),g=a.getCharCount(),c={type:"ModelChanging",text:a.getText(),start:0,removedCharCount:b,addedCharCount:g,removedLineCount:d,addedLineCount:f};this.onModelChanging(c);this._model=a;c={type:"ModelChanged",start:0,removedCharCount:b,addedCharCount:g,removedLineCount:d,addedLineCount:f};this.onModelChanged(c);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);
this._reset();this._update()}},setOptions:function(a){var d=this._defaultOptions(),b;for(b in a)if(a.hasOwnProperty(b)){var f=a[b];if(!t(this["_"+b],f)){var c=d[b]?d[b].update:null;c?c.call(this,f):this["_"+b]=g(f)}}this.onOptions({type:"Options",options:a})},setSelection:function(a,d,b,f){var g=a>d;if(g){var c=a;a=d;d=c}c=this._model.getCharCount();a=Math.max(0,Math.min(a,c));d=Math.max(0,Math.min(d,c));a=new s(a,d,g);this._setSelection(a,void 0===b||b,!0,f)},setSelections:function(a,d,b){a=this._rangesToSelections(a);
this._setSelection(a,void 0===d||d,!0,b)},setText:function(a,d,f,g,c){var n="string"===typeof a,e=void 0===d&&void 0===f&&n;n?(void 0===d&&(d=0),void 0===f&&(f=this._model.getCharCount()),a={text:a,selection:[new s(d,f,!1)]}):a.selection=this._rangesToSelections(a.selection);a._code=!0;e&&(this._variableLineHeight=!1);this._modifyContent(a,!e,void 0===g||g,c);e&&13>b.isFirefox&&this._fixCaret()},setTopIndex:function(a,d){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,a))-
this._getScroll().y,d)},setTopPixel:function(a,d){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,a)-this._getScroll().y,d)},showSelection:function(a,d){return this._showCaret(a?!1:!0,d,a)},update:function(a,d){this._clientDiv&&((a||this._metrics.invalid)&&this._updateStyle(),void 0===d||d?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){13>b.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=
(this._overlayDiv||this._clientDiv).draggable=!0);var d=this._overlayDiv||this._clientDiv;9>b.isIE&&(d=this._viewDiv);for(var f=a.target?a.target:a.srcElement;f;){if(d===f||f.className&&-1!==f.className.indexOf("textViewFind"))return;f=f.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var g=this;this._getWindow().setTimeout(function(){g._clientDiv.focus()},0)}}},_handleRootMouseUp:function(a){this._ignoreEvent(a)||(13>b.isFirefox&&1===
a.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),b.isFirefox&&1===a.which&&(this._fixCaret(),this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>b.isIE&&!this._getSelections()[0].isEmpty()){var a=this._rootDiv,d=b.createElement(a.ownerDocument,"div");a.appendChild(d);a.removeChild(d)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._domSelection)if(this._domSelection.forEach(function(a){a.update()}),
a=this._getWindow(),d=this._parent.ownerDocument,a.getSelection){d=a.getSelection();for(a=d.anchorNode;a;){if(a===this._clientDiv){0<d.rangeCount&&d.removeAllRanges();break}a=a.parentNode}}else if(d.selection){this._ignoreSelect=!1;for(a=d.selection.createRange().parentElement();a;){if(a===this._clientDiv){d.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleCompositionStart:function(a){this._ignoreEvent(a)||(this._startIME(),this._mutationObserver&&
(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(a){this._ignoreEvent(a)||this._commitIME(a.data)},_handleContextMenu:function(a){if(!this._ignoreEvent(a)){b.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var d=!1;this.isListening("ContextMenu")?(d=this._createMouseEvent("ContextMenu",a),d.screenX=a.screenX,d.screenY=a.screenY,this.onContextMenu(d),d=d.defaultPrevented):b.isMac&&(b.isFirefox&&0===a.button)&&(d=!0);if(d)return a.preventDefault&&
a.preventDefault(),!1;this._contextMenuOpen=!0;b.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){this._ignoreEvent(a)||
(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a)))},_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(13>b.isFirefox){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.contentEditable=!0;d._clientDiv.draggable=!1;d._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&
a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",a));13>b.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var d=
!0;this._dropTarget=!0;this.isListening("DragEnter")&&(d=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(b.isWebkit||d)return a.preventDefault&&a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var d=!0;this.isListening("DragOver")&&(d=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(b.isWebkit||d)return d&&(a.dataTransfer.dropEffect="none"),a.preventDefault&&a.preventDefault(),!1}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=
!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;b.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display=
"block");this._domSelection&&this._domSelection.forEach(function(a){a.update()});if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var d=this._createKeyEvent("KeyDown",a);this.onKeyDown(d);if(d.defaultPrevented){b.isFirefox&&(this._keyDownPrevented=!0);a.preventDefault();return}}d=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:d=!0;break;default:this._setLinksVisible(!1)}if(229===
a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;d=!0;b.isSafari&&b.isMac&&a.ctrlKey&&(d=!1,a.keyCode=129);d&&this._startIME()}else d||this._commitIME();if((b.isMac||b.isLinux)&&4>b.isFirefox||12.16>b.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&
(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(b.isMac&&b.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((b.isMac||b.isLinux)&&4>b.isFirefox||12.16>b.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var d=b.isMac?a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&d)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(d=this._createKeyEvent("KeyPress",a),this.onKeyPress(d),
d.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;d=!1;if(b.isMac){if(a.ctrlKey||a.metaKey)d=!0}else if(b.isFirefox){if(a.ctrlKey||a.altKey)d=!0}else a.ctrlKey^a.altKey&&(d=!0);if(!d&&(d=b.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<d))return this._doContent(String.fromCharCode(d)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(b.isMac?
a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var d=this._createKeyEvent("KeyUp",a);this.onKeyUp(d);if(d.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);13===a.keyCode&&this._commitIME()}},_handleLinkClick:function(a){if(!(b.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var d=this._getWindow(),f=!0,g=d;if(b.isIE||b.isFirefox&&!this._overlayDiv)g=
this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var c=this;d.setTimeout(function(){c.focus();c._ignoreFocus=!1},0)}var d=a.shiftKey,n=a.altKey,e=b.isMac?a.metaKey:a.ctrlKey;this._blockSelection=this._doubleClickSelection=null;1===this._clickCount?(f=(!b.isOpera||12.16<=b.isOpera)&&this._hasFocus&&this.isListening("DragStart"),(f=this._setSelectionTo(a.clientX,a.clientY,!0,d,e,f))&&this._setGrab(g)):(this._isW3CEvents&&this._setGrab(g),this._setSelectionTo(a.clientX,a.clientY,
!0,d,e,!1),this._doubleClickSelection=s.editing(this._getSelections()));n&&(this._blockSelection=s.editing(this._getSelections()));return f},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if("A"!==(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var d=a.which;d||(4===a.button&&(d=2),2===a.button&&(d=3),1===a.button&&(d=1));var f=2!==d&&a.timeStamp?a.timeStamp:(new Date).getTime(),g=f-this._lastMouseTime,c=Math.abs(this._lastMouseX-
a.clientX),n=Math.abs(this._lastMouseY-a.clientY),e=this._lastMouseButton===d;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=f;this._lastMouseButton=d;1===d&&(this._isMouseDown=!0,e&&g<=this._clickTime&&c<=this._clickDist&&n<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(f=this._createMouseEvent("MouseDown",a),this.onMouseDown(f),f.defaultPrevented)){a.preventDefault();return}if(1===d&&this._handleMouse(a)&&(9<=b.isIE||b.isOpera||
b.isChrome||b.isSafari||b.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();b.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){if(!this._animation){var d=
this._isClientDiv(a);if(this.isListening("MouseMove")&&(d||this._isMouseDown)){var f=this._createMouseEvent("MouseMove",a);this.onMouseMove(f);if(f.defaultPrevented){a.preventDefault();return}}if(!this._dropTarget){f=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(f&&!this._isMouseDown&&a.altKey&&(b.isMac?a.metaKey:a.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===
a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===a.button&&0!==(this._clickCount&1)&&d)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){d=a.clientX;a=a.clientY;var g=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect(),n=this._getClientWidth(),e=this._getClientHeight(),f=c.left+g.left,s=c.top+g.top,n=c.left+g.left+n,g=c.top+g.top+e;a<s?this._doAutoScroll("up",d,a-s):a>g?this._doAutoScroll("down",d,a-g):d<f&&!this._wrapMode?
this._doAutoScroll("left",d-f,a):d>n&&!this._wrapMode?this._doAutoScroll("right",d-n,a):(this._endAutoScroll(),this._setSelectionTo(d,a,!1,!0))}}}},_isClientDiv:function(a){var d=this._overlayDiv||this._clientDiv;for(a=a.target?a.target:a.srcElement;a;){if(d===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,d){return{type:a,event:d,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,d){var b=this.convert({x:d.clientX,y:d.clientY},"page","document");return{type:a,
event:d,clickCount:this._clickCount,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(a,d){var b=d.touches.length?this.convert({x:d.touches[0].clientX,y:d.touches[0].clientY},"page","document"):{};return{type:a,event:d,touchCount:d.touches.length,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var d=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||d&&this._isMouseDown)){var f=
this._createMouseEvent("MouseUp",a);this.onMouseUp(f);if(f.defaultPrevented){a.preventDefault();this._isMouseDown=!1;return}}if(!this._linksVisible){if(d&&this._isMouseDown){var f=this._getSelections(),g=s.editing(f);f.forEach(function(a){a._editing=!1});-1!==this._dragOffset&&(g.extend(this._dragOffset),g.collapse(),f=g,this._dragOffset=-1);this._setSelection(f,!1);this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}d&&b.isFirefox&&(this._updateDOMSelection(),a.preventDefault())}},
_handleMouseWheel:function(a){if(!this._noScroll){var d=this._getLineHeight(),f=0,g=0;b.isIE||b.isOpera?g=-a.wheelDelta/40*d:b.isFirefox?"wheel"===a.type?a.deltaMode?(f=Math.max(-256,Math.min(256,a.deltaX))*d,g=Math.max(-256,Math.min(256,a.deltaY))*d):(f=a.deltaX,g=a.deltaY):(d=b.isMac?3*a.detail:Math.max(-256,Math.min(256,a.detail))*d,a.axis===a.HORIZONTAL_AXIS?f=d:g=d):b.isMac?(g=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,f=0!==a.wheelDeltaX%120?1:40>g?40/(40-g):40,g=0!==
a.wheelDeltaY%120?1:40>g?40/(40-g):40,f=Math.ceil(-a.wheelDeltaX/f),-1<f&&0>f&&(f=-1),0<f&&1>f&&(f=1),g=Math.ceil(-a.wheelDeltaY/g),-1<g&&0>g&&(g=-1),0<g&&1>g&&(g=1)):(f=-a.wheelDeltaX,g=8*(-a.wheelDeltaY/120)*d);if(b.isSafari||b.isChrome&&b.isMac){for(d=a.target;d&&void 0===d.lineIndex;)d=d.parentNode;this._mouseWheelLine=d}d=this._getScroll();this._scrollView(f,g);f=this._getScroll();if(d.x!==f.x||d.y!==f.y)return a.preventDefault&&a.preventDefault(),!1}},_handlePaste:function(a){this._cancelCheckSelection();
if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(b.isIE){var d=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){d._updateDOMSelection();d._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var a=this._rootDiv.clientWidth,d=this._rootDiv.clientHeight;if(this._rootWidth!==a||this._rootHeight!==d)this._rootWidth!==a&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=a,this._rootHeight=d,a=9>b.isIE,d=this._calculateMetrics(),
t(d,this._metrics)||(this._metrics.invalid&&!d.invalid?this._updateStyle(!1,d):(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=d),a=!0),a?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},_handleRulerEvent:function(a){for(var d=a.target?a.target:a.srcElement,b=d.lineIndex;d&&!d._ruler;)void 0===b&&void 0!==d.lineIndex&&(b=d.lineIndex),d=d.parentNode;var f=d?d._ruler:null;if(void 0===b&&f&&"document"===f.getOverview()){var g=this._getClientHeight(),
c=this._model.getLineCount(),n=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect(),e=this._getLineHeight(),g=g+n.top+n.bottom-2*this._metrics.scrollWidth;e*c<g?n=n.top:(e=g/c,n=this._metrics.scrollWidth);b=Math.floor((a.clientY-b.top-n)/e);0<=b&&b<c||(b=void 0)}if(f)switch(a.type){case "click":if(f.onClick)f.onClick(b,a);break;case "dblclick":if(f.onDblClick)f.onDblClick(b,a);break;case "mousemove":if(f.onMouseMove)f.onMouseMove(b,a);break;case "mouseover":if(f.onMouseOver)f.onMouseOver(b,
a);break;case "mouseout":if(f.onMouseOut){for(c=a.relatedTarget;c&&c!==this._rootDiv;){if(c===d)return;c=c.parentNode}f.onMouseOut(b,a)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),d=this._hScroll,b=this._vScroll;if(d!==a.x||b!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(b===a.y),this.onScroll({type:"Scroll",oldValue:{x:d,y:b},newValue:a})},_handleSelectStart:function(a){var d=this._contextMenuOpen;this._contextMenuOpen=
!1;if(d)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,d){if(a){var b;b="DIV"===a.tagName?a:a.parentNode.parentNode;return!b._line?0:b._line.getModelOffset(a,d)}},_updateSelectionFromDOM:function(){if(!b.isIOS&&!b.isAndroid&&!this._checkSelectionChange)return!1;var a=this._getWindow().getSelection(),d=this._getModelOffset(a.anchorNode,a.anchorOffset),f=this._getModelOffset(a.focusNode,a.focusOffset),g=this._getSelections()[0];
if(void 0===d||void 0===f||g.start===d&&g.end===f)return!1;if(this._checkSelectionChange){var g=this._getLineNext(),c=this._getLinePrevious();if(a.anchorNode===g.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===c.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===g.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===c.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)d=0,f=this.getModel().getCharCount()}this._setSelection(new s(d,f),
!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var d=this,b=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=b.setTimeout(function(){d._selPollTimer=null;d._clientDiv&&!d._updateSelectionFromDOM()&&
a&&d._pollSelectionChange(a)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(b.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){var d=-1!==this._imeOffset;this._imeOffset=-1;var f=this._getWindow().getSelection();if(f.anchorNode!==this._anchorNode||f.focusNode!==this._focusNode||f.anchorOffset!==this._anchorOffset||f.focusOffset!==this._focusOffset){for(var g=f.anchorNode;g&&void 0===g.lineIndex;)g=g.parentNode;
if(g){var c=this._model,n=g.lineIndex,e=c.getLine(n),s=e,u=0,c=c.getLineStart(n);0<f.rangeCount&&(f.getRangeAt(0).deleteContents(),n=g.ownerDocument.createTextNode(a.data),f.getRangeAt(0).insertNode(n),u=this._getDOMText(g,n),s=u.text,u=u.offset,n.parentNode.removeChild(n));g.lineRemoved=!0;for(g=0;e.charCodeAt(g)===s.charCodeAt(g)&&g<u;)g++;f=e.length-1;for(n=s.length-e.length;e.charCodeAt(f)===s.charCodeAt(f+n)&&f+n>=u+a.data.length;)f--;f++;e=s.substring(g,f+n);g+=c;f+=c;s=this._getSelections();
u=s[0].start-g;c=s[0].end-f;s[0].start=g;s[0].end=f;for(g=1;g<s.length;g++)s[g].start-=u,s[g].end-=c;this._ignoreQueueUpdate=b.isSafari;this._ignoreUpdate=d&&b.isChrome&&b.isWindows;this._modifyContent({text:e,selection:s,_ignoreDOMSelection:!0,_ignoreDOMSelection1:d&&b.isChrome&&b.isMac},!0);this._ignoreUpdate&&this._queueUpdate();this._ignoreUpdate=this._ignoreQueueUpdate=!1}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){if(this.isListening("TouchStart")){var d=
this._createTouchEvent("TouchStart",a);this.onTouchStart(d);if(d.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}this._commitIME();d=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",d.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var f=a.touches;if(1===f.length){var f=f[0],g=f.clientX,c=f.clientY;this._touchStartX=g;this._touchStartY=c;if(b.isAndroid&&(c<f.pageY-d.pageYOffset||g<f.pageX-
d.pageXOffset))g=f.pageX-d.pageXOffset,c=f.pageY-d.pageYOffset;d=this.convert({x:g,y:c},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(d.x,d.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){if(this.isListening("TouchMove")){var d=this._createTouchEvent("TouchMove",a);this.onTouchMove(d);if(d.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}d=a.touches;if(1===d.length){d=d[0];this._touchCurrentX=d.clientX;this._touchCurrentY=
d.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,f=this._getWindow();this._touchScrollTimer=f.setInterval(function(){var a=0,d=0;if(b._touching)a=b._touchStartX-b._touchCurrentX,d=b._touchStartY-b._touchCurrentY,b._touchSpeedX=a/10,b._touchSpeedY=d/10,b._touchStartX=b._touchCurrentX,b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display=
"none";b._hScrollDiv.style.display="none";f.clearInterval(b._touchScrollTimer);b._touchScrollTimer=null;return}a=10*b._touchSpeedX;d=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(a,d)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(this.isListening("TouchEnd")){var d=this._createTouchEvent("TouchEnd",a);this.onTouchEnd(d);if(d.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}0===a.touches.length&&(this._touching=!1)},
_doAction:function(a){var d,b,f=this._keyModes;for(b=f.length-1;0<=b;b--)if(d=f[b],"function"===typeof d.match&&(d=d.match(a),void 0!==d))return this.invokeAction(d);return!1},_doMove:function(a,d){var b=this._model,f=d.getCaret(),g=b.getLineAtOffset(f);a.count||(a.count=1);for(;0!==a.count;){var c=b.getLineStart(g);if(0>a.count&&f===c)if(0<g)"character"===a.unit&&a.count++,g--,d.extend(b.getLineEnd(g));else break;else if(0<a.count&&f===b.getLineEnd(g))if(g+1<b.getLineCount())"character"===a.unit&&
a.count--,g++,d.extend(b.getLineStart(g));else break;else{var n=!1;a.expandTab&&("character"===a.unit&&0===(f-c)%this._tabSize)&&(c=b.getText(c,f),n=!/[^ ]/.test(c));n?(d.extend(f-this._tabSize),a.count+=0>a.count?1:-1):(c=this._getLine(g),d.extend(c.getNextOffset(f,a)),c.destroy())}f=d.getCaret()}return d},_doBackspace:function(a){var d=this,b=this._getSelections();b.forEach(function(b){b.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=d._expandTab,d._doMove(a,b))});this._modifyContent({text:"",
selection:b},!0);return!0},_doCase:function(a){var d=this,b=this._getSelections(),f=[];b.forEach(function(b){d._doMove(a,b);b=d.getText(b.start,b.end);switch(a.type){case "lower":b=b.toLowerCase();break;case "capitalize":b=b.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":for(var g="",c=0;c<b.length;c++)var n=b[c],e=n.toLowerCase(),n=e!==n?e:n.toUpperCase(),g=g+n;b=g;break;default:b=b.toUpperCase()}f.push(b)});return this._modifyContent({text:f,selection:b,_ignoreDOMSelection:!0},
!0)},_doContent:function(a){var d=this,b=this._getSelections();b.forEach(function(a){if(d._overwriteMode&&a.isEmpty()){var b=d._model,f=b.getLineAtOffset(a.end);a.end<b.getLineEnd(f)&&(b=d._getLine(f),a.extend(b.getNextOffset(a.getCaret(),{unit:"character",count:1})),b.destroy())}});return this._modifyContent({text:a,selection:b,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var d=this.getSelectionText();return d?this._setClipboardText(d,a):!0},_doCursorNext:function(a){var d=this,b=this._getSelections();
b.forEach(function(b){!b.isEmpty()&&!a.select?b.start=b.end:d._doMove(a,b);a.select||b.collapse()});this._setSelection(b,!0);return!0},_doCursorPrevious:function(a){var d=this,b=this._getSelections();b.forEach(function(b){!b.isEmpty()&&!a.select?b.end=b.start:(a.count||(a.count=1),a.count*=-1,d._doMove(a,b));a.select||b.collapse()});this._setSelection(b,!0);return!0},_doCut:function(a){var d=this.getSelectionText();return d?(this._doContent(""),this._setClipboardText(d,a)):!0},_doDelete:function(a){var d=
this,b=this._getSelections();b.forEach(function(b){b.isEmpty()&&d._doMove(a,b)});this._modifyContent({text:"",selection:b},!0);return!0},_doEnd:function(a){var d=this._model,b=this,f=this._getSelections();f.forEach(function(f){if(a.ctrl)f.extend(d.getCharCount());else{var g=f.getCaret(),c=d.getLineAtOffset(g);if(b._wrapMode){var n=b._getLine(c),g=n.getLineIndex(g),g=g===n.getLineCount()-1?d.getLineEnd(c):n.getLineStart(g+1)-1;n.destroy()}else a.count&&0<a.count&&(c=Math.min(c+a.count-1,d.getLineCount()-
1)),g=d.getLineEnd(c);f.extend(g)}a.select||f.collapse()});this._setSelection(f,!0,!0,a.ctrl?function(){}:null);return!0},_doEnter:function(a){if(this._singleMode)return!0;var d=this._model,b=this._getSelections();this._doContent(d.getLineDelimiter());a&&a.noCursor&&(b.forEach(function(a){a.end=a.start}),this._setSelection(b,!0));return!0},_doEscape:function(){var a=this._getSelections();1<a.length&&this._setSelection(a[0],!0);return!0},_doHome:function(a){var d=this._model,b=this,f=this._getSelections();
f.forEach(function(f){if(a.ctrl)f.extend(0);else{var g=f.getCaret(),c=d.getLineAtOffset(g);b._wrapMode?(c=b._getLine(c),g=c.getLineIndex(g),g=c.getLineStart(g),c.destroy()):g=d.getLineStart(c);f.extend(g)}a.select||f.collapse()});this._setSelection(f,!0,!0,a.ctrl?function(){}:null);return!0},_doLineDown:function(a){var d=this._model,f=this,g=this._getSelections();g.forEach(function(g){var c=g.getCaret(),n=d.getLineAtOffset(c),e=f._getLine(n),s=g._columnX,u=1,m=!1;if(-1===s||a.wholeLine||a.select&&
b.isIE)s=a.wholeLine?d.getLineEnd(n+1):c,s=g._columnX=e.getBoundingClientRect(s).left;(c=e.getLineIndex(c))<e.getLineCount()-1?u=e.getClientRects(c+1).top+1:(c=d.getLineCount()-1,m=n===c,a.count&&0<a.count?n=Math.min(n+a.count,c):n++);c=!1;if(m){if(a.select||b.isMac||b.isLinux)g.extend(d.getCharCount()),c=!0}else e.lineIndex!==n&&(e.destroy(),e=f._getLine(n)),g.extend(e.getOffset(s,u)),c=!0;c&&(a.select||g.collapse());e.destroy()});f._setSelection(g,!0,!0,null,0,!1,!0);return!0},_doLineUp:function(a){var d=
this._model,f=this,g=this._getSelections();g.forEach(function(g){var c=g.getCaret(),n=d.getLineAtOffset(c),e=f._getLine(n),s=g._columnX,u=!1,m;if(-1===s||a.wholeLine||a.select&&b.isIE)s=a.wholeLine?d.getLineStart(n-1):c,s=g._columnX=e.getBoundingClientRect(s).left;0<(c=e.getLineIndex(c))?m=e.getClientRects(c-1).top+1:(u=0===n,u||(a.count&&0<a.count?n=Math.max(n-a.count,0):n--,m=f._getLineHeight(n)-1));c=!1;if(u){if(a.select||b.isMac||b.isLinux)g.extend(0),c=!0}else e.lineIndex!==n&&(e.destroy(),e=
f._getLine(n)),g.extend(e.getOffset(s,m)),c=!0;c&&(a.select||g.collapse());e.destroy()});f._setSelection(g,!0,!0,null,0,!1,!0);return!0},_doNoop:function(){return!0},_doPageDown:function(a){var d=this,f=this._model,g=this._getSelections(),c=f.getLineCount(),n=this._getScroll(),e=this._getClientHeight(),s=this._getLineHeight(),u=Math.floor(e/s),m,t,v;g.forEach(function(g){var k=g.getCaret(),h=f.getLineAtOffset(k);if(d._lineHeight){m=g._columnX;var A=d._getBoundsAtOffset(k);if(-1===m||a.select&&b.isIE)m=
g._columnX=A.left;k=d._getLineIndex(A.top+e);t=d._getLine(k);var h=d._getLinePixel(k),k=t.getOffset(m,A.top+e-h),l=t.getBoundingClientRect(k);t.destroy();g.extend(k);a.select||g.collapse();v=void 0!==v?Math.min(v,l.top+h-A.top):l.top+h-A.top}else if(h<c-1){A=Math.min(c-h-1,u);A=Math.max(1,A);m=g._columnX;if(-1===m||a.select&&b.isIE)t=d._getLine(h),m=g._columnX=t.getBoundingClientRect(k).left,t.destroy();t=d._getLine(h+A);g.extend(t.getOffset(m,0));t.destroy();a.select||g.collapse();g=c*s;k=n.y+A*
s;k+e>g&&(k=g-e);v=void 0!==v?Math.min(v,k-n.y):k-n.y}});this._setSelection(g,!0,!0,function(){},v,!1,!0);return!0},_doPageUp:function(a){var d=this,f=this._model,g=this._getSelections(),c=this._getScroll(),n=this._getClientHeight(),e=this._getLineHeight(),s=Math.floor(n/e),u,m,t;g.forEach(function(g){var v=g.getCaret(),k=f.getLineAtOffset(v);if(d._lineHeight){u=g._columnX;k=d._getBoundsAtOffset(v);if(-1===u||a.select&&b.isIE)u=g._columnX=k.left;v=d._getLineIndex(k.bottom-n);m=d._getLine(v);var h=
d._getLinePixel(v),v=m.getOffset(u,k.bottom-n-h),A=m.getBoundingClientRect(v);m.destroy();g.extend(v);a.select||g.collapse();t=void 0!==t?Math.max(t,A.top+h-k.top):A.top+h-k.top}else if(0<k){h=Math.max(1,Math.min(k,s));u=g._columnX;if(-1===u||a.select&&b.isIE)m=d._getLine(k),u=g._columnX=m.getBoundingClientRect(v).left,m.destroy();m=d._getLine(k-h);g.extend(m.getOffset(u,d._getLineHeight(k-h)-1));m.destroy();a.select||g.collapse();g=Math.max(0,c.y-h*e);t=void 0!==t?Math.max(t,g-c.y):g-c.y}});this._setSelection(g,
!0,!0,function(){},t,!1,!0);return!0},_doPaste:function(a){var d=this;return null!==this._getClipboardText(a,function(a){if(a.length){b.isLinux&&2===d._lastMouseButton&&(new Date).getTime()-d._lastMouseTime<=d._clickTime&&d._setSelectionTo(d._lastMouseX,d._lastMouseY,!0);var f=d._getSelections(),g=d._singleMode?"":d._model.getLineDelimiter();d._doContent(1<f.length&&f.length===a.length?a:a.join(g))}})},_doScroll:function(a){var d=a.type,b=this._model,f=b.getLineCount();a=this._getClientHeight();var g=
this._getLineHeight(),f=this._lineHeight?this._scrollHeight:f*g,c=this._getScroll().y,n;switch(d){case "textStart":n=0;break;case "textEnd":n=f-a;break;case "pageDown":n=c+a;break;case "pageUp":n=c-a;break;case "lineDown":n=c+g;break;case "lineUp":n=c-g;break;case "centerLine":d=this._getSelections()[0],n=b.getLineAtOffset(d.start),b=(b.getLineAtOffset(d.end)-n+1)*g,n=n*g-a/2+b/2}void 0!==n&&(n=Math.min(Math.max(0,n),f-a),this._scrollViewAnimated(0,n-c,function(){}));return!0},_doSelectAll:function(){this._setSelection(new s(0,
this._model.getCharCount()),!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t",d=this._getSelections();if(this._expandTab){var a=[],b=this._model,f=this._tabSize;d.forEach(function(d){d=d.getCaret();var g=b.getLineAtOffset(d),g=b.getLineStart(g);a.push(Array(f-(d-g)%f+1).join(" "))})}return this._modifyContent({text:a,selection:d,_ignoreDOMSelection:!0},!0)}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),
!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,d=this._getSelections(),f=s.editing(d,"down"===this._autoScrollDir),g=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=f.getCaret(),n=a.getLineCount(),e=a.getLineAtOffset(c),u;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)c=this._autoScrollY/this._getLineHeight(),
c=0>c?Math.floor(c):Math.ceil(c),u=Math.max(0,Math.min(n-1,e+c));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)u=this._getLineIndex(g.y),e=this._getLine(e),g.x+=e.getBoundingClientRect(c,!1).left,e.destroy();this._blockSelection?d=this._getBlockSelections(d,u,g):0===u&&(b.isMac||b.isLinux)?f.extend(0):u===n-1&&(b.isMac||b.isLinux)?f.extend(a.getCharCount()):(e=this._getLine(u),f.extend(e.getOffset(g.x,g.y-this._getLinePixel(u))),e.destroy());this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();
var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var d=this._model.getLineCount(),b=0;if(a){a=0;for(var f=(new Date).getTime(),g=0;b<d&&!(this._lineHeight[b]||(a++,g||(g=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,100<(new Date).getTime()-f););this.redrawRulers(0,d);this._queueUpdate()}a=this._getWindow();if(b!==d){var c=this;this._calculateLHTimer=
a.setTimeout(function(){c._calculateLHTimer=null;c._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var d=a.getBoundingClientRect();a.destroy();return Math.max(1,d.bottom-d.top)},_calculateMetrics:function(){var a=this._clientDiv,f=a.ownerDocument,g=b.createElement(f,"div");g.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),
lineStart:0};this.onLineStyle(c);m(c.style,g);g.style.position="fixed";g.style.left="-1000px";var e=b.createElement(f,"span");e.appendChild(f.createTextNode(" "));g.appendChild(e);var s=b.createElement(f,"span");s.style.fontStyle="italic";s.appendChild(f.createTextNode(" "));g.appendChild(s);var u=b.createElement(f,"span");u.style.fontWeight="bold";u.appendChild(f.createTextNode(" "));g.appendChild(u);c=b.createElement(f,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(f.createTextNode(" "));
g.appendChild(c);a.appendChild(g);var t=g.getBoundingClientRect(),e=e.getBoundingClientRect(),s=s.getBoundingClientRect(),u=u.getBoundingClientRect(),c=c.getBoundingClientRect(),e=e.bottom-e.top,s=s.bottom-s.top,u=u.bottom-u.top,v=c.bottom-c.top,k=0,c=0>=t.bottom-t.top,t=Math.max(1,t.bottom-t.top);s>e&&(k=1);u>s&&(k=2);v>u&&(k=3);var h;0!==k&&(h={style:{}},0!==(k&1)&&(h.style.fontStyle="italic"),0!==(k&2)&&(h.style.fontWeight="bold"));e=d(g);a.removeChild(g);k=n(this._viewDiv);g=b.createElement(f,
"div");g.style.position="fixed";g.style.left="-1000px";g.style.paddingLeft=k.left+"px";g.style.paddingTop=k.top+"px";g.style.paddingRight=k.right+"px";g.style.paddingBottom=k.bottom+"px";g.style.width="100px";g.style.height="100px";k=b.createElement(f,"div");k.style.width="100%";k.style.height="100%";g.appendChild(k);a.appendChild(g);s=g.getBoundingClientRect();u=k.getBoundingClientRect();v=0;!this._singleMode&&!this._noScroll&&(g.style.overflow="hidden",k.style.height="200px",v=g.clientWidth,g.style.overflow=
"scroll",v-=g.clientWidth);a.removeChild(g);var k={left:u.left-s.left,top:u.top-s.top,right:s.right-u.right,bottom:s.bottom-u.bottom},A=0,l=u=0;if(!c){g=b.createElement(f,"div");g.style.position="fixed";g.style.left="-1000px";a.appendChild(g);g.innerHTML=Array(2).join("a");s=g.getBoundingClientRect();l=Math.ceil(s.right-s.left);if(this._wrapOffset||this._marginOffset)g.innerHTML=Array(this._wrapOffset+1+(b.isWebkit?0:1)).join(" "),s=g.getBoundingClientRect(),A=Math.ceil(s.right-s.left),g.innerHTML=
Array(this._marginOffset+1).join(" "),u=g.getBoundingClientRect(),u=Math.ceil(u.right-u.left);a.removeChild(g)}return{lineHeight:t,largestFontStyle:h,lineTrim:e,viewPadding:k,scrollWidth:v,wrapWidth:A,marginWidth:u,charWidth:l,invalid:c}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var d=this._getSelections();d.forEach(function(d){"next"===a?d.start=d.end:d.end=d.start});this._setSelection(d,!0);return!0},_commitIME:function(a){if(-1!==
this._imeOffset){var d=this._model,f=d.getLineAtOffset(this._imeOffset),g=d.getLineStart(f),c=this._getLineNode(f);if(!a){this._scrollDiv.focus();this._clientDiv.focus();var n=this._getDOMText(c).text,d=d.getLine(f),g=this._imeOffset-g,d=g+n.length-d.length;g!==d&&(a=n.substring(g,d))}a&&(!this._doContent(a)&&!b.isWebkit)&&(c.lineRemoved=!0,this._queueUpdate());this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new p.DefaultKeyMode(this));var d=this;this._actions={noop:{defaultHandler:function(){return d._doNoop()}},
lineUp:{defaultHandler:function(b){return d._doLineUp(a(b,{select:!1}))},actionDescription:{name:l.lineUp}},lineDown:{defaultHandler:function(b){return d._doLineDown(a(b,{select:!1}))},actionDescription:{name:l.lineDown}},lineStart:{defaultHandler:function(b){return d._doHome(a(b,{select:!1,ctrl:!1}))},actionDescription:{name:l.lineStart}},lineEnd:{defaultHandler:function(b){return d._doEnd(a(b,{select:!1,ctrl:!1}))},actionDescription:{name:l.lineEnd}},charPrevious:{defaultHandler:function(b){return d._doCursorPrevious(a(b,
{select:!1,unit:"character"}))},actionDescription:{name:l.charPrevious}},charNext:{defaultHandler:function(b){return d._doCursorNext(a(b,{select:!1,unit:"character"}))},actionDescription:{name:l.charNext}},pageUp:{defaultHandler:function(b){return d._doPageUp(a(b,{select:!1}))},actionDescription:{name:l.pageUp}},pageDown:{defaultHandler:function(b){return d._doPageDown(a(b,{select:!1}))},actionDescription:{name:l.pageDown}},scrollPageUp:{defaultHandler:function(b){return d._doScroll(a(b,{type:"pageUp"}))},
actionDescription:{name:l.scrollPageUp}},scrollPageDown:{defaultHandler:function(b){return d._doScroll(a(b,{type:"pageDown"}))},actionDescription:{name:l.scrollPageDown}},scrollLineUp:{defaultHandler:function(b){return d._doScroll(a(b,{type:"lineUp"}))},actionDescription:{name:l.scrollLineUp}},scrollLineDown:{defaultHandler:function(b){return d._doScroll(a(b,{type:"lineDown"}))},actionDescription:{name:l.scrollLineDown}},wordPrevious:{defaultHandler:function(b){return d._doCursorPrevious(a(b,{select:!1,
unit:"word"}))},actionDescription:{name:l.wordPrevious}},wordNext:{defaultHandler:function(b){return d._doCursorNext(a(b,{select:!1,unit:"word"}))},actionDescription:{name:l.wordNext}},textStart:{defaultHandler:function(b){return d._doHome(a(b,{select:!1,ctrl:!0}))},actionDescription:{name:l.textStart}},textEnd:{defaultHandler:function(b){return d._doEnd(a(b,{select:!1,ctrl:!0}))},actionDescription:{name:l.textEnd}},scrollTextStart:{defaultHandler:function(b){return d._doScroll(a(b,{type:"textStart"}))},
actionDescription:{name:l.scrollTextStart}},scrollTextEnd:{defaultHandler:function(b){return d._doScroll(a(b,{type:"textEnd"}))},actionDescription:{name:l.scrollTextEnd}},centerLine:{defaultHandler:function(b){return d._doScroll(a(b,{type:"centerLine"}))},actionDescription:{name:l.centerLine}},selectLineUp:{defaultHandler:function(b){return d._doLineUp(a(b,{select:!0}))},actionDescription:{name:l.selectLineUp}},selectLineDown:{defaultHandler:function(b){return d._doLineDown(a(b,{select:!0}))},actionDescription:{name:l.selectLineDown}},
selectWholeLineUp:{defaultHandler:function(b){return d._doLineUp(a(b,{select:!0,wholeLine:!0}))},actionDescription:{name:l.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(b){return d._doLineDown(a(b,{select:!0,wholeLine:!0}))},actionDescription:{name:l.selectWholeLineDown}},selectLineStart:{defaultHandler:function(b){return d._doHome(a(b,{select:!0,ctrl:!1}))},actionDescription:{name:l.selectLineStart}},selectLineEnd:{defaultHandler:function(b){return d._doEnd(a(b,{select:!0,ctrl:!1}))},
actionDescription:{name:l.selectLineEnd}},selectCharPrevious:{defaultHandler:function(b){return d._doCursorPrevious(a(b,{select:!0,unit:"character"}))},actionDescription:{name:l.selectCharPrevious}},selectCharNext:{defaultHandler:function(b){return d._doCursorNext(a(b,{select:!0,unit:"character"}))},actionDescription:{name:l.selectCharNext}},selectPageUp:{defaultHandler:function(b){return d._doPageUp(a(b,{select:!0}))},actionDescription:{name:l.selectPageUp}},selectPageDown:{defaultHandler:function(b){return d._doPageDown(a(b,
{select:!0}))},actionDescription:{name:l.selectPageDown}},selectWordPrevious:{defaultHandler:function(b){return d._doCursorPrevious(a(b,{select:!0,unit:"word"}))},actionDescription:{name:l.selectWordPrevious}},selectWordNext:{defaultHandler:function(b){return d._doCursorNext(a(b,{select:!0,unit:"word"}))},actionDescription:{name:l.selectWordNext}},selectTextStart:{defaultHandler:function(b){return d._doHome(a(b,{select:!0,ctrl:!0}))},actionDescription:{name:l.selectTextStart}},selectTextEnd:{defaultHandler:function(b){return d._doEnd(a(b,
{select:!0,ctrl:!0}))},actionDescription:{name:l.selectTextEnd}},deletePrevious:{defaultHandler:function(b){return d._doBackspace(a(b,{unit:"character"}))},actionDescription:{name:l.deletePrevious}},deleteNext:{defaultHandler:function(b){return d._doDelete(a(b,{unit:"character"}))},actionDescription:{name:l.deleteNext}},deleteWordPrevious:{defaultHandler:function(b){return d._doBackspace(a(b,{unit:"word"}))},actionDescription:{name:l.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(b){return d._doDelete(a(b,
{unit:"word"}))},actionDescription:{name:l.deleteWordNext}},deleteLineStart:{defaultHandler:function(b){return d._doBackspace(a(b,{unit:"line"}))},actionDescription:{name:l.deleteLineStart}},deleteLineEnd:{defaultHandler:function(b){return d._doDelete(a(b,{unit:"line"}))},actionDescription:{name:l.deleteLineEnd}},tab:{defaultHandler:function(b){return d._doTab(a(b,{}))},actionDescription:{name:l.tab}},shiftTab:{defaultHandler:function(b){return d._doShiftTab(a(b,{}))},actionDescription:{name:l.shiftTab}},
enter:{defaultHandler:function(b){return d._doEnter(a(b,{}))},actionDescription:{name:l.enter}},enterNoCursor:{defaultHandler:function(b){return d._doEnter(a(b,{noCursor:!0}))},actionDescription:{name:l.enterNoCursor}},escape:{defaultHandler:function(b){return d._doEscape(a(b,{}))},actionDescription:{name:l.escape}},selectAll:{defaultHandler:function(b){return d._doSelectAll(a(b,{}))},actionDescription:{name:l.selectAll}},copy:{defaultHandler:function(b){return d._doCopy(a(b,{}))},actionDescription:{name:l.copy}},
cut:{defaultHandler:function(b){return d._doCut(a(b,{}))},actionDescription:{name:l.cut}},paste:{defaultHandler:function(b){return d._doPaste(a(b,{}))},actionDescription:{name:l.paste}},uppercase:{defaultHandler:function(b){return d._doCase(a(b,{type:"upper"}))},actionDescription:{name:l.uppercase}},lowercase:{defaultHandler:function(b){return d._doCase(a(b,{type:"lower"}))},actionDescription:{name:l.lowercase}},capitalize:{defaultHandler:function(b){return d._doCase(a(b,{unit:"word",type:"capitalize"}))},
actionDescription:{name:l.capitalize}},reversecase:{defaultHandler:function(b){return d._doCase(a(b,{type:"reverse"}))},actionDescription:{name:l.reversecase}},toggleOverwriteMode:{defaultHandler:function(b){return d._doOverwriteMode(a(b,{}))},actionDescription:{name:l.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(b){return d._doTabMode(a(b,{}))},actionDescription:{name:l.toggleTabMode}},toggleWrapMode:{defaultHandler:function(b){return d._doWrapMode(a(b,{}))},actionDescription:{name:l.toggleWrapMode}}}},
_createRulerParent:function(a,d){var f=b.createElement(a,"div");f.className=d;f.tabIndex=-1;f.style.overflow="hidden";f.style.MozUserSelect="none";f.style.WebkitUserSelect="none";f.style.position="absolute";f.style.top="0px";f.style.bottom="0px";f.style.cursor="default";f.style.display="none";f.setAttribute("aria-hidden","true");this._rootDiv.appendChild(f);return f},_createRuler:function(a,d){if(this._clientDiv){var f=this._getRulerParent(a);if(f){if(f!==this._marginDiv||this._marginOffset)f.style.display=
"block";f.rulerWidth=void 0;var g=b.createElement(f.ownerDocument,"div");g._ruler=a;a.node=g;g.rulerChanged=!0;g.style.position="relative";g.style.cssFloat="left";g.style.styleFloat="left";g.style.outline="none";if(void 0===d||0>d||d>=f.children.length)f.appendChild(g);else{for(var c=f.firstChild;c&&0<d--;)c=c.nextSibling;f.insertBefore(g,c)}}}},_createSelectionDiv:function(){var a=b.createElement(this._parent.ownerDocument,"div");a.className="textviewSelection";a.style.position="absolute";a.style.borderWidth=
"0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.width="0px";a.style.height="0px";a.style.zIndex="0";return a},_createView:function(){function a(){n._rootDiv&&(n.update(!0),n._metrics.invalid&&n._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var f=d.ownerDocument,g=b.createElement(f,"div");this._rootDiv=g;g.tabIndex=-1;g.style.position="relative";g.style.overflow="hidden";g.style.width=
"100%";g.style.height="100%";g.style.overflow="hidden";g.style.WebkitTextSizeAdjust="100%";g.setAttribute("role","application");d.appendChild(g);this._leftDiv=this._createRulerParent(f,"textviewLeftRuler");d=b.createElement(f,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.outline="none";d.style.background="transparent";g.appendChild(d);var c=this._createRulerParent(f,
"textviewRightRuler");this._rightDiv=c;c.style.right="0px";this._innerRightDiv=c=this._createRulerParent(f,"textviewInnerRightRuler");c.style.zIndex="1";this._scrollDiv=c=b.createElement(f,"div");c.style.margin="0px";c.style.borderWidth="0px";c.style.padding="0px";d.appendChild(c);(this._marginDiv=this._createRulerParent(f,"textviewMarginRuler")).style.zIndex="4";!b.isIE&&!b.isIOS&&(this._clipDiv=d=b.createElement(f,"div"),d.style.position="absolute",d.style.overflow="hidden",d.style.margin="0px",
d.style.borderWidth="0px",d.style.padding="0px",d.style.background="transparent",g.appendChild(d),this._clipScrollDiv=c=b.createElement(f,"div"),c.style.position="absolute",c.style.height="1px",c.style.top="-1000px",c.style.background="transparent",d.appendChild(c));d=b.createElement(f,"div");d.className="textviewContent";this._clientDiv=d;d.tabIndex=0;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";d.style.zIndex="1";d.style.WebkitUserSelect=
"text";d.setAttribute("spellcheck","false");if(b.isIOS||b.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||g).appendChild(d);this._setFullSelection(this._fullSelection,!0);if(b.isIOS||b.isAndroid)this._vScrollDiv=c=b.createElement(f,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline=
"none",c.style.zIndex="3",c.style.width="8px",c.style.display="none",g.appendChild(c),this._hScrollDiv=c=b.createElement(f,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="3",c.style.height="8px",c.style.display="none",g.appendChild(c);b.isFirefox&&!d.setCapture&&(this._overlayDiv=
c=b.createElement(f,"div"),c.style.position=d.style.position,c.style.borderWidth=d.style.borderWidth,c.style.margin=d.style.margin,c.style.padding=d.style.padding,c.style.cursor="text",c.style.zIndex="2",(this._clipDiv||g).appendChild(c));d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,
!0);this._hookEvents();d=this._rulers;for(c=0;c<d.length;c++)this._createRuler(d[c]);this._update();var n=this;u(f,g,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,
update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},undoStack:{value:null,update:this._setUndoStack},theme:{value:e.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},
_destroyRuler:function(a){var d=this._getRulerParent(a);if(d)for(var b=d.firstChild;b;){if(b._ruler===a){b._ruler=void 0;d.removeChild(b);if(0===d.children.length&&(d!==this._marginDiv||!this._marginOffset))d.style.display="none";d.rulerWidth=void 0;break}b=b.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),
this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);this._cursorTimer&&(a.clearInterval(this._cursorTimer),this._cursorTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._innerRightDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._domSelection=
null}},_doAutoScroll:function(a,d,b){this._autoScrollDir=a;this._autoScrollX=d;this._autoScrollY=b;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var d=this._hasFocus;this._ignoreFocus=!0;d&&a.blur();a.contentEditable=!1;a.contentEditable=!0;d&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,
d){var b=this._model;b.getBaseModel&&(a=b.mapOffset(a),d=b.mapOffset(d),b=b.getBaseModel());return b.getText(a,d)},_getBottomIndex:function(a){var d=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=d.getBoundingClientRect();var b=this._clientDiv.getBoundingClientRect();a.bottom>b.bottom&&(d=this._getLinePrevious(d)||d)}return d.lineIndex},_getBlockSelections:function(a,d,b){var f=this._model;a=a.filter(function(a){return!a._editing});var g=f.getLineAtOffset(this._blockSelection.getAnchor()),
c;d>g?c=d:(c=g,g=d);for(d=g;d<=c;d++){var n=this._getLine(d),g=n.getOffset(b.x,1),e=n.getOffset(this._blockSelection._docX,1);n.destroy();g===e&&g===f.getLineEnd(d)||(n=g<e,g=new s(n?g:e,n?e:g,n),g._editing=!0,a.push(g))}return a},_getBoundsAtOffset:function(a){var d=this._getLine(this._model.getLineAtOffset(a));a=d.getBoundingClientRect(a);var b=this._getLinePixel(d.lineIndex);a.top+=b;a.bottom+=b;d.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-
a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===a&&(a=this._innerRightDiv.getBoundingClientRect(),this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),d=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-d)},_getClipboardText:function(a,d){function g(a){var b=[];f(a,function(a){b.push(a)},null);d&&d(b);return b}var c=this._getWindow(),n=c.clipboardData;!n&&
a&&(n=a.clipboardData);if(n)return g(n.getData(b.isIE?"Text":"text/plain"));if(b.isFirefox){this._ignoreFocus=!0;var e=this._clipboardDiv,n=this._rootDiv.ownerDocument;e||(this._clipboardDiv=e=b.createElement(n,"div"),e.style.position="fixed",e.style.whiteSpace="pre",e.style.left="-1000px",this._rootDiv.appendChild(e));e.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";e.firstChild.focus();var s=this,u=function(){var a=s._getTextFromElement(e);e.innerHTML="";return g(a)},m=!1;this._ignorePaste=
!0;if(!b.isLinux||2!==this._lastMouseButton)try{m=n.execCommand("paste",!1,null)}catch(t){m=1<e.childNodes.length||e.firstChild&&0<e.firstChild.childNodes.length}this._ignorePaste=!1;if(!m){if(a)return c.setTimeout(function(){s.focus();u();s._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;return u()}return""},_getDOMText:function(a,d){return a._line.getText(d)},_getTextFromElement:function(a){var d=a.ownerDocument,b=d.defaultView;if(!b.getSelection)return a.innerText||
a.textContent;d=d.createRange();d.selectNode(a);a=b.getSelection();var b=[],f;for(f=0;f<a.rangeCount;f++)b.push(a.getRangeAt(f));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(d);d=a.toString();a.removeAllRanges();for(f=0;f<b.length;f++)a.addRange(b[f]);this._ignoreSelect=!1;return d},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var d=this._getLineNode(a);return d&&!d.lineChanged&&!d.lineRemoved?d._line:new F(this,a)},_getLineHeight:function(a,d){if(void 0!==
a&&this._lineHeight){var b=this._lineHeight[a];if(b)return b;if(d||void 0===d)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var d=this._clientDiv.firstChild;d;){if(a===d.lineIndex)return d;d=d.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===
a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var d=this._getTopIndex(),b=-this._topIndexY+this._getScroll().y;if(a>d)for(;d<a;d++)b+=this._getLineHeight(d);else for(d-=1;d>=a;d--)b-=this._getLineHeight(d);return b}return this._getLineHeight()*a},_getLineIndex:function(a,d){var b,f=0,g=this._model.getLineCount();if(this._lineHeight){var f=this._getTopIndex(),c=-this._topIndexY+this._getScroll().y;
if(a!==c)if(a<c)for(;a<c&&0<f;)a+=this._getLineHeight(--f);else for(b=this._getLineHeight(f);a-b>=c&&f<g-1;)a-=b,b=this._getLineHeight(++f)}else b=this._getLineHeight(),f=Math.floor(a/b);return d&&(0===g||0>f||f>g-1)?-1:Math.max(0,Math.min(g-1,f))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&
this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return(Array.isArray(this._selection)?this._selection[0]:this._selection).clone()},_getSelections:function(){return(Array.isArray(this._selection)?this._selection:[this._selection]).map(function(a){return a.clone()})},_getTopIndex:function(a){var d=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=d.getBoundingClientRect();var b=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();
a.top<f.top+b.top&&(d=this._getLineNext(d)||d)}return d.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(d){a._onModelChanging(d)},onChanged:function(d){a._onModelChanged(d)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);
var d=this._handlers=[],f=this._clientDiv,g=this._viewDiv,c=this._rootDiv,n=this._overlayDiv||f,e=f.ownerDocument,s=this._getWindow(),u=b.isIE?e:s;d.push({target:s,type:"resize",handler:function(d){return a._handleResize(d?d:s.event)}});d.push({target:f,type:"blur",handler:function(d){return a._handleBlur(d?d:s.event)}});d.push({target:f,type:"focus",handler:function(d){return a._handleFocus(d?d:s.event)}});d.push({target:g,type:"focus",handler:function(){f.focus()}});d.push({target:g,type:"scroll",
handler:function(d){return a._handleScroll(d?d:s.event)}});d.push({target:f,type:"textInput",handler:function(d){return a._handleTextInput(d?d:s.event)}});d.push({target:f,type:"keydown",handler:function(d){return a._handleKeyDown(d?d:s.event)}});d.push({target:f,type:"keypress",handler:function(d){return a._handleKeyPress(d?d:s.event)}});d.push({target:f,type:"keyup",handler:function(d){return a._handleKeyUp(d?d:s.event)}});b.isIE&&d.push({target:e,type:"keyup",handler:function(d){return a._handleDocKeyUp(d?
d:s.event)}});d.push({target:f,type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:s.event)}});d.push({target:f,type:"copy",handler:function(d){return a._handleCopy(d?d:s.event)}});d.push({target:f,type:"cut",handler:function(d){return a._handleCut(d?d:s.event)}});d.push({target:f,type:"paste",handler:function(d){return a._handlePaste(d?d:s.event)}});d.push({target:e,type:"selectionchange",handler:function(d){return a._handleSelectionChange(d?d:s.event)}});if(b.isIOS||b.isAndroid)d.push({target:f,
type:"touchstart",handler:function(d){return a._handleTouchStart(d?d:s.event)}}),d.push({target:f,type:"touchmove",handler:function(d){return a._handleTouchMove(d?d:s.event)}}),d.push({target:f,type:"touchend",handler:function(d){return a._handleTouchEnd(d?d:s.event)}});else{d.push({target:f,type:"selectstart",handler:function(d){return a._handleSelectStart(d?d:s.event)}});d.push({target:f,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:s.event)}});d.push({target:f,type:"mouseover",
handler:function(d){return a._handleMouseOver(d?d:s.event)}});d.push({target:f,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:s.event)}});d.push({target:u,type:"mouseup",handler:function(d){return a._handleMouseUp(d?d:s.event)}});d.push({target:u,type:"mousemove",handler:function(d){return a._handleMouseMove(d?d:s.event)}});d.push({target:c,type:"mousedown",handler:function(d){return a._handleRootMouseDown(d?d:s.event)}});d.push({target:c,type:"mouseup",handler:function(d){return a._handleRootMouseUp(d?
d:s.event)}});d.push({target:n,type:"dragstart",handler:function(d){return a._handleDragStart(d?d:s.event)}});d.push({target:n,type:"drag",handler:function(d){return a._handleDrag(d?d:s.event)}});d.push({target:n,type:"dragend",handler:function(d){return a._handleDragEnd(d?d:s.event)}});d.push({target:n,type:"dragenter",handler:function(d){return a._handleDragEnter(d?d:s.event)}});d.push({target:n,type:"dragover",handler:function(d){return a._handleDragOver(d?d:s.event)}});d.push({target:n,type:"dragleave",
handler:function(d){return a._handleDragLeave(d?d:s.event)}});d.push({target:n,type:"drop",handler:function(d){return a._handleDrop(d?d:s.event)}});d.push({target:this._clientDiv,type:26<b.isFirefox?"wheel":b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:s.event)}});this._clipDiv&&d.push({target:this._clipDiv,type:26<b.isFirefox?"wheel":b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:s.event)}});if(b.isFirefox&&
(!b.isWindows||15<=b.isFirefox))(g=s.MutationObserver||s.MozMutationObserver)?(this._mutationObserver=new g(function(d){a._handleDataModified(d)}),this._mutationObserver.observe(f,{subtree:!0,characterData:!0})):d.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(d){return a._handleDataModified(d?d:s.event)}});if(b.isFirefox&&(!b.isWindows||15<=b.isFirefox)||b.isIE)d.push({target:this._clientDiv,type:"compositionstart",handler:function(d){return a._handleCompositionStart(d?
d:s.event)}}),d.push({target:this._clientDiv,type:"compositionend",handler:function(d){return a._handleCompositionEnd(d?d:s.event)}});this._overlayDiv&&(d.push({target:this._overlayDiv,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:s.event)}}),d.push({target:this._overlayDiv,type:"mouseover",handler:function(d){return a._handleMouseOver(d?d:s.event)}}),d.push({target:this._overlayDiv,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:s.event)}}),d.push({target:this._overlayDiv,
type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:s.event)}}));this._isW3CEvents||d.push({target:this._clientDiv,type:"dblclick",handler:function(d){return a._handleDblclick(d?d:s.event)}})}this._hookRulerEvents(this._leftDiv,d);this._hookRulerEvents(this._rightDiv,d);this._hookRulerEvents(this._innerRightDiv,d);this._hookRulerEvents(this._marginDiv,d);for(g=0;g<d.length;g++)c=d[g],D(c.target,c.type,c.handler,c.capture)},_hookRulerEvents:function(a,d){if(a){var f=this,g=this._getWindow();
b.isIE&&d.push({target:a,type:"selectstart",handler:function(){return!1}});d.push({target:a,type:26<b.isFirefox?"wheel":b.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return f._handleMouseWheel(a?a:g.event)}});d.push({target:a,type:"click",handler:function(a){f._handleRulerEvent(a?a:g.event)}});d.push({target:a,type:"dblclick",handler:function(a){f._handleRulerEvent(a?a:g.event)}});d.push({target:a,type:"mousemove",handler:function(a){f._handleRulerEvent(a?a:g.event)}});d.push({target:a,
type:"mouseover",handler:function(a){f._handleRulerEvent(a?a:g.event)}});d.push({target:a,type:"mouseout",handler:function(a){f._handleRulerEvent(a?a:g.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var d=a.parent;"string"===typeof d&&(d=(a.document||document).getElementById(d));if(!d)throw Error("no parent");
a.parent=d;a.model=a.model||new r.TextModel;var f=this._defaultOptions(),g;for(g in f)f.hasOwnProperty(g)&&(this["_"+g]=void 0!==a[g]?a[g]:f[g].value);this._keyModes=[];this._rulers=[];this._selection=[new s(0,0,!1)];this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=-1;this._isRangeRects=(!b.isIE||9<=b.isIE)&&"function"===typeof d.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=
d.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(b.isMac&&b.isWebkit&&!this._metrics.invalid&&
0===this._metrics.scrollWidth){var a=this._viewDiv,d=this._isOverOverlayScroll();a.style.pointerEvents=d.vertical||d.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),d=this._lastMouseMoveX,b=this._lastMouseMoveY;return{vertical:a.top<=b&&b<a.bottom&&a.right-15<=d&&d<a.right,horizontal:a.bottom-15<=b&&b<a.bottom&&a.left<=d&&d<a.right}},_startUndo:function(){if(this._undoStack){var a=this;
this._compoundChange=this._undoStack.startCompoundChange({end:function(){a._compoundChange=null}})}},_endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_modifyContent:function(a,d,b,f){if(this._readonly&&!a._code)return!1;a.type="Verify";var g=a.start=a.selection[0].start,c=a.end=a.selection[0].end;this.onVerify(a);g!==a.start&&(a.selection[0].start=a.start);c!==a.end&&(a.selection[0].end=a.end);if(null===a.text||void 0===a.text)return!1;1<a.selection.length&&this.setRedraw(!1);
(g=this._compoundChange)?s.compare(this._getSelections(),g.owner.selection)||(this._endUndo(),1<a.selection.length&&this._startUndo()):1<a.selection.length&&this._startUndo();var n=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0);var e=0,u=0;a.selection.forEach(function(b){b.start+=e;b.end+=e;var f=Array.isArray(a.text)?a.text[u]:a.text;n.setText(f,b.start,b.end);e+=b.start-b.end+f.length;b.setCaret(d?b.start+f.length:b.start);u++})}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=
!1)}try{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(a.selection,b,!0,f)}finally{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}if(g=this._compoundChange)g.owner.selection=a.selection;1<a.selection.length&&this.setRedraw(!0);this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var d=a.start,b=a.addedCharCount,f=a.removedCharCount,g=a.addedLineCount,c=a.removedLineCount,n=this._getSelections();
n.forEach(function(a){a.end>d&&(a.end>d&&a.start<d+f?a.setCaret(d+b):(a.start+=b-f,a.end+=b-f))});this._setSelection(n,!1,!1);for(var n=this._model.getLineAtOffset(d),e=this._getLineNext();e;){var s=e.lineIndex;n<=s&&s<=n+c&&(n===s&&!e.modelChangedEvent&&!e.lineRemoved?(e.modelChangedEvent=a,e.lineChanged=!0):(e.lineRemoved=!0,e.lineChanged=!1,e.modelChangedEvent=null));s>n+c&&(e.lineIndex=s+g-c,e._line.lineIndex=e.lineIndex);e=this._getLineNext(e)}this._lineHeight&&(a=[n,c].concat(Array(g)),Array.prototype.splice.apply(this._lineHeight,
a));!this._wrapMode&&(n<=this._maxLineIndex&&this._maxLineIndex<=n+c)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_rangesToSelections:function(a){var d=[],b=this._model.getCharCount();
a.forEach(function(a){var f;if(a instanceof s)f=a.clone();else{f=a.start;a=a.end;var g=f>a;if(g){var c=f;f=a;a=c}f=Math.max(0,Math.min(f,b));a=Math.max(0,Math.min(a,b));f=new s(f,a,g)}d.push(f)});return d},_resetLineHeight:function(a,d){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==d)for(var b=a;b<d;b++)this._lineHeight[b]=void 0;else b=this._model.getLineCount(),this._lineHeight=Array(b);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=
this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new s(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>b.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,
d,b){var f=this._getWindow();if(b&&this._scrollAnimation){var g=this;this._animation=new C({window:f,duration:this._scrollAnimation,curve:[d,0],onAnimate:function(a){a=d-Math.floor(a);g._scrollView(0,a);d-=a},onEnd:function(){g._animation=null;g._scrollView(a,d);b&&f.setTimeout(b,0)}});this._animation.play()}else this._scrollView(a,d),b&&f.setTimeout(b,0)},_scrollView:function(a,d){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);d&&(b.scrollTop+=d)},_setClipboardText:function(a,
d){var g,c=this._getWindow(),n=c.clipboardData;!n&&d&&(n=d.clipboardData);if(n&&(g=[],f(a,function(a){g.push(a)},function(){g.push(b.platformDelimiter)}),n.setData(b.isIE?"Text":"text/plain",g.join(""))||21<b.isFirefox))return!0;var e=this._parent.ownerDocument,s=b.createElement(e,"pre");s.style.position="fixed";s.style.left="-1000px";f(a,function(a){s.appendChild(e.createTextNode(a))},function(){s.appendChild(b.createElement(e,"br"))});s.appendChild(e.createTextNode(" "));this._clientDiv.appendChild(s);
n=e.createRange();n.setStart(s.firstChild,0);n.setEndBefore(s.lastChild);var u=c.getSelection();0<u.rangeCount&&u.removeAllRanges();u.addRange(n);var m=this,n=function(){s&&s.parentNode===m._clientDiv&&m._clientDiv.removeChild(s);m._updateDOMSelection()},u=!1;this._ignoreCopy=!0;try{u=e.execCommand("copy",!1,null)}catch(t){}this._ignoreCopy=!1;if(!u&&d)return c.setTimeout(n,0),!1;n();return!0},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&
this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;b.isIE&&a&&(this._hadFocus=this._hasFocus);var d=this._clientDiv;d.contentEditable=!a;this._hadFocus&&!a&&d.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,d,b,f,g,c,n){if(a){void 0===b&&(b=!0);var e=this._getSelections();
a=Array.isArray(a)?a:c?e.concat([a]):[a];this._selection=s.merge(a);n||a.forEach(function(a){a._columnX=-1});!1!==d&&this._showCaret(!1,f,d,g);b&&this._updateDOMSelection();s.compare(e,a)||(d={type:"Selection",oldValue:s.convert(e),newValue:s.convert(a)},this.onSelection(d))}},_setSelectionTo:function(a,d,b,f,g,c){var n=this._model,e=this._getSelections(),u=this.convert({x:a,y:d},"page","document");d=this._getLineIndex(u.y);a=this._getLine(d);var m=a.getOffset(u.x,u.y-this._getLinePixel(d));if(c&&
!f&&s.contains(e,m))return this._dragOffset=m,a.destroy(),!1;this._blockSelection?e=this._getBlockSelections(e,d,u):(b?f?(b=e[e.length-1],b._editing=!0):(b=new s(0,0),b._editing=!0,g?e.push(b):e=[b],b._docX=u.x):b=s.editing(e),1===this._clickCount?(b.extend(m),f||b.collapse()):(0===(this._clickCount&1)?this._doubleClickSelection?m>=this._doubleClickSelection.start?(f=this._doubleClickSelection.start,n=a.getNextOffset(m,{unit:"wordend",count:1})):(f=a.getNextOffset(m,{unit:"word",count:-1}),n=this._doubleClickSelection.end):
(f=a.getNextOffset(m,{unit:"word",count:-1}),n=a.getNextOffset(f,{unit:"wordend",count:1})):this._doubleClickSelection?(g=n.getLineAtOffset(this._doubleClickSelection.start),d>=g?(f=n.getLineStart(g),n=n.getLineEnd(d)):(f=n.getLineStart(d),n=n.getLineEnd(g))):(f=n.getLineStart(d),n=n.getLineEnd(d)),b.setCaret(f),b.extend(n)));this._setSelection(e,!0,!0,null,!1);a.destroy();return!0},_setFullSelection:function(a,d){this._fullSelection=a;b.isWebkit&&(this._fullSelection=!0);this._domSelection||(this._domSelection=
[],this._cursorVisible=!0);d||this._updateDOMSelection()},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,d=b.createElement(a.ownerDocument,"div");d.className="textviewBlockCursor";this._cursorDiv=d;d.tabIndex=-1;d.style.zIndex="2";d.style.color=
"transparent";d.style.position="absolute";d.style.pointerEvents="none";d.innerHTML="\x26nbsp;";a.appendChild(d);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,d){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,d){this._wrapOffset=a;d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},
_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,d){this._singleMode=a;this._updateOverflow();this._updateStyle(d)},_setNoScroll:function(a,d){this._noScroll=a;this._updateOverflow();this._updateStyle(d)},_setTabSize:function(a,d){this._tabSize=a;this._customTabSize=void 0;var f=this._clientDiv;b.isOpera?f&&(f.style.OTabSize=this._tabSize+""):537.1<=b.isWebkit?f&&(f.style.tabSize=this._tabSize+""):4<=b.isFirefox?f&&
(f.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);d||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,d){this._themeClass=a;var b="textview",f=this._theme.getThemeClass();f&&(b+=" "+f);this._themeClass&&
f!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(d)},_setUndoStack:function(a){this._undoStack=a},_setWrapMode:function(a,d){this._wrapMode=a&&this._wrappable;var b=this._clientDiv;this._wrapMode?(b.style.whiteSpace="pre-wrap",b.style.wordWrap="break-word"):(b.style.whiteSpace="pre",b.style.wordWrap="normal");this._updateOverflow();d||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,d,b,f){if(this._clientDiv&&!(0<this._redrawCount)&&
!this._ignoreDOMSelection){var g=this._model,c=this._getSelections(),n=s.editing(c,"down"===this._autoScrollDir),e=this._getScroll(),c=n.getCaret(),u=n.start,m=n.end,t=g.getLineAtOffset(u),k=g.getLineAtOffset(m),v=Math.max(Math.max(u,g.getLineStart(k)),m-1),g=this._getClientWidth(),h=this._getClientHeight(),A=g/4,l=this._getBoundsAtOffset(c===u?u:v),F=l.left,z=l.right,p=l.top,r=l.bottom,D=0,B="object"===typeof b;if((a||B)&&!n.isEmpty())l=this._getBoundsAtOffset(c===m?u:v),D=(l.bottom>r?l.bottom:r)-
(l.top<p?l.top:p),a&&(l.top===p?c===u?z=F+Math.min(l.right-F,g):F=z-Math.min(z-l.left,g):c===u?r=p+Math.min(l.bottom-p,h):p=r-Math.min(r-l.top,h));a=0;F<e.x&&(a=Math.min(F-e.x,-A));z>e.x+g&&(a=Math.max(z-e.x-g,A));n=0;p<e.y?n=p-e.y:r>e.y+h&&(n=r-e.y-h);f&&(0<f?0<n&&(n=Math.max(n,f)):0>n&&(n=Math.min(n,f)));f=B&&"always"===b.scrollPolicy;if(0!==a||0!==n||f)return B?(f=0<n,0===n&&(n=p-e.y),e=b.viewAnchor,p=b.selectionAnchor,b=Math.min(Math.max(0,b.viewAnchorOffset||0)),n="top"===e?n+Math.floor(f?(1-
b)*h:-b*h):"bottom"===e?n+Math.floor(f?b*h:-(1-b)*h):"center"===e?n+Math.floor(f?h/2+b*h:h/2-(1-b)*h):n+Math.floor(f?b*h:-b*h),t!==k&&("top"===p&&c!==u?n+=Math.floor(-D):"bottom"===p&&c!==m?n+=Math.floor(D):"center"===p&&(n+=Math.floor(D/2)))):0!==n&&"number"===typeof b&&(0>b&&(b=0),1<b&&(b=1),n+=Math.floor(0<n?b*h:-b*h)),this._scrollViewAnimated(a,n,d),h!==this._getClientHeight()||g!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;d&&d();return!1}},_startIME:function(){if(-1===
this._imeOffset){for(var a=!1,d=this._getSelections(),b=0;b<d.length&&!a;b++)a=!d[b].isEmpty();a&&this._modifyContent({text:"",selection:d},!0);this._imeOffset=d[0].start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var d=
this._handlers[a];B(d.target,d.type,d.handler)}this._handlers=null;this._mutationObserver&&this._mutationObserver.disconnect()},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelections(),d=this._domSelection,b;if(d.length<a.length)for(b=d.length;b<a.length;b++)d.push(new v(this));else d.length>a.length&&d.splice(a.length).forEach(function(a){a.destroy()});for(b=0;b<d.length;b++)d[b].setPrimary(0===b),d[b].setSelection(a[b]);var a=
this._getWindow(),f=this;1<d.length?this._cursorTimer||(this._cursorTimer=a.setInterval(function(){f._cursorVisible=!f._cursorVisible;f._domSelection.forEach(function(a){a.update()})},500)):this._cursorTimer&&(a.clearInterval(this._cursorTimer),this._cursorTimer=null)}},_update:function(a){if(!(0<this._redrawCount)&&!this._ignoreUpdate){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var d=this._clientDiv,f=this._viewDiv;if(d){this._metrics.invalid&&
(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var g=this._model,c=this._getScroll(!1),n=this._getViewPadding(),e=g.getLineCount(),s=this._getLineHeight(),u=!1,m=!1,t=!1,k=this._metrics.scrollWidth;this._wrapMode&&(d.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var v,h,A,l,z=0,p=0,r;if(this._lineHeight){for(;p<e;){r=this._getLineHeight(p);if(z+r>c.y)break;z+=r;p++}v=p;h=Math.max(0,v-1);A=g=c.y-z;0<v&&(g+=this._getLineHeight(v-1))}else l=Math.max(0,
c.y)/s,v=Math.floor(l),h=Math.max(0,v-1),g=Math.round((l-h)*s),A=Math.round((l-v)*s);this._topIndexY=A;l=this._rootDiv;var D=l.clientWidth,B=l.clientHeight;if(a){s=0;this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),s=v.right-v.left);v=this._getClientWidth();l=this._getClientHeight();m=v;this._wrapMode?this._metrics.wrapWidth&&(m=this._metrics.wrapWidth):m=Math.max(this._maxLineWidth,m);for(;p<e;)r=this._getLineHeight(p,!1),z+=r,p++;e=z}else{l=this._getClientHeight();A=Math.min(v+Math.floor((l+
A)/s),e-1);var c=Math.min(A+1,e-1),C;for(r=d.firstChild;r;){C=r.lineIndex;var y=r.nextSibling;if(!(h<=C&&C<=c)||r.lineRemoved||-1===r.lineIndex)this._mouseWheelLine===r?(r.style.display="none",r.lineIndex=-1):d.removeChild(r);r=y}r=this._getLineNext();var y=f.ownerDocument,R=y.createDocumentFragment();for(C=h;C<=c;C++)!r||r.lineIndex>C?(new F(this,C)).create(R,null):(R.firstChild&&(d.insertBefore(R,r),R=y.createDocumentFragment()),r&&r.lineChanged&&(r=(new F(this,C)).create(R,r),r.lineChanged=!1),
r=this._getLineNext(r));R.firstChild&&d.insertBefore(R,r);b.isWebkit&&!this._wrapMode&&(d.style.width="0x7fffffffpx");r=this._getLineNext();C=l+g;for(R=!1;r;)h=r.lineWidth,void 0===h&&(y=r._line.getBoundingClientRect(),h=r.lineWidth=Math.ceil(y.right-y.left),y=y.bottom-y.top,this._lineHeight?this._lineHeight[r.lineIndex]=y:0!==s&&(0!==y&&Math.ceil(s)!==Math.ceil(y))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[r.lineIndex]=y)),this._lineHeight&&!R&&(C-=this._lineHeight[r.lineIndex],
0>C&&(A=r.lineIndex,R=!0)),this._wrapMode||(h>=this._maxLineWidth&&(this._maxLineWidth=h,this._maxLineIndex=r.lineIndex),this._checkMaxLineIndex===r.lineIndex&&(this._checkMaxLineIndex=-1)),r.lineIndex===v&&(this._topChild=r),r.lineIndex===A&&(this._bottomChild=r),r=this._getLineNext(r);-1!==this._checkMaxLineIndex&&(C=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=C&&C<e&&(s=new F(this,C),y=s.getBoundingClientRect(),h=y.right-y.left,h>=this._maxLineWidth&&(this._maxLineWidth=h,this._maxLineIndex=
C),s.destroy()));for(;p<e;)r=this._getLineHeight(p,p<=A),z+=r,p++;e=z;this._updateRuler(this._leftDiv,v,c,B);this._updateRuler(this._rightDiv,v,c,B);this._updateRuler(this._innerRightDiv,v,c,B);this._updateRuler(this._marginDiv,v,c,B);s=0;this._leftDiv&&(v=this._leftDiv.getBoundingClientRect(),s=v.right-v.left);z=0;this._rightDiv&&(c=this._rightDiv.getBoundingClientRect(),z=c.right-c.left);f.style.left=s+"px";f.style.right=z+"px";c=this._scrollDiv;c.style.height=e+(b.isWebkit?0:n.bottom)+"px";v=this._getClientWidth();
!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(p=u=l,(A="scroll"===f.style.overflowX)?u+=k:p-=k,h=r=v,(C="scroll"===f.style.overflowY)?r+=k:h-=k,l=u,v=r,e>l&&(t=!0,v=h),this._maxLineWidth>v&&(m=!0,l=p,e>l&&(t=!0,v=h)),A!==m&&(f.style.overflowX=m?"scroll":"hidden"),C!==t&&(f.style.overflowY=t?"scroll":"hidden"),u=A!==m||C!==t);t=v;this._wrapMode?this._metrics.wrapWidth&&(t=this._metrics.wrapWidth):t=Math.max(this._maxLineWidth+this._getInnerRightWidth(),t);m=t;if((!b.isIE||9<=b.isIE)&&this._maxLineWidth>
v)t+=n.right+n.left;c.style.width=t+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=t+"px");c=this._getScroll(!1);if(t=this._innerRightDiv)t.style.right=z+("scroll"===f.style.overflowY?this._metrics.scrollWidth:0)+"px",t.style.bottom=("scroll"===f.style.overflowX?k:0)+"px"}this._scrollHeight=e;this._vScrollDiv&&(t=l-8,z=Math.max(15,Math.ceil(Math.min(1,t/(e+n.top+n.bottom))*t)),this._vScrollDiv.style.left=s+v-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,c.y*t/e))+"px",this._vScrollDiv.style.height=
z+"px");!this._wrapMode&&this._hScrollDiv&&(t=v-8,z=Math.max(15,Math.ceil(Math.min(1,t/(this._maxLineWidth+n.left+n.right))*t)),this._hScrollDiv.style.left=s+Math.floor(Math.max(0,Math.floor(c.x*t/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=l-9+"px",this._hScrollDiv.style.width=z+"px");p=c.x;z=this._clipDiv;t=this._overlayDiv;if(A=this._marginDiv)A.style.left=-p+s+this._metrics.marginWidth+n.left+"px",A.style.bottom=("scroll"===f.style.overflowX?k:0)+"px";z?(z.scrollLeft=p,z.scrollTop=0,
f=s+n.left,k=n.top,a=v,s=l,p=0,A=-g,0===c.x&&(f-=n.left,a+=n.left,p=n.left),c.x+v===m&&(a+=n.right),0===c.y&&(k-=n.top,s+=n.top,A+=n.top),c.y+l===e&&(s+=n.bottom),z.style.left=f+"px",z.style.top=k+"px",z.style.right=D-a-f+"px",z.style.bottom=B-s-k+"px",d.style.left=p+"px",d.style.top=A+"px",d.style.width=m+"px",d.style.height=l+g+"px",t&&(t.style.left=d.style.left,t.style.top=d.style.top,t.style.width=d.style.width,t.style.height=d.style.height)):(f=p,k=g,D=p+v,B=g+l,0===f&&(f-=n.left),0===k&&(k-=
n.top),D===m&&(D+=n.right),c.y+l===e&&(B+=n.bottom),d.style.clip="rect("+k+"px,"+D+"px,"+B+"px,"+f+"px)",d.style.left=-p+s+n.left+"px",d.style.width=(this._wrapMode||b.isWebkit?m:v+p)+"px",a||(d.style.top=-g+n.top+"px",d.style.height=l+g+"px"),t&&(t.style.clip=d.style.clip,t.style.left=d.style.left,t.style.width=d.style.width,a||(t.style.top=d.style.top,t.style.height=d.style.height)));this._updateDOMSelection();u&&(d=this._ensureCaretVisible,this._ensureCaretVisible=!1,d&&this._showCaret(),this._queueUpdate())}}},
_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow="hidden":this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,d,f,g){if(a)for(var c=this._parent.ownerDocument,n=this._getLineHeight(),e=this._getViewPadding(),s=a.firstChild;s;){var u=s._ruler,t=u.getOverview();s.rulerChanged&&(m(u.getRulerStyle(),s),a.rulerWidth=void 0);if("fixed"!==t){var v=n;"page"===t&&(v+=this._topIndexY);s.style.top=-v+"px";s.style.height=
g+v+"px";var k,h=s.firstChild;h?(k=h,h=h.nextSibling):(k=b.createElement(c,"div"),k.style.visibility="hidden",s.appendChild(k));var A;if(s.rulerChanged&&k){v=-1;if(A=u.getWidestAnnotation())m(A.style,k),A.html&&(k.innerHTML=A.html);k.lineIndex=v;k.style.height=n+e.top+"px"}var l,z;if("page"===t){for(u=u.getAnnotations(d,f+1);h;)v=h.lineIndex,A=h.nextSibling,(!(d<=v&&v<=f)||h.lineChanged)&&s.removeChild(h),h=A;h=s.firstChild.nextSibling;z=c.createDocumentFragment();for(v=d;v<=f;v++)if(!h||h.lineIndex>
v){l=b.createElement(c,"div");if(A=u[v])m(A.style,l),A.html&&(l.innerHTML=A.html),l.annotation=A;l.lineIndex=v;l.style.height=this._getLineHeight(v)+"px";z.appendChild(l)}else z.firstChild&&(s.insertBefore(z,h),z=c.createDocumentFragment()),h&&(h=h.nextSibling);z.firstChild&&s.insertBefore(z,h)}else{A=this._getClientHeight();v=this._model.getLineCount();h=A+e.top+e.bottom-2*this._metrics.scrollWidth;n*v<h?(t=n,k=e.top):(t=h/v,k=this._metrics.scrollWidth);if(s.rulerChanged){for(A=s.childNodes.length;1<
A;)s.removeChild(s.lastChild),A--;u=u.getAnnotations(0,v);z=c.createDocumentFragment();for(var F in u)v=F>>>0,0>v||(l=b.createElement(c,"div"),A=u[F],m(A.style,l),l.style.position="absolute",l.style.top=k+n+Math.floor(v*t)+"px",A.html&&(l.innerHTML=A.html),l.annotation=A,l.lineIndex=v,z.appendChild(l));s.appendChild(z)}else if(s._oldTrackHeight!==h)for(l=s.firstChild?s.firstChild.nextSibling:null;l;)l.style.top=this._metrics.scrollWidth+n+Math.floor(l.lineIndex*t)+"px",l=l.nextSibling;s._oldTrackHeight=
h}}s.rulerChanged=!1;s=s.nextSibling}},_updateStyleSheet:function(){var a="";b.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");if(a){var d=this._clientDiv.ownerDocument,f=d.getElementById("_textviewStyle");if(f)f.removeChild(f.firstChild),f.appendChild(d.createTextNode(a));else{f=b.createElement(d,"style");f.id="_textviewStyle";var g=d.getElementsByTagName("head")[0]||d.documentElement;f.appendChild(d.createTextNode(a));g.insertBefore(f,
g.firstChild)}}},_updateStyle:function(a,d){!a&&b.isIE&&(this._rootDiv.style.lineHeight="normal");d=this._metrics=d||this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=b.isIE?d.lineHeight-(d.lineTrim.top+d.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(b.isMac&&b.isWebkit){var f=this._viewDiv;!d.invalid&&0===d.scrollWidth?(f.style.pointerEvents="none",f.style.zIndex="2"):(f.style.pointerEvents="",f.style.zIndex=
"")}a||(this.redraw(),this._resetLineWidth())}};h.EventTarget.addMixin(z.prototype);return{TextView:z}});y("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(l,r){function p(h){this._model=h;this._projections=[];var e=this;this._listener={onChanged:function(c){e._onChanged(c)},onChanging:function(c){e._onChanging(c)}};h.addEventListener("postChanged",this._listener.onChanged);h.addEventListener("preChanging",this._listener.onChanging)}p.prototype={destroy:function(){this._model&&
(this._model.removeEventListener("postChanged",this._listener.onChanged),this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(h){if(h){var e=this._model,c=this._projections;h._lineIndex=e.getLineAtOffset(h.start);h._lineCount=e.getLineAtOffset(h.end)-h._lineIndex;var b=h.text;b||(b="");h._model="string"===typeof b?new l.TextModel(b,e.getLineDelimiter()):b;var e=this.mapOffset(h.start,!0),b=h.end-h.start,k=h._lineCount,m=h._model.getCharCount(),
g=h._model.getLineCount()-1,a={type:"Changing",text:h._model.getText(),start:e,removedCharCount:b,addedCharCount:m,removedLineCount:k,addedLineCount:g};this.onChanging(a);a=this._binarySearch(c,h.start);c.splice(a,0,h);this.onChanged({type:"Changed",start:e,removedCharCount:b,addedCharCount:m,removedLineCount:k,addedLineCount:g})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(h,e){var c=this._projections,b=0,k,m;if(e){for(k=
0;k<c.length;k++){m=c[k];if(m.start>h)break;if(m.end>h)return-1;b+=m._model.getCharCount()-(m.end-m.start)}return h+b}for(k=0;k<c.length;k++){m=c[k];if(m.start>h-b)break;var g=m._model.getCharCount();if(m.start+g>h-b)return-1;b+=g-(m.end-m.start)}return h-b},removeProjection:function(h){this._removeProjection(h)},_removeProjection:function(h,e){var c,b=0;for(c=0;c<this._projections.length;c++){var k=this._projections[c];if(k===h){h=k;break}b+=k._model.getCharCount()-(k.end-k.start)}if(c<this._projections.length){var k=
this._model,b=h.start+b,m=h.end-h.start,g=h._lineCount,a=h._model.getCharCount(),t=h._model.getLineCount()-1;e||(k={type:"Changing",text:k.getText(h.start,h.end),start:b,removedCharCount:a,addedCharCount:m,removedLineCount:t,addedLineCount:g},this.onChanging(k));this._projections.splice(c,1);if(!e)this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:m,removedLineCount:t,addedLineCount:g})}},_binarySearch:function(h,e){for(var c=h.length,b=-1,k;1<c-b;)k=Math.floor((c+b)/2),e<=h[k].start?
c=k:b=k;return c},getCharCount:function(){for(var h=this._model.getCharCount(),e=this._projections,c=0;c<e.length;c++)var b=e[c],h=h+(b._model.getCharCount()-(b.end-b.start));return h},getLine:function(h,e){if(0>h)return null;var c=this._model,b=this._projections,k=0,m=[],g=0,a,t,f;for(a=0;a<b.length;a++){f=b[a];if(f._lineIndex>=h-k)break;t=f._model.getLineCount()-1;if(f._lineIndex+t>=h-k){g=h-(f._lineIndex+k);if(g<t)return f._model.getLine(g,e);m.push(f._model.getLine(t))}g=f.end;k+=t-f._lineCount}for(g=
Math.max(g,c.getLineStart(h-k));a<b.length;a++){f=b[a];if(f._lineIndex>h-k)break;m.push(c.getText(g,f.start));t=f._model.getLineCount()-1;if(f._lineIndex+t>h-k)return m.push(f._model.getLine(0,e)),m.join("");m.push(f._model.getText());g=f.end;k+=t-f._lineCount}b=c.getLineEnd(h-k,e);g<b&&m.push(c.getText(g,b));return m.join("")},getLineAtOffset:function(h){for(var e=this._model,c=this._projections,b=0,k=0,m=0;m<c.length;m++){var g=c[m];if(g.start>h-b)break;var a=g._model.getCharCount();if(g.start+
a>h-b){c=h-(g.start+b);k+=g._model.getLineAtOffset(c);b+=c;break}k+=g._model.getLineCount()-1-g._lineCount;b+=a-(g.end-g.start)}return e.getLineAtOffset(h-b)+k},getLineCount:function(){for(var h=this._projections,e=this._model.getLineCount(),c=0;c<h.length;c++)var b=h[c],e=e+(b._model.getLineCount()-1-b._lineCount);return e},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(h,e){if(0>h)return-1;for(var c=this._model,b=this._projections,k=0,m=0,g=0;g<b.length;g++){var a=
b[g];if(a._lineIndex>h-k)break;var t=a._model.getLineCount()-1;if(a._lineIndex+t>h-k)return a._model.getLineEnd(h-(a._lineIndex+k),e)+a.start+m;m+=a._model.getCharCount()-(a.end-a.start);k+=t-a._lineCount}return c.getLineEnd(h-k,e)+m},getLineStart:function(h){if(0>h)return-1;for(var e=this._model,c=this._projections,b=0,k=0,m=0;m<c.length;m++){var g=c[m];if(g._lineIndex>=h-b)break;var a=g._model.getLineCount()-1;if(g._lineIndex+a>=h-b)return g._model.getLineStart(h-(g._lineIndex+b))+g.start+k;k+=
g._model.getCharCount()-(g.end-g.start);b+=a-g._lineCount}return e.getLineStart(h-b)+k},getText:function(h,e){void 0===h&&(h=0);var c=this._model,b=this._projections,k=0,m=[],g,a,t;for(g=0;g<b.length;g++){a=b[g];if(a.start>h-k)break;t=a._model.getCharCount();if(a.start+t>h-k){if(void 0!==e&&a.start+t>e-k)return a._model.getText(h-(a.start+k),e-(a.start+k));m.push(a._model.getText(h-(a.start+k)));h=a.end+k+t-(a.end-a.start)}k+=t-(a.end-a.start)}var f=h-k;if(void 0!==e){for(;g<b.length;g++){a=b[g];
if(a.start>e-k)break;m.push(c.getText(f,a.start));t=a._model.getCharCount();if(a.start+t>e-k)return m.push(a._model.getText(0,e-(a.start+k))),m.join("");m.push(a._model.getText());f=a.end;k+=t-(a.end-a.start)}m.push(c.getText(f,e-k))}else{for(;g<b.length;g++)a=b[g],m.push(c.getText(f,a.start)),m.push(a._model.getText()),f=a.end;m.push(c.getText(f))}return m.join("")},_onChanged:function(h){h=this._change;var e=h.baseStart,c=h.baseEnd,b,k,m=this._projections;for(b=0;b<m.length&&!(k=m[b],k.end>e);b++);
var g=b;for(b=0;b<m.length&&!(k=m[b],k.start>=c);b++);var a=b,t=this._model,e=h.baseText.length-(c-e);for(b=a;b<m.length;b++)k=m[b],k.start+=e,k.end+=e,k._lineIndex=t.getLineAtOffset(k.start);k=m.splice(g,a-g);for(b=0;b<k.length;b++)k[b].annotation&&k[b].annotation._expand();this.onChanged({type:"Changed",start:h.start,removedCharCount:h.removedCharCount,addedCharCount:h.addedCharCount,removedLineCount:h.removedLineCount,addedLineCount:h.addedLineCount});this._change=void 0},_onChanging:function(h){var e=
!!this._change,c=this._change||{},b=h.start,k=b+h.removedCharCount;c.baseStart=b;c.baseEnd=k;c.baseText=h.text;c.addedLineCount=h.addedLineCount;if(!e){this._change=c;c.text=h.text;var m=this._projections,g,a,t;h=function(b){for(g=a=0;a<m.length;a++){t=m[a];if(t.start>b)break;if(t.end>b)return-1;g+=t._model.getCharCount()-(t.end-t.start)}return b+g};c.start=h(b);-1===c.start&&(c.text=this._model.getText(t.start,b)+c.text,c.addedLineCount+=this._model.getLineAtOffset(b)-this._model.getLineAtOffset(t.start),
c.start=t.start+g);c.end=h(k);-1===c.end&&(c.text+=this._model.getText(k,t.end),c.addedLineCount+=this._model.getLineAtOffset(t.end)-this._model.getLineAtOffset(k),c.end=t.start+g)}c.addedCharCount=c.text.length;c.removedCharCount=c.end-c.start;c.removedLineCount=this.getLineAtOffset(c.end)-this.getLineAtOffset(c.start);this.onChanging({type:"Changing",text:c.text,start:c.start,removedCharCount:c.removedCharCount,addedCharCount:c.addedCharCount,removedLineCount:c.removedLineCount,addedLineCount:c.addedLineCount})},
onChanging:function(h){return this.dispatchEvent(h)},onChanged:function(h){return this.dispatchEvent(h)},setLineDelimiter:function(h){this._model.setLineDelimiter(h)},setText:function(h,e,c){function b(b){for(m=g=0;g<k.length;g++){a=k[g];if(a.start>b-m)break;var d=a._model.getCharCount();if(a.start+d>b-m)return-1;m+=d-(a.end-a.start)}return b-m}this._change={text:h||"",start:e||0,end:void 0===c?this.getCharCount():c};var k=this._projections,m,g,a,t,f;h=b(this._change.start);-1===h&&(t={projection:a,
start:this._change.start-(a.start+m)},h=a.end);e=b(this._change.end);-1===e&&(f={projection:a,end:this._change.end-(a.start+m)},e=a.start);t&&f&&t.projection===f.projection?a._model.setText(this._change.text,t.start,f.end):(this._model.setText(this._change.text,h,e),t&&(a=t.projection,a._model.setText("",t.start)),f&&(a=f.projection,a._model.setText("",0,f.end),a.start=a.end,a._lineCount=0));this._change=void 0}};r.EventTarget.addMixin(p.prototype);return{ProjectionTextModel:p}});y("orion/editor/tooltip",
"i18n!orion/editor/nls/messages orion/editor/textView orion/editor/projectionTextModel orion/Deferred orion/editor/util orion/webui/littlelib orion/util".split(" "),function(l,r,p,h,e,c,b){function k(b){this._view=b;b=b.getOptions("parent");this._create(b?b.ownerDocument:document)}k.getTooltip=function(b){b._tooltip||(b._tooltip=new k(b));return b._tooltip};k.prototype={_create:function(c){if(!this._tooltipDiv){var g=this._tooltipDiv=b.createElement(c,"div");g.tabIndex=0;g.className="textviewTooltip";
g.setAttribute("aria-live","assertive");g.setAttribute("aria-atomic","true");this._tooltipDiv.style.visibility="hidden";c.body.appendChild(g);var a=this;e.addEventListener(c,"mousedown",this._mouseDownHandler=function(b){a.isVisible()&&(e.contains(g,b.target||b.srcElement)||a._locked||a.hide())},!0);e.addEventListener(c,"mousemove",this._mouseMoveHandler=function(b){a.isVisible()&&(!a._locked&&!a._hasFocus())&&(a._isInRect(a._outerArea,b.clientX,b.clientY)||a.hide())},!0);e.addEventListener(g,"focus",
function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnFocus")},!1);e.addEventListener(g,"blur",function(b){a._tooltipDiv.classList.remove("textViewTooltipOnFocus")},!1);e.addEventListener(g,"mouseenter",function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnHover")},!1);e.addEventListener(g,"mouseleave",function(b){a._hasFocus()||a._tooltipDiv.classList.remove("textViewTooltipOnHover")},!1);e.addEventListener(g,"keydown",function(b){27===b.keyCode&&(a._locked||a.hide())},
!1);this._view.addEventListener("Destroy",function(){a.destroy()})}},destroy:function(){if(this._tooltipDiv){this.hide();var b=this._tooltipDiv.parentNode;b&&b.removeChild(this._tooltipDiv);b=this._tooltipDiv.ownerDocument;e.removeEventListener(b,"mousedown",this._mouseDownHandler,!0);e.removeEventListener(b,"mousemove",this._mouseMoveHandler,!0);this._tooltipDiv=null}},show:function(b,g,a){this._locked=g;this._giveFocus=a;this._processInfo(b.getTooltipInfo())},update:function(b){b&&this._processInfo(b.getTooltipInfo(),
!0)},onHover:function(b,g,a){b&&!this._isInRect(this._anchorArea,g,a)&&(!this._isInRect(this._tooltipArea,g,a)&&!this._locked&&!this._hasFocus())&&this._processInfo(b.getTooltipInfo())},hide:function(){this.isVisible()&&(this.hover&&this.hover.clearQuickFixes(),this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipDiv.removeChild(this._tooltipContents),this._tooltipContents=null),this._tooltipDiv.classList.remove("textviewTooltipCodeProjection"),
this._tooltipDiv.classList.remove("textviewTooltipOnHover"),this._tooltipDiv.classList.remove("textviewTooltipOnFocus"),this._tooltipDiv.style.visibility="hidden",this._tooltipDiv.style.left="",this._tooltipDiv.style.right="",this._tooltipDiv.style.top="",this._tooltipDiv.style.bottom="",this._tooltipDiv.style.width="auto",this._tooltipDiv.style.maxWidth="",this._tooltipDiv.style.height="auto",this._tooltipDiv.style.maxHeight="",this._tooltipDiv.style.overflowX="",this._tooltipDiv.style.overflowY=
"",this._outerArea=this._tooltipArea=this._anchorArea=this._locked=this._giveFocus=void 0,this._hoverPromises&&this._hoverPromises.forEach(function(b){b.resolved||b.cancel()}),this._tipRect=this._hoverPromises=void 0)},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},_processInfo:function(c,g){if(this._tooltipDiv){var a;g&&this._tooltipContents?(this._tooltipContents.innerHTML="",a=this._tooltipContents):a=b.createElement(this._tooltipDiv.ownerDocument,
"div");if(c){if(c.contents&&this._renderImmediateInfo(a,c.contents,c.context))return this._showContents(a,c,g),!0;if(this.hover&&c.context&&(this._hoverPromises=this.hover.computeHoverInfo(c.context))){var e=this;this._hoverPromises.slice(0).forEach(function(b){h.when(b,function(n){if(e._hoverPromises){var d=e._hoverPromises.indexOf(b);0<=d&&e._hoverPromises.splice(d,1)}n&&e._renderPluginContent(a,n)&&(n.offsetStart&&(c.context.offsetStart=n.offsetStart),n.offsetEnd&&(c.context.offsetEnd=n.offsetEnd),
n.allowFullWidth&&(c.allowFullWidth=n.allowFullWidth),e._showContents(a,c,g))},function(a){console&&(a&&"Cancel"!==a.name)&&(console.log("Error computing hover tooltip"),console.log(a&&a.stack))})});return!0}}}},_showContents:function(b,g,a){if(a){if(this._tooltipArea&&g.tooltipArea&&(this._tooltipArea.left!==g.tooltipArea.left||this._tooltipArea.top!==g.tooltipArea.top||this._tooltipArea.width!==g.tooltipArea.width||this._tooltipArea.height!==g.tooltipArea.height))this._outerArea=this._tooltipArea=
this._anchorArea=null}else this.hide();this._tooltipContents=b;this._tooltipDiv.appendChild(b);this._anchorArea||(this._anchorArea=this._computeAnchorArea(g));this._tooltipArea||(this._tooltipArea=this._computeTooltipArea(g,this._anchorArea,this._tooltipDiv));this._outerArea||(this._outerArea=this._computeOuterArea(this._anchorArea,this._tooltipArea));this._tooltipDiv.style.visibility="visible";this._giveFocus&&(this._setInitialFocus(this._tooltipDiv),this._giveFocus=void 0)},_computeAnchorArea:function(b){if(b.anchorArea&&
b.anchorArea.top&&b.anchorArea.left&&b.anchorArea.height&&b.anchorArea.width)return b.anchorArea;if(b.context){if(b.context.offsetStart&&b.context.offsetEnd)return this._computeRectangleFromOffset(b.context.offsetStart,b.context.offsetEnd);if(0<=b.context.offset){var g=this._view.getNextOffset(b.context.offset,{unit:"word",count:-1});b=this._view.getNextOffset(b.context.offset,{unit:"word",count:0});return this._computeRectangleFromOffset(g,b)}}return{top:0,left:0,height:0,width:0}},_computeTooltipArea:function(b,
g,a){var c=a.ownerDocument.documentElement;if(b.tooltipArea&&b.tooltipArea.top&&b.tooltipArea.left&&b.tooltipArea.height&&b.tooltipArea.width)return a.style.overflowY="auto",a.style.resize="none",a.style.top=b.tooltipArea.top+"px",a.style.left=b.tooltipArea.left+"px",a.style.height=b.tooltipArea.height-16+"px",a.style.width=b.tooltipArea.width-16+"px",b.tooltipArea;var f=a.getBoundingClientRect(),f={width:f.width,height:f.height},n=b.position?b.position:"below",d=(this._view._rootDiv?this._view._rootDiv:
c).getBoundingClientRect(),c=d.left,e=d.top,s=d.width,d=d.height,v=s;if(!b.allowFullWidth){var v=Math.min(s/2,600),k=Math.min(d/2,250);f.width=Math.min(f.width,v);f.height=Math.min(f.height,k)}41>f.height&&f.width>v-16&&(f.height=56);var v=d-(g.top+g.height-e),h=g.top-e,k=s-(g.left+g.width-c);"above"===n&&f.height>h&&f.height<=v?n="below":"below"===n&&(f.height>v&&f.height<=h)&&(n="above");h=b.tooltipOffsetX?b.tooltipOffsetX:0;b=b.tooltipOffsetY?b.tooltipOffsetY:0;switch(n){case "left":f.top=f.height+
b>v+g.height?d+e-f.height:g.top+b;f.top=Math.max(f.top,e);f.left=Math.max(g.left-f.width+h,c);break;case "right":f.top=f.height+b>v+g.height?d+e-f.height:g.top+b;f.top=Math.max(f.top,e);f.left=Math.max(g.left+g.width+h,c);break;case "above":f.left=f.width+h>k+g.width?s+c-f.width:g.left+h;f.left=Math.max(f.left,c);f.top=Math.max(g.top-f.height+b,e);break;case "below":f.left=f.width+h>k+g.width?s+c-f.width:g.left+h,f.left=Math.max(f.left,c),f.top=Math.max(g.top+g.height+b,e)}f.maxWidth=Math.min(s+c-
f.left,s);f.maxHeight=Math.min(d+e-f.top,d);a.style.maxWidth=f.maxWidth-16+"px";a.style.maxHeight=f.maxHeight-16+"px";a.style.width=f.width-16+"px";a.style.height=f.height-16+"px";a.style.left=f.left+"px";a.style.top=f.top+"px";return f},_computeOuterArea:function(b,g){var a=Math.min(b.left,g.left),c=Math.min(b.top,g.top),f=Math.max(b.left+b.width,g.left+g.width),n=Math.max(b.top+b.height,g.top+g.height);return{left:a,top:c,width:f-a,height:n-c}},_hasFocus:function(){var b=this._tooltipDiv;return!b?
!1:e.contains(b,b.ownerDocument.activeElement)},_isNode:function(b){return"object"===typeof Node?b instanceof Node:b&&"object"===typeof b&&"number"===typeof b.nodeType&&"string"===typeof b.nodeName},_setInitialFocus:function(b){var g=c.$("button",b);if(g)g.focus();else if(g=c.$("a",b)){g.focus();var a=this;g.addEventListener("click",function(){a.hide()})}else(b=c.firstTabbable(b))&&b.focus()},_isInRect:function(b,g,a){if(!b)return!1;a=a>=b.top&&a<=b.top+b.height;return g>=b.left&&g<=b.left+b.width&&
a},mapOffset:function(b,g){var a=this._view.getModel();a.getBaseModel&&(b=a.mapOffset(b,g));return b},_computeRectangleFromOffset:function(b,g){b=this.mapOffset(b);g=this.mapOffset(g);var a=this._view,c=a.getLineAtOffset(b),f=a.getLineAtOffset(g);c!==f&&(g=a.getModel().getLineEnd(c));c=a.getLineHeight(c);f=a.getLocationAtOffset(b);a=a.getLocationAtOffset(g);a={x:f.x,y:f.y,width:a.x-f.x,height:c};a=this._view.convert(a,"document","page");return{left:a.x,top:a.y,width:a.width,height:a.height}},_renderPluginContent:function(c,
g){var a=this._tooltipDiv.ownerDocument;if("string"!==typeof g&&"undefined"===typeof g.content)return!1;var e=b.createElement(a,"div");if(g.title){var f=b.createElement(a,"div");f.innerHTML=this.hover.renderMarkDown?this.hover.renderMarkDown(g.title):g.title;e.appendChild(f)}f=b.createElement(a,"div");if("string"===typeof g)f.appendChild(a.createTextNode(g));else switch(g.type){case "delegatedUI":case "html":g.content&&(a=a.createElement("iframe"),a.id="HtmlHover",a.name="HTML Hover",a.type="text/html",
a.sandbox="allow-scripts allow-same-origin allow-forms",a.style.border="none",a.style.width="100%",a.style.height="100%",this._tooltipDiv.style.paddingBottom="5px",a.srcdoc=g.content,g.width&&(a.style.width=g.width),g.height&&(a.style.height=g.height),e.style.height="100%",c.style.height="100%",e.appendChild(a));break;case "markdown":this.hover.renderMarkDown&&(f.innerHTML=this.hover.renderMarkDown(g.content));break;default:f.appendChild(a.createTextNode(g.content))}e.appendChild(f);c.appendChild(e);
return!0},_renderImmediateInfo:function(b,g,a){if(g instanceof Array&&(g=this._getAnnotationContents(g,a),!g))return!1;if("string"===typeof g)return b.innerHTML=g,!0;if(this._isNode(g))return b.appendChild(g),!0;if(g instanceof p.ProjectionTextModel){var c=this._view;a=c.getOptions();a.wrapMode=!1;a.parent=b;var f=a.themeClass;f?((f=f.replace("tooltipTheme",""))&&(f=" "+f),f="tooltipTheme"+f):f="tooltipTheme";a.themeClass=f;a=this._contentsView=new r.TextView(a);a.addEventListener("LineStyle",function(a){c.onLineStyle(a)});
a.setModel(g);this._tooltipDiv.appendChild(b);this._tooltipDiv.classList.add("textviewTooltipCodeProjection");g=a.computeSize();b.style.width=g.width+8+"px";b.style.height=g.height+8+"px";a.resize();this._tooltipDiv.removeChild(b);return!0}return!1},_getAnnotationContents:function(c,g){function a(a,d){var f=a.title,c=b.createElement(s,"div");c.className="tooltipRow";if(a.html){var n=b.createElement(s,"div");n.className="tooltipImage";n.innerHTML=a.html;n.lastChild&&e.addEventListener(n.lastChild,
"click",function(){var d=a.start,b=a.end;k.getBaseModel&&(d=k.mapOffset(d,!0),b=k.mapOffset(b,!0));v.setSelection(d,b,1/3,function(){t.hide()})},!1);c.appendChild(n)}f||(f=h.getLineStart(h.getLineAtOffset(a.start)),n=h.getLineEnd(h.getLineAtOffset(a.end),!0),f=h.getText(f,n));"function"===typeof f&&(f=a.title());"string"===typeof f&&(n=b.createElement(s,"span"),n.className="tooltipTitle",n.appendChild(s.createTextNode(f)),f=n);c.appendChild(f);d&&t.hover.renderQuickFixes(a,c);g&&(g.offsetStart=a.start,
g.offsetEnd=a.end);return c}var t=this,f=t.hover?!0:!1;f&&(g&&g.source&&0<=g.source.indexOf("ruler"))&&(f=!1);for(var n,d=[],u=0;u<c.length;u++)n=c[u],""!==n.title&&!n.groupAnnotation&&(!f||n.title)&&d.push(n);c=d;if(0===c.length)return null;var s=this._tooltipDiv.ownerDocument,v=this._view,k=v.getModel(),h=k.getBaseModel?k.getBaseModel():k;if(1===c.length&&"orion.annotation.folding"===c[0].type)return f=new p.ProjectionTextModel(h),n=h.getLineStart(h.getLineAtOffset(c[0].start)),d=h.getCharCount(),
c[0].end!==d&&f.addProjection({start:c[0].end,end:d}),0<n&&f.addProjection({start:0,end:n}),f;if(1===c.length){if((n=a(c[0],f))&&n.firstChild)(f=n.firstChild.className)&&(f+=" "),n.firstChild.className=f+"single";return n}d=b.createElement(s,"div");n=b.createElement(s,"em");n.appendChild(s.createTextNode(l.multipleAnnotations));d.appendChild(n);for(u=0;u<c.length;u++)(n=a(c[u],f))&&d.appendChild(n);return d}};return{Tooltip:k}});y("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],
function(l,r){function p(){}function h(a,b,f){this.start=a;this.end=b;this._projectionModel=f;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function e(a,b){var f=a.lastIndexOf("."),f=a.substring(f+1),g={title:l[f],style:{styleClass:"annotation "+f},html:"\x3cdiv class\x3d'annotationHTML "+f+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+f}};b?g.lineStyle={styleClass:"annotationLine "+f}:g.rangeStyle={styleClass:"annotationRange "+f};p.registerType(a,
g)}function c(){}function b(a,b,f,g,d){var c;void 0===g&&(g=-1);void 0===d&&(d=a.length);for(;1<d-g;)if(c=Math.floor((d+g)/2),b<=a[c].start)d=c;else if(f&&b<a[c].end){d=c;break}else g=c;return d}function k(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}function m(a,b){this._view=a;this._annotationModel=b;var f=this;this._listener={onDestroy:function(a){f._onDestroy(a)},onLineStyle:function(a){f._onLineStyle(a)},onChanged:function(a){f._onAnnotationModelChanged(a)}};
a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}h.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded)return!1;this.expanded=
!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;
var b=a.getBaseModel();this._projection={annotation:this,start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var b=this._annotationModel.getAnnotations(this.start,
this.end);b.hasNext();){var f=b.next();f!==this&&f.type===p.ANNOTATION_FOLDING&&a.call(this,f)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};p.ANNOTATION_ERROR="orion.annotation.error";p.ANNOTATION_WARNING="orion.annotation.warning";p.ANNOTATION_TASK="orion.annotation.task";p.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";p.ANNOTATION_BOOKMARK="orion.annotation.bookmark";p.ANNOTATION_FOLDING="orion.annotation.folding";
p.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";p.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";p.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";p.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";p.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";p.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";p.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";p.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";
p.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";p.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";p.ANNOTATION_BLAME="orion.annotation.blame";p.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";p.ANNOTATION_DIFF_ADDED="orion.annotation.diffAdded";p.ANNOTATION_DIFF_DELETED="orion.annotation.diffDeleted";p.ANNOTATION_DIFF_MODIFIED="orion.annotation.diffModified";var g={};p.registerType=function(a,b){var f=b;"function"!==typeof f&&(f=function(a,d,b){this.start=a;
this.end=d;void 0!==b&&(this.title=b)},f.prototype=b);f.prototype.type=a;g[a]=f;return a};p.createAnnotation=function(a,b,f,g){return new (this.getType(a))(b,f,g)};p.getType=function(a){return g[a]};e(p.ANNOTATION_ERROR);e(p.ANNOTATION_WARNING);e(p.ANNOTATION_TASK);e(p.ANNOTATION_BREAKPOINT);e(p.ANNOTATION_BOOKMARK);e(p.ANNOTATION_CURRENT_BRACKET);e(p.ANNOTATION_MATCHING_BRACKET);e(p.ANNOTATION_CURRENT_SEARCH);e(p.ANNOTATION_MATCHING_SEARCH);e(p.ANNOTATION_READ_OCCURRENCE);e(p.ANNOTATION_WRITE_OCCURRENCE);
e(p.ANNOTATION_SELECTED_LINKED_GROUP);e(p.ANNOTATION_CURRENT_LINKED_GROUP);e(p.ANNOTATION_LINKED_GROUP);e(p.ANNOTATION_CURRENT_LINE,!0);e(p.ANNOTATION_BLAME,!0);e(p.ANNOTATION_CURRENT_BLAME,!0);e(p.ANNOTATION_DIFF_ADDED);e(p.ANNOTATION_DIFF_DELETED);e(p.ANNOTATION_DIFF_MODIFIED);p.registerType(p.ANNOTATION_FOLDING,h);c.addMixin=function(a){var b=c.prototype,f;for(f in b)b.hasOwnProperty(f)&&(a[f]=b[f])};c.prototype={addAnnotationType:function(a,b){this._annotationTypes||(this._annotationTypes=[]);
var f=b-1;void 0==b||!(0<=f&&f<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(f,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a)return b+1;return 0},getAnnotationsByType:function(a,b,f){a=a.getAnnotations(b,f);for(f=[];a.hasNext();)b=a.next(),0!==this.getAnnotationTypePriority(b.type)&&f.push(b);var g=this;f.sort(function(a,b){return g.getAnnotationTypePriority(a.type)-
g.getAnnotationTypePriority(b.type)});return f},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a){this._annotationTypes.splice(b,1);break}}};k.prototype={addAnnotation:function(a){if(a){var g=this._annotations,f=b(g,a.start);g.splice(f,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},
getTextModel:function(){return this._model},getAnnotations:function(a,b){var f=this._annotations,g,d=0,c;c=void 0===a&&void 0===b?function(){return d<f.length?f[d++]:null}:function(){for(;d<f.length;){var g=f[d++];if(a===g.start||(a>g.start?a<g.end:g.start<b))return g;if(g.start>=b)break}return null};g=c();return{next:function(){var a=g;a&&(g=c());return a},hasNext:function(){return null!==g}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],
removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,f,g;if(a){f=[];for(g=b.length-1;0<=g;g--){var d=b[g];d.type===a&&(b.splice(g,1),f.splice(0,0,d),d._annotationModel=null)}}else f=b;this.onChanged({type:"Changed",removed:f,added:[],changed:[]})},removeAnnotation:function(a){if(a){var b=this._getAnnotationIndex(a);0>b||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(b,1),added:[],changed:[]},
this.onChanged(a))}},replaceAnnotations:function(a,g){var f=this._annotations,c,d,e,s=[];if(a)for(c=a.length-1;0<=c;c--)e=a[c],d=this._getAnnotationIndex(e),0>d||(e._annotationModel=null,f.splice(d,1),s.splice(0,0,e));g||(g=[]);for(c=0;c<g.length;c++)e=g[c],d=b(f,e.start),e._annotationModel=this,f.splice(d,0,e);this.onChanged({type:"Changed",removed:s,added:g,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",
this._listener.onChanged)},_getAnnotationIndex:function(a){for(var g=this._annotations,f=b(g,a.start);f<g.length&&g[f].start===a.start;){if(g[f]===a)return f;f++}return-1},_onChanged:function(a){var b=a.start,f=a.addedCharCount,g=a.removedCharCount,d=this._annotations,c=b+g;if(0<d.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};f-=g;for(g=0;g<d.length;g++){var e=d[g];e.start>=c?(e._oldStart=e.start,e._oldEnd=e.end,e.start+=f,e.end+=f,a.changed.push(e)):e.end<=b||
(e.start<b&&c<e.end?(e._oldStart=e.start,e._oldEnd=e.end,e.end+=f,a.changed.push(e)):(d.splice(g,1),a.removed.push(e),e._annotationModel=null,e.expand&&e.expand(),g--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};r.EventTarget.addMixin(k.prototype);m.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&
a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var f;b.tagName&&!a.tagName&&(a.tagName=b.tagName);if(b.style)for(f in a.style||(a.style={}),b.style)a.style[f]||(a.style[f]=b.style[f]);if(b.attributes)for(f in a.attributes||(a.attributes={}),b.attributes)a.attributes[f]||(a.attributes[f]=b.attributes[f])}return a},_mergeStyleRanges:function(a,
g){a||(a=[]);for(var f,c=b(a,g.start,!0);c<a.length&&g;c++){var d=a[c];if(g.end<=d.start)break;if(!(g.start>=d.end)){f=this._mergeStyle({},d.style);f=this._mergeStyle(f,g.style);var e=[];e.push(c,1);g.start<d.start&&e.push({start:g.start,end:d.start,style:g.style});g.start>d.start&&e.push({start:d.start,end:g.start,style:d.style});e.push({start:Math.max(d.start,g.start),end:Math.min(d.end,g.end),style:f});g.end<d.end&&e.push({start:g.end,end:d.end,style:d.style});g=g.end>d.end?{start:d.end,end:g.end,
style:g.style}:null;Array.prototype.splice.apply(a,e)}}g&&(f=this._mergeStyle({},g.style),a.splice(c,0,{start:g.start,end:g.end,style:f}));return a},_onAnnotationModelChanged:function(a){function b(a,d){c.getBaseModel&&(a=c.mapOffset(a,!0),d=c.mapOffset(d,!0));-1!==a&&-1!==d&&g.redrawRange(a,d)}function f(a,f){for(var g=0;g<a.length;g++)if(d.isAnnotationTypeVisible(a[g].type)){var c=a[g];b(c.start,c.end);f&&(void 0!==c._oldStart&&c._oldEnd)&&b(c._oldStart,c._oldEnd)}}var g=this._view;if(g){var d=
this,c=g.getModel();f(a.added);f(a.removed);f(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,f=a.textView.getModel(),g=b.getTextModel(),d=a.lineStart,c=a.lineStart+a.lineText.length;g!==f&&(d=f.mapOffset(d),c=f.mapOffset(c));for(b=b.getAnnotations(d,c);b.hasNext();)if(d=b.next(),this.isAnnotationTypeVisible(d.type)){if(d.rangeStyle){var c=d.start,e=d.end;g!==f&&(c=f.mapOffset(c,!0),e=f.mapOffset(e,!0));a.ranges=this._mergeStyleRanges(a.ranges,
{start:c,end:e,style:d.rangeStyle})}d.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,d.lineStyle))}}};c.addMixin(m.prototype);return{FoldingAnnotation:h,AnnotationType:p,AnnotationTypeList:c,AnnotationModel:k,AnnotationStyler:m}});y("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(l,r,p,h,e,c){function b(b){b=b||{};this._domNode=b.domNode;this._model=
b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}function k(g){g=g||{};b.call(this,g);this._textViewFactory=g.textViewFactory;this._undoStackFactory=g.undoStackFactory;this._textDNDFactory=g.textDNDFactory;this._annotationFactory=g.annotationFactory;this._zoomRulerFactory=g.zoomRulerFactory;this._foldingRulerFactory=
g.foldingRulerFactory;this._lineNumberRulerFactory=g.lineNumberRulerFactory;this._contentAssistFactory=g.contentAssistFactory;this._keyBindingFactory=g.keyBindingFactory;this._hoverFactory=g.hoverFactory;this._contentAssist=this._foldingRuler=this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var m=h.AnnotationType;b.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._undoStack?!this._undoStack.isClean():this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},
onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,c){this._statusReporter&&this._statusReporter(b,a,c)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,c,f){this._title=b;f||(a?this.reportStatus(a,"error"):null!==c&&
void 0!==c&&("string"===typeof c&&this._setModelText(c),this._undoStack&&this._undoStack.reset()));this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:c,contentsSaved:f})},setText:function(b,a,c){this.getModel().setText(b,a,c)},uninstall:function(){this.installed=!1}};r.EventTarget.addMixin(b.prototype);k.prototype=new b;e.mixin(k.prototype,{destroy:function(){b.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=
this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},
getTooltip:function(){return p.Tooltip.getTooltip(this._textView)},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var c=this._textView;b?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=
b,this._foldingRuler){var c=this._textView;c.getModel().getBaseModel&&(b?c.addRuler(this._foldingRuler):c.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var c=this._textView;b?c.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):c.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=
b,this._overviewRuler){var c=this._textView;b?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(b,a){if(this._zoomRulerVisible!==b||a)if(this._zoomRulerVisible=b,this._zoomRuler){var c=this._textView;b?c.addRuler(this._zoomRuler):c.removeRuler(this._zoomRuler)}},mapOffset:function(b,a){var c=this._textView.getModel();c.getBaseModel&&(b=c.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},
getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},getSelections:function(){var b=this._textView,a=b.getModel(),b=b.getSelections();b.forEach(function(b){a.getBaseModel&&(b.start=a.mapOffset(b.start),b.end=a.mapOffset(b.end))});return b},_expandOffset:function(b){var a=
this._textView.getModel(),c=this._annotationModel;if(c&&a.getBaseModel)for(b=c.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===m.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,c){var f=this._textView,n=f.getModel();n.getBaseModel&&(this._expandOffset(b),b=n.mapOffset(b,!0));f.setCaretOffset(b,a,c)},setText:function(b,a,c,f,n){var d=this._textView,e=d.getModel();e.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=e.mapOffset(a,!0)),void 0!==c&&(this._expandOffset(c),
c=e.mapOffset(c,!0)));d.setText(b,a,c,f,n)},setSelection:function(b,a,c,f){var n=this._textView,d=n.getModel();d.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=d.mapOffset(b,!0),a=d.mapOffset(a,!0));n.setSelection(b,a,c,f)},setSelections:function(b,a,c){var f=this,n=this._textView,d=n.getModel();b.forEach(function(a){var b=a.start,g=a.end;d.getBaseModel&&(f._expandOffset(b),f._expandOffset(g),b=d.mapOffset(b,!0),g=d.mapOffset(g,!0));a.start=b;a.end=g});n.setSelections(b,a,c)},moveSelection:function(b,
a,c,f){var n=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===f||f)&&n.focus();c&&c()})},_getTooltipInfo:function(b,a){var c=this._textView,f=this.getAnnotationModel();if(!f)return null;var n=this._annotationStyler;if(!n||!c.isValidTextPosition(b,a))return null;c=c.getOffsetAtLocation(b,a);if(-1===c)return null;for(var c=this.mapOffset(c),f=n.getAnnotationsByType(f,c,c+1),n=[],d=0;d<f.length;d++)f[d].rangeStyle&&n.push(f[d]);return{contents:n,position:"below",context:{source:"editor",
offset:c}}},_highlightCurrentLine:function(b,a){function c(a){var d={};return a&&a.some(function(a){if(a&&a.isEmpty())d[e.getLineAtOffset(a.start).toString()]=!0;else return!0;return!1})?{}:d}function f(a,d){for(var b in a)if(!d[b])return!0;return!1}var n=this._annotationModel;if(n){var d=this._textView;if(!d.getOptions("singleMode")){a=Array.isArray(a)?a:[a];b=Array.isArray(b)?b:[b];var e=d.getModel(),d=c(a),s=c(b);if(f(d,s)||f(s,d)){var d=this._currentLineAnnotations,k=[],h;for(h in s){var l=h>>
0,s=e.getLineStart(l),l=e.getLineEnd(l);e.getBaseModel&&(s=e.mapOffset(s),l=e.mapOffset(l));s=m.createAnnotation(m.ANNOTATION_CURRENT_LINE,s,l);k.push(s)}this._currentLineAnnotations=k;n.replaceAnnotations(d,k)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this._textView.setOptions({undoStack:this._undoStack}),this.checkDirty());this._textDNDFactory&&
(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var g=p.Tooltip.getTooltip(this._textView);this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this),g.hover=this._hover);var a=this,c=this._textView,f=this;this._listener={onModelChanged:function(a){f.checkDirty()},onMouseOver:function(a){f._listener.onMouseMove(a)},onMouseDown:function(a){f._listener.mouseDown=
!0},onMouseUp:function(a){f._listener.mouseDown=!1},onMouseMove:function(a){g&&!f._listener.mouseDown&&!(a.event.clientX===f._listener.lastMouseX&&a.event.clientY===f._listener.lastMouseY)&&(f._listener.lastMouseX=a.event.clientX,f._listener.lastMouseY=a.event.clientY,f._hoverTimeout&&(window.clearTimeout(f._hoverTimeout),f._hoverTimeout=null),f._hoverTimeout=window.setTimeout(function(){f._hoverTimeout=null;if(f._listener)g.onHover({y:a.y,x:a.x,getTooltipInfo:function(){return f._getTooltipInfo(this.x,
this.y)}},a.x,a.y)},175))},onMouseOut:function(a){f._hoverTimeout&&(window.clearTimeout(f._hoverTimeout),f._hoverTimeout=null)},onScroll:function(a){g&&g.hide()},onSelection:function(a){g&&g.hide();f._updateCursorStatus();f._highlightCurrentLine(a.newValue,a.oldValue)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Selection",this._listener.onSelection);c.addEventListener("MouseOver",this._listener.onMouseOver);c.addEventListener("MouseOut",this._listener.onMouseOut);
c.addEventListener("MouseDown",this._listener.onMouseDown);c.addEventListener("MouseUp",this._listener.onMouseUp);c.addEventListener("MouseMove",this._listener.onMouseMove);c.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var n;if(n="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(a,this._undoStack,this._contentAssist))this._textActions=n.textActions,
this._linkedMode=n.linkedMode,this._sourceCodeActions=n.sourceCodeActions}n=function(d,b){if(void 0!==d&&-1!==d){for(var f=this.getView().getModel(),g=this.getAnnotationModel(),c=a.mapOffset(f.getLineStart(d)),f=a.mapOffset(f.getLineEnd(d)),n=g.getAnnotations(c,f),e=null;n.hasNext();){var u=n.next();if(u.type===m.ANNOTATION_BOOKMARK){e=u;break}}e?g.removeAnnotation(e):(e=m.createAnnotation(m.ANNOTATION_BOOKMARK,c,f,a.getText(c,f)),g.addAnnotation(e))}};if(this._annotationFactory){var d=c.getModel();
d.getBaseModel&&(d=d.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(d))if(d=this._annotationStyler=this._annotationFactory.createAnnotationStyler(c,this._annotationModel))d.addAnnotationType(m.ANNOTATION_CURRENT_SEARCH),d.addAnnotationType(m.ANNOTATION_MATCHING_SEARCH),d.addAnnotationType(m.ANNOTATION_ERROR),d.addAnnotationType(m.ANNOTATION_WARNING),d.addAnnotationType(m.ANNOTATION_MATCHING_BRACKET),d.addAnnotationType(m.ANNOTATION_CURRENT_BRACKET),d.addAnnotationType(m.ANNOTATION_CURRENT_LINE),
d.addAnnotationType(m.ANNOTATION_READ_OCCURRENCE),d.addAnnotationType(m.ANNOTATION_WRITE_OCCURRENCE),d.addAnnotationType(m.ANNOTATION_SELECTED_LINKED_GROUP),d.addAnnotationType(m.ANNOTATION_CURRENT_LINKED_GROUP),d.addAnnotationType(m.ANNOTATION_LINKED_GROUP),d.addAnnotationType("orion.annotation.highlightError");var d=this._annotationFactory.createAnnotationRulers(this._annotationModel),e=this._annotationRuler=d.annotationRuler;e&&(e.onDblClick=n,e.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),
e.addAnnotationType(m.ANNOTATION_ERROR),e.addAnnotationType(m.ANNOTATION_WARNING),e.addAnnotationType(m.ANNOTATION_TASK),e.addAnnotationType(m.ANNOTATION_BOOKMARK),e.addAnnotationType(m.ANNOTATION_DIFF_ADDED),e.addAnnotationType(m.ANNOTATION_DIFF_DELETED),e.addAnnotationType(m.ANNOTATION_DIFF_MODIFIED));this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(e=this._overviewRuler=d.overviewRuler)e.addAnnotationType(m.ANNOTATION_CURRENT_SEARCH),e.addAnnotationType(m.ANNOTATION_MATCHING_SEARCH),
e.addAnnotationType(m.ANNOTATION_READ_OCCURRENCE),e.addAnnotationType(m.ANNOTATION_WRITE_OCCURRENCE),e.addAnnotationType(m.ANNOTATION_CURRENT_BLAME),e.addAnnotationType(m.ANNOTATION_ERROR),e.addAnnotationType(m.ANNOTATION_WARNING),e.addAnnotationType(m.ANNOTATION_TASK),e.addAnnotationType(m.ANNOTATION_BOOKMARK),e.addAnnotationType(m.ANNOTATION_MATCHING_BRACKET),e.addAnnotationType(m.ANNOTATION_CURRENT_BRACKET),e.addAnnotationType(m.ANNOTATION_CURRENT_LINE),e.addAnnotationType(m.ANNOTATION_DIFF_ADDED),
e.addAnnotationType(m.ANNOTATION_DIFF_DELETED),e.addAnnotationType(m.ANNOTATION_DIFF_MODIFIED);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),this.setZoomRulerVisible(this._zoomRulerVisible,!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(m.ANNOTATION_CURRENT_BLAME),
this._lineNumberRuler.addAnnotationType(m.ANNOTATION_BLAME),this._lineNumberRuler.addAnnotationType(m.ANNOTATION_DIFF_ADDED),this._lineNumberRuler.addAnnotationType(m.ANNOTATION_DIFF_MODIFIED),this._lineNumberRuler.addAnnotationType(m.ANNOTATION_DIFF_DELETED),this._lineNumberRuler.onDblClick=n,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),
this._foldingRuler.addAnnotationType(m.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:c});b.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var g=this._textView;g&&(g.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=
this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotations=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:g}),b.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getKeyModes(),a=0;a<b.length;a++){var e=
b[a];if(e.isActive()&&e.isStatusActive&&e.isStatusActive())return}b=this.getModel();a=this.getSelections();1<a.length?b=c.formatMessage(l.multiSelections,a.length):(a=a[0].getCaret(),e=b.getLineAtOffset(a),b=b.getLineStart(e),b=c.formatMessage(l.lineColumn,e+1,a-b+1));this.reportStatus(b)},showAnnotations:function(b,a,c,f){var n=this._annotationModel;if(n){for(var d=[],e=[],s=n.getTextModel(),k=n.getAnnotations(),h;k.hasNext();)h=k.next(),-1!==a.indexOf(h.type)&&h.creatorID===this&&d.push(h);if(b)for(a=
0;a<b.length;a++)if(h=b[a]){if(c)h=c(h);else{var l;h.lineStart&&h.lineEnd?(k=s.getLineStart(h.lineStart),l=s.getLineCount()===h.lineEnd?s.getLineEnd(h.lineEnd-1):s.getLineStart(h.lineEnd)):"number"===typeof h.line?(l=s.getLineStart(h.line-1),k=l+h.start-1,l=l+h.end-1):(k=h.start,l=h.end);var z=f(h);if(!z)continue;h=m.createAnnotation(z,k,l,h.description)}h.id=b[a].id;b[a].data&&(h.data=b[a].data);h.creatorID=this;e.push(h)}n.replaceAnnotations(d,e)}},showProblems:function(b){this.showAnnotations(b,
[m.ANNOTATION_ERROR,m.ANNOTATION_WARNING,m.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return m.ANNOTATION_ERROR;case "warning":return m.ANNOTATION_WARNING;case "task":return m.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[m.ANNOTATION_READ_OCCURRENCE,m.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?m.ANNOTATION_READ_OCCURRENCE:m.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,k=this.getTextView().getOptions("parent").ownerDocument;
if(!a){var f=c.createElement(k,"div");f.className="annotation blame";k.body.appendChild(f);var n=(k.defaultView||k.parentWindow).getComputedStyle(f).getPropertyValue("background-color");f.parentNode.removeChild(f);var f=n.indexOf("("),d=n.indexOf(")"),n=n.substring(f+1,d);this._blameRGB=a=n.split(",").slice(0,3)}var u=function(){var a=h.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=e.mixin({},a.style);a.style.style=e.mixin({},a.style.style);a.style.style.backgroundColor=
"";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},s=function(){var a=c.createElement(k,"div");a.className="tooltipTitle";var d=this.blame.Message.indexOf("\n");-1===d&&(d=this.blame.Message.length);var b=c.createElement(k,"a");b.href=this.blame.CommitLink;b.appendChild(k.createTextNode(this.blame.Message.substring(0,d)));a.appendChild(b);a.appendChild(c.createElement(k,"br"));a.appendChild(k.createTextNode(c.formatMessage(l.committerOnTime,this.blame.AuthorName,
this.blame.Time)));return a},v=this.getModel();this.showAnnotations(b,[m.ANNOTATION_BLAME,m.ANNOTATION_CURRENT_BLAME],function(d){var b=v.getLineStart(d.Start-1),f=v.getLineEnd(d.End-1,!0),b=h.AnnotationType.createAnnotation(m.ANNOTATION_BLAME,b,f,s),f=a.slice(0);f.push(d.Shade);b.style=e.mixin({},b.style);b.style.style=e.mixin({},b.style.style);b.style.style.backgroundColor="rgba("+f.join()+")";b.groupId=d.Name;b.groupType=m.ANNOTATION_CURRENT_BLAME;b.createGroupAnnotation=u;b.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+
d.AuthorImage+'"/\x3e';b.blame=d;return b})},showDiffAnnotations:function(b){this.showAnnotations(b,[m.ANNOTATION_DIFF_ADDED,m.ANNOTATION_DIFF_MODIFIED,m.ANNOTATION_DIFF_DELETED],null,function(a){return"added"===a.type?m.ANNOTATION_DIFF_ADDED:"modified"===a.type?m.ANNOTATION_DIFF_MODIFIED:m.ANNOTATION_DIFF_DELETED})},showSelection:function(b,a,c,f,n){return"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a),!0):"number"===typeof c?(b=this.getModel().getLineStart(c-1),"number"===
typeof f&&(b+=f),"number"!==typeof n&&(n=0),this.moveSelection(b,b+n),!0):!1},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelections()))},setInput:function(g,a,c,f,n){b.prototype.setInput.call(this,g,a,c,f);this._textView&&(!f&&!n)&&this._textView.focus()},onGotoLine:function(b,a,c,f){if(this._textView){var n=this.getModel();b=Math.max(0,Math.min(b,n.getLineCount()-1));var d=n.getLineStart(b),
e=0;void 0===c&&(c=0);"string"===typeof a?(b=n.getLine(b).indexOf(a),-1!==b&&(e=b,c=e+a.length)):(e=a,a=n.getLineEnd(b)-d,e=Math.min(e,a),c=Math.min(c,a));this.moveSelection(d+e,d+c,f)}}});return{BaseEditor:b,Editor:k}});y("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(l,r,p,h,e,c,b){function k(a){var b=a.getTextView();p.KeyMode.call(this,b);this.editor=a;this._active=!1;
this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));var f=this;this._listener={onVerify:function(a){var d=f.editor,b=d.getModel(),c=d.mapOffset(a.start),d=d.mapOffset(a.end),b=b.getText(c,d);if((b=f._prefix.match(RegExp("^"+e.escape(b),"i")))&&0<b.length)f._prefix+=a.text,f._success=!0,f._status(),f.find(f._forward,!0),
a.text=null},onSelection:function(){f._ignoreSelection||f.setActive(!1)}}}function m(a,b,f){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var c=this;this._listeners={onEditorFocus:function(a){c._removeCurrentAnnotation(a)}};this.setOptions(f)}}var g={};k.prototype=
new p.KeyMode;c.mixin(k.prototype,{createKeyBindings:function(){var a=r.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",
keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var f=this._prefix;if(0===f.length)return!1;var c=this.editor,d=c.getModel(),d=a?this._success?b?this._start:c.getCaretOffset()+1:0:this._success?b?this._start:c.getCaretOffset():d.getCharCount()-1;(f=c.getModel().find({string:f,start:d,reverse:!a,caseInsensitive:f.toLowerCase()===f}).next())?(b||(this._start=d),this._ignoreSelection=this._success=!0,c.moveSelection(a?f.start:f.end,
a?f.end:f.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix="",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):
(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?
l.incrementalFindStr:l.incrementalFindStrNotFound:this._success?l.incrementalFindReverseStr:l.incrementalFindReverseStrNotFound;a=b.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});g.IncrementalFind=k;m.prototype={find:function(a,b,f){this.setOptions({reverse:!a});var c=this.getFindString(),d;b&&(c=b.findString||c,d=b.count);a=this.getOptions();this.setOptions(b);b=f?this._startOffset:this.getStartOffset();if((d=this._doFind(c,
b,d))&&!f)this._startOffset=d.start;this.setOptions(a);this._hideAfterFind&&this.hide();return d},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=e.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,
wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",
this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",f=!1,c=this._editor.getModel().getLineDelimiter(),d=0;d<a.length;d++){var g=a.substring(d,d+1);if(f){switch(g){case "R":b+=c;break;case "r":b+="\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+g}f=!1}else"\\"===g?f=!0:b+=g}f&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=
this._editor,f=this._processReplaceString(this.getReplaceString()),c=b.getSelection().start;if(b=b.getModel().find({string:a,start:c,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),this._doReplace(b.start,b.end,a,f),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var c=this._editor,f=c.getTextView();c.reportStatus(l.replacingAll);
var g=this._processReplaceString(this.getReplaceString()),d=this;window.setTimeout(function(){for(var e=0,s=0;;){var k=d._doFind(a,e,null,!0);if(!k)break;s++;1===s&&(f.setRedraw(!1),d.startUndo());d._doReplace(k.start,k.end,a,g);e=d.getStartOffset()}0<s&&(d.endUndo(),f.setRedraw(!0));0<e?c.reportStatus(b.formatMessage(l.replacedMatches,s)):c.reportStatus(l.nothingReplaced,"error");d._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=
a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(h.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=
a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),
this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,f){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:f?
!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,f,c){f=f||1;var d=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var g,e;if(this._regex)try{e=this._find(a,b,c)}catch(k){d.reportStatus(k.message,"error");return}else e=this._find(a,b,c);for(a=0;a<f&&e.hasNext();a++)g=e.next();if(!this._replacingAll){g?this._editor.reportStatus(""):this._editor.reportStatus(l.notFound,"error");if(this.isVisible()){f=
h.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(e=d.getAnnotationModel())e.removeAnnotations(f),g&&e.addAnnotation(h.AnnotationType.createAnnotation(f,g.start,g.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var m=this;this._timer=window.setTimeout(function(){m._markAllOccurrences();m._timer=null},500)}}this._findCallback?this._findCallback(g):g&&d.moveSelection(g.start,g.end,null,!1)}return g},_doReplace:function(a,b,f,c){var d=this._editor;this._regex&&(c=d.getText(a,b).replace(RegExp(f,
this._caseInsensitive?"i":""),c));d.setText(c,a,b);d.setSelection(a,a+c.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=h.AnnotationType.ANNOTATION_MATCHING_SEARCH,f=a.getAnnotations(),c=[],d;f.hasNext();){var g=f.next();g.type===b&&c.push(g)}if(this.isVisible()){f=this.getFindString();f=this._editor.getModel().find({string:f,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(d=[];f.hasNext();)g=f.next(),d.push(h.AnnotationType.createAnnotation(b,
g.start,g.end))}a.replaceAnnotations(c,d)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(h.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(h.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=this._editor.getAnnotationModel())&&a.removeAnnotations(h.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};g.Find=m;return g});y("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects",
"orion/editor/util","orion/util"],function(l,r,p,h,e){function c(b,c,e){r.Find.call(this,b,c,e)}c.prototype=new r.Find;p.mixin(c.prototype,{getFindString:function(){var b=this._findInput;return!b?r.Find.prototype.getFindString.call(this):b.value},getReplaceString:function(){var b=this._replaceInput;return!b?r.Find.prototype.getReplaceString(this):b.value},hide:function(){var b=this.isVisible();r.Find.prototype.hide.call(this);b&&(this._rootDiv.className="textViewFind")},show:function(b){r.Find.prototype.show.call(this,
b);var c=b.findString;b=b.replaceString;var e=this._findInput;e||(this._create(),e=this._findInput);c&&(e.value=c);b&&(this._replaceInput.value=b);var g=this;window.setTimeout(function(){g._rootDiv.className="textViewFind show";e.select();e.focus()},0)},_create:function(){var b=this,c=this._editor.getTextView(),m=c.getOptions("parent").ownerDocument,g=e.createElement(m,"div");g.className="textViewFind";h.addEventListener(g,"keydown",function(a){b._handleKeyDown(a)});this._rootDiv=g;this._createContents(m,
g);c._rootDiv.insertBefore(g,c._rootDiv.firstChild)},_createContents:function(b,c){var m=this,g=e.createElement(b,"input");g.className="textViewFindInput";this._findInput=g;g.type="text";g.placeholder=l.findWith;h.addEventListener(g,"input",function(a){return m._handleInput(a)});c.appendChild(g);g=e.createElement(b,"span");m._createButton(b,g,l.next,function(){m.find(!0)});m._createButton(b,g,l.previous,function(){m.find(!1)});c.appendChild(g);m._editor.getTextView().getOptions("readonly")||(g=e.createElement(b,
"input"),g.className="textViewReplaceInput",this._replaceInput=g,g.type="text",g.placeholder=l.replaceWith,c.appendChild(g),g=e.createElement(b,"span"),m._createButton(b,g,l.replace,function(){m.replace()}),m._createButton(b,g,l.replaceAll,function(){m.replaceAll()}),c.appendChild(g));g=e.createElement(b,"span");m._createButton(b,g,l.regex,function(a){m._toggle("regex",a.target)},this._regex,l.regexTooltip);m._createButton(b,g,l.caseInsensitive,function(a){m._toggle("caseInsensitive",a.target)},this._caseInsensitive,
l.caseInsensitiveTooltip);m._createButton(b,g,l.wholeWord,function(a){m._toggle("wholeWord",a.target)},this._wholeWord,l.wholeWordTooltip);c.appendChild(g);g=m._createButton(b,c,"",function(){m.hide()});g.className="textViewFindCloseButton";g.title=l.closeTooltip},_createButton:function(b,c,e,g,a,t){var f=b.createElement("button");this._checked(a,f);t&&(f.title=t);h.addEventListener(f,"click",function(a){g.call(this,a)},!1);e&&f.appendChild(b.createTextNode(e));c.appendChild(f);return f},_toggle:function(b,
c){var e={};e[b]=!this["_"+b];this.setOptions(e);this._checked(e[b],c)},_checked:function(b,c){c.className="textViewFindButton";b&&(c.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(b){var c,h=(e.isMac?b.metaKey:b.ctrlKey)&&!b.altKey&&!b.shiftKey;h&&70===b.keyCode&&(c=!0);if((e.isMac?b.metaKey:b.ctrlKey)&&!b.altKey&&75===b.keyCode||13===b.keyCode)13===b.keyCode?this.find(this._reverse?b.shiftKey:!b.shiftKey):this.find(!b.shiftKey),
c=!0;h&&82===b.keyCode&&(this.replace(),c=!0);27===b.keyCode&&(this.hide(),c=!0);return c?(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault(),b.cancelBubble=!0,!1):!0}});return{FindUI:c}});y("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(l,r,p,h,e,c,b){function k(a,b,d,c){function g(a,d,b){k.setText(a,d,b);e+=d-b+a.length}var e=0,k=a.editor,
h=k.getSelections();!c&&(b||1<h.length)&&a.startUndo();h.forEach(function(a){a.start+=e;a.end+=e;d(a,g)});k.setSelections(h);!c&&(b||1<h.length)&&a.endUndo()}function m(a,b,d){this.editor=a;this.undoStack=b;this._incrementalFind=new e.IncrementalFind(a);this._find=d?d:new c.FindUI(a,b);this._lastEditLocation=null;this.init()}function g(a,b,d,c){this.editor=a;this.undoStack=b;this.contentAssist=d;this.linkedMode=c;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));
this.init()}var a=p.AnnotationType,t={};m.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var d=1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.undo(),--d;return!0}return!1}.bind(this),{name:l.undo});a.setAction("redo",function(a){if(this.undoStack){var d=
1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.redo(),--d;return!0}return!1}.bind(this),{name:l.redo});a.setKeyBinding(new r.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:l.find});a.setKeyBinding(new r.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?(this._find.find(!0,a),!0):!1}.bind(this),{name:l.findNext});
a.setKeyBinding(new r.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:l.findPrevious});a.setKeyBinding(new r.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:l.incrementalFind});a.setKeyBinding(new r.KeyBinding("j",!0,!0),"incrementalFindReverse");a.setAction("incrementalFindReverse",function(){this._incrementalFind&&
this._incrementalFind.find(!1);return!0}.bind(this),{name:l.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:l.unindentLines});a.setKeyBinding(new r.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:l.moveLinesUp});a.setKeyBinding(new r.KeyBinding(40,!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),
{name:l.moveLinesDown});a.setKeyBinding(new r.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:l.copyLinesUp});a.setKeyBinding(new r.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:l.copyLinesDown});a.setKeyBinding(new r.KeyBinding("d",!0,!1,!1),"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:l.deleteLines});
a.setKeyBinding(new r.KeyBinding("l",!b.isMac,!1,!1,b.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:l.gotoLine});a.setKeyBinding(new r.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:l.nextAnnotation});a.setKeyBinding(new r.KeyBinding(188,!0),"previousAnnotation");a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:l.prevAnnotation});
a.setKeyBinding(new r.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:l.expand});a.setKeyBinding(new r.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:l.collapse});a.setKeyBinding(new r.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:l.expandAll});a.setKeyBinding(new r.KeyBinding("c",
!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:l.collapseAll});a.setKeyBinding(new r.KeyBinding("q",!b.isMac,!1,!1,b.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:l.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();k(this,!1,function(a,f){var c=b.getLineAtOffset(a.start),g=b.getLineAtOffset(a.end>a.start?
a.end-1:a.end),e=b.getLineStart(c),c=b.getLineEnd(g,!0),k=b.getLineCount(),h="",e=b.getText(e,c);g===k-1&&(e=(h=b.getLineDelimiter())+e);f(e,c,c);a.start=c+h.length;a.end=c+e.length});return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();k(this,!1,function(a,f){var c=b.getLineAtOffset(a.start),g=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),c=b.getLineStart(c),e=b.getLineEnd(g,!0),k=b.getLineCount(),h="",e=b.getText(c,e);g===k-1&&
(e+=h=b.getLineDelimiter());f(e,c,c);a.start=c;a.end=c+e.length-h.length});return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=1;a&&a.count&&(d=a.count);var c=b.getModel();k(this,!1,function(a,b){var f=c.getLineAtOffset(a.start),g=c.getLineStart(f),f=a.start!==a.end||1===d?c.getLineAtOffset(a.end>a.start?a.end-1:a.end):Math.min(f+d-1,c.getLineCount()-1),f=c.getLineEnd(f,!0);b("",g,f);a.start=a.end=g});return!0},expandAnnotation:function(a){var b=
this.editor,d=b.getAnnotationModel();if(!d)return!0;var c=b.getModel(),g=b.getCaretOffset(),e=c.getLineAtOffset(g),g=c.getLineStart(e),e=c.getLineEnd(e,!0);c.getBaseModel&&(g=c.mapOffset(g),e=c.mapOffset(e),c.getBaseModel());for(var k,d=d.getAnnotations(g,e);!k&&d.hasNext();)c=d.next(),c.type===p.AnnotationType.ANNOTATION_FOLDING&&(k=c);k&&a!==k.expanded&&(a?k.expand():(b.setCaretOffset(k.start),k.collapse()));return!0},expandAnnotations:function(a){var b=this.editor,d=b.getTextView(),b=b.getAnnotationModel();
if(!b)return!0;var c=b.getAnnotations();for(d.setRedraw(!1);c.hasNext();)b=c.next(),b.type===p.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel(),c=0,g=a.getSelections();1<g.length&&this.startUndo();if(g.some(function(e){e.start+=c;e.end+=c;var k=d.getLineAtOffset(e.start),h=d.getLineAtOffset(e.end>e.start?
e.end-1:e.end);if(k!==h||1<g.length){var m=[];m.push("");for(var t=k;t<=h;t++)m.push(d.getLine(t,!0));var t=d.getLineStart(k),l=d.getLineEnd(h,!0),p=b.getOptions("tabSize","expandTab"),p=p.expandTab?Array(p.tabSize+1).join(" "):"\t",m=m.join(p);a.setText(m,t,l);var q=t===e.start?e.start:e.start+p.length,k=e.end+(h-k+1)*p.length;c+=t-l+m.length;e.start=q;e.end=k}else return!0;return!1}))return!1;a.setSelections(g);1<g.length&&this.endUndo();return!0}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&
this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(l.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();k(this,!0,function(a,f){var c=b.getLineAtOffset(a.start),g=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),e=b.getLineCount();if(g!==e-1){var c=b.getLineStart(c),
k=b.getLineEnd(g,!0),h=b.getLineEnd(g+1,!0)-(k-c),m=0;g!==e-2?g=b.getText(c,k):(e=b.getLineEnd(g),g=b.getText(e,k)+b.getText(c,e),m+=k-e);f("",c,k);f(g,h,h);a.start=h+m;a.end=h+m+g.length}});return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();k(this,!0,function(a,f){var c=b.getLineAtOffset(a.start);if(0!==c){var g=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),e=b.getLineCount(),k=b.getLineStart(c-1),h=b.getLineStart(c),m=b.getLineEnd(g,
!0),t=b.getText(h,m),l=0;g===e-1&&(g=b.getLineEnd(c-1),c=b.getLineEnd(c-1,!0),t+=b.getText(g,c),h=g,l=c-g);f("",h,m);f(t,k,k);a.start=k;a.end=k+t.length-l}});return!0},nextAnnotation:function(b){function c(b){return!!b.lineStyle||b.type===a.ANNOTATION_MATCHING_BRACKET||b.type===a.ANNOTATION_CURRENT_BRACKET||!e.isAnnotationTypeVisible(b.type)}var d=this.editor,g=d.getAnnotationModel();if(!g)return!0;var e=d.getOverviewRuler()||d.getAnnotationStyler();if(!e)return!0;for(var k=d.getModel(),m=d.getCaretOffset(),
t=g.getAnnotations(b?m:0,b?k.getCharCount():m),l=null;t.hasNext();){var p=t.next();if(b){if(p.start<=m)continue}else if(p.start>=m)continue;if(!c(p)&&(l=p,b))break}if(l){for(var r=[l],t=g.getAnnotations(l.start,l.start);t.hasNext();)p=t.next(),p!==l&&!c(p)&&r.push(p);var C=d.getTextView(),q=k.getLineAtOffset(l.start),x=h.Tooltip.getTooltip(C);if(!x)return d.moveSelection(l.start),!0;d.moveSelection(l.start,l.start,function(){x.setTarget({getTooltipInfo:function(){var a=C.convert({x:C.getLocationAtOffset(l.start).x,
y:C.getLocationAtOffset(k.getLineStart(q)).y},"document","page");return{contents:r,x:a.x,y:a.y+Math.floor(1.33*C.getLineHeight(q))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel();k(this,!1,function(a,f){for(var c=d.getLineAtOffset(a.start),g=d.getLineAtOffset(a.end>a.start?a.end-1:a.end),e=b.getOptions("tabSize"),k=Array(e+1).join(" "),h=[],m=0,t=0,l=c;l<=g;l++){var p=d.getLine(l,!0);
if(d.getLineStart(l)!==d.getLineEnd(l))if(0===p.indexOf("\t"))p=p.substring(1),m++;else if(0===p.indexOf(k))p=p.substring(e),m+=e;else return!0;l===c&&(t=m);h.push(p)}c=d.getLineStart(c);e=d.getLineEnd(g,!0);g=d.getLineStart(g);h=h.join("");f(h,c,e);t=c===a.start?a.start:a.start-t;m=Math.max(t,a.end-m+(a.end===g+1&&a.start!==a.end?1:0));a.start=t;a.end=m});return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};
t.TextActions=m;g.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new r.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:l.trimTrailingWhitespaces});a.setKeyBinding(new r.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:l.toggleLineComment});a.setKeyBinding(new r.KeyBinding(191,!0,!b.isMac,!1,b.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:l.addBlockComment});a.setKeyBinding(new r.KeyBinding(220,!0,!b.isMac,!1,b.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:l.removeBlockComment});a.setKeyBinding(new r.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new r.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new r.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new r.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new r.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new r.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new r.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new r.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new r.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new r.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){function a(b,d){if(b.start===b.end){for(var f=c.getLineAtOffset(b.start),n=c.getLine(f,!1),k=c.getLineStart(f),p=0,r=b.start-k,y;p<r&&(32===(y=n.charCodeAt(p))||
9===y);)p++;var k=n.substring(0,p),H=n.substring(0,r),I=n.substring(r),G;if(l.smartIndentation&&123===n.charCodeAt(G=H.trimRight().length-1))return f=r-G-1,I=I.length-I.trimLeft().length,n=125===n.charCodeAt(r+I)?e+k+g+e+k:e+k+g,d(n,b.start-f,b.end+I),b.start=b.end=b.start+e.length+k.length+g.length-f,!0;if(l.autoCompleteComments&&!t.test(H)&&(h.test(H)||m.test(H))){if(p=h.exec(H)){n=e+k+" * ";n=t.test(I)?n+I.substring(0,I.length-2).trim():n+I.trim();if(c.getLineCount()===f+1||!m.test(c.getLine(f+
1)))n+=e+k+" */";d(n,b.start,b.end+I.length);b.start=b.end=b.start+e.length+k.length+3;return!0}if(p=m.exec(H))for(f-=1;0<=f;f--){p=c.getLine(f,!1);if(h.test(p))return t.test(I)||47===n.charCodeAt(r)?(n=e+k+"*"+I,k=b.start+e.length+k.length+1):(n=e+k+"* "+I,k=b.start+e.length+k.length+2),d(n,b.start,b.end+I.length),b.start=b.end=k,!0;if(!m.test(p))break}}else{if(t.test(H)&&32===k.charCodeAt(k.length-1))return n=e+k.substring(0,k.length-1),d(n,b.start,b.end),b.start=b.end=b.start+n.length,!0;if(0<
p){for(p=r;p<n.length&&(32===(y=n.charCodeAt(p++))||9===y);)b.end++;n=c.getLineDelimiter()+k;d(n,b.start,b.end);b.start=b.end=b.start+n.length;return!0}}}return!1}var b=this.editor,d=b.getTextView();if(d.getOptions("readonly")||d.getOptions("singleMode"))return!1;var c=b.getModel(),b=d.getOptions("tabSize","expandTab"),g=b.expandTab?Array(b.tabSize+1).join(" "):"\t",e=c.getLineDelimiter(),h=/^[\s]*\/\*[\*]*[\s]*$/,m=/^[\s]*\*/,t=/\*\/[\s]*$/,l=this;k(this,!0,function(b,d){a(b,d)||(d(e,b.start,b.end),
b.start=b.end=b.start+e.length)});return!0},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=/\/\*|\*\//g,c=this;k(this,!1,function(a,f){var g=c._findEnclosingComment(b,a.start,a.end);if(!(void 0!==g.commentStart&&void 0!==g.commentEnd)&&(g=b.getText(a.start,a.end),0!==g.length)){var e=g.length,g=g.replace(d,""),k=g.length;f("/*"+g+"*/",a.start,a.end);a.start+=2;a.end+=2+(k-e)}});return!0},autoPairBrackets:function(a,b){if("["===
a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var c=/^$|[)}\]>]/,g=d.getModel();k(this,!1,function(d,e){var k=d.start===g.getCharCount()?"":g.getText(d.start,d.start+1).trim();d.start===d.end&&c.test(k)?(k=a+b,e(k,d.start,d.start),d.start=d.end=d.start+1):d.start!==d.end?(k=a+g.getText(d.start,d.end)+b,e(k,d.start,d.end),d.start+=
1,d.end+=1):(e(a,d.start,d.end),d.start=d.end=d.start+a.length)});return!0},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=/^"$|^'$/,c=/\w/,g=/^$|[)}\]>]/,e=b.getModel();k(this,!1,function(b,n){function k(){n(a,b.start,b.end);b.start=b.end=b.start+a.length}var h=0===b.start?"":e.getText(b.start-1,b.start).trim(),m=b.start===e.getCharCount()?"":e.getText(b.start,b.start+1).trim();b.start!==b.end?(h=e.getText(b.start,
b.end),d.test(h)?k():(n(a+h+a,b.start,b.end),b.start+=1,b.end+=1)):m===a?b.start=b.end=b.start+1:h===a||d.test(m)||c.test(h)||!g.test(m)?k():(n(a+a,b.start,b.end),b.start=b.end=b.start+a.length)});return!0},contentAssistProposalApplied:function(a){function b(){return"number"===typeof d.escapePosition?d.escapePosition:a.data.start+d.proposal.length}var d=a.data.proposal;if(d.positions&&0<d.positions.length&&this.linkedMode){for(var c=[],g=0;g<d.positions.length;++g)c[g]={positions:[{offset:d.positions[g].offset,
length:d.positions[g].length}]};this.linkedMode.enterLinkedMode({groups:c,escapePosition:b()})}else d.groups&&0<d.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:d.groups,escapePosition:b()}):"number"===typeof d.escapePosition&&this.editor.getTextView().setCaretOffset(d.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();k(this,!1,function(a,f){if(a.start===a.end){var c=0===a.start?"":b.getText(a.start-
1,a.start),g=a.start===b.getCharCount()?"":b.getText(a.start,a.start+1);("("===c&&")"===g||"["===c&&"]"===g||"{"===c&&"}"===g||"\x3c"===c&&"\x3e"===g||'"'===c&&'"'===g||"'"===c&&"'"===g)&&f("",a.start,a.start+1)}},!0);return!1},_findEnclosingComment:function(a,b,d){var c=a.getLineAtOffset(b),g=a.getLineAtOffset(d),e,k,h,m,t,l;for(e=c;0<=e&&!(k=a.getLine(e),h=e===c?b-a.getLineStart(c):k.length,m=k.lastIndexOf("/*",h),k=k.lastIndexOf("*/",h),k>m);e--)if(-1!==m){t=a.getLineStart(e)+m;break}for(e=g;e<
a.getLineCount()&&!(k=a.getLine(e),h=e===g?d-a.getLineStart(g):0,m=k.indexOf("/*",h),k=k.indexOf("*/",h),-1!==m&&m<k);e++)if(-1!==k){l=a.getLineStart(e)+k;break}return{commentStart:t,commentEnd:l}},lineStart:function(){var a=this.editor.getModel();k(this,!1,function(b){var d=b.getCaret(),c=a.getLineAtOffset(d),g=a.getLineStart(c),c=a.getLine(c),e;for(e=0;e<c.length;e++){var k=c.charCodeAt(e);if(!(32===k||9===k))break}e+=g;d!==e?b.setCaret(e):b.setCaret(g)});return!0},removeBlockComment:function(){var a=
this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=this;k(this,!1,function(a,f){var c=b.getText(a.start,a.end),g,e,k;for(k=0;k<c.length;k++)if("/*"===c.substring(k,k+2)){g=a.start+k;break}for(;k<c.length;k++)if("*/"===c.substring(k,k+2)){e=a.start+k;break}void 0!==g&&void 0!==e?(c=b.getText(g+2,e),f(c,g,e+2),a.start=g,a.end=e):(g=d._findEnclosingComment(b,a.start,a.end),void 0===g.commentStart||void 0===g.commentEnd||(c=b.getText(g.commentStart+2,g.commentEnd),f(c,
g.commentStart,g.commentEnd+2),a.start-=2,a.end-=2))});return!0},toggleLineComment:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var d=this.lineComment||"//",c=a.getModel();b.setRedraw(!1);k(this,!0,function(a,b){for(var f=c.getLineAtOffset(a.start),g=c.getLineAtOffset(a.end>a.start?a.end-1:a.end),e=!0,n=[],k,h=f;h<=g;h++){var m=c.getLine(h,!0);k=m.indexOf(d);n.push(k);if(!e||-1===k)e=!1;else if(0!==k){for(e=0;e<k;e++){var t=m.charCodeAt(e);if(!(32===t||9===t))break}e=
e===k}}h=d.length;m=c.getLineStart(f);if(e){for(e=n.length-1;0<=e;e--)k=n[e]+c.getLineStart(f+e),b("",k,k+h);k=c.getLineStart(g);n=m===a.start?a.start:a.start-h;f=a.end-h*(g-f+1)+(a.end===k+1?h:0)}else{for(e=n.length-1;0<=e;e--)k=c.getLineStart(f+e),b(d,k,k);n=m===a.start?a.start:a.start+h;f=a.end+h*(g-f+1)}a.start=n;a.end=f});b.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),d=a.getSelections();a.getTextView().setRedraw(!1);this.startUndo();for(var c=/(\s+$)/,
g=b.getLineCount(),e=0;e<g;e++){var k=b.getLine(e);if(k=c.exec(k)){var h=b.getLineStart(e),m=k[0].length,t=h+k.index;b.setText("",t,t+m);d.forEach(function(a){a.start>t&&(a.start=Math.max(t,a.start-m));a.start!==a.end&&a.end>t&&(a.end=Math.max(t,a.end-m))})}}this.endUndo();a.setSelections(d,!1);a.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;
var d=b.getModel(),c=b.getSelections();return 1===c.length&&c[0].start===c[0].end&&(c[0].start===d.getCharCount()?"":d.getText(c[0].start,c[0].start+1))===a?(c[0].start=c[0].end=c[0].start+1,b.setSelections(c),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=
a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};t.SourceCodeActions=g;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return t});y("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/editor/util orion/util".split(" "),
function(l,r,p,h,e,c,b){function k(a,b,f){this._location=a||"left";this._overview=b||"page";this._rulerStyle=f;this._view=null}function m(a,b,f,c){k.call(this,b,f,c);var g=this;this._listener={onTextModelChanged:function(a){g._onTextModelChanged(a)},onAnnotationModelChanged:function(a){g._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function g(a,b,f,c,g){m.call(this,a,b,"page",f);this._oddStyle=c||{style:{backgroundColor:"white"}};this._evenStyle=g||{style:{backgroundColor:"white"}};this._numOfDigits=
0;this._firstLine=1}function a(a,b,f){m.call(this,a,b,"page",f)}function t(a,b,f){m.call(this,a,b,"document",f)}function f(b,d,f){a.call(this,b,d,f)}k.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&
this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};m.prototype=e.mixin(new k,{getAnnotations:function(a,b){var f=this._annotationModel;if(!f)return[];var c=this._view.getModel(),g=c.getLineStart(a),e=c.getLineEnd(b-1),k=c;c.getBaseModel&&(k=c.getBaseModel(),g=c.mapOffset(g),e=c.mapOffset(e));for(var h=[],f=this.getAnnotationsByType(f,g,e),g=0;g<f.length;g++)for(var e=f[g],m=k.getLineAtOffset(e.start),t=k.getLineAtOffset(Math.max(e.start,e.end-1)),l=m;l<=t;l++){var q=
l;if(c!==k){q=k.getLineStart(l);q=c.mapOffset(q,!0);if(-1===q)continue;q=c.getLineAtOffset(q)}if(a<=q&&q<b){var p=this._mergeAnnotation(h[q],e,l-m,t-m+1);p&&(h[q]=p)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var r in h)h[r]._multiple&&(h[r].html+=this._multiAnnotationOverlay.html);return h},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",
this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=a},onClick:function(a,b){if(void 0!==a){var f=this._view,c=f.getModel(),g=c.getLineStart(a),e=c.getLineEnd(a,!0),k=f.getSelection().start,f=f.getSelection().end,m=this._annotationModel,t,l,p;if(m){c.getBaseModel&&(g=c.mapOffset(g),
e=c.mapOffset(e),k=c.mapOffset(k),f=c.mapOffset(f));var q=this;l=(t=this._findNextAnnotation(m,g,e,k,f,function(a){return q.isAnnotationTypeVisible(a)}))?t.start:g;p=t?t.end:g;c.getBaseModel&&(l=c.mapOffset(l,!0),p=c.mapOffset(p,!0));t&&void 0!==t.groupId&&(this._currentClickGroup=this._currentClickGroup===t.groupId?null:t.groupId,this._setCurrentGroup(a))}this._view.setSelection(p,l,1/3,function(){});(c=h.Tooltip.getTooltip(this._view))&&(t&&"left"===this.getLocation()?c.show({getTooltipInfo:function(){return q._getTooltipInfo([t])}},
!1,!1):c.hide())}},onDblClick:function(a,b){},onMouseMove:function(a,b){var f=h.Tooltip.getTooltip(this._view);if(f&&!(f.isVisible()&&this._tooltipLineIndex===a)&&(this._tooltipLineIndex=a,!(b.clientX===this._lastMouseX&&b.clientY===this._lastMouseY))){this._lastMouseX=b.clientX;this._lastMouseY=b.clientY;this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null);var c=b.target?b.target:b.srcElement;this._curElementBounds=c.getBoundingClientRect();c._ruler&&(this._curElementBounds.top=
b.clientY,this._curElementBounds.height=1);var g=this;g._hoverTimeout=window.setTimeout(function(){g._hoverTimeout=null;f.onHover({getTooltipInfo:function(){var a=g._getAnnotationsAtLineIndex(g._tooltipLineIndex),a=g._getTooltipContents(g._tooltipLineIndex,a);return g._getTooltipInfo(a,b.clientY,{source:"ruler",rulerLocation:g.getLocation()})}},b.clientX,b.clientY)},175)}},onMouseOver:function(a,b){this.onMouseMove(a,b);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,b){this._currentClickGroup||
this._setCurrentGroup(-1);this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null)},_findNextAnnotation:function(a,b,f,c,g,e){var k=null,h,m=b;if(0<=c&&0<=g&&c>=b&&c<f)for(var m=c,t=a.getAnnotations(c,g);!h&&t.hasNext();)if(b=t.next(),!e||e(b.type))b.start===c&&b.end===g&&(h=b);a=a.getAnnotations(m,f);for(var l;a.hasNext();)if(b=a.next(),!e||e(b.type)){k||(k=b);if(!h){k=b;break}if(l&&(h.start!==b.start||h.end!==b.end)){l=!1;k=b;break}h&&h===b&&(l=!0)}l&&(k=null);return k},
_getAnnotationsAtLineIndex:function(a){if(void 0!==a){var b=this._view.getModel(),f=this._annotationModel,c=[];f&&(c=b.getLineStart(a),a=b.getLineEnd(a),b.getBaseModel&&(c=b.mapOffset(c),a=b.mapOffset(a)),c=this.getAnnotationsByType(f,c,a));return c}},_getTooltipInfo:function(a,b,f){if(!a)return null;var c=Object.create(null);c.top=this._curElementBounds.top;c.left=this._curElementBounds.left;c.height=this._curElementBounds.height;c.width=this._curElementBounds.width;"string"===typeof a&&b&&(c.top=
b,c.height=1);var g=this.getLocation();b=this.getRulerStyle();var g="left"===g?"right":"left",e=0,k=0,e=this._view._clientDiv.getBoundingClientRect().left-(c.left+c.width),k=c.height;"left"===g&&(e=-25,1===c.height&&(e+=2));0<=b.styleClass.indexOf("folding")&&(k-=14);return{contents:a,position:g,tooltipOffsetX:e,tooltipOffsetY:k,anchorArea:c,context:f}},_getTooltipContents:function(a,b){return b},_getOnClickTooltipInfo:function(a){var b=this._view,c=Object.create(null);c.top=this._curElementBounds.top;
c.left=this._curElementBounds.left;c.height=this._curElementBounds.height;c.width=this._curElementBounds.width;var f="left"===this.getLocation()?"right":"left";a={contents:[a],position:f,anchorArea:c};b=b._clientDiv.getBoundingClientRect();a.offsetX=b.left-(c.left+c.width);a.offsetY=c.height;"left"===a.position&&(a.offsetX=20);return a},_onAnnotationModelChanged:function(a){function b(a){for(var d=0;d<a.length;d++)if(g.isAnnotationTypeVisible(a[d].type)){k=a[d].start;var e=a[d].end;f.getBaseModel&&
(k=f.mapOffset(k,!0),e=f.mapOffset(e,!0));-1!==k&&-1!==e&&c.redrawLines(f.getLineAtOffset(k),f.getLineAtOffset(Math.max(k,e-1))+1,g)}}var c=this._view;if(c){var f=c.getModel(),g=this,e=f.getLineCount();if(a.textModelChangedEvent){var k=a.textModelChangedEvent.start;f.getBaseModel&&(k=f.mapOffset(k,!0));a=f.getLineAtOffset(k);c.redrawLines(a,e,g)}else b(a.added),b(a.removed),b(a.changed)}},_mergeAnnotation:function(a,b,c,f){a||(a={});0===c&&(a.html&&b.html?(b.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&
(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=b.html);a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var c;if(b.style)for(c in a.style||(a.style={}),b.style)void 0===a.style[c]&&(a.style[c]=b.style[c]);if(b.attributes)for(c in a.attributes||(a.attributes={}),b.attributes)void 0===a.attributes[c]&&(a.attributes[c]=b.attributes[c])}return a},
_setCurrentGroup:function(a){var b=this._annotationModel,c=null,f=b.getTextModel(),g,e=this._currentGroupAnnotation;if(-1!==a){var k=f.getLineStart(a),h=f.getLineEnd(a);f.getBaseModel&&(k=f.mapOffset(k),h=f.mapOffset(h));for(g=b.getAnnotations(k,h);g.hasNext();)if(f=g.next(),this.isAnnotationTypeVisible(f.type)&&f.start<=k&&f.end>=h&&void 0!==f.groupId){c=f;break}if(e&&c&&e.groupId===c.groupId)return}this._currentGroupAnnotation=null;e&&b.removeAnnotations(e.groupType);if(c&&-1!==a){this._currentGroupAnnotation=
c;g=b.getAnnotations();for(a=[];g.hasNext();)f=g.next(),delete f.groupAnnotation,f.groupId===c.groupId&&(f=f.createGroupAnnotation(),a.push(f));b.replaceAnnotations(null,a)}}});p.AnnotationTypeList.addMixin(m.prototype);g.prototype=new m;g.prototype.getAnnotations=function(a,b){for(var c=m.prototype.getAnnotations.call(this,a,b),f=this._view.getModel(),g=a;g<b;g++){var e=g-this._firstLine&1?this._oddStyle:this._evenStyle,k=g;f.getBaseModel&&(k=f.getLineStart(k),k=f.getBaseModel().getLineAtOffset(f.mapOffset(k)));
c[g]||(c[g]={});c[g].html=this._firstLine+k+"";c[g].style||(c[g].style=e)}return c};g.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};g.prototype.setFirstLine=function(a){this._firstLine=void 0!==a?a:1};g.prototype._onTextModelChanged=function(a){var b=a.start;a=this._view.getModel();var c=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),c=(this._firstLine+c-1+"").length;this._numOfDigits!==c&&(this._numOfDigits=
c,b=a.getLineAtOffset(b),this._view.redrawLines(b,a.getLineCount(),this))};a.prototype=new m;t.prototype=new m;t.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};t.prototype._getTooltipContents=function(a,d){if(d&&0===d.length){var c=this._view.getModel(),f=a;c.getBaseModel&&(f=c.getLineStart(f),f=c.getBaseModel().getLineAtOffset(c.mapOffset(f)));return b.formatMessage(l.line,f+1)}return m.prototype._getTooltipContents.call(this,
a,d)};t.prototype._mergeAnnotation=function(a,b,c,f){if(0===c)return a||(a={html:"\x26nbsp;",style:{style:{height:3*f+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle)),a};f.prototype=new a;f.prototype.onClick=function(a,b){if(void 0!==a){var c=this._annotationModel;if(c){var f=this._view.getModel(),g=f.getLineStart(a),e=f.getLineEnd(a,!0);f.getBaseModel&&(g=f.mapOffset(g),e=f.mapOffset(e),f=f.getBaseModel());for(var k,c=c.getAnnotations(g,e);!k&&c.hasNext();)e=c.next(),this.isAnnotationTypeVisible(e.type)&&
f.getLineAtOffset(e.start)===f.getLineAtOffset(g)&&(k=e);k&&((f=h.Tooltip.getTooltip(this._view))&&f.hide(),k.expanded?k.collapse():k.expand())}}};f.prototype._getTooltipContents=function(b,d){if(d&&0<d.length){var c=this._view.getModel(),f=c.getLineStart(b);c.getBaseModel&&(f=c.mapOffset(f),c=c.getBaseModel());for(var f=c.getLineAtOffset(f),g=0;g<d.length;g++){var e=d[g];if(this.isAnnotationTypeVisible(e.type)&&c.getLineAtOffset(e.start)===f){if(d[g].expanded)break;return a.prototype._getTooltipContents.call(this,
b,[e])}}}return null};f.prototype._onAnnotationModelChanged=function(b){function d(a){for(e=0;e<a.length;e++)if(g.isAnnotationTypeVisible(a[e].type)){var b=a[e].start;f.getBaseModel&&(b=f.mapOffset(b,!0));-1!==b&&(h=Math.min(h,f.getLineAtOffset(b)))}}if(b.textModelChangedEvent)a.prototype._onAnnotationModelChanged.call(this,b);else{var c=this._view;if(c){var f=c.getModel(),g=this,e,k=f.getLineCount(),h=k;d(b.added);d(b.removed);d(b.changed);b=c.getRulers();for(e=0;e<b.length;e++)c.redrawLines(h,k,
b[e])}}};p=function(a,b){k.call(this,a,"fixed",b)};p.prototype=e.mixin(new k,{setView:function(a){this._destroy();k.prototype.setView.call(this,a);this._create()},_create:function(){function a(b){var d=b.themeClass;d?((d=d.replace("textviewZoom",""))&&(d=" "+d),d="textviewZoom"+d):d="textviewZoom";b.themeClass=d;b.noScroll=!0;b.readonly=!0;return b}function d(){var a=h._metrics.viewPadding,b=h._metrics.viewPadding,d=h.getLineHeight(),c=t.getLineHeight(),f=h.getModel().getLineCount(),d=h._lineHeight?
h._scrollHeight:f*d,c=t._lineHeight?t._scrollHeight:f*c,f=c/d,g=h.getClientArea().height+a.top+a.bottom,b=t.getClientArea().height+b.top+b.bottom;return{zoomFactor:f,documentHeight:d,zoomDocumentHeight:c,clientHeight:g,zoomClientHeight:b,scrollWidth:h._metrics.scrollWidth,windowHeight:g*f,padding:a}}function f(a){a=a||{y:h.getTopPixel()};var b=d();t.setTopPixel(a.y*(b.zoomFactor+(b.windowHeight-b.clientHeight-b.scrollWidth)/b.documentHeight));a=a.y*b.zoomFactor;b=b.clientHeight*b.zoomFactor;x.top=
a;x.bottom=a+b;a=t.convert({y:a},"document","page").y;a-=x.node.getBoundingClientRect().top;p.style.top=a+"px";p.style.height=b-q+"px"}function g(a){a.wrapMode&&!a.wrapOffset&&h._metrics.charWidth?(a=b.createElement(l,"div"),a.style.position="fixed",a.style.left="-1000px",t._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(h.getClientArea().width/h._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var d=x.node.style.width;x.node.style.width=
a;return d!==a}function e(a,b,d){d||x.top<=a.y&&a.y<=x.bottom?(x.mouseDown=!0,x.delta=b-p.getBoundingClientRect().top+x.node.getBoundingClientRect().top):(a=t.getOffsetAtLocation(a.x,a.y),h.setSelection(a,a,0.5,function(){}))}function k(a){if(x.mouseDown){var b=d();a=Math.min(b.zoomClientHeight-b.windowHeight,Math.max(0,a-x.delta));h.setTopPixel(a*(b.documentHeight-b.clientHeight)/Math.min(b.zoomDocumentHeight,b.zoomClientHeight-b.windowHeight))}}var h=this.getView();if(h){var m=a(h.getOptions());
m.parent=this.node;var t=this._zoomView=new r.TextView(m);t._clientDiv.contentEditable=!1;t.setModel(h.getModel());var l=h.getOptions("parent").ownerDocument,p=this._windowDiv=b.createElement(l,"div");p.className="rulerZoomWindow";this.node.appendChild(p);var q=parseInt(c.getNodeStyle(p,"border-top-width",0))+parseInt(c.getNodeStyle(p,"border-bottom-width",0)),x=this;h.addEventListener("Scroll",this._scrollListener=function(a){f(a.newValue)});h.addEventListener("Resize",this._resizeListener=function(){g(t.getOptions());
f()});h.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||t.redrawLines(a.startLine,a.endLine)});h.addEventListener("Options",this._optionsListener=function(b){b=a(b.options);t.setOptions(b);g(t.getOptions())});t.addEventListener("LineStyle",this._lineListener=function(a){h.onLineStyle(a)});b.isIOS||b.isAndroid?(p.addEventListener("touchstart",function(a){1===a.touches.length&&(e(a,a.touches[0].clientY,!0),a.preventDefault())}),p.addEventListener("touchend",function(a){0===a.touches.length&&
(x.mouseDown=!1)}),p.addEventListener("touchmove",function(a){1===a.touches.length&&k(a.touches[0].clientY)}),t.addEventListener("TouchStart",function(a){1===a.touchCount&&(e(a,a.event.touches[0].clientY),a.preventDefault())})):(p.style.pointerEvents="none",t.addEventListener("MouseDown",function(a){var b=a.event;(b.which?0===b.button:1===b.button)&&e(a,b.clientY);a.preventDefault()}),t.addEventListener("MouseUp",function(a){x.mouseDown=!1;a.preventDefault()}),t.addEventListener("MouseMove",function(a){k(a.event.clientY);
a.preventDefault()}));(l.defaultView||l.parentWindow).setTimeout(function(){f()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",
this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:k,Ruler:m,AnnotationRuler:a,LineNumberRuler:g,OverviewRuler:t,FoldingRuler:f,ZoomRuler:p}});y("orion/editor/textDND",["orion/util"],function(l){function r(l,h){this._view=l;this._undoStack=h;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var e=this;this._listener={onDragStart:function(c){e._onDragStart(c)},onDragEnd:function(c){e._onDragEnd(c)},onDragEnter:function(c){e._onDragEnter(c)},onDragOver:function(c){e._onDragOver(c)},
onDrop:function(c){e._onDrop(c)},onDestroy:function(c){e._onDestroy(c)}};l.addEventListener("DragStart",this._listener.onDragStart);l.addEventListener("DragEnd",this._listener.onDragEnd);l.addEventListener("DragEnter",this._listener.onDragEnter);l.addEventListener("DragOver",this._listener.onDragOver);l.addEventListener("Drop",this._listener.onDrop);l.addEventListener("Destroy",this._listener.onDestroy)}r.prototype={destroy:function(){var l=this._view;l&&(l.removeEventListener("DragStart",this._listener.onDragStart),
l.removeEventListener("DragEnd",this._listener.onDragEnd),l.removeEventListener("DragEnter",this._listener.onDragEnter),l.removeEventListener("DragOver",this._listener.onDragOver),l.removeEventListener("Drop",this._listener.onDrop),l.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(l){this.destroy()},_onDragStart:function(l){var h=this._view,e=h.getSelectionText();e&&(this._dragSelection=h.getSelections(),l.event.dataTransfer.effectAllowed="copyMove",l.event.dataTransfer.setData("Text",
e))},_onDragEnd:function(p){if(this._dragSelection){var h=this._view,e=p.event.dataTransfer.dropEffect;if(!l.isFirefox&&("none"!==e||this._dropText))e=p.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(p="move"===e)&&h.setText({text:"",selection:this._dragSelection});if(this._dropText){var e=this._dropText,c=this._dropOffset;p&&this._dragSelection.forEach(function(b){c>=b.end?c-=b.end-b.start:c>=b.start&&(c=b.start)});h.setText(e,c,c);h.setSelection(c,
c+e.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange();this._dragSelection=null}},_onDragEnter:function(l){this._onDragOver(l)},_onDragOver:function(p){var h=p.event.dataTransfer.types,e=!this._view.getOptions("readonly");e&&h&&(e=h.contains?h.contains("text/plain")||h.contains("Text"):-1!==h.indexOf("text/plain")||-1!==h.indexOf("Text"));e?l.isFirefox||(this._dropEffect=p.event.dataTransfer.dropEffect=(l.isMac?p.event.altKey:p.event.ctrlKey)?"copy":
"move"):p.event.dataTransfer.dropEffect="none"},_onDrop:function(p){var h=this._view,e=p.event.dataTransfer.getData("Text");e&&(l.isFirefox||(p.event.dataTransfer.dropEffect=this._dropEffect),p=h.getOffsetAtLocation(p.x,p.y),this._dragSelection?(this._dropOffset=p,this._dropText=e):(h.setText(e,p,p),h.setSelection(p,p+e.length)))}};return{TextDND:r}});y("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/objects orion/util".split(" "),
function(l,r,p,h,e){function c(b){this._data=b}function b(b,c,a){var e=b.getTextView();p.KeyMode.call(this,e);this.editor=b;this.undoStack=c;this.contentAssist=a;this.linkedModeModel=null;e.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));e.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);return!0}.bind(this));e.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));
e.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,
c,g;d;)if(c=this._getPositionChanged(d,b,b+a.removedCharCount),g=c.position,void 0===g||g.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;c=c.positions;for(var e,k=0;k<c.length;++k){e=c[k];g=e.position;var h=g.offset<=b&&b<=g.offset+g.length;h&&!e.ansestor?(g.offset+=d,g.length+=a,d+=a):(g.offset+=d,e.ansestor&&h&&(g.length+=a));e.escape&&(e.model.escapePosition=g.offset)}this._updateAnnotations(c)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=
this.editor,d=b.mapOffset(a.start),c=this.editor.mapOffset(a.end),g=this.linkedModeModel,e,k;g;)if(e=this._getPositionChanged(g,d,c),k=e.position,void 0===k||k.model!==g)this.exitLinkedMode(!1),g=this.linkedModeModel;else break;if(g){var h=this._compoundChange;h?h.owner.model===g&&h.owner.group===k.group||(this.endUndo(),this.startUndo()):this.startUndo();g.selectedGroupIndex=k.group;var h=0,m=a.text.length-(c-d);e=e.positions;for(var t,d=d-k.position.offset,l=c-k.position.offset,p=0;p<e.length;++p)t=
e[p],c=t.position,t.oldOffset=c.offset,t.model===g&&t.group===k.group?(c.offset+=h,c.length+=m,h+=m):(c.offset+=h,t.ansestor&&(c.length+=k.count*m)),t.escape&&(t.model.escapePosition=c.offset);this.ignoreVerify=!0;for(p=e.length-1;0<=p;p--)t=e[p],t.model===g&&t.group===k.group&&b.setText(a.text,t.oldOffset+d,t.oldOffset+l,!1);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(e)}}}.bind(this)}}var k={};c.prototype={chop:function(b,c){return c.substring(b.length)},computeProposals:function(b,
c,a){c=a.prefix;b=[];a=(a=this._data.style?this._data.style:null)?a:"emphasis";for(var e=this._data.values,f=0;f<e.length;f++){var n=e[f];"string"===typeof n&&0===n.indexOf(c)?b.push({proposal:this.chop(c,n),description:n,hover:n,style:a}):"object"===typeof n&&n.proposal&&b.push({proposal:this.chop(c,n.proposal),description:n.description?n.description:n.proposal,hover:n.hover?n.hover:n.proposal,style:a})}c=this._data.title?this._data.title:null;0<b.length&&b.splice(0,0,{proposal:"",description:c?
c:"Options",style:"noemphasis_title",unselectable:!0});return b}};b.prototype=new p.KeyMode;e.mixin(b.prototype,{createKeyBindings:function(){var b=r.KeyBinding,c=[];c.push({actionID:"linkedModeEnter",keyBinding:new b(13)});c.push({actionID:"linkedModeCancel",keyBinding:new b(27)});c.push({actionID:"linkedModeNextGroup",keyBinding:new b(9)});c.push({actionID:"linkedModePreviousGroup",keyBinding:new b(9,!1,!0)});return c},enterLinkedMode:function(b){if(!this.linkedModeModel){var c=this.editor.getTextView();
c.addKeyMode(this);c.addEventListener("Verify",this.linkedModeListener.onVerify);c.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(l.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(b.previousModel=this.linkedModeModel,b.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=b);this.linkedModeModel=b;this.selectLinkedGroup(0)},
exitLinkedMode:function(b){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var c=this.linkedModeModel;this.linkedModeModel=c.previousModel;c.parentGroup=c.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,e=a.getTextView();e.removeKeyMode(this);e.removeEventListener("Verify",this.linkedModeListener.onVerify);e.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);
e=this.contentAssist;e.removeEventListener("Activating",this.linkedModeListener.onActivating);e.offset=void 0;this.editor.reportStatus(l.linkedModeExited,null,!0);b&&"number"===typeof c.escapePosition&&a.setCaretOffset(c.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var b=this,c=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:c,group:c.selectedGroupIndex,end:function(){b._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(b){var g=this.linkedModeModel;if(g){g.selectedGroupIndex=b;b=g.groups[b];var a=b.positions[0],e=this.editor;e.setSelection(a.offset,a.offset+a.length);if(g=this.contentAssist)g.offset=void 0,b.data&&"link"===b.data.type&&b.data.values?((this._groupContentAssistProvider=new c(b.data)).getPrefix=function(){var b=e.getSelection();return b.start===
b.end&&(b=e.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?e.getText(a.offset,b):""},g.offset=a.offset,g.deactivate(),g.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,g.deactivate())}this._updateAnnotations()},_getModelPositions:function(b,c,a){for(var e=c.groups,f=0;f<e.length;f++)for(var n=e[f].positions,d=0;d<n.length;d++){var k=n[d];a&&(k={offset:k.offset+a,length:k.length});k={index:d,group:f,count:n.length,model:c,position:k};b.push(k);c.nextModel&&
c.nextModel.parentGroup===f&&(k.ansestor=!0,this._getModelPositions(b,c.nextModel,(a||0)+n[d].offset-n[0].offset))}},_getSortedPositions:function(b){var c=this._sortedPositions;if(!c){for(c=[];b.previousModel;)b=b.previousModel;for(this._getModelPositions(c,b);b;)"number"===typeof b.escapePosition&&c.push({escape:!0,model:b,position:{offset:b.escapePosition,length:0}}),b=b.nextModel;c.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=c}return c},_getPositionChanged:function(b,
c,a){var e;b=this._getSortedPositions(b);for(var f=b.length-1;0<=f;f--){var n=b[f].position;if(n.offset<=c&&a<=n.offset+n.length){e=b[f];break}}return{position:e,positions:b}},_updateAnnotations:function(b){var c=this.editor.getAnnotationModel();if(c){for(var a=[],e=[],f=c.getAnnotations(),n;f.hasNext();)switch(n=f.next(),n.type){case h.AnnotationType.ANNOTATION_LINKED_GROUP:case h.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case h.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(n)}if(f=
this.linkedModeModel){b=b||this._getSortedPositions(f);for(var d=0;d<b.length;d++)if(n=b[d],n.model===f&&!n.escape){var k=h.AnnotationType.ANNOTATION_LINKED_GROUP;n.group===f.selectedGroupIndex&&(k=0===n.index?h.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:h.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);n=n.position;n=h.AnnotationType.createAnnotation(k,n.offset,n.offset+n.length,"");e.push(n)}}c.replaceAnnotations(a,e)}}});k.LinkedMode=b;return k});y("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),
function(l,r,p,h,e,c,b){function k(){}function m(){}function g(){}function a(){}function t(){}function f(){}function n(){}var d={};k.prototype={createKeyBindings:function(a,b,d,f){f=new l.TextActions(a,b,f);var g=new c.LinkedMode(a,b,d);a=new l.SourceCodeActions(a,b,d,g);return{textActions:f,linkedMode:g,sourceCodeActions:a}}};d.KeyBindingsFactory=k;m.prototype={createUndoStack:function(a){a=a.getTextView();return new r.UndoStack(a,200)}};d.UndoFactory=m;g.prototype={createLineNumberRuler:function(a){return new p.LineNumberRuler(a,
"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};d.LineNumberRulerFactory=g;a.prototype={createFoldingRuler:function(a){return new p.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};d.FoldingRulerFactory=a;t.prototype={createZoomRuler:function(a){return new p.ZoomRuler(b.isIOS||b.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};d.ZoomRulerFactory=t;f.prototype={createAnnotationModel:function(a){return new h.AnnotationModel(a)},createAnnotationStyler:function(a,
b){return new h.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new p.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new p.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};d.AnnotationFactory=f;n.prototype={createTextDND:function(a,b){return new e.TextDND(a.getTextView(),b)}};d.TextDNDFactory=n;return d});y("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],
function(l,r,p,h){return h.mixin({},l,r,p)});(function(){function l(b){this.tokens=[];this.tokens.links={};this.options=b||g.defaults;this.rules=a.normal;this.options.gfm&&(this.rules=this.options.tables?a.tables:a.gfm)}function r(a,b){this.options=b||g.defaults;this.links=a;this.rules=t.normal;this.renderer=this.options.renderer||new p;this.renderer.options=this.options;if(!this.links)throw Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?t.breaks:
t.gfm:this.options.pedantic&&(this.rules=t.pedantic)}function p(a){this.options=a||{}}function h(a){this.tokens=[];this.token=null;this.options=a||g.defaults;this.options.renderer=this.options.renderer||new p;this.renderer=this.options.renderer;this.renderer.options=this.options}function e(a,b){return a.replace(!b?/&(?!#?\w+;)/g:/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")}function c(a){return a.replace(/&([#\w]+);/g,function(a,
b){b=b.toLowerCase();return"colon"===b?":":"#"===b.charAt(0)?"x"===b.charAt(1)?String.fromCharCode(parseInt(b.substring(2),16)):String.fromCharCode(+b.substring(1)):""})}function b(a,b){a=a.source;b=b||"";return function u(c,g){if(!c)return RegExp(a,b);g=g.source||g;g=g.replace(/(^|[^\[])\^/g,"$1");a=a.replace(c,g);return u}}function k(){}function m(a){for(var b=1,d,c;b<arguments.length;b++)for(c in d=arguments[b],d)Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c]);return a}function g(a,b,d){if(d||
"function"===typeof b){d||(d=b,b=null);b=m({},g.defaults,b||{});var c=b.highlight,k,t,p=0;try{k=l.lex(a,b)}catch(r){return d(r)}t=k.length;var z=function(){var a,f;try{a=h.parse(k,b)}catch(g){f=g}b.highlight=c;return f?d(f):d(null,a)};if(!c||3>c.length)return z();delete b.highlight;if(!t)return z();for(;p<k.length;p++)(function(a){return"code"!==a.type?--t||z():c(a.text,a.lang,function(b,d){if(null==d||d===a.text)return--t||z();a.text=d;a.escaped=!0;--t||z()})})(k[p])}else try{return b&&(b=m({},g.defaults,
b)),h.parse(l.lex(a,b),b)}catch(D){D.message+="\nPlease report this to https://github.com/chjj/marked.";if((b||g.defaults).silent)return"\x3cp\x3eAn error occured:\x3c/p\x3e\x3cpre\x3e"+e(D.message+"",!0)+"\x3c/pre\x3e";throw D;}}var a={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:k,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:k,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,
html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:k,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/,bullet:/(?:[*+-]|\d+\.)/,item:/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/};a.item=b(a.item,"gm")(/bull/g,a.bullet)();a.list=b(a.list)(/bull/g,a.bullet)("hr","\\n+(?\x3d\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?\x3d"+a.def.source+")")();a.blockquote=b(a.blockquote)("def",a.def)();
a._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b";a.html=b(a.html)("comment",/\x3c!--[\s\S]*?--\x3e/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,a._tag)();a.paragraph=b(a.paragraph)("hr",a.hr)("heading",a.heading)("lheading",a.lheading)("blockquote",a.blockquote)("tag","\x3c"+a._tag)("def",a.def)();a.normal=m({},a);a.gfm=m({},a.normal,
{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});a.gfm.paragraph=b(a.paragraph)("(?!","(?!"+a.gfm.fences.source.replace("\\1","\\2")+"|"+a.list.source.replace("\\1","\\3")+"|")();a.tables=m({},a.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});l.rules=a;l.lex=function(a,b){return(new l(b)).lex(a)};l.prototype.lex=function(a){a=a.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g,
" ").replace(/\u2424/g,"\n");return this.token(a,!0)};l.prototype.token=function(b,c,d){b=b.replace(/^ +$/gm,"");for(var g,e,k,h,m,l,t;b;){if(k=this.rules.newline.exec(b))b=b.substring(k[0].length),1<k[0].length&&this.tokens.push({type:"space"});if(k=this.rules.code.exec(b))b=b.substring(k[0].length),k=k[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:!this.options.pedantic?k.replace(/\n+$/,""):k});else if(k=this.rules.fences.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"code",
lang:k[2],text:k[3]});else if(k=this.rules.heading.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"heading",depth:k[1].length,text:k[2]});else if(c&&(k=this.rules.nptable.exec(b))){b=b.substring(k[0].length);m={type:"table",header:k[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:k[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:k[3].replace(/\n$/,"").split("\n")};for(l=0;l<m.align.length;l++)/^ *-+: *$/.test(m.align[l])?m.align[l]="right":/^ *:-+: *$/.test(m.align[l])?m.align[l]=
"center":/^ *:-+ *$/.test(m.align[l])?m.align[l]="left":m.align[l]=null;for(l=0;l<m.cells.length;l++)m.cells[l]=m.cells[l].split(/ *\| */);this.tokens.push(m)}else if(k=this.rules.lheading.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"heading",depth:"\x3d"===k[2]?1:2,text:k[1]});else if(k=this.rules.hr.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"hr"});else if(k=this.rules.blockquote.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"blockquote_start"}),k=k[0].replace(/^ *> ?/gm,
""),this.token(k,c,!0),this.tokens.push({type:"blockquote_end"});else if(k=this.rules.list.exec(b)){b=b.substring(k[0].length);h=k[2];this.tokens.push({type:"list_start",ordered:1<h.length});k=k[0].match(this.rules.item);g=!1;t=k.length;for(l=0;l<t;l++)m=k[l],e=m.length,m=m.replace(/^ *([*+-]|\d+\.) +/,""),~m.indexOf("\n ")&&(e-=m.length,m=!this.options.pedantic?m.replace(RegExp("^ {1,"+e+"}","gm"),""):m.replace(/^ {1,4}/gm,"")),this.options.smartLists&&l!==t-1&&(e=a.bullet.exec(k[l+1])[0],h!==e&&
!(1<h.length&&1<e.length)&&(b=k.slice(l+1).join("\n")+b,l=t-1)),e=g||/\n\n(?!\s*$)/.test(m),l!==t-1&&(g="\n"===m.charAt(m.length-1),e||(e=g)),this.tokens.push({type:e?"loose_item_start":"list_item_start"}),this.token(m,!1,d),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(k=this.rules.html.exec(b))b=b.substring(k[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===k[1]||"script"===k[1]||"style"===k[1],text:k[0],isHTML:!0});else if(!d&&
c&&(k=this.rules.def.exec(b)))b=b.substring(k[0].length),this.tokens.links[k[1].toLowerCase()]={href:k[2],title:k[3]},this.tokens.push({type:"def",id:k[1].toLowerCase(),href:k[2],title:k[3]});else if(c&&(k=this.rules.table.exec(b))){b=b.substring(k[0].length);m={type:"table",header:k[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:k[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:k[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(l=0;l<m.align.length;l++)/^ *-+: *$/.test(m.align[l])?m.align[l]=
"right":/^ *:-+: *$/.test(m.align[l])?m.align[l]="center":/^ *:-+ *$/.test(m.align[l])?m.align[l]="left":m.align[l]=null;for(l=0;l<m.cells.length;l++)m.cells[l]=m.cells[l].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(m)}else if(c&&(k=this.rules.paragraph.exec(b)))b=b.substring(k[0].length),this.tokens.push({type:"paragraph",text:"\n"===k[1].charAt(k[1].length-1)?k[1].slice(0,-1):k[1]});else if(k=this.rules.text.exec(b))b=b.substring(k[0].length),this.tokens.push({type:"text",text:k[0]});
else if(b)throw Error("Infinite loop on byte: "+b.charCodeAt(0));}return this.tokens};var t={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:k,tag:/^\x3c!--[\s\S]*?--\x3e|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,
br:/^ {2,}\n(?!\s*$)/,del:k,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,_inside:/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,_href:/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/};t.link=b(t.link)("inside",t._inside)("href",t._href)();t.reflink=b(t.reflink)("inside",t._inside)();t.normal=m({},t);t.pedantic=m({},t.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});t.gfm=m({},t.normal,{escape:b(t.escape)("])","~|])")(),
url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:b(t.text)("]|","~]|")("|","|https?://|")()});t.breaks=m({},t.gfm,{br:b(t.br)("{2,}","*")(),text:b(t.gfm.text)("{2,}","*")()});r.rules=t;r.output=function(a,b,d){return(new r(b,d)).output(a)};r.prototype.output=function(a){for(var b="",d,c;a;)if(c=this.rules.escape.exec(a))a=a.substring(c[0].length),b+=c[1];else if(c=this.rules.autolink.exec(a))a=a.substring(c[0].length),"@"===c[2]?(d=":"===c[1].charAt(6)?this.mangle(c[1].substring(7)):
this.mangle(c[1]),c=this.mangle("mailto:")+d):c=d=e(c[1]),b+=this.renderer.link(c,null,d);else if(!this.inLink&&(c=this.rules.url.exec(a)))a=a.substring(c[0].length),c=d=e(c[1]),b+=this.renderer.link(c,null,d);else if(c=this.rules.tag.exec(a))!this.inLink&&/^<a /i.test(c[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(c[0])&&(this.inLink=!1),a=a.substring(c[0].length),b+=this.options.sanitize?e(c[0]):c[0];else if(c=this.rules.link.exec(a))a=a.substring(c[0].length),this.inLink=!0,b+=this.outputLink(c,
{href:c[2],title:c[3]}),this.inLink=!1;else if((c=this.rules.reflink.exec(a))||(c=this.rules.nolink.exec(a)))a=a.substring(c[0].length),d=(c[2]||c[1]).replace(/\s+/g," "),d=this.links[d.toLowerCase()],!d||!d.href?(b+=c[0].charAt(0),a=c[0].substring(1)+a):(this.inLink=!0,b+=this.outputLink(c,d),this.inLink=!1);else if(c=this.rules.strong.exec(a))a=a.substring(c[0].length),b+=this.renderer.strong(this.output(c[2]||c[1]));else if(c=this.rules.em.exec(a))a=a.substring(c[0].length),b+=this.renderer.em(this.output(c[2]||
c[1]));else if(c=this.rules.code.exec(a))a=a.substring(c[0].length),b+=this.renderer.codespan(e(c[2],!0));else if(c=this.rules.br.exec(a))a=a.substring(c[0].length),b+=this.renderer.br();else if(c=this.rules.del.exec(a))a=a.substring(c[0].length),b+=this.renderer.del(this.output(c[1]));else if(c=this.rules.text.exec(a))a=a.substring(c[0].length),b+=e(this.smartypants(c[0]));else if(a)throw Error("Infinite loop on byte: "+a.charCodeAt(0));return b};r.prototype.outputLink=function(a,b){var d=e(b.href),
c=b.title?e(b.title):null;return"!"!==a[0].charAt(0)?this.renderer.link(d,c,this.output(a[1])):this.renderer.image(d,c,e(a[1]))};r.prototype.smartypants=function(a){return!this.options.smartypants?a:a.replace(/--/g,"\u2014").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026")};r.prototype.mangle=function(a){for(var b="",d=a.length,c=0,g;c<d;c++)g=a.charCodeAt(c),0.5<Math.random()&&
(g="x"+g.toString(16)),b+="\x26#"+g+";";return b};p.prototype.code=function(a,b,d){if(this.options.highlight){var c=this.options.highlight(a,b);null!=c&&c!==a&&(d=!0,a=c)}return!b?"\x3cpre\x3e\x3ccode\x3e"+(d?a:e(a,!0))+"\n\x3c/code\x3e\x3c/pre\x3e":'\x3cpre\x3e\x3ccode class\x3d"'+this.options.langPrefix+e(b,!0)+'"\x3e'+(d?a:e(a,!0))+"\n\x3c/code\x3e\x3c/pre\x3e\n"};p.prototype.blockquote=function(a){return"\x3cblockquote\x3e\n"+a+"\x3c/blockquote\x3e\n"};p.prototype.def=function(a,b,d){return""};
p.prototype.html=function(a){return a};p.prototype.heading=function(a,b,d){return"\x3ch"+b+' id\x3d"'+this.options.headerPrefix+d.toLowerCase().replace(/[^\w]+/g,"-")+'"\x3e'+a+"\x3c/h"+b+"\x3e\n"};p.prototype.hr=function(){return this.options.xhtml?"\x3chr/\x3e\n":"\x3chr\x3e\n"};p.prototype.list=function(a,b){var d=b?"ol":"ul";return"\x3c"+d+"\x3e\n"+a+"\x3c/"+d+"\x3e\n"};p.prototype.listitem=function(a){return"\x3cli\x3e"+a+"\x3c/li\x3e\n"};p.prototype.paragraph=function(a){return"\x3cp\x3e"+a+
"\x3c/p\x3e\n"};p.prototype.table=function(a,b){return"\x3ctable\x3e\n\x3cthead\x3e\n"+a+"\x3c/thead\x3e\n\x3ctbody\x3e\n"+b+"\x3c/tbody\x3e\n\x3c/table\x3e\n"};p.prototype.tablerow=function(a){return"\x3ctr\x3e\n"+a+"\x3c/tr\x3e\n"};p.prototype.tablecell=function(a,b){var d=b.header?"th":"td";return(b.align?"\x3c"+d+' style\x3d"text-align:'+b.align+'"\x3e':"\x3c"+d+"\x3e")+a+"\x3c/"+d+"\x3e\n"};p.prototype.strong=function(a){return"\x3cstrong\x3e"+a+"\x3c/strong\x3e"};p.prototype.em=function(a){return"\x3cem\x3e"+
a+"\x3c/em\x3e"};p.prototype.codespan=function(a){return"\x3ccode\x3e"+a+"\x3c/code\x3e"};p.prototype.br=function(){return this.options.xhtml?"\x3cbr/\x3e":"\x3cbr\x3e"};p.prototype.del=function(a){return"\x3cdel\x3e"+a+"\x3c/del\x3e"};p.prototype.link=function(a,b,d){if(this.options.sanitize){try{var g=decodeURIComponent(c(a)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return""}if(0===g.indexOf("javascript:"))return""}a='\x3ca href\x3d"'+a+'"';b&&(a+=' title\x3d"'+b+'"');return a+("\x3e"+d+"\x3c/a\x3e")};
p.prototype.image=function(a,b,d){a='\x3cimg src\x3d"'+a+'" alt\x3d"'+d+'"';b&&(a+=' title\x3d"'+b+'"');return a+=this.options.xhtml?"/\x3e":"\x3e"};h.parse=function(a,b,d){return(new h(b,d)).parse(a)};h.prototype.parse=function(a){this.inline=new r(a.links,this.options,this.renderer);this.tokens=a.reverse();for(a="";this.next();)a+=this.tok();return a};h.prototype.next=function(){return this.token=this.tokens.pop()};h.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};h.prototype.parseText=
function(){for(var a=this.token.text;"text"===this.peek().type;)a+="\n"+this.next().text;return this.inline.output(a)};h.prototype.tok=function(){switch(this.token.type){case "space":return"";case "def":return this.renderer.def(this.token.id,this.token.href,this.token.title);case "hr":return this.renderer.hr();case "heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case "code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);
case "table":var a="",b="",d,c,g,e;g="";for(d=0;d<this.token.header.length;d++)g+=this.renderer.tablecell(this.inline.output(this.token.header[d]),{header:!0,align:this.token.align[d]});a+=this.renderer.tablerow(g);for(d=0;d<this.token.cells.length;d++){c=this.token.cells[d];g="";for(e=0;e<c.length;e++)g+=this.renderer.tablecell(this.inline.output(c[e]),{header:!1,align:this.token.align[e]});b+=this.renderer.tablerow(g)}return this.renderer.table(a,b);case "blockquote_start":for(b="";"blockquote_end"!==
this.next().type;)b+=this.tok();return this.renderer.blockquote(b);case "list_start":b="";for(a=this.token.ordered;"list_end"!==this.next().type;)b+=this.tok();return this.renderer.list(b,a);case "list_item_start":for(b="";"list_item_end"!==this.next().type;)b+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(b);case "loose_item_start":for(b="";"list_item_end"!==this.next().type;)b+=this.tok();return this.renderer.listitem(b);case "html":return b=!this.token.pre&&
!this.options.pedantic?this.inline.output(this.token.text):this.token.text,this.renderer.html(b);case "paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case "text":return this.renderer.paragraph(this.parseText())}};k.exec=k;g.options=g.setOptions=function(a){m(g.defaults,a);return g};g.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new p,xhtml:!1};g.Parser=
h;g.parser=h.parse;g.Renderer=p;g.Lexer=l;g.lexer=l.lex;g.InlineLexer=r;g.inlineLexer=r.output;g.parse=g;"object"===typeof exports?module.exports=g:"function"===typeof y&&y.amd?y("marked/marked",[],function(){return g}):this.marked=g}).call(function(){return this||("undefined"!==typeof window?window:global)}());y("orion/hover",["marked/marked"],function(l){function r(h,e){this.editor=h;this.hoverFactory=e;this.inputManager=e.inputManager;this.serviceRegistry=e.serviceRegistry;this.commandRegistry=
e.commandRegistry;this._qfToolbars=[]}function p(h,e,c){this.serviceRegistry=h;this.inputManager=e;this.commandRegistry=c;this.filterHoverPlugins();this.inputManager.addEventListener("InputChanged",function(){this.filterHoverPlugins()}.bind(this))}r.prototype={computeHoverInfo:function(h){var e=[];this.hoverFactory._applicableProviders.forEach(function(c){if((c=this.serviceRegistry.getService(c))&&c.computeHoverInfo){var b=this.editor.getEditorContext();e.push(c.computeHoverInfo(b,h))}}.bind(this));
return e},renderMarkDown:function(h){return l(h,{sanitize:!0})},clearQuickFixes:function(){this._qfToolbars.forEach(function(h){h.destroy()});this._qfToolbars=[]},renderQuickFixes:function(h,e){if(h&&e){var c=document.createElement("div");c.className="commandList";var b=this.inputManager.getFileMetadata();b.annotation=h;this.commandRegistry.renderCommands("orion.edit.quickfix",c,b,this.editor,"quickfix",h,[]);delete b.annotation;e.appendChild(c)}}};p.prototype={createHover:function(h){return new r(h,
this)},filterHoverPlugins:function(){this._applicableProviders=[];for(var h=this.serviceRegistry.getServiceReferences("orion.edit.hover"),e=0;e<h.length;e++){var c=h[e],b=this.inputManager.getContentType();if(b){var k=c.getProperty("contentType");k&&-1!==k.indexOf(b.id)&&this._applicableProviders.push(c)}}}};return{HoverFactory:p}});y("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/tooltip orion/editor/util orion/util orion/webui/littlelib orion/metrics".split(" "),
function(l,r,p,h,e,c,b,k,m,g,a){function t(a){this.textView=a;this.state=d.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,a)?this.setState(d.INACTIVE):this.isActive()&&(this.state===d.ACTIVE&&this.setState(d.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(d.INACTIVE)}.bind(this)};
a.setKeyBinding(m.isMac?new r.KeyBinding(" ",!1,!1,!1,!0):new r.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(m.isMac?new r.KeyBinding(" ",!1,!1,!0,!0):new r.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();return!0},{name:l.contentAssist})}function f(a,b){var d=a.textView;p.KeyMode.call(this,d);this.contentAssist=a;this.widget=b;this.proposals=[];var c=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){c.proposals=
a.data.proposals;if(0===c.proposals.length)c.selectedIndex=-1,c.cancel();else{for(c.selectedIndex=0;c.proposals[c.selectedIndex]&&c.proposals[c.selectedIndex].unselectable;)c.selectedIndex++;if(c.proposals[c.selectedIndex]){if(c.widget){var b=!0;if(a.autoApply){for(a=c.selectedIndex+1;c.proposals[a]&&c.proposals[a].unselectable;)a++;c.proposals[a]||(b=!1,c.contentAssist.apply(c.proposals[c.selectedIndex]))}b&&(c.widget.show(),c.widget.selectNode(c.selectedIndex))}}else c.selectedIndex=-1,c.cancel()}});
d.setAction("contentAssistApply",function(){return this.enter()}.bind(this));d.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));d.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));d.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this));d.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));d.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));d.setAction("contentAssistHome",
function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));d.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));d.setAction("contentAssistTab",function(){return this.tab()}.bind(this));this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function n(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var d=this.textView.getOptions("parent").ownerDocument;
this.parentNode="string"===typeof b?d.getElementById(b):b;if(!this.parentNode){this.parentNode=m.createElement(d,"div");this.parentNode.className="contentassist";var c=d.getElementsByTagName("body")[0];if(c)c.appendChild(this.parentNode);else throw Error("parentNode is required");}k.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var g=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==g.parentNode&&g.contentAssist.deactivate()}};
this.contentAssist.addEventListener("Deactivating",function(a){g.hide()});this.scrollListener=function(a){g.isShowing&&g.position()};k.addEventListener(d,"scroll",this.scrollListener)}var d={INACTIVE:1,ACTIVE:2,FILTERING:3},u={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};
t.prototype={apply:function(b){if(!b)return!1;var c=this.textView,g=c.getSelection(),f=this._initialCaretOffset,e=f,k=g=Math.max(g.start,g.end),n=c.getModel();n.getBaseModel&&(e=n.mapOffset(e),k=n.mapOffset(k),n=n.getBaseModel());b.overwrite&&(f="string"===typeof b.prefix?e-b.prefix.length:this.getPrefixStart(n,e));e={proposal:b,start:e,end:k};this.setState(d.INACTIVE);c.setText("string"===typeof b?b:b.proposal,f,g);if(b.additionalEdits)for(g=0;g<b.additionalEdits.length;g++)f=b.additionalEdits[g],
c.setText(f.text,f.offset,f.offset+f.length);this.dispatchEvent({type:"ProposalApplied",data:e});a.logEvent("contentAssist","apply");return!0},activate:function(b,c){this.state===d.INACTIVE&&(a.logEvent("contentAssist","activate",void 0,c?0:1),this._autoTriggered=c?!0:!1,this.setState(d.ACTIVE,b))},deactivate:function(){this.setState(d.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===d.ACTIVE||this.state===d.FILTERING},isDeactivatingChange:function(a,
b){var d=!1;(Array.isArray(b.newValue)?b.newValue:[b.newValue])[0].start<this._initialCaretOffset||!a?d=!0:a&&(d=0<a.removedLineCount||0<a.addedLineCount);return d},setState:function(a,b){var c;a===d.ACTIVE?(c="Activating",this._mode&&this._mode.setActive(!0)):a===d.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===d.INACTIVE?(this._removeTextViewListeners(),
this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===d.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&
(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var d=b;0<d&&/[A-Za-z0-9_]/.test(a.getText(d-1,d));)d--;return d},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=
a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,d=this.textView,g=d.getSelection(),f=d.getModel(),k=a;f.getBaseModel&&(k=f.mapOffset(k),g.start=f.mapOffset(g.start),g.end=f.mapOffset(g.end),f=f.getBaseModel());a=f.getLine(f.getLineAtOffset(k));for(var n=0;n<a.length&&/\s/.test(a.charAt(n));)n++;var n=a.substring(0,n),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",h={line:a,offset:k,prefix:f.getText(this.getPrefixStart(f,
k),k),selection:g,delimiter:f.getLineDelimiter(),tab:d,indentation:n},m=this,b=b.map(function(a){a=a.provider;var b;try{var d,g;if(d=a.computeContentAssist){var n=m.editorContextProvider,s=n.getEditorContext();h=c.mixin(h,n.getOptions());g=d.apply(a,[s,h])}else if(d=a.getProposals||a.computeProposals)g=d.apply(a,[f.getText(),k,h]);b=m.progress?m.progress.progress(g,"Generating content assist proposal"):g}catch(l){return(new e).reject(l)}return e.when(b)});return e.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&
(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),d=b,c=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;d="string"===typeof a.prefix?a.prefix:b;if(u[a.style]===u.hr||u[a.style]===u.noemphasis_title)return!0;var c="";if(a.overwrite){if(a.name)c=a.name;else if(a.proposal)c=a.proposal;else return!1;
return 0===c.indexOf(d+this._filterText)}return a.name||a.proposal?(c=!1,a.name&&(c=0===a.name.indexOf(d+this._filterText)),!c&&a.proposal&&(c=0===a.proposal.indexOf(this._filterText)),c):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&c.push(a))},this);a=[];c&&(c=this._removeExtraUnselectableElements(c),a=this._flatten(c));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,
d){var c=!0;if(u[b.style]===u.hr)0===d||a.length-1===d?c=!1:u.hr===u[a[d-1].style]&&(c=!1);else if(u[b.style]===u.noemphasis_title){var g=a[d+1];g?u[g.style]===u.noemphasis_title&&(c=!1):c=!1}return c})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=
this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=
a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var d=a,c=null;b&&Array.isArray(b)&&(c=b.filter(function(a){return a}));if(c&&Array.isArray(c)&&0<c.length){var d=c,g=a,f=c[0].style;f&&(u[f]&&0===u[f].indexOf(u.noemphasis))&&(d=a,g=c);0<d.length&&(c=d[d.length-1].style)&&u.hr!==u[c]&&(d=d.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));d=d.concat(g)}return d},[])},_triggerListener:function(){var a=
this.textView.getCaretOffset(),b=null,d=[];if(this._charTriggersInstalled){var c=this.textView.getText(a-1,a);this._providers.forEach(function(g){var f=g.charTriggers;if(f&&f.test(c)){var f=!1,e=g.excludedStyles;this._styleAccessor&&e&&(b||(b=this._styleAccessor.getStyles(a-1)),f=b.some(function(a){return e.test(a.style)}));f||d.push(g)}},this);0<d.length&&this.activate(d,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));
if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),
this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",
this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};h.EventTarget.addMixin(t.prototype);f.prototype=new p.KeyMode;c.mixin(f.prototype,{createKeyBindings:function(){var a=r.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});
b.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(g.KEY.HOME)});b.push({actionID:"contentAssistEnd",keyBinding:new a(g.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},
getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,d){if(d){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;
a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var c=a;this.proposals[a]&&this.proposals[a].unselectable;){if(d){if(a++,a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===c){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);this._showTooltip(!0);return!0},_showTooltip:function(a){var d=b.Tooltip.getTooltip(this.contentAssist.textView),c=this,g={getTooltipInfo:function(){var a=
c.widget.parentNode.getBoundingClientRect(),b={width:350,height:a.height,top:a.top};a.left+a.width>=document.documentElement.clientWidth?(b.left=a.left-b.width,b.left-=10):(b.left=a.left+a.width,b.left+=10);return{context:{proposal:c.proposals[c.selectedIndex]},anchorArea:a,tooltipArea:b}}};a?d.update(g):d.show(g,!0,!1)},_hideTooltip:function(){b.Tooltip.getTooltip(this.contentAssist.textView).hide()},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,
!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});n.prototype={onClick:function(a){a||
(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(u.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,d){var c=b.ownerDocument,g=m.createElement(c,"div");g.id="contentoption"+d;g.setAttribute("role","option");g.className=u[a.style]?u[a.style]:u.dfault;"hr"===a.style?a=m.createElement(c,
"hr"):(a=this._createDisplayNode(g,a,d),g.contentAssistProposalIndex=d);g.appendChild(a);b.appendChild(g)},createAccessible:function(){var a=this._contentAssistMode,b=this;k.addEventListener(this.parentNode,"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===g.KEY.ESCAPE?a.cancel():d.keyCode===g.KEY.UP?a.lineUp():d.keyCode===g.KEY.DOWN?a.lineDown():d.keyCode===g.KEY.ENTER?a.enter():d.keyCode===g.KEY.PAGEDOWN?a.pageDown():d.keyCode===g.KEY.PAGEUP?a.pageUp():
d.keyCode===g.KEY.HOME?(b.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===g.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,d){var c=a=null;if("string"===typeof b)c=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var g=this._createNameNode(b.name);g.contentAssistProposalIndex=d;a=document.createElement("span");a.appendChild(g);b=document.createTextNode(b.description);a.appendChild(b)}else c=b.description;else c=b.proposal;
c&&(a=this._createNameNode(c));a.contentAssistProposalIndex=d;return a},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},
getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var d=a[b];if(d.offsetTop+d.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){var d=this.parentNode.childNodes[a];d&&(d.scrollIntoView(b),this.preserveCloneThroughScroll=!0)},selectNode:function(a){var b=null;this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null);this._fadeTimer&&(window.clearTimeout(this._fadeTimer),
this._fadeTimer=null);this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(u.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a&&(b=this.parentNode.childNodes[a])){b.classList.add(u.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&
(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var d=(b.firstChild||b).getBoundingClientRect(),c=this.parentNode.clientWidth?this.parentNode.clientWidth:this.parentNode.getBoundingClientRect();a=window.getComputedStyle(this.parentNode);var g=window.getComputedStyle(b),g=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(g.paddingLeft)+parseInt(g.paddingRight);if(d.width>=c-g){g=parseInt(a.top);c=b.cloneNode(!0);c.classList.add("cloneProposal");c.style.top=g+b.offsetTop-this.parentNode.scrollTop+
"px";c.style.left=a.left;c.setAttribute("id",c.id+"_clone");d=d.left+d.width-parseInt(document.documentElement.clientWidth);0<d&&(a=parseInt(a.left)-d,0>a&&(a=0),c.style.left=a+"px");var f=document.createElement("div");f.id="clone_contentassist";f.classList.add("contentassist");f.classList.add("cloneWrapper");f.appendChild(c);f.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(f,this.parentNode);var e=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var d=
0;d<a.childNodes.length;d++)e(a.childNodes[d])};e(f);var k=this;this._hideTimeout=window.setTimeout(function(){k._hideTimeout=null;b.classList.add(u.selected);var a=1;k._fadeTimer=window.setInterval(function(){!k.previousCloneNode||0.01>=a?(k._removeCloneNode(),window.clearInterval(k._fadeTimer),k._fadeTimer=null):(f.style.opacity=a,f.style.filter="alpha(opacity\x3d"+100*a+")",a-=0.1*a)},50)},1500);b.classList.remove(u.selected);this.previousCloneNode=f}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=
a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML="";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this._contentAssistMode._showTooltip(!1);this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===
this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this._contentAssistMode._hideTooltip();this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=
a.offset,d=b.getModel();d.getBaseModel&&(a=d.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;d=this.parentNode.ownerDocument;b=d.documentElement.clientWidth;d=d.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>
d){var c=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>c?d>c?this.parentNode.style.maxHeight=d+"px":(this.parentNode.style.maxHeight=c+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=c+"px")}else this.parentNode.style.maxHeight=d+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=
b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);this.previousCloneNode=null}};return{ContentAssist:t,ContentAssistMode:f,ContentAssistWidget:n}});y("orion/editor/emacs",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(l,r,p,h){function e(c){r.KeyMode.call(this,c)}e.prototype=new r.KeyMode;e.prototype.createKeyBindings=
function(){var c=[];c.push({actionID:"emacs-beginning-of-line",keyBinding:this._createStroke("a",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-end-of-line",keyBinding:this._createStroke("e",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-forward-char",keyBinding:this._createStroke("f",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-backward-char",keyBinding:this._createStroke("b",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-forward-word",keyBinding:this._createStroke("f",!1,!1,!0)});
c.push({actionID:"emacs-backward-word",keyBinding:this._createStroke("b",!1,!1,!0)});c.push({actionID:"emacs-next-line",keyBinding:this._createStroke("n",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-previous-line",keyBinding:this._createStroke("p",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-beginning-of-buffer",keyBinding:this._createStroke(188,!1,!0,!0)});c.push({actionID:"emacs-end-of-buffer",keyBinding:this._createStroke(190,!1,!0,!0)});c.push({actionID:"emacs-delete-backward-char",
keyBinding:this._createStroke(46,!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-delete-char",keyBinding:this._createStroke("d",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-kill-line",keyBinding:this._createStroke("k",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-kill-word",keyBinding:this._createStroke("d",!1,!1,!0)});c.push({actionID:"emacs-backward-kill-word",keyBinding:this._createStroke(46,!1,!1,!0)});c.push({actionID:"undo",keyBinding:this._createSequence([this._createStroke("x",
!0),this._createStroke("u")])});c.push({actionID:"redo",keyBinding:this._createSequence([this._createStroke("x",!0),this._createStroke("r")])});c.push({actionID:"emacs-scroll-up",keyBinding:this._createStroke("v",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-scroll-down",keyBinding:this._createStroke("v",!1,!1,!0)});c.push({actionID:"emacs-set-mark-command",keyBinding:this._createStroke(" ",!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-reset-mark-command",keyBinding:this._createStroke("g",
!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-exchange-point-and-mark",keyBinding:this._createSequence([this._createStroke("x",!h.isMac,!1,!1,h.isMac),this._createStroke("x",!h.isMac,!1,!1,h.isMac)])});for(var b=0;9>=b;b++)c.push({actionID:"emacs-digit-argument-"+b,keyBinding:this._createStroke(48+b,!h.isMac,!1,!1,h.isMac)}),c.push({actionID:"emacs-digit-argument-"+b,keyBinding:this._createStroke(48+b,!1,!1,!0)}),c.push({actionID:"emacs-digit-argument-"+b,keyBinding:this._createStroke(48+b,!h.isMac,
!1,!0,h.isMac)});c.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!h.isMac,!1,!1,h.isMac)});c.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!1,!1,!0)});c.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!h.isMac,!1,!0,h.isMac)});c.push({actionID:"emacs-uppercase",keyBinding:this._createStroke("u",!1,!1,!0)});c.push({actionID:"emacs-lowercase",keyBinding:this._createStroke("l",!1,!1,!0)});c.push({actionID:"emacs-capitalize",
keyBinding:this._createStroke("c",!1,!1,!0)});c.push({actionID:"contentAssist",keyBinding:this._createStroke(191,!1,!1,!0)});c.push({actionID:"find",keyBinding:this._createStroke("r",!1,!1,!0)});c.push({actionID:"incrementalFind",keyBinding:this._createStroke("s",!0)});c.push({actionID:"incrementalFindReverse",keyBinding:this._createStroke("r",!0)});c.push({actionID:"save",keyBinding:this._createSequence([this._createStroke("x",!h.isMac,!1,!1,h.isMac),this._createStroke("s",!h.isMac,!1,!1,h.isMac)])});
this._createActions(this.getView());return c};e.prototype._createStroke=function(c,b,e,h,g){c=new p.KeyStroke(c,b,e,h,g);c.scopeName=l.emacs;return c};e.prototype._createSequence=function(c){c=new p.KeySequence(c);c.scopeName=l.emacs;return c};e.prototype._getData=function(){var c={count:(this._argument||1)*(this._sign||1)};this._argument=0;this._sign=1;return c};e.prototype._moveCursor=function(c){var b=this._getData();this._marker&&(b.select=!0);return this.getView().invokeAction(c,!1,b)};e.prototype._digitArgument=
function(c){this._argument=10*(this._argument||0)+c;return!0};e.prototype._negativeArgument=function(){this._sign=-1*(this._sign||1);return!0};e.prototype._createActions=function(c){var b=this;c.setAction("emacs-beginning-of-line",function(){return b._moveCursor("lineStart")},{name:l.lineStart});c.setAction("emacs-end-of-line",function(){return b._moveCursor("lineEnd")},{name:l.lineEnd});c.setAction("emacs-forward-char",function(){return b._moveCursor("charNext")},{name:l.charNext});c.setAction("emacs-backward-char",
function(){return b._moveCursor("charPrevious")},{name:l.charPrevious});c.setAction("emacs-forward-word",function(){return b._moveCursor("wordNext")},{name:l.wordNext});c.setAction("emacs-backward-word",function(){return b._moveCursor("wordPrevious")},{name:l.wordPrevious});c.setAction("emacs-next-line",function(){return b._moveCursor("lineDown")},{name:l.lineDown});c.setAction("emacs-previous-line",function(){return b._moveCursor("lineUp")},{name:l.lineUp});c.setAction("emacs-beginning-of-buffer",
function(){return b._moveCursor("textStart")},{name:l.textStart});c.setAction("emacs-end-of-buffer",function(){return b._moveCursor("textEnd")},{name:l.textEnd});c.setAction("emacs-delete-backward-char",function(){return c.invokeAction("deletePrevious")},{name:l.deletePrevious});c.setAction("emacs-delete-char",function(){return c.invokeAction("deletePrevious")},{name:l.deletePrevious});c.setAction("emacs-kill-line",function(){return c.invokeAction("deleteLineEnd")},{name:l.deleteLineEnd});c.setAction("emacs-kill-word",
function(){return c.invokeAction("deleteWordNext")},{name:l.deleteWordNext});c.setAction("emacs-backward-kill-word",function(){return c.invokeAction("deleteWordPrevious")},{name:l.deleteWordPrevious});c.setAction("emacs-scroll-up",function(){return b._moveCursor("pageDown")},{name:l.pageDown});c.setAction("emacs-scroll-down",function(){return b._moveCursor("pageUp")},{name:l.pageUp});c.setAction("emacs-set-mark-command",function(){var e=c.getCaretOffset();c.setCaretOffset(e);b._marker=e;return!0},
{name:l.setMarkCommand});c.setAction("emacs-exchange-point-and-mark",function(){if(void 0!==b._marker){var e=c.getCaretOffset(),h=c.getSelection();if(h.end===e){var g=h.start;h.start=h.end;h.end=g}b._marker=e;c.setSelection(h.start,h.end)}return!0},{name:l.exchangeMarkPoint});c.setAction("emacs-reset-mark-command",function(){var e=c.getCaretOffset();c.setCaretOffset(e);b._marker=void 0;return!0},{name:l.clearMark});c.setAction("emacs-digit-argument-0",function(){return b._digitArgument(0)},{name:h.formatMessage(l.digitArgument,
"0")});c.setAction("emacs-digit-argument-1",function(){return b._digitArgument(1)},{name:h.formatMessage(l.digitArgument,"1")});c.setAction("emacs-digit-argument-2",function(){return b._digitArgument(2)},{name:h.formatMessage(l.digitArgument,"2")});c.setAction("emacs-digit-argument-3",function(){return b._digitArgument(3)},{name:h.formatMessage(l.digitArgument,"3")});c.setAction("emacs-digit-argument-4",function(){return b._digitArgument(4)},{name:h.formatMessage(l.digitArgument,"4")});c.setAction("emacs-digit-argument-5",
function(){return b._digitArgument(5)},{name:h.formatMessage(l.digitArgument,"5")});c.setAction("emacs-digit-argument-6",function(){return b._digitArgument(6)},{name:h.formatMessage(l.digitArgument,"6")});c.setAction("emacs-digit-argument-7",function(){return b._digitArgument(7)},{name:h.formatMessage(l.digitArgument,"7")});c.setAction("emacs-digit-argument-8",function(){return b._digitArgument(8)},{name:h.formatMessage(l.digitArgument,"8")});c.setAction("emacs-digit-argument-9",function(){return b._digitArgument(9)},
{name:h.formatMessage(l.digitArgument,"9")});c.setAction("emacs-negative-argument",function(){return b._negativeArgument()},{name:l.negativeArgument});c.setAction("emacs-uppercase",function(){var e=b._getData();e.unit="word";return c.invokeAction("uppercase",!1,e)},{name:l.uppercase});c.setAction("emacs-lowercase",function(){var e=b._getData();e.unit="word";return c.invokeAction("lowercase",!1,e)},{name:l.lowercase});c.setAction("emacs-capitalize",function(){var e=b._getData();e.unit="word";return c.invokeAction("capitalize",
!1,e)},{name:l.capitalize})};return{EmacsMode:e}});y("orion/editor/vi",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(l,r,p,h){function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a,b,c,g,f,e,k){a=new p.KeyStroke(a,b,c,g,f,e);a.scopeName=k||l.vi;return a}function b(a,b){var c=new p.KeySequence(a);c.scopeName=b||l.vi;return c}function k(a,b,c){this.key=b;this.msg=c;this.number="";r.KeyMode.call(this,a);a&&this._createActions(a)}
function m(a){var b=a.getView();this.viMode=a;r.KeyMode.call(this,b);this._createActions(b)}function g(a,b,c,g){this.viMode=a;this.nextMode=b;k.call(this,a.getView(),c,g)}function a(a){var b=a.getView();r.KeyMode.call(this,b);this.viMode=a;this._createActions(b)}function t(b,c){k.call(this,b,"",l.vimove);this.insertMode=new a(this);this.changeMode=new g(this,this.insertMode,"c",l.vichange);this.deleteMode=new g(this,this,"d",l.videlete);this.yankMode=new g(this,this,"y",l.viyank);this.statusReporter=
c}var f,n;k.prototype=new r.KeyMode;e(k.prototype,{_msg:function(a){return{name:h.formatMessage(l[a],this.msg)}},createKeyBindings:function(){for(var a=[],b=this.key,b=b?"-"+b+"-":"-",g=0;9>=g;g++)a.push({actionID:"vi"+b+g,keyBinding:c(g+"",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi"+b+"Left",keyBinding:c("h",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"Left",keyBinding:c("h",!0,!1,!1,!1)});a.push({actionID:"vi"+b+"Left",keyBinding:c(8)});a.push({actionID:"vi"+b+"Left",keyBinding:c(37)});
a.push({actionID:"vi"+b+"Down",keyBinding:c("j",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"Down",keyBinding:c(40)});a.push({actionID:"vi"+b+"Up",keyBinding:c("k",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"Up",keyBinding:c(38)});a.push({actionID:"vi"+b+"Right",keyBinding:c("l",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"Right",keyBinding:c(39)});a.push({actionID:"vi"+b+"Right",keyBinding:c(32)});a.push({actionID:"vi"+b+"w",keyBinding:c("w",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+
b+"b",keyBinding:c("b",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"W",keyBinding:c("W",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"B",keyBinding:c("B",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"e",keyBinding:c("e",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"E",keyBinding:c("E",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"$",keyBinding:c("$",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"^_",keyBinding:c("^",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"^_",
keyBinding:c("_",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"+",keyBinding:c("+",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"+",keyBinding:c(13)});a.push({actionID:"vi"+b+"-",keyBinding:c("-",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"|",keyBinding:c("|",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"H",keyBinding:c("H",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"M",keyBinding:c("M",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"L",keyBinding:c("L",!1,!1,!1,!1,
"keypress")});a.push({actionID:"vi"+b+"/",keyBinding:c("/",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"?",keyBinding:c("?",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"n",keyBinding:c("n",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"N",keyBinding:c("N",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"f",keyBinding:c("f",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"F",keyBinding:c("F",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"t",keyBinding:c("t",!1,!1,!1,!1,"keypress")});
a.push({actionID:"vi"+b+"T",keyBinding:c("T",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+",",keyBinding:c(",",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+";",keyBinding:c(";",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi"+b+"G",keyBinding:c("G",!1,!1,!1,!1,"keypress")});return a},_createActions:function(a){function b(c){c=a.getModel().getLine(c);for(var g=0,f=c.charCodeAt(g);32===f||9===f;)g++,f=c.charCodeAt(g);return g}function c(a,b){a&&f.getView().setCaretOffset(a.start);b.editDone&&
b.editDone()}var g=this.key,g=g?"-"+g+"-":"-",f=this;a.setAction("vi"+g+"0",function(){return f._storeNumber(0)});a.setAction("vi"+g+"1",function(){return f._storeNumber(1)});a.setAction("vi"+g+"2",function(){return f._storeNumber(2)});a.setAction("vi"+g+"3",function(){return f._storeNumber(3)});a.setAction("vi"+g+"4",function(){return f._storeNumber(4)});a.setAction("vi"+g+"5",function(){return f._storeNumber(5)});a.setAction("vi"+g+"6",function(){return f._storeNumber(6)});a.setAction("vi"+g+"7",
function(){return f._storeNumber(7)});a.setAction("vi"+g+"8",function(){return f._storeNumber(8)});a.setAction("vi"+g+"9",function(){return f._storeNumber(9)});a.setAction("vi"+g+"Left",function(){return f._invoke("charPrevious",{unit:"character"})},this._msg("viLeft"));a.setAction("vi"+g+"Right",function(){return f._invoke("charNext",{unit:"character"})},this._msg("viRight"));a.setAction("vi"+g+"Up",function(){return f._invoke("lineUp",{editLine:!0})},this._msg("viUp"));a.setAction("vi"+g+"Down",
function(){return f._invoke("lineDown",{editLine:!0})},this._msg("viDown"));a.setAction("vi"+g+"w",function(){return f._invoke("wordNext",{unit:"word"})},this._msg("viw"));a.setAction("vi"+g+"b",function(){return f._invoke("wordPrevious",{unit:"word"})},this._msg("vib"));a.setAction("vi"+g+"W",function(){return f._invoke("wordNext",{unit:"wordWS"})},this._msg("viW"));a.setAction("vi"+g+"B",function(){return f._invoke("wordPrevious",{unit:"wordWS"})},this._msg("viB"));a.setAction("vi"+g+"e",function(){f._invoke("charNext",
{unit:"character"});f._invoke("wordNext",{unit:"wordend"});f._invoke("charPrevious",{unit:"character"});return!0},this._msg("vie"));a.setAction("vi"+g+"E",function(){return f._invoke("wordNext",{unit:"wordendWS"})},this._msg("viE"));a.setAction("vi"+g+"$",function(){return f._invoke("lineEnd")},this._msg("vi$"));a.setAction("vi"+g+"^_",function(){return f._invoke(function(){var c=a.getModel(),g=a.getCaretOffset(),g=c.getLineAtOffset(g);a.setCaretOffset(c.getLineStart(g)+b(g))})},this._msg("vi^_"));
a.setAction("vi"+g+"+",function(){return f._invoke(function(c){var g=a.getModel(),f=a.getCaretOffset(),e=g.getLineCount()-1;c=Math.min(g.getLineAtOffset(f)+c.count,e);a.setCaretOffset(g.getLineStart(c)+b(c))},{editLine:!0})},this._msg("vi+"));a.setAction("vi"+g+"-",function(){return f._invoke(function(c){var g=a.getModel(),f=a.getCaretOffset();c=Math.max(g.getLineAtOffset(f)-c.count,0);a.setCaretOffset(g.getLineStart(c)+b(c))},{editLine:!0})},this._msg("vi-"));a.setAction("vi"+g+"|",function(){return f._invoke(function(b){var c=
a.getModel(),g=a.getCaretOffset(),g=c.getLineAtOffset(g);a.setCaretOffset(Math.min(c.getLineStart(g)+b.count-1,c.getLineEnd(g)))})},this._msg("vi|"));a.setAction("vi"+g+"H",function(){return f._invoke(function(b){b=a.getModel().getLineStart(a.getTopIndex(!0)+(b.count-1));a.setCaretOffset(b)},{editLine:!0})},this._msg("viH"));a.setAction("vi"+g+"M",function(){return f._invoke(function(b){b=Math.ceil((a.getBottomIndex(!0)-a.getTopIndex(!0))/2)+a.getTopIndex(!0);a.setCaretOffset(a.getModel().getLineStart(b))},
{editLine:!0})},this._msg("viM"));a.setAction("vi"+g+"L",function(){return f._invoke(function(b){a.setCaretOffset(a.getModel().getLineStart(a.getBottomIndex(!0)-(b.count-1)))},{editLine:!0})},this._msg("viL"));a.setAction("vi"+g+"/",function(){var a={hideAfterFind:!0,incremental:!1,reverse:!1,findCallback:function(b){f._searchFwd=!0;c(b,a)}};return f._invoke("find",a)},this._msg("vi/"));a.setAction("vi"+g+"?",function(){var a={hideAfterFind:!0,incremental:!1,reverse:!0,findCallback:function(b){f._searchFwd=
!1;c(b,a)}};return f._invoke("find",a)},this._msg("vi?"));a.setAction("vi"+g+"n",function(){var b,g=a.getCaretOffset();f._searchFwd?(b="findNext",g++):b="findPrevious";var e={start:g,findCallback:function(a){c(a,e)}};return f._invoke(b,e)},this._msg("vin"));a.setAction("vi"+g+"N",function(){var b,g=a.getCaretOffset();f._searchFwd?b="findPrevious":(b="findNext",g++);var e={start:g,findCallback:function(a){c(a,e)}};return f._invoke(b,e)},this._msg("viN"));a.setAction("vi"+g+"f",function(){var b=a.getModel(),
c=a.getCaretOffset();return f._findChar(c,b.getLineEnd(b.getLineAtOffset(c)),!1,0)},this._msg("vif"));a.setAction("vi"+g+"F",function(){var b=a.getModel(),c=a.getCaretOffset();return f._findChar(b.getLineStart(b.getLineAtOffset(c)),c,!0,0)},this._msg("viF"));a.setAction("vi"+g+"t",function(){var b=a.getModel(),c=a.getCaretOffset();return f._findChar(c,b.getLineEnd(b.getLineAtOffset(c)),!1,-1)},this._msg("vit"));a.setAction("vi"+g+"T",function(){var b=a.getModel(),c=a.getCaretOffset();return f._findChar(b.getLineStart(b.getLineAtOffset(c)),
c,!0,1)},this._msg("viT"));a.setAction("vi"+g+",",function(){return f._findNextChar(f._charTempOptions.reverse)},this._msg("vi,"));a.setAction("vi"+g+";",function(){return f._findNextChar(!f._charTempOptions.reverse)},this._msg("vi;"));a.setAction("vi"+g+"G",function(){if(""===f.number){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());f.number=b.getLineCount()}return f._invoke(function(b){b=b||{};b.line=b.count;b.editLine=!0;b.callback=function(){b.editDone&&b.editDone()};a.invokeAction("gotoLine",
!1,b)})},this._msg("viG"))},_invoke:function(a,b){var c=this.getView();b=b||{};b.count=this._getCount();"function"===typeof a?a(b):c.invokeAction(a,!1,b);return!0},_getCount:function(){var a=1;""!==this.number&&(a=this.number>>0);this.number="";return a},_findChar:function(a,b,c,g){this._charTempOptions={};this._charTempOptions.start=a;this._charTempOptions.end=b;this._charTempOptions.hideAfterFind=!0;this._charTempOptions.incremental=!1;this._charTempOptions.reverse=c;this._charTempOptions.offset=
g;var f=this._charTempOptions,e=this;this._charTempOptions.findCallback=function(a){a&&e.getView().setCaretOffset(a.start+g);f.editDone&&f.editDone()};return this._invoke("find",this._charTempOptions)},_findNextChar:function(a){if(this._charTempOptions){var b=this.getView(),c={};c.hideAfterFind=this._charTempOptions.hideAfterFind;c.incremental=this._charTempOptions.incremental;c.reverse=this._charTempOptions.reverse;c.wrap=!1;var g=this;c.findCallback=function(a){a&&g.getView().setCaretOffset(a.start+
g._charTempOptions.offset);c.editDone&&c.editDone()};var f=b.getModel();if(a)return c.start=b.getCaretOffset()+1-this._charTempOptions.offset,c.end=f.getLineEnd(f.getLineAtOffset(c.start)),c.reverse=!1,this._invoke("findNext",c);c.start=b.getCaretOffset()-this._charTempOptions.offset;c.end=f.getLineStart(f.getLineAtOffset(c.start));c.reverse=!0;return this._invoke("findPrevious",c)}return!0},_storeNumber:function(a){var b=this;if(0===a&&!this.number)return this._invoke(function(){b.getView().invokeAction("lineStart",
!0)});this.number+=a;return!0}});m.prototype=new r.KeyMode;e(m.prototype,{createKeyBindings:function(){var a=[];a.push({actionID:"vi-:-ESC",keyBinding:c(27),predefined:!0});return a},_createActions:function(a){var b=this;a.setAction("vi-:-ESC",function(){a.removeKeyMode(b);a.addKeyMode(b.viMode);return!0})},match:function(a){var b=r.KeyMode.prototype.match.call(this,a);b||(b=this.getView().getKeyModes()[0].match(a));return b},storeNumber:function(a){this.number=a}});g.prototype=new k;e(g.prototype,
{createKeyBindings:function(){var a=k.prototype.createKeyBindings.call(this);a.push({actionID:"vi-"+this.key+"ESC",keyBinding:c(27),predefined:!0});a.push({actionID:"vi-"+this.key+"-"+this.key,keyBinding:c(this.key,!1,!1,!1,!1,"keypress")});return a},_invoke:function(a,b){b=b||{};var c=this.getView(),g=c.getCaretOffset(),e=g,h=c.getModel(),m=this;b.editDone=function(){var a=c.getCaretOffset();if(e>a){var d=e;e=a;a=d}b.editLine&&(e=h.getLineStart(h.getLineAtOffset(e)),a=h.getLineEnd(h.getLineAtOffset(a),
"c"===m.key?!1:!0));"y"===m.key?(f=c.getText(e,a),n=b.editLine,c.setCaretOffset(g)):c.setText("",e,a);c.removeKeyMode(m);c.addKeyMode(m.nextMode)};k.prototype._invoke.call(this,a,b);b.editDone();return!0},_getCount:function(){var a=1;""!==this.firstNumber&&(a=this.firstNumber>>0);var b=1;""!==this.number&&(b=this.number>>0);this.number=this.firstNumber="";return a*b},_createActions:function(a){k.prototype._createActions.call(this,a);var b=this;a.setAction("vi-"+b.key+"ESC",function(){a.removeKeyMode(b);
a.addKeyMode(b.viMode);return!0});a.setAction("vi-"+b.key+"-"+b.key,function(){return b._invoke("lineEnd",{editLine:!0})},this._msg("viycd"))},storeNumber:function(a){this.firstNumber=a},_modeAdded:function(){this.secondNumber=""},_modeRemoved:function(){this.number=this.firstNumber=this.command=""}});a.prototype=new r.KeyMode;e(a.prototype,{createKeyBindings:function(){var a=[];a.push({actionID:"vi-insert-ESC",keyBinding:c(27),predefined:!0});return a},_createActions:function(a){var b=this;a.setAction("vi-insert-ESC",
function(){a.removeKeyMode(b);a.addKeyMode(b.viMode);return!0})},match:function(a){var b=r.KeyMode.prototype.match.call(this,a);b||(b=this.getView().getKeyModes()[0].match(a));return b},storeNumber:function(a){}});t.prototype=new k;e(t.prototype,{createKeyBindings:function(){var a=k.prototype.createKeyBindings.call(this);a.push({actionID:"vi-ctrl-f",keyBinding:c("f",!0)});a.push({actionID:"vi-ctrl-b",keyBinding:c("b",!0)});a.push({actionID:"vi-ctrl-e",keyBinding:c("e",!0)});a.push({actionID:"vi-ctrl-y",
keyBinding:c("y",!0)});a.push({actionID:"statusLineMode",keyBinding:c(":",!1,!1,!1,!1,"keypress")});a.push({actionID:"vi-a",keyBinding:c("a",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-A",keyBinding:c("A",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-i",keyBinding:c("i",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-I",keyBinding:c("I",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-o",keyBinding:c("o",!1,!1,!1,!1,"keypress"),predefined:!0});
a.push({actionID:"vi-O",keyBinding:c("O",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-R",keyBinding:c("R",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-s",keyBinding:c("s",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-S",keyBinding:c("S",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-p",keyBinding:c("p",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-P",keyBinding:c("P",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-u",
keyBinding:c("u",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-c",keyBinding:c("c",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-d",keyBinding:c("d",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-y",keyBinding:c("y",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-~",keyBinding:c("~",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-x",keyBinding:c("x",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-X",keyBinding:c("X",
!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-C",keyBinding:c("C",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-D",keyBinding:c("D",!1,!1,!1,!1,"keypress"),predefined:!0});a.push({actionID:"vi-*",keyBinding:c("*",!1,!1,!1,!1,"keypress"),predefined:!0});return a},getKeyBindings:function(a){var g=r.KeyMode.prototype.getKeyBindings.call(this,a),g=g||[],f=this.changeMode.getKeyBindings(a),e;if(!this.changeMode.isActive())for(e=0;e<f.length;e++)f[e]=b([c("c",!1,!1,!1,!1,"keypress"),
f[e]]);g=g.concat(f);f=this.deleteMode.getKeyBindings(a);if(!this.deleteMode.isActive())for(e=0;e<f.length;e++)f[e]=b([c("d",!1,!1,!1,!1,"keypress"),f[e]]);g=g.concat(f);f=this.yankMode.getKeyBindings(a);if(!this.yankMode.isActive())for(e=0;e<f.length;e++)f[e]=b([c("y",!1,!1,!1,!1,"keypress"),f[e]]);return g=g.concat(f)},match:function(a){var b=r.KeyMode.prototype.match.call(this,a);!b&&"keypress"===a.type&&(b="noop");return b},_createActions:function(a){k.prototype._createActions.call(this,a);var b=
this;a.setAction("vi-ctrl-f",function(){return b._invoke("pageDown")},{name:l.pageDown});a.setAction("vi-ctrl-b",function(){return b._invoke("pageUp")},{name:l.pageUp});a.setAction("vi-ctrl-e",function(){return b._invoke("scrollLineDown")},{name:l.scrollLineDown});a.setAction("vi-ctrl-y",function(){return b._invoke("scrollLineUp")},{name:l.scrollLineUp});a.setAction("vi-a",function(){return b._toInsertMode("charNext")},{name:l.via});a.setAction("vi-A",function(){return b._toInsertMode("lineEnd")},
{name:l.viA});a.setAction("vi-i",function(){return b._toInsertMode("noop")},{name:l.vii});a.setAction("vi-I",function(){return b._toInsertMode("lineStart")},{name:l.viI});a.setAction("vi-O",function(){b._invoke("lineUp");b._invoke("lineEnd");b._toInsertMode("enter");return!0},{name:l.viO});a.setAction("vi-o",function(){b._invoke("lineEnd");b._toInsertMode("enter");return!0},{name:l.vio});a.setAction("vi-R",function(){return b._toInsertMode("toggleOverwriteMode")},{name:l.viR});a.setAction("vi-s",
function(){return b._toInsertMode("deleteNext",{unit:"char"})},{name:l.vis});a.setAction("vi-S",function(){return b._toInsertMode("deleteLines",{unit:"line"})},{name:l.viS});a.setAction("vi-p",function(){return b._invoke(function(){var a=b.getView(),d=a.getSelection();if(d.start===d.end){var c=a.getModel(),g=a.getCaretOffset();n?d.start=d.end=c.getLineEnd(c.getLineAtOffset(g),!0):(d.start++,d.end++)}a.setText(f,d.start,d.end)})},{name:l.vip});a.setAction("vi-P",function(){return b._invoke(function(){var a=
b.getView(),d=a.getSelection();if(d.start===d.end){var c=a.getModel(),g=a.getCaretOffset();n&&(d.start=d.end=c.getLineStart(c.getLineAtOffset(g)))}a.setText(f,d.start,d.end)})},{name:l.viP});a.setAction("vi-u",function(){return b._invoke("undo")},{name:l.Undo});a.setAction("vi-c",function(){a.removeKeyMode(b);a.addKeyMode(b.changeMode);b.changeMode.storeNumber(b.number);b.number="";return!0});a.setAction("vi-d",function(){a.removeKeyMode(b);a.addKeyMode(b.deleteMode);b.deleteMode.storeNumber(b.number);
b.number="";return!0});a.setAction("vi-y",function(){a.removeKeyMode(b);a.addKeyMode(b.yankMode);b.yankMode.storeNumber(b.number);b.number="";return!0});a.setAction("vi-~",function(){return b._invoke("reversecase")},{name:l.reversecase});a.setAction("vi-x",function(){return b._invoke("deleteNext")},{name:l.deleteNext});a.setAction("vi-X",function(){return b._invoke("deletePrevious")},{name:l.deletePrevious});a.setAction("vi-C",function(){return b._toInsertMode("deleteLineEnd")},{name:l.viC});a.setAction("vi-D",
function(){return b._invoke("deleteLineEnd")},{name:l.deleteLineEnd});a.setAction("vi-*",function(){var a=b.getView(),d=a.getCaretOffset(),d=a.getNextOffset(d+1,{count:-1,unit:"word"}),c=a.getNextOffset(d,{count:1,unit:"wordend"}),a=a.getText(d,c);b._searchFwd=!0;return b._invoke("find",{hideAfterFind:!0,incremental:!1,reverse:!1,findString:a})},{name:l.viStar})},_reportStatus:function(a){this.statusReporter&&this.statusReporter(a)},_toInsertMode:function(a,b){b=b||{};var c=1;""!==this.number&&(c=
this.number>>0);b.count=c;c=this.getView();this.insertMode.storeNumber(this.number);c.invokeAction(a,!1,b);c.removeKeyMode(this);c.addKeyMode(this.insertMode);this.number="";return!0},_modeAdded:function(){this.getView().setOptions({blockCursorVisible:!0})},_modeRemoved:function(){var a=this.getView();a.setOptions({blockCursorVisible:!1});a.removeKeyMode(this.insertMode);a.removeKeyMode(this.changeMode);a.removeKeyMode(this.deleteMode)}});return{VIMode:t}});y("orion/editorPreferences",[],function(){return{}});
y("orion/widgets/themes/ThemePreferences",[],function(){return{}});y("orion/widgets/themes/editor/ThemeData",[],function(){return{}});y("orion/widgets/settings/EditorSettings",[],function(){return null});y("orion/searchAndReplace/textSearcher",[],function(){return{TextSearcher:null}});y("orion/webui/dialogs/OpenResourceDialog",[],function(){return{OpenResourceDialog:{}}});y("orion/widgets/input/DropDownMenu",["orion/objects","orion/webui/littlelib"],function(l,r){function p(h,e,c){if(h=r.node(h))this._parent=
h;else throw Error("Parent node of dropdown menu not found");this.options=c=c||{};this.navDropDownId=this._parent.id+"_navdropdown";this.selectionClass=c.selectionClass;h=document.createElement("div");h.classList.add("dropdownMenu");h.classList.add("dropdownMenuOpen");h.id=this.navDropDownId;h.style.display="none";this._parent.appendChild(h);this._dropdownMenu=h;if(e=r.node(e))this._triggerNode=e;else throw"Trigger node of dropdown menu not found";"hidden"===this._triggerNode.style.visibility&&(this._triggerNode.style.visibility=
"visible");c.noClick||(this._triggerNode.onclick=this.click.bind(this));this._dropdownMenu.addEventListener("keydown",function(b){b.keyCode===r.KEY.ESCAPE&&this.clearPanel()}.bind(this))}l.mixin(p.prototype,{click:function(){"none"===this._dropdownMenu.style.display?this.updateContent(this.getContentNode(),function(){r.setFramesEnabled(!1);this._dropdownMenu.style.display="";this._positionDropdown();this.selectionClass&&this._triggerNode.classList.add(this.selectionClass);this.handle=r.addAutoDismiss([this._triggerNode,
this._dropdownMenu],this.clearPanel.bind(this));if(this.options.onShow)this.options.onShow()}.bind(this)):this.clearPanel()},clearPanel:function(){if(this.isVisible()&&(this._dropdownMenu.style.display="none",r.setFramesEnabled(!0),this.selectionClass&&this._triggerNode.classList.remove(this.selectionClass),this.options.onHide))this.options.onHide()},addContent:function(h){this._dropdownMenu.innerHTML=h},getContentNode:function(){return this._dropdownMenu},updateContent:function(h,e){e()},_positionDropdown:function(){this._dropdownMenu.style.right=
"";var h=r.bounds(this._dropdownMenu),e=r.bounds(document.body);h.left+h.width>e.left+e.width&&(h=r.bounds(this._boundingNode(this._triggerNode)),e=r.bounds(this._triggerNode),this._dropdownMenu.style.right=h.width-(e.left-h.left+e.width)+"px")},_boundingNode:function(h){var e=window.getComputedStyle(h,null);return null===e||"absolute"===e.getPropertyValue("position")||!h.parentNode||h===document.body?h:this._boundingNode(h.parentNode)},isDestroyed:function(){return!this._dropdownMenu.parentNode},
isVisible:function(){return"none"!==this._dropdownMenu.style.display&&!this.isDestroyed()},focus:function(){this._dropdownMenu.focus()},destroy:function(){this._parent&&(r.setFramesEnabled(!0),r.empty(this._parent),this._parent=this.select=null)}});return p});y("orion/URITemplate",[],function(){function l(a){this._text=a}function r(a){return a.replace("%25","%")}function p(a,b){if("U"===b)return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()});
if("U+R"===b)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(g,r);if("U+R-,"===b)return encodeURI(a).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw Error("Unknown allowed character set: "+b);}function h(a,b,c){for(var g=[],d=0;d<a.length;d++)"undefined"!==typeof a[d]&&g.push(p(a[d],b));return g.join(c)}function e(a,b,c,g){for(var d=Object.keys(a),e=[],k=0;k<d.length;k++)"undefined"!==typeof a[d[k]]&&e.push(p(d[k],b)+c+p(a[d[k]],b));return e.join(g)}function c(a){if(0===
a.length)throw Error("Invalid Expression: 0 length expression");(this._operator=k[a[0]])?a=a.substring(1):this._operator=k.NUL;for(var b=[],c=a.split(","),g=0;g<c.length;g++){var d=c[g].match(m);if(null===d)throw Error("Bad VarSpec: "+a);b.push({name:d[1],explode:!!d[2],prefix:d[3]?parseInt(d[3],10):-1})}this._varSpecList=b}function b(a){for(var b=[],g=0,e=a.indexOf("{",g);-1!==e;){b.push(new l(a.substring(g,e)));g=a.indexOf("}",e+1);if(-1===g)throw Error("Invalid template: "+a);b.push(new c(a.substring(e+
1,g)));g+=1;e=a.indexOf("{",g)}b.push(new l(a.substring(g)));this._templateComponents=b}var k={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"\x26",named:!0,ifemp:"\x3d",allow:"U"},"\x26":{first:"\x26",sep:"\x26",named:!0,ifemp:"\x3d",allow:"U"},"#":{first:"#",sep:",",
named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},m=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,g=/%25[0-9A-F][0-9A-F]/g;l.prototype={expand:function(a){return encodeURI(this._text)}};c.prototype={expand:function(a){for(var b=[],c=0;c<this._varSpecList.length;c++){var g=this._varSpecList[c],d=g.name,k=a[d],m=typeof k;if("undefined"!==m&&null!==k){var l=0===b.length?this._operator.first:this._operator.sep;
if("string"===m)this._operator.named&&(l+=p(d,"U+R"),l+=0===k.length?this._operator.ifemp:"\x3d"),-1!==g.prefix&&g.prefix<k.length&&(k=k.substring(0,g.prefix)),l+=p(k,this._operator.allow);else if(Array.isArray(k)){if(0===k.length)continue;g.explode?l+=h(k,this._operator.allow,this._operator.sep):(g=h(k,this._operator.allow,","),this._operator.named&&(l+=p(d,"U+R"),l+=0===g.length?this._operator.ifemp:"\x3d"),l+=g)}else if("object"===m){if(0===Object.keys(k).length)continue;g.explode?l+=e(k,this._operator.allow,
"\x3d",this._operator.sep):(g=e(k,this._operator.allow,",",","),this._operator.named&&(l+=p(d,"U+R"),l+=0===g.length?this._operator.ifemp:"\x3d"),l+=g)}else throw Error("bad param type: "+d+" : "+m);b.push(l)}}return b.join("")}};b.prototype={expand:function(a){for(var b=[],c=0;c<this._templateComponents.length;c++)b.push(this._templateComponents[c].expand(a));return b.join("")}};return b});y("orion/PageLinks","require orion/Deferred orion/PageUtil orion/URITemplate orion/i18nUtil orion/objects orion/URL-shim".split(" "),
function(l,r,p,h,e,c){function b(){if(l.toUrl){var a=new URL(l.toUrl("orion/"),self.location.href);return(new URL("../",a)).href.slice(0,-1)}return(new URL("/",self.location.href)).href.slice(0,-1)}function k(a){var b={};a.getPropertyKeys().forEach(function(c){"objectClass"!==c&&("service.names"!==c&&"service.id"!==c&&"__plugin__"!==c)&&(b[c]=a.getProperty(c))});return b}function m(a,d){var c=a.getServiceReferences(d||"orion.page.link"),g=p.matchResourceParameters(window.location.href),f={OrionHome:b(),
Location:g.resource},e=[];c.forEach(function(a){a=k(a);if(a.uriTemplate&&(a.nls||a.name)){var b=(new h(a.uriTemplate)).expand(f),b=p.validateURLScheme(b);a.href=b;a.textContent=a.name||a.nameKey;e.push((new r).resolve(a))}});return r.all(e)}function g(a){var b=this.categories=Object.create(null);a.forEach(function(a){b[a.id]=a})}function a(a){this.allPageLinks=a;this.allPageLinks.sort(t)}function t(a,b){var c=a.textContent&&a.textContent.toLowerCase(),g=b.textContent&&b.textContent.toLowerCase();
return c<g?-1:c>g?1:0}var f;c.mixin(g.prototype,{getCategoryIDs:function(){return Object.keys(this.categories)},getCategory:function(a){return this.categories[a]||null}});c.mixin(a.prototype,{createLinkElements:function(){return this.allPageLinks.map(function(a){var b=a.href;a=a.textContent;var c=document.createElement("a");c.href=b;c.target="_self";c.classList.add("targetSelector");c.textContent=a;return c})},getAllLinks:function(){return this.allPageLinks}});return{getCategoriesInfo:function(a){var b;
return!f?(b=[],a.getServiceReferences("orion.page.link.category").forEach(function(c){var g=k(c);if(g.id&&(g.name||g.nameKey))g.service=a.getService(c),g.textContent=g.name,b.push((new r).resolve(g))}),r.all(b).then(function(a){return f=new g(a)})):(new r).resolve(f)},getPageLinksInfo:function(b,d){return m(b,d).then(function(b){return new a(b)})},getOrionHome:b}});y("orion/extensionCommands","orion/Deferred orion/commands orion/contentTypes orion/URITemplate orion/i18nUtil orion/PageLinks i18n!orion/edit/nls/messages orion/URL-shim".split(" "),
function(l,r,p,h,e,c,b){function k(a){var b={};a.getPropertyKeys().forEach(function(d){b[d]=a.getProperty(d)});return b}var m={},g=c.getOrionHome();m._cloneItemWithoutChildren=function n(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),c;for(c in a)"children"!==c&&"Children"!==c&&(b[c]=n(a[c]));return b};m._getOpenWithNavCommandExtensions=function(a,b){function c(a,b){for(var d=a.getServiceReferences("orion.navigate.openWith"),g=[],e=[],k=0;k<d.length;k++){var h=d[k];if(h.getProperty("editor")===
b.id){var n=h.getProperty("contentType");n instanceof Array?g=g.concat(n):g.push(n||"*/*");h=h.getProperty("excludedContentTypes");h instanceof Array?e=e.concat(h):null!==h&&"undefined"!==typeof h&&e.push(h)}}0===g.length&&(g=null);0===e.length&&(e=null);return{contentTypes:g,excludedContentTypes:e}}for(var g=function(){for(var b=a.getServiceReferences("orion.edit.editor"),d=[],c=0;c<b.length;c++){var g=b[c],e=g.getProperty("id");d.push({id:e,"default":g.getProperty("default")||!1,name:g.getProperty("name"),
nameKey:g.getProperty("nameKey"),nls:g.getProperty("nls"),uriTemplate:g.getProperty("orionTemplate")||g.getProperty("uriTemplate"),validationProperties:g.getProperty("validationProperties")||[]})}return d}(),e=[],k,h=0;h<g.length;h++){var m=g[h],l=c(a,m),l={properties:{name:m.name||m.id,nameKey:m.nameKey,id:"eclipse.openWithCommand."+m.id,contentType:l.contentTypes,excludedContentTypes:l.excludedContentTypes,uriTemplate:m.uriTemplate,nls:m.nls,forceSingleItem:!0,isEditor:m["default"]?"default":"editor",
validationProperties:m.validationProperties},service:{}};"orion.editor"===m.id?k=l:e.push(l)}k&&e.push(k);return e};m._makeValidator=function(a,b,c,e){function k(a,b,d,c,g){var e=!1,h;if("!"===b.charAt(0))return"undefined"===typeof a[b.substring(1)];if("undefined"!==typeof a[b]){if("undefined"===typeof d)h=a[b],e=!0;else if("string"===typeof d){if(!typeof("string"===a[b]))return!1;if(c.variableName){if(d=RegExp(d).exec(a[b]))e=d[0],h="before"===c.variableMatchPosition?a[b].substring(0,d.index):"after"===
c.variableMatchPosition?a[b].substring(d.index+e.length):"only"===c.variableMatchPosition?e:a[b],e=!0}else return RegExp(d).test(a[b])}else a[b]===d&&(h=a[b],e=!0);b=c.variableName;c=c.replacements;if(e&&b&&(g[b]=h,g.itemCached=a,c)){if("string"!==typeof h)return window.console.log("Cannot replace "+b+", value is not a string: "+h),e;for(a=0;a<c.length;a++){h=!1;if(c[a].pattern){d=c[a].pattern;var n=c[a].replacement||"";g[b]=g[b].replace(RegExp(d),n).replace(RegExp(d),n)}else h=!0;h&&window.console.log("Invalid replacements specified in validation property.  "+
c[a])}}return e}return!1}function m(a,b,d,c){var g=d.match,e,h;if(0<=(e=b.indexOf("["))){if(0>(h=b.indexOf("]")))return!1;var n=b.substring(0,e),l;if(!(l=a[n])||!Array.isArray(l))return!1;e=b.substring(e+1,h);e=parseInt(e,10);if(isNaN(e))return!1;0>e&&(e+=l.length);b=b.substring(h+1);b=n+":"+String(e)+b}return 0<=b.indexOf("|")?(e=b.substring(0,b.indexOf("|")),b=b.substring(b.indexOf("|")+1),m(a,e,d,c)?!0:m(a,b,d,c)):0<=b.indexOf(":")?(e=b.substring(0,b.indexOf(":")),b=b.substring(b.indexOf(":")+
1),a[e]?m(a[e],b,d,c):!1):k(a,b,g,d,c)}function l(b,d,c){if(c.info.validationProperties)for(var g=0;g<c.info.validationProperties.length;g++){var e=c.info.validationProperties[g];if("undefined"!==typeof e.source){if(!m(b,e.source,e,c))return!1}else return window.console.log("Invalid validationProperties in "+a.id+".  No source property specified."),!1}if(!c.info.contentType&&!c.info.excludedContentTypes)return!0;if(b.Directory)return c.info.contentType&&0<=c.info.contentType.indexOf("*/*")?!0:!1;
var g=!0,k=d?p.getFilenameContentType(b.Name,d):null,k=k||{id:"application/octet-stream"};c.info.excludedContentTypes&&d&&(g=c.info.excludedContentTypes.every(function(a){a=a.replace(/([*?])/g,".$1");return-1!==k.id.search(a)?!1:!0}));g&&(c.info.contentType&&d)&&(g=c.info.contentType.some(function(a){a=a.replace(/([*?])/g,".$1");return-1!==k.id.search(a)?!0:!1}));return g}return{info:a,validationFunction:function(a){"function"===typeof e&&(a=e.call(this,a));if(a){if(Array.isArray(a)){if((this.info.forceSingleItem||
this.info.uriTemplate)&&1!==a.length||1>a.length)return!1}else a=[a];for(var b=0;b<a.length;b++)if(!l(a[b],c,this))return!1;return!0}return!1},generatesURI:function(){return!!this.info.uriTemplate},getURI:function(a){if(this.info.uriTemplate){var b={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(b[d]=a[d]);if(this.info.validationProperties)for(d=0;d<this.info.validationProperties.length;d++){var c=this.info.validationProperties[d];c.source&&c.variableName&&(this.itemCached===a&&this[c.variableName]||
m(a,c.source,c,this),a[c.variableName]?window.console.log("Variable name "+c.variableName+" in the extension "+this.info.id+" conflicts with an existing property in the item metadata."):b[c.variableName]=this[c.variableName])}b.OrionHome=g;return(new h(this.info.uriTemplate)).expand(b)}return null}}};var a=b.UnnamedCommand;m._createCommandOptions=function(b,d,c,g,e,k){var h=new l;(function(a,h){var l=m._makeValidator(b,c,g,k);a.visibleWhen=l.validationFunction.bind(l);e&&(l.generatesURI.bind(l)()?
a.hrefCallback=function(a){a=Array.isArray(a.items)?a.items[0]:a.items;return l.getURI.bind(l)(a)}:a.callback=function(g){var e;if(b.forceSingleItem)g=Array.isArray(g.items)?g.items[0]:g.items,e=m._cloneItemWithoutChildren(g);else if(Array.isArray(g.items)){e=[];for(var k=0;k<g.items.length;k++)e.push(m._cloneItemWithoutChildren(g.items[k]))}else e=m._cloneItemWithoutChildren(g.items);if(c)var h=c.getService("orion.page.progress");d.run?h?h.progress(d.run(e),"Running command: "+a.name):d.run(e):c&&
(h?h.progress(c.getService(d).run(e),"Running command: "+a.name):c.getService(d).run(e))});h.resolve(a)})({name:b.name||b.nameKey||a,image:b.image,id:b.id||b.name,tooltip:b.tooltip||b.tooltipKey||"",isEditor:b.isEditor,showGlobally:b.showGlobally},h);return h};m.getOpenWithCommand=function(a,b,c){var g;a=c||m.getOpenWithCommands(a);for(c=0;c<a.length;c++)if(a[c].visibleWhen(b)){var e="default"===a[c].isEditor;if(!g||e)if(g=a[c],e)break}return g};m.getOpenWithCommands=function(a){var b=[],c;for(c in a._commandList){var g=
a._commandList[c];g.isEditor&&b.push(g)}return b};var t;m.createAndPlaceFileCommandsExtension=function(a,d,c,g,e,k){return m.createFileCommands(a,null,k?"all":void 0,!!k,d).then(function(a){e&&0<a.length&&(d.addCommandGroup(c,"eclipse.openWith",1E3,b.OpenWith,e,null,null,null,"dropdownSelection"),d.addCommandGroup(c,"eclipse.fileCommandExtensions",1E3,b.OpenRelated,e));a.forEach(function(a){var b=null;e&&(b=a.isEditor?e+"/eclipse.openWith":e+"/eclipse.fileCommandExtensions");d.registerCommandContribution(c,
a.id,g,b)});return{}})};m.createFileCommands=function(a,b,c,g,e){c=void 0===c?"global":c;g=void 0===g?!0:g;var k=[];m._cachedFileCommands||m._createCachedFileCommands(a);("all"===c||"global"===c)&&m._cachedFileCommands.forEach(function(a){var b=a.properties;("all"===c||b.forceSingleItem&&b.showGlobally)&&k.push(a)});return l.when(function(){var c=a.getService("orion.core.contentTypeRegistry")||b;return t||l.when(c.getContentTypes(),function(a){return t=a})}(),function(){g&&(m._cachedOpenWithExtensions||
(m._cachedOpenWithExtensions=m._getOpenWithNavCommandExtensions(a,t)),k=k.concat(m._cachedOpenWithExtensions),e._addedOpenWithCommands=g);var b=k.map(function(b){var d=b.properties;b=b.service;var c=e.findCommand(d.id||d.name);return c?(new l).resolve(c):m._createCommandOptions(d,b,a,t,!0).then(function(a){a=new r.Command(a);e.addCommand(a);return a})});return l.all(b,function(a){return{_error:a}}).then(function(a){return a})})};m._createCachedFileCommands=function(a){var b=a.getServiceReferences("orion.navigate.command");
m._cachedFileCommands=[];for(var c=0;c<b.length;c++)if("orion.navigateFromMetadata"!==b[c].getProperty("id")){var g=a.getService(b[c]),e=k(b[c]);m._cachedFileCommands.push({properties:e,service:g})}};m.getFileCommandIds=function(){var a=[];if(m._cachedFileCommands)m._cachedFileCommands.length&&(a=m._cachedFileCommands.map(function(a){return a.properties.id}));else throw"extensionCommandUtils._cachedFileCommands is not initialized";return a};m.createOpenWithCommands=function(a,b,c){return c&&c._addedOpenWithCommands?
(new l).resolve(m.getOpenWithCommands(c)):m.createFileCommands(a,b,"none",!0,c)};return m});y("orion/searchUtils",["i18n!orion/nls/messages","require","orion/regex","orion/URITemplate"],function(l,r,p,h){function e(b,c,e){var g="";e&&(g="^");if(g=p.parse("/"+g+b.searchStr+"/"))e=g.pattern,g=g.flags,-1===g.indexOf("i")&&!c.caseSensitive&&(g+="i"),b.regExp={pattern:e,flags:g},b.wildCard=!0}var c={ALL_FILE_TYPE:"*.*",getSearchParams:function(b,e,h){if(b){var g=!0;"*"===e&&(e="");""===e&&(g=h&&h.type!==
c.ALL_FILE_TYPE);if(g)return b.createSearchParams(e,!1,!1,h)}else window.alert(l.NoSearchAvailableErr);return null},generateSearchHelper:function(b,k){var h=b.keyword,g=h,a={};b.fileType&&(b.fileType!==c.ALL_FILE_TYPE&&""===h)&&(g="*."+b.fileType);if(b.regEx)a.searchStr=h,e(a,b,k);else{var l=-1<h.indexOf("*"),f=-1<h.indexOf("?");l&&(h=h.split("*").join(".*"));f&&(h=h.split("?").join("."));!l&&!f&&!b.nameSearch?(a.searchStr=b.caseSensitive?h.split("\\").join(""):h.split("\\").join("").toLowerCase(),
a.wildCard=!1):(a.searchStr=b.caseSensitive?h:h.toLowerCase(),e(a,b,k),a.wildCard=!0)}a.searchStrLength=a.searchStr.length;return{params:b,inFileQuery:a,displayedSearchTerm:g}},convertSearchParams:function(b){void 0!==b.rows&&(b.rows=parseInt(b.rows,10));void 0!==b.start&&(b.start=parseInt(b.start,10));"string"===typeof b.regEx&&(b.regEx="true"===b.regEx.toLowerCase());"string"===typeof b.caseSensitive&&(b.caseSensitive="true"===b.caseSensitive.toLowerCase());"string"===typeof b.nameSearch&&(b.nameSearch=
"true"===b.nameSearch.toLowerCase());void 0!==b.fileNamePatterns&&(b.fileNamePatterns=c.getFileNamePatternsArray(b.fileNamePatterns))},getFileNamePatternsArray:function(b){var c=void 0;b&&(b=b.trim(),b=b.replace(/^(\s*,\s*)+/g,""),b=b.replace(/([^\\]),(\s*,\s*)*/g,"$1/"),b=b.replace(/(\s*\/\s*)/g,"/"),b=b.replace(/\/\/+/g,"/"),b=b.replace(/\/+$/g,""),c=b.split("/"));return c},copySearchParams:function(b,c){var e={},g;for(g in b)if(void 0!==b[g]&&null!==b[g]&&(c||"replace"!==g))e[g]=b[g];return e},
generateFindURLBinding:function(b,c,e,g,a){b={find:c.searchStr,regEx:c.wildCard?!0:void 0,caseSensitive:b.caseSensitive?!0:void 0,replaceWith:"string"===typeof g?g:void 0,atLine:"number"===typeof e?e:void 0};return a?b:","+(new h("{,params*}")).expand({params:b})},convertFindURLBinding:function(b){"string"===typeof b.regEx&&(b.regEx="true"===b.regEx.toLowerCase());"string"===typeof b.caseSensitive&&(b.caseSensitive="true"===b.caseSensitive.toLowerCase());"string"===typeof b.atLine&&(b.atLine=parseInt(b.atLine,
10))},replaceRegEx:function(b,c,e){return b.replace(RegExp(c.pattern,c.flags),e)},replaceStringLiteral:function(b,e,h){e=p.parse("/"+e+"/gim");return c.replaceRegEx(b,e,h)},searchOnelineLiteral:function(b,c,e){var g;g=0;for(var a=!1,h=[];!(g=c.indexOf(b.searchStr,g),0>g);){h.push({startIndex:g,length:b.searchStrLength});a=!0;if(e)break;g+=b.searchStrLength}return a?h:null},findRegExp:function(b,c,e,g){if(!c)return null;e=e||"";e+=(-1===e.indexOf("g")?"g":"")+(-1===e.indexOf("m")?"m":"");var a=null;
return(a=RegExp(c,e).exec(b.substring(g)))&&{startIndex:a.index+g,length:a[0].length}},searchOnelineRegEx:function(b,e,h){for(var g=0,a=!1,l=[];;)if(g=c.findRegExp(e,b.regExp.pattern,b.regExp.flags,g)){l.push(g);a=!0;if(h)break;g=g.startIndex+g.length}else break;return a?l:null},generateNewContents:function(b,e,h,g,a,l){if(g&&e){b||(h.contents=[]);for(var f=0;f<e.length;f++){for(var n=e[f],d=!1,u=!1,s=[],p,r=0,F=0;F<g.children.length;F++)if(g.children[F].lineNumber-1===f){r=F;for(d=0;d<g.children[F].matches.length;d++)!1!==
g.children[F+d].checked&&s.push(d);u=0<s.length;p=g.children[F].matches;d=!0;break}if(d){if(u){s=c.replaceCheckedMatches(n,a,p,s,l);n=s.replacedStr;for(d=0;d<g.children[r].matches.length;d++)g.children[r+d].newMatches=s.newMatches}else for(d=0;d<g.children[r].matches.length;d++)g.children[r+d].newMatches=g.children[r+d].matches;b?h.contents[f]=n:h.contents.push(n)}else b||h.contents.push(n)}}},generateMatchContext:function(b,c,e){var g=[],a=2*b+1,h;c.length<=a?(h=0,b=c.length-1):(h=e-b,0>h?(h=0,b=
h+a-1):(b=e+b,b>c.length-1&&(b=c.length-1,h=b-a+1)));for(a=h;a<=b;a++)g.push({context:c[a],current:a===e});return g},splitFile:function(b){for(var c=0,e=0,g=0,a=0,h=[];;){-1!==c&&c<=g&&(c=b.indexOf("\r",g));-1!==e&&e<=g&&(e=b.indexOf("\n",g));if(-1===e&&-1===c){h.push(b.substring(a));break}var f=1;-1!==c&&-1!==e?c+1===e?(f=2,g=e+1):g=(c<e?c:e)+1:g=-1!==c?c+1:e+1;h.push(b.substring(a,g-f));a=g}return h},searchWithinFile:function(b,e,h,g,a,l){h=c.splitFile(h);a&&(e.contents=h);if(e){e.children=[];for(var f=
g=0;f<h.length;f++){var n=h[f];if(n&&0<n.length){var d=l?n:n.toLowerCase();if(d=b.wildCard?c.searchOnelineRegEx(b,d):c.searchOnelineLiteral(b,d)){var u,s=f+1;if(a)for(var p=0;p<d.length;p++)u=p+1,u={parent:e,checked:e.checked,type:"detail",matches:d,lineNumber:s,matchNumber:u,name:n,location:e.location+"-"+s+"-"+u},e.children.push(u);else u={parent:e,context:c.generateMatchContext(2,h,f),checked:e.checked,type:"detail",matches:d,lineNumber:s,name:n,location:e.location+"-"+s},e.children.push(u);g+=
d.length}}}e.totalMatches=g}},replaceCheckedMatches:function(b,c,e,g,a){for(var h=0,f="",n=[],d=0;d<e.length;d++){h!==e[d].startIndex&&(f+=b.substring(h,e[d].startIndex));e[d].length&&(a=e[d].length);for(var h=!1,l=0;l<g.length;l++)if(g[l]===d){h=!0;break}h?(n.push({startIndex:f.length,length:c.length}),f+=c):(n.push({startIndex:f.length,length:a}),f+=b.substring(e[d].startIndex,e[d].startIndex+a));h=e[d].startIndex+a}h<b.length&&(f+=b.substring(h));return{replacedStr:f,newMatches:n}},fullPathNameByMeta:function(b){var c=
b.length,e="";if(0<c)for(c-=1;-1<c;c--)e=e+(""===e?"":"/")+b[c].Name;return e}};return c});y("orion/editorCommands","i18n!orion/edit/nls/messages orion/i18nUtil orion/webui/littlelib orion/webui/dialogs/OpenResourceDialog orion/widgets/input/DropDownMenu orion/Deferred orion/URITemplate orion/commands orion/keyBinding orion/commandRegistry orion/extensionCommands orion/contentTypes orion/searchUtils orion/objects orion/PageUtil orion/PageLinks orion/editor/annotations orion/regex orion/uiUtils orion/util".split(" "),
function(l,r,p,h,e,c,b,k,m,g,a,t,f,n,d,u,s,v,A,F){function z(a){var d=new b(a.uriTemplate),c=a.params||{};c.OrionHome=c.OrionHome||u.getOrionHome();var d=d.expand(c),g=document.createElement("div"),f=document.createElement("iframe");f.id=a.id;f.name=a.id;f.type="text/html";f.sandbox="allow-scripts allow-same-origin allow-forms allow-popups";f.frameborder=void 0!==a.border?a.border:1;f.src=d;f.className="delegatedUI";a.width&&(g.style.width=a.width,f.style.width=a.width);a.height&&(g.style.height=
a.height,f.style.height=a.height);f.style.visibility="hidden";null!==a.parent&&(a.parent||window.document.body).appendChild(g);g.appendChild(f);f.style.left=a.left||(window.innerWidth-parseInt(f.clientWidth,10))/2+"px";f.style.top=a.top||(window.innerHeight-parseInt(f.clientHeight,10))/2+"px";f.style.visibility="";window.addEventListener("message",function G(b){if(b.source===f.contentWindow&&"string"===typeof b.data&&(b=JSON.parse(b.data),"orion.page.delegatedUI"===b.pageService&&b.source===a.id)){if(b.cancelled)a.cancelled&&
a.cancelled();else if(b.result)a.done&&a.done(b.result);else if(b.Status||b.status)a.status&&a.status(b.Status||b.status);window.removeEventListener("message",G,!1);g.parentNode&&g.parentNode.removeChild(g)}},!1);return g}function y(a,b){b&&"undefined"!==typeof b.HTML&&delete b.HTML;var d=a.getService("orion.page.message");if(d)return d.setProgressResult(b).then(null,function(a){console.log(a);throw a;});console.log(b);return(new c).resolve(b)}function B(a){return{_error:a}}function C(a){this.serviceRegistry=
a.serviceRegistry;this.commandService=a.commandRegistry;this.fileClient=a.fileClient;this.inputManager=a.inputManager;this.renderToolbars=a.renderToolbars;this.toolbarId=a.toolbarId;this.saveToolbarId=a.saveToolbarId;this.editToolbarId=a.editToolbarId;this.pageNavId=a.navToolbarId;this.editorContextMenuId=a.editorContextMenuId;this.isReadOnly=a.readonly;this.textSearcher=a.textSearcher;this.searcher=a.searcher;this.localSettings=a.localSettings;this.editorPreferences=a.editorPreferences;this.differ=
a.differ;this.blamer=a.blamer;var b=this;this.listener={onServiceAdded:function(a){b._onServiceAdded(a.serviceReference)},onServiceRemoved:function(a){b._onServiceRemoved(a.serviceReference)}};this.serviceRegistry.addEventListener("registered",this.listener.onServiceAdded);this.serviceRegistry.addEventListener("unregistering",this.listener.onServiceRemoved)}var q={},x=null;q.createDelegatedUI=z;C.prototype={createCommands:function(){this._createSettingsCommand();this._createSearchFilesCommand();this._createGotoLineCommnand();
this._createFindCommnand();this._createBlameCommand();this._createDiffCommand();this._createShowTooltipCommand();this._createUndoStackCommands();this._createSaveCommand();return this._createEditCommands()},getEditCommands:function(){var a=[],b=this.commandService,d;for(d in b._commandList){var c=b._commandList[d];c.editInfo&&a.push(c)}return a},updateCommands:function(a){a=a||{};this.editor=a.editor;this.inputManager=a.inputManager;this.localSettings=a.localSettings;this.differ=a.differ;this.blamer=
a.blamer;this.textSearcher=a.textSearcher;this._recreateEditCommands&&this._createEditCommands().then(function(){this.registerCommands();this.registerContextMenuCommands();this.renderToolbars&&this.renderToolbars()}.bind(this))},registerCommands:function(){function a(b){if(!b)return null;var d=new m.KeyBinding;m.KeyBinding.apply(d,b);return d}var b=this.commandService;b.registerCommandContribution("settingsActions","orion.edit.settings",1,null,!1,new m.KeyBinding("s",!0,!0),null,this);b.registerCommandContribution(this.editToolbarId||
this.toolbarId,"orion.edit.undo",400,this.editToolbarId?"orion.menuBarEditGroup/orion.edit.undoGroup":null,!this.editToolbarId,new m.KeyBinding("z",!0),null,this);b.registerCommandContribution(this.editToolbarId||this.toolbarId,"orion.edit.redo",401,this.editToolbarId?"orion.menuBarEditGroup/orion.edit.undoGroup":null,!this.editToolbarId,F.isMac?new m.KeyBinding("z",!0,!0):new m.KeyBinding("y",!0),null,this);b.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.edit.searchFiles",
1,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new m.KeyBinding("h",!0),null,this);b.registerCommandContribution(this.saveToolbarId||this.toolbarId,"orion.edit.save",1,this.saveToolbarId?"orion.menuBarFileGroup/orion.edit.saveGroup":null,!1,new m.KeyBinding("s",!0),null,this);b.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.edit.gotoLine",3,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new m.KeyBinding("l",
!F.isMac,!1,!1,F.isMac),new g.URLBinding("gotoLine","line"),this);b.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.edit.find",0,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new m.KeyBinding("f",!0),new g.URLBinding("find","find"),this);b.registerCommandContribution(this.toolbarId,"orion.edit.blame",1,"orion.menuBarToolsGroup",!1,new m.KeyBinding("b",!0,!0),new g.URLBinding("blame","blame"),this);b.registerCommandContribution(this.toolbarId,
"orion.edit.diff",2,"orion.menuBarToolsGroup",!1,new m.KeyBinding("d",!0,!0),new g.URLBinding("diff","diff"),this);b.registerCommandContribution(this.toolbarId,"orion.edit.showTooltip",3,"orion.menuBarToolsGroup",!1,new m.KeyBinding(113),null,this);for(var d=this.getEditCommands(),c=0,f=100;c<d.length;c++,f++){var e=d[c],k=e.editInfo;k.scopeId?b.registerCommandContribution(k.scopeId,e.id,f,k.scopeId+"Group",k.bindingOnly,a(k.key),null,this):b.registerCommandContribution(this.toolbarId,e.id,f,"orion.menuBarToolsGroup",
k.bindingOnly,a(k.key),null,this)}},registerContextMenuCommands:function(){var a=this.commandService;a.addCommandGroup(this.editorContextMenuId,"orion.editorContextMenuGroup",100,null,null,null,null,null,"dropdownSelection");var b=1;a.registerCommandContribution(this.editorContextMenuId,"orion.edit.undo",b++,"orion.editorContextMenuGroup/orion.edit.undoGroup",!1);a.registerCommandContribution(this.editorContextMenuId,"orion.edit.redo",b++,"orion.editorContextMenuGroup/orion.edit.undoGroup",!1);a.registerCommandContribution(this.editorContextMenuId,
"orion.edit.find",b++,"orion.editorContextMenuGroup/orion.findGroup",!1);a.registerCommandContribution(this.editorContextMenuId,"orion.edit.searchFiles",b++,"orion.editorContextMenuGroup/orion.findGroup",!1);a.registerCommandContribution(this.editorContextMenuId,"orion.edit.gotoLine",b++,"orion.editorContextMenuGroup/orion.findGroup",!1);a.addCommandGroup(this.editorContextMenuId,"orion.editorContextMenuToolsGroup",400,l.Tools,"orion.editorContextMenuGroup");a.registerCommandContribution(this.editorContextMenuId,
"orion.edit.blame",1,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup",!1);a.registerCommandContribution(this.editorContextMenuId,"orion.edit.diff",2,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup",!1);for(var a=this.getEditCommands(),b=0,d=100;b<a.length;b++,d++)this.commandService.registerCommandContribution(this.editorContextMenuId,a[b].id,d,"orion.editorContextMenuGroup/orion.editorContextMenuToolsGroup")},overwriteKeyBindings:function(a){var b=this;this.editor=
a;if(a.getTextView&&a.getTextView()){var d=a.getTextView();d.setKeyBinding(new m.KeyBinding("s",!0),"save");var c=b.commandService.findCommand("orion.edit.save");d.setAction("save",function(){c.callback.call({inputManager:b.inputManager});return!0},c);d.setAction("gotoLine",function(d){if(d)return a.onGotoLine(d.line-1,0,void 0,d.callback),!0;b.commandService.runCommand("orion.edit.gotoLine");return!0},b.commandService.findCommand("orion.edit.gotoLine"));this.textSearcher&&d.setAction("find",function(a){if(a)return b.textSearcher.show(a),
!0;b.commandService.runCommand("orion.edit.find",null,null,new g.ParametersDescription([new g.CommandParameter("useEditorSelection","text","","true")],{clientCollect:!0}));return!0},b.commandService.findCommand("orion.edit.find"))}},showKeyBindings:function(a){var b=this.editor;if(b&&b.getTextView&&b.getTextView()){var d=b.getTextView(),c=d.getActions(!0).filter(function(a){return(a=d.getActionDescription(a))&&a.name});c.sort(function(a,b){return d.getActionDescription(a).name.localeCompare(d.getActionDescription(b).name)});
a.createHeader(l.Editor);for(var g=function(a){return function(){d.focus();return d.invokeAction(a)}},b={},f,e=0;e<c.length;e++)for(var k=c[e],h=d.getActionDescription(k),n=d.getKeyBindings(k),m=0;m<n.length;m++){f=n[m];var t=A.getUserKeyString(f);f.scopeName?(b[f.scopeName]||(b[f.scopeName]=[]),b[f.scopeName].push({bindingString:t,name:h.name,execute:g(k)})):a.createItem(t,h.name,g(k))}for(var s in b)if(b[s].length){a.createHeader(s);for(c=0;c<b[s].length;c++)f=b[s][c],a.createItem(f.bindingString,
f.name,f.execute)}}},_createSettingsCommand:function(){var a=this,b=new k.Command({imageClass:"core-sprite-wrench",tooltip:l.LocalEditorSettings,id:"orion.edit.settings",visibleWhen:function(b,d){var c=d.handler.editor||a.editor;return c&&c.installed&&d.handler.localSettings},callback:function(d){var c=this.localSettings||a.localSettings,g=b.settingsDropDown;if(!g||g.isDestroyed())g=b.settingsDropDown=new e(d.domNode.parentNode,d.domNode,{noClick:!0,selectionClass:"dropdownSelection",onShow:function(){g.focus()},
onHide:function(){a.editor.focus()}}),g.updateContent=c.show.bind(c),d=g.getContentNode(),d.tabIndex=d.style.marginTop=0;g.click()}});this.commandService.addCommand(b)},_createUndoStackCommands:function(){var a=this,b=new k.Command({name:l.Undo,id:"orion.edit.undo",visibleWhen:function(b,d){var c=d.handler.editor||a.editor;return c&&c.installed},callback:function(){(this.editor||a.editor).getUndoStack().undo()}});this.commandService.addCommand(b);b=new k.Command({name:l.Redo,id:"orion.edit.redo",
visibleWhen:function(b,d){var c=d.handler.editor||a.editor;return c&&c.installed},callback:function(){(this.editor||a.editor).getUndoStack().redo()}});this.commandService.addCommand(b)},_createSearchFilesCommand:function(){var a=this,b=!1,d=new k.Command({name:l.searchFiles,tooltip:l.searchFiles,id:"orion.edit.searchFiles",visibleWhen:function(b,d){var c=d.handler.editor||a.editor,g=d.handler.searcher||a.searcher;return c&&c.installed&&g},callback:function(){var d=this.editor||a.editor;if(!b){var c=
d.getSelection(),c=d.getText(c.start,c.end),g=a.serviceRegistry.getService("orion.page.progress"),f=new h.OpenResourceDialog({searcher:a.searcher,progress:g,searchRenderer:a.searcher.defaultRenderer,nameSearch:!1,title:l.searchFiles,message:l.searchTerm,initialText:c,onHide:function(){b=!1;d.focus()}});window.setTimeout(function(){b=!0;f.show(p.node(a.toolbarId))},0)}}});this.commandService.addCommand(d)},_createSaveCommand:function(){var a=this,b=new k.Command({name:l.Save,tooltip:l.saveFile,imageClass:"core-sprite-save",
id:"orion.edit.save",visibleWhen:function(b,d){var c=d.handler.inputManager||a.inputManager,g=d.handler.editor||a.editor||c&&c.getEditor();return!g||!g.installed||!c||!c.isSaveEnabled()?!1:!0},callback:function(){(this.inputManager||a.inputManager).save()}});this.commandService.addCommand(b)},_createGotoLineCommnand:function(){var a=this,b=new g.ParametersDescription([new g.CommandParameter("line","number",l.gotoLinePrompt)],{hasOptionalParameters:!1},function(b){b=b.handler.editor||a.editor;b=b.getModel().getLineAtOffset(b.getCaretOffset())+
1;return[new g.CommandParameter("line","number",l.gotoLinePrompt,b.toString())]}),b=new k.Command({name:l.gotoLine,tooltip:l.gotoLineTooltip,id:"orion.edit.gotoLine",visibleWhen:function(b,d){var c=d.handler.editor||a.editor;return c&&c.installed},parameters:b,callback:function(b){var d=this.editor||a.editor,c=d.getModel();b.parameters&&b.parameters.valueFor("line")?b=b.parameters.valueFor("line"):(b=c.getLineAtOffset(d.getCaretOffset()),(b=prompt(l.gotoLinePrompt,b+1))&&(b=parseInt(b,10)));if(b)d.onGotoLine(b-
1,0)}});this.commandService.addCommand(b)},_createFindCommnand:function(){var a=this,b=new g.ParametersDescription([new g.CommandParameter("find","text","Find:")],{clientCollect:!0},function(b){var d=b.handler.editor||a.editor;b=b.handler.textSearcher||a.textSearcher;var c=d.getSelection(),f="";c.end>c.start&&(f=d.getModel().getText(c.start,c.end),b&&b.getOptions().regex&&(f=v.escape(f)));return[new g.CommandParameter("find","text","Find:",f)]}),c=new k.Command({name:l.Find,tooltip:l.Find,id:"orion.edit.find",
visibleWhen:function(b,d){var c=d.handler.editor||a.editor,g=d.handler.textSearcher||a.textSearcher;return c&&c.installed&&g},parameters:b,callback:function(b){var g=p.node("replaceCompareDiv");if(g&&g.classList.contains("replaceCompareDivVisible"))return!1;var g=this.editor||a.editor,e=this.textSearcher||a.textSearcher;c.textSearcher&&c.textSearcher!==e&&c.textSearcher.hide();c.textSearcher=e;var k="",h=null,n=g.getSelection();n.end>n.start&&b.parameters.valueFor("useEditorSelection")?(k=g.getModel().getText(n.start,
n.end),e.getOptions().regex&&(k=v.escape(k))):b.parameters&&b.parameters.valueFor("find")&&(k=b.parameters.valueFor("find"),h=d.matchResourceParameters(),f.convertFindURLBinding(h));h?(e.setOptions({regex:h.regEx,caseInsensitive:!h.caseSensitive}),b={},h.atLine&&(b.start=g.getModel().getLineStart(h.atLine-1)),e.show({findString:k,replaceString:h.replaceWith}),e.find(!0,b),a.commandService.closeParameterCollector()):e.show({findString:k})}});this.commandService.addCommand(c)},_createBlameCommand:function(){var a=
this,b=new k.Command({name:l.Blame,tooltip:l.BlameTooltip,id:"orion.edit.blame",parameters:new g.ParametersDescription([new g.CommandParameter("blame","boolean")],{clientCollect:!0}),visibleWhen:function(b,d){var c=d.handler.editor||a.editor,g=d.handler.blamer||a.blamer;return c&&c.installed&&g&&g.isVisible()},callback:function(b){for(var d=!1,c=this.editor||a.editor,g=this.blamer||a.blamer,f=c.getAnnotationModel().getAnnotations();f.hasNext();)if(f.next().type===s.AnnotationType.ANNOTATION_BLAME){d=
!0;break}d=!d;b.parameters&&b.parameters.valueFor("blame")&&(d="true"===b.parameters.valueFor("blame"));d?g.doBlame():c.showBlame([])}});this.commandService.addCommand(b)},_createDiffCommand:function(){var a=this,b=new k.Command({name:l.Diff,tooltip:l.DiffTooltip,id:"orion.edit.diff",visibleWhen:function(b,d){var c=d.handler.editor||a.editor,g=d.handler.differ||a.differ;return c&&c.installed&&g&&g.isVisible()},callback:function(){var b=this.differ||a.differ;b.toggleEnabled();var d=this.editorPreferences;
d.getPrefs(function(a){a.diffService=b.isEnabled();d.setPrefs(a)})}});this.commandService.addCommand(b)},_createShowTooltipCommand:function(){var a=this,b=new k.Command({name:l.showTooltip,tooltip:l.showTooltipTooltip,id:"orion.edit.showTooltip",visibleWhen:function(b,d){var c=d.handler.editor||a.editor;return c&&c.installed},callback:function(){var b=this.editor||a.editor,d=b.getTooltip(),c=b.getTextView(),g=c.getCaretOffset(),c=c.getLocationAtOffset(g);d.show({x:c.x,y:c.y,getTooltipInfo:function(){return b._getTooltipInfo(this.x,
this.y)}},!1,!0)}});this.commandService.addCommand(b)},_onServiceRemoved:function(a){-1!==a.getProperty("objectClass").indexOf("orion.edit.command")&&(this._recreateEditCommands=!0)},_onServiceAdded:function(a){-1!==a.getProperty("objectClass").indexOf("orion.edit.command")&&(this._recreateEditCommands=!0)},_createEditCommands:function(){var b=this;this._recreateEditCommands=!1;var d=this.serviceRegistry,g=this.commandService,f=d.getServiceReferences("orion.edit.command"),e=d.getService("orion.page.progress"),
h=y.bind(null,d),m=function(a,d,c){var g=c.visibleWhen;c.visibleWhen=function(d,c){var f=c.handler.editor||b.editor,e=c.handler.inputManager||b.inputManager;return!f||(!f.installed||!e)||a.editor&&f.id&&a.editor!==f.id||b.inputManager.getReadOnly()?!1:!g||g(d)};c.callback=function(g){var f=this.editor||b.editor,k=this.inputManager||b.inputManager,m=f.getSelection?f.getSelection():{start:0,end:0},t=f.getModel(),s=function(a){"object"===typeof a&&a?(a.text&&f.setText(a.text),a.selection&&(f.setSelection&&
f.setSelection(a.selection.start,a.selection.end,!0),f.focus())):"string"===typeof a&&(f.setText(a,m.start,m.end,!0),f.setSelection&&f.setSelection(m.start,m.start+a.length),f.focus())};d.execute?(t={contentType:k.getContentType(),input:k.getInput(),offset:f.getCaretOffset()},"orion.edit.quickfix"===a.scopeId&&(t.annotation={start:g.userData.start,end:g.userData.end,title:g.userData.title,id:g.userData.id,data:g.userData.data}),g=f.getEditorContext(),g.openDelegatedUI=function(){var a=arguments[0],
a=a||{};a.done=s;a.status=h;a.params=a.params||{};n.mixin(a.params,k.getFileMetadata());z.apply(null,Array.prototype.slice.call(arguments))},g.setStatus=h,g=d.execute(g,t),t=null):(g=d.run(t.getText(m.start,m.end),t.getText(),m,k.getInput()),t=function(b){if(b&&b.uriTemplate){var d={};d.uriTemplate=b.uriTemplate;d.params=k.getFileMetadata();d.id=a.id;d.width=b.width;d.height=b.height;d.done=s;d.status=h;z(d)}else b&&(b.Status||b.status)?h(b.Status||b.status):s(b)});e.showWhile(g,r.formatMessage(l.running,
c.name)).then(t);return!0};return new k.Command(c)};return c.when(function(a){if(x)return x;var b=a.getService("orion.core.contentTypeRegistry");b||(b=new t.ContentTypeRegistry(a),b=a.getService("orion.core.contentTypeRegistry"));return b.getContentTypes().then(function(a){return x=a})}(this.serviceRegistry),function(){var d=[];f.forEach(function(c){for(var f=b.serviceRegistry.getService(c),e={},k=c.getPropertyKeys(),h=0;h<k.length;h++)e[k[h]]=c.getProperty(k[h]);e.forceSingleItem=!0;c=a._createCommandOptions(e,
c,b.serviceRegistry,x,!1,function(a){return b.inputManager.getFileMetadata()}).then(function(a){a=m(e,f,a);a.editInfo=e;g.addCommand(a);return a});d.push(c)});return c.all(d,B)})}};q.EditorCommandFactory=C;q.handleStatusMessage=y;return q});y("orion/globalCommands",[],function(){return{}});y("orion/edit/dispatcher",["orion/edit/dispatcher"],function(){function l(l,p,h,e){this.serviceRegistry=l;this.editor=h;this.inputManager=e;this.ctRegistry=p;this.serviceReferences={};var c=this;this.inputManager.addEventListener("InputChanged",
function(b){c.contentType=b.contentType;c.updateListeners()}.bind(this));this.listener={onServiceAdded:function(b){c._onServiceAdded(b.serviceReference)},onServiceRemoved:function(b){c._onServiceRemoved(b.serviceReference)}};this.serviceRegistry.addEventListener("registered",this.listener.onServiceAdded);this.serviceRegistry.addEventListener("unregistering",this.listener.onServiceRemoved)}l.prototype={updateListeners:function(){this._removeAllListeners();for(var l=this.serviceRegistry.getServiceReferences("orion.edit.model"),
p=0;p<l.length;p++)this._wireServiceReference(l[p])},_wireServiceReference:function(l){var p=l.getProperty("contentType");"undefined"!==typeof p&&null!==p&&this.ctRegistry.isSomeExtensionOf(this.contentType,p)&&this._wireService(l,this.serviceRegistry.getService(l))},_wireService:function(l,p){var h=this.editor.getTextView();if(!h)throw Error("TextView not installed");for(var e=Object.keys(p),c=0;c<e.length;c++){var b=e[c],k=p[b];"on"!==b.substr(0,2)||"function"!==typeof k||(b=b.substr(2),this._wireServiceMethod(l,
p,k,h,b))}},_wireServiceMethod:function(l,p,h,e,c){var b=this;p=function(c){c.file=b.getServiceFileObject();h(c).then()};l=l.getProperty("service.id");this.serviceReferences[l]=this.serviceReferences[l]||[];this.serviceReferences[l].push([e,c,p]);e.addEventListener(c,p)},_onServiceRemoved:function(l){l=l.getProperty("service.id");this._removeListeners(l)},_onServiceAdded:function(l){-1!==l.getProperty("objectClass").indexOf("orion.edit.model")&&this._wireServiceReference(l)},_removeListeners:function(l){var p=
this.serviceReferences[l];if(p){for(var h=0;h<p.length;h++){var e=p[h];e[0].removeEventListener(e[1],e[2])}delete this.serviceReferences[l]}},_removeAllListeners:function(){for(var l=Object.keys(this.serviceReferences),p=0;p<l.length;p++)this._removeListeners(l[p])},getServiceFileObject:function(){var r=this.inputManager.getFileMetadata();return!r?null:l.toServiceFileObject(r,this.inputManager.getContentType())}};l.toServiceFileObject=function(l,p){var h=Object.create(null);h.name=l.Name;h.location=
l.Location;p&&(h.contentType=Object.create(null),h.contentType.id=p.id,h.contentType.name=p.name,h.contentType.imageClass=p.imageClass,h.contentType.extension=p.extension);return h};return{Dispatcher:l}});y("orion/edit/editorContext",[],function(){return{getEditorContext:function(l,r){var p=Object.create(null);l.getServiceReferences(r||"orion.edit.context").forEach(function(h){var e=l.getService(h);Object.keys(e).forEach(function(c){"function"===typeof e[c]&&(p[c]=e[c].bind(e))})});return p},getOptions:function(l,
r){var p=Object.create(null);l.getServiceReferences(r||"orion.edit.context").forEach(function(h){h.getPropertyKeys().forEach(function(e){"service.id"!==e&&("service.names"!==e&&"objectClass"!==e)&&(p[e]=h.getProperty(e))})});return p}}});y("orion/serviceTracker",[],function(){function l(h,e){function c(a){var b=a.getProperty("service.id"),d=this.addingService(a);d&&(k[b]=a,m[b]=d)}function b(a){var b=a.getProperty("service.id"),d=m[b];delete k[b];delete m[b];this.removedService(a,d)}this.serviceRegistry=
h;var k={},m={},g=r,a,l;this.close=function(){if(g!==p)throw"Already closed";g=r;h.removeEventListener("registered",a);h.removeEventListener("unregistering",l);l=a=null;var c=this;this.getServiceReferences().forEach(function(a){b.call(c,a)});if("function"===typeof this.onClose)this.onClose()};this.getServiceReferences=function(){var a=Object.keys(k);return!a.length?null:a.map(function(a){return k[a]})};this.open=function(){if(g!==r)throw"Already open";g=p;var f=this;a=function(a){if(-1!==a.serviceReference.getProperty("objectClass").indexOf(e)&&
(c.call(f,a.serviceReference),"function"===typeof f.onServiceAdded))return f.onServiceAdded(a.serviceReference,f.serviceRegistry.getService(a.serviceReference))};l=function(a){-1!==a.serviceReference.getProperty("objectClass").indexOf(e)&&b.call(f,a.serviceReference)};h.addEventListener("registered",a);h.addEventListener("unregistering",l);h.getServiceReferences(e).forEach(function(a){c.call(f,a);if("function"===typeof f.onServiceAdded)return f.onServiceAdded(a,h.getService(a))});if("function"===
typeof this.onOpen)this.onOpen()}}var r=0,p=1;l.prototype={addingService:function(h){return this.serviceRegistry.getService(h)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(h,e){}};return l});y("orion/edit/typedefs",["orion/objects","orion/serviceTracker","orion/i18nUtil"],function(l,r,p){function h(e){this.props=Object.create(null);this.defs=Object.create(null);this.registration=null;var c=new r(e,"orion.core.typedef"),b=this;c.onServiceAdded=function(c){var e=c.getProperty("id"),
g=c.getProperty("defs");if(!e||!g)throw Error(p.formatMessage("${0} [service id: ${1}]","TypeDef registration missing required 'id' or 'defs'",c.getProperty("service.id")));var a={};c.getPropertyKeys().forEach(function(b){"defs"!==b&&("service.id"!==b&&"service.names"!==b&&"objectClass"!==b)&&(a[b]=c.getProperty(b))});b.props[e]=a;b.defs[e]=g;b._updateRegistration()};c.removedService=function(c){c=c.getProperty("id");delete b.props[c];delete b.defs[c];b._updateRegistration()};c.open();this.registration=
e.registerService("orion.edit.context",{getTypeDef:this.getTypeDef.bind(this)},null);this._updateRegistration()}l.mixin(h.prototype,{_updateRegistration:function(){this.registration&&this.registration.setProperties({typeDefs:this.getAllProperties()})},getTypeDef:function(e){return this.defs[e]||null},getProperties:function(e){return this.props[e]||null},getAllProperties:function(){return this.props}});return h});y("examples/editor/textStyler",[],function(){return{}});y("orion/editor/textStyler",["orion/editor/annotations",
"orion/editor/eventTarget","orion/metrics"],function(l,r,p){function h(b,a,c){this._patternManager=new e(b,a);this._contentType=c}function e(b,a){this._unnamedCounter=0;this._patterns=[];this._rootId=a;b.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function c(b,a,c,f,e,d,k){this.start=b.start;this.end=b.end;this.contentStart=b.contentStart;this.contentEnd=b.contentEnd;this.name=a;this.typeId=c;this.styler=f;this.parent=
d;k&&k(this);this._subBlocks=f.computeBlocks(e,e.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function b(b){this._styler=b}function k(c,a,e){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._annotationProviders=[];this._view=c;this._annotationModel=a;this._stylerAdapter=e;this._stylerAdapter.setStyler(this);this._accessor=new b(this);this._bracketAnnotations;var f=this;this._listener={onChanged:function(a){f._onModelChanged(a)},
onDestroy:function(a){f._onDestroy(a)},onLineStyle:function(a){f._onLineStyle(a)},onMouseDown:function(a){f._onMouseDown(a)},onSelection:function(a){f._onSelection(a)}};var k=c.getModel();k.getBaseModel&&(k=k.getBaseModel());k.addEventListener("Changed",this._listener.onChanged);c.addEventListener("MouseDown",this._listener.onMouseDown);c.addEventListener("Selection",this._listener.onSelection);c.addEventListener("Destroy",this._listener.onDestroy);c.addEventListener("LineStyle",this._listener.onLineStyle);
var d=k.getCharCount(),h={start:0,contentStart:0,end:d,contentEnd:d};if(5E4<=d)var m=(new Date).getTime();this._rootBlock=this._stylerAdapter.createBlock(h,this,k,null);m&&(h=(new Date).getTime()-m,10<h&&p.logTiming("editor","styler compute blocks (ms/50000 chars)",5E4*h/d,e.getContentType()));a&&(e=[],a.removeAnnotations(l.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),c.getModel(),e),this._detectTasks&&(a.removeAnnotations(l.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,
k,e)),a.replaceAnnotations([],e));c.redrawLines()}var m=function(b,a,c,f,e){var d;void 0===f&&(f=-1);void 0===e&&(e=b.length);for(;1<e-f;)if(d=Math.floor((e+f)/2),a<=b[d].start)e=d;else if(c&&a<b[d].end){e=d;break}else f=d;return e};h.prototype={blockSpansBeyondEnd:function(b){return b.pattern.regexEnd===this._eolRegex},computeBlocks:function(b,a,c,f,e,d,k){if(!a)return[];var h=[],m=[],l;e=e||0;d=d||Infinity;k=k||Infinity;c.blockPatterns.forEach(function(b){(l=this._findMatch(b.regexBegin||b.regex,
a,e))&&m.push({result:l,pattern:b})}.bind(this));if(!m.length)return h;m.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var p=0;0<m.length;){var r=m[0];m.splice(0,1);if(d<r.result.index)break;if(!(r.result.index<p)){var p=f+r.result.index,y=r.result.index,B=null,C=r.pattern.regexEnd;if(C){var y=y+r.result[0].length,q=r.pattern,x=this._substituteCaptureValues(C,r.result);x!==C&&(q={pattern:q.pattern,
regexBegin:q.regexBegin,regexEnd:x},C=x);for(x=y;!B;){l=this._findMatch(C,a,x);l||(this._eolRegex.lastIndex=0,l=this._eolRegex.exec(a),q={pattern:q.pattern,regexBegin:q.regexBegin,regexEnd:this._eolRegex});var x=this.createBlock({start:p,end:f+l.index+l[0].length,contentStart:f+y,contentEnd:f+l.index},c.styler,b,c,q),w=x.getBlocks();if(!w.length||w[w.length-1].end<=l.index+f)B=x;x=l.index+l[0].length}}else B=this.createBlock({start:p,end:p+r.result[0].length,contentStart:p,contentEnd:p+r.result[0].length},
c.styler,b,c,r.pattern);h.push(B);if(h.length===k||d<=B.end)break;p=B.end-f}this._updateMatch(r,a,m,p,d)}return h},computeStyle:function(b,a,c){if(!b.pattern)return null;var f={start:b.start,end:b.end,style:b.pattern.pattern.name};if(b.contentStart<=c&&c<b.contentEnd)return b.pattern.pattern.contentName?{start:b.contentStart,end:b.contentEnd,style:b.pattern.pattern.contentName}:f;var e,d;if(c<b.contentStart){d=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures;if(!d)return f;e=b.pattern.regexBegin;
a=a.getText(b.start,b.contentStart);b=b.start}else{d=b.pattern.pattern.endCaptures||b.pattern.pattern.captures;if(!d)return f;e=b.pattern.regexEnd;a=a.getText(b.contentEnd,b.end);b=b.contentEnd}e.lastIndex=0;if(e=e.exec(a))if(a=[],this._getCaptureStyles(e,d,b,a),(d=a[m(a,c,!0)])&&d.start<=c&&c<d.end)return d;return f},createBlock:function(b,a,e,f,k){return new c(b,k?k.pattern.name:null,k?k.pattern.id:null,a,e,f,function(a){a.pattern=k;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,
a)}.bind(this))},getBlockContentStyleName:function(b){return b.pattern.pattern.contentName||b.pattern.pattern.name},getBlockEndStyle:function(b,a,c,f){var e;if(b.pattern.regexEnd&&(e=this._findMatch(b.pattern.regexEnd,a,0)))(a=b.pattern.pattern.endCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,c-e[0].length,f):b.pattern.pattern.name&&f.push({start:c-e[0].length,end:c,style:b.pattern.pattern.name});return e?e[0]:null},getBlockFoldBounds:function(b,a){return{start:b.start,end:b.end}},
getBlockStartStyle:function(b,a,c,f){var e;if(b.pattern.regexBegin&&(e=this._findMatch(b.pattern.regexBegin,a,0)))(a=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,c,f):f.push({start:c,end:c+e[0].length,style:b.pattern.pattern.name});return e?e[0]:null},getBracketMatch:function(b,a){for(var c,f=Object.keys(b.enclosurePatterns),e=0;e<f.length;e++){var d=b.enclosurePatterns[f[e]],k=this._findMatch(d.regex,a,0);if(k&&0===k.index){c=d;break}}if(!c)return null;
e=!1;-1!==c.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(e=!0,f=c.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):f=c.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);return!b.enclosurePatterns[f]?null:{beginName:c.pattern.name,endName:f,atStart:e}},getContentType:function(){return this._contentType},parse:function(b,a,c,f,e,d){if(b&&(f=f.linePatterns)){var k=[],h;f.forEach(function(a){var d=a.regex||a.regexBegin;d.oldLastIndex=
d.lastIndex;(h=this._findMatch(d,b,c))&&k.push({result:h,pattern:a})}.bind(this));k.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var m=c;0<k.length;){var l=k[0];k.splice(0,1);if(!(l.result.index<m)){var p=l.result.index,r,m=[];if(l.pattern.regex){h=l.result;r=p+h[0].length;r={start:a+p,end:a+r,style:l.pattern.pattern.name};if(!d){l.pattern.pattern.captures&&this._getCaptureStyles(h,l.pattern.pattern.captures,
a+p,m);m.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(p=0;p<m.length-1;p++)if(m[p+1].start<m[p].end){var y={start:m[p+1].end,end:m[p].end,style:m[p].style};m[p].end=m[p+1].start;m.splice(p+2,0,y)}}this._mergeStyles(r,m,e)}else m=l.pattern.regexEnd,m=this._substituteCaptureValues(m,l.result),h=this._findMatch(m,b,l.result.index+l.result[0].length),h||(this._eolRegex.lastIndex=0,h=this._eolRegex.exec(b)),r=h.index+h[0].length,e.push({start:a+p,end:a+r,style:l.pattern.pattern.name});
m=h.index+h[0].length}this._updateMatch(l,b,k,m)}f.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(b){},verifyBlock:function(b,a,c,f){var e=null,d=[],k;c.parent.blockPatterns.forEach(function(b){(k=this._findMatch(b.regexBegin||b.regex,a,0))&&d.push({result:k,pattern:b})}.bind(this));d.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?
-1:1:0});if(!d.length||0!==d[0].result.index||d[0].pattern.pattern.id!==c.pattern.pattern.id)e=!1;else{k=d[0];var h=k.pattern.regexEnd;if(h){for(var h=this._substituteCaptureValues(h,k.result),m=k.result[0].length,l=this._findMatch(h,a,m);null===e&&l&&c.start+l.index!==c.contentEnd+f;){var p=this.computeBlocks(b,a,c,c.start,m,l.index+1,null);!p.length||p[p.length-1].end<=c.start+l.index?e=!1:p.length?(m=p[p.length-1].end-c.start,l=this._findMatch(h,a,m)):l=null}l||(this._eolRegex.lastIndex=0,l=this._eolRegex.exec(a),
e=c.start+l.index===c.end+f)}else e=c.start+k.result[0].length===c.end+f}return null!==e?e:!0},_findMatch:function(b,a,c,f){var e=c,d=b.lastIndex;this._linebreakRegex.lastIndex=c;c=this._linebreakRegex.exec(a);var k,h;b.lastIndex=0;if(c){for(h=c.index;0<=--h&&!(k=a.charAt(h),k===this._NEWLINE||k===this._CR););k=a.substring(h+1,c.index+c[1].length);b.lastIndex=h=c.index-h-1}for(;c&&c.index<a.length;){var m;if(f){var l=b.lastIndex;b.test(k)&&(b.lastIndex=l,m=b.exec(k))}else m=b.exec(k);if(m)return m.index+=
e,m.index-=h,b.lastIndex=d,m;h=0;e+=c[0].length;if(c=this._linebreakRegex.exec(a))k=c[1],b.lastIndex=0}b.lastIndex=d;return null},_getCaptureStyles:function(b,a,c,f){if(a[0])f.push({start:c,end:c+b[0].length,style:a[0].name});else for(var e=0,d=1;d<b.length;d++)if(b[d]){var k=a[d];if(k){var h=c+e;f.push({start:h,end:h+b[d].length,style:k.name})}e+=b[d].length}},_initPatterns:function(b,a){if(a.pattern&&a.pattern.pattern.linePatterns)a.linePatterns=a.pattern.pattern.linePatterns,a.blockPatterns=a.pattern.pattern.blockPatterns,
a.enclosurePatterns=a.pattern.pattern.enclosurePatterns;else{var c=b.getPatterns(a.pattern?a.pattern.pattern:null),f=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),d=this._FLAGS;b&&(a=a.substring(b[0].length),d+="i");return RegExp(a,d)}.bind(this),e=-1,d=0;c.forEach(function(b){var c;if(b.match&&!b.begin&&!b.end){if(c={regex:f(b.match),pattern:b},a.linePatterns.push(c),b.name&&0===b.name.indexOf("punctuation.section")&&(-1!==b.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||
-1!==b.name.indexOf(this._PUNCTUATION_SECTION_END)))a.enclosurePatterns[b.name]=c}else!b.match&&(b.begin&&b.end)&&(e=d,c={regexBegin:f(b.begin),regexEnd:f(b.end),pattern:b},a.linePatterns.push(c));d++}.bind(this));a.blockPatterns=a.linePatterns.slice(0,e+1);a.pattern&&(a.pattern.pattern.enclosurePatterns=a.enclosurePatterns,a.pattern.pattern.linePatterns=a.linePatterns,a.pattern.pattern.blockPatterns=a.blockPatterns)}},_mergeStyles:function(b,a,c){var f=b.start;a.forEach(function(a){f<=a.start&&c.push({start:f,
end:a.start,style:b.style});c.push(a);f=a.end});f<b.end&&c.push({start:f,end:b.end,style:b.style})},_substituteCaptureValues:function(b,a){var c=b.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(c))return b;this._captureReferenceRegex.lastIndex=0;for(var f=this._captureReferenceRegex.exec(c);f;)c=c.replace(f[0],a[f[1]]||""),this._captureReferenceRegex.lastIndex=0,f=this._captureReferenceRegex.exec(c);return RegExp(c.substring(1,c.length-1-this._FLAGS.length),
this._FLAGS)},_updateMatch:function(b,a,c,f,e){var d=b.pattern.regex?b.pattern.regex:b.pattern.regexBegin;e=e||Infinity;if((a=this._findMatch(d,a,f,!0))&&a.index<e){b.result=a;for(e=0;e<c.length;e++)if(a.index<c[e].result.index||a.index===c[e].result.index&&b.pattern.pattern.index<c[e].pattern.pattern.index){c.splice(e,0,b);return}c.push(b)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",
_PUNCTUATION_SECTION_END:".end"};e.prototype={getPatterns:function(b){b?(b="string"===typeof b?b:b.qualifiedId,b+="#"):b=this._rootId+"#"+this._NO_ID;var a=[0],c={},f=RegExp("^"+b+"[^#]+$");this._patterns.forEach(function(b){if(f.test(b.qualifiedId))if(b.include)this._processInclude(b,a,c);else{var g=JSON.parse(JSON.stringify(b));g.index=a[0]++;c[b.qualifiedId]=g}}.bind(this));var e=[];Object.keys(c).forEach(function(a){e.push(c[a])});return e},_addPattern:function(b,a,c){b.parentId=c;b.id=a;b.qualifiedId=
b.parentId+"#"+b.id;this._patterns.push(b);b.patterns&&!b.include&&this._addPatterns(b.patterns,b.qualifiedId)},_addPatterns:function(b,a){b.forEach(function(b){this._addPattern(b,this._NO_ID+this._unnamedCounter++,a)}.bind(this))},_addRepositoryPatterns:function(b,a){Object.keys(b).forEach(function(c){this._addPattern(b[c],c,a)}.bind(this))},_processInclude:function(b,a,c){var f,e=b.include.indexOf("#");f=0===e?RegExp("^"+b.qualifiedId.substring(0,b.qualifiedId.indexOf("#"))+b.include+"$"):-1===
e?RegExp("^"+b.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+b.include+"$");this._patterns.forEach(function(b){if(f.test(b.qualifiedId))if(b.include)this._processInclude(b,a,c);else if(!c[b.qualifiedId]){var g=JSON.parse(JSON.stringify(b));g.index=a[0]++;c[b.qualifiedId]=g}}.bind(this))},_NO_ID:"NoID"};c.prototype={adjustBounds:function(b,a){b<this.start&&(this.start+=a);b<this.contentStart&&(this.contentStart+=a);b<=this.end&&(this.end+=a);b<=this.contentEnd&&(this.contentEnd+=a);this._subBlocks.forEach(function(c){b<=
c.end&&c.adjustBounds(b,a)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(b){return m(this.getBlocks(),b,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};b.prototype={getStyles:function(b){return this._styler.getStyles(b)}};k.prototype={addAnnotationProvider:function(b){"function"===typeof b&&this._annotationProviders.push(b)},computeBlocks:function(b,a,c,f,e,d,k){return this._stylerAdapter.computeBlocks(b,a,c,f,e,d,k)},destroy:function(){if(this._view){var b=
this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",this._listener.onLineStyle);this._view=null}},getAnnotationModel:function(){return this._annotationModel},getBlockAtIndex:function(b){return this._findBlock(this._rootBlock,
b)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(b){var a=[],c=this._view.getModel();c.getBaseModel&&(c=c.getBaseModel());var f=this._findBlock(this._rootBlock,b),e=c.getLineAtOffset(b),d=c.getLine(e),k=[];this._stylerAdapter.parse(d,c.getLineStart(e),0,f,k);for((e=k[m(k,b,!0)])&&(e.start<=b&&b<e.end)&&a.push(e);f;)(e=this._stylerAdapter.computeStyle(f,c,b))&&a.splice(0,0,e),f=f.parent;return a},getTextModel:function(){var b=
this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},removeAnnotationProvider:function(b){"function"===typeof b&&(b=this._annotationProviders.indexOf(b),-1!==b&&this._annotationProviders.splice(b,1))},setDetectHyperlinks:function(){},setDetectTasks:function(b){this._detectTasks=b},setFoldingEnabled:function(b){this._foldingEnabled=b},setHighlightCaretLine:function(b){this._highlightCaretLine=b},setWhitespacesVisible:function(b,a){this._whitespacesVisible!==b&&(this._whitespacesVisible=
b,a&&this._view.redraw())},_computeFolding:function(b,a,c){if(a.getBaseModel){var f=a.getBaseModel();b.forEach(function(b){var d=this._stylerAdapter.getBlockFoldBounds(b,f);(d=this._createFoldingAnnotation(a,f,d.start,d.end))&&c.push(d);this._computeFolding(b.getBlocks(),a,c)}.bind(this))}},_computeTasks:function(b,a,c,f,e){f=f||b.start;e=e||b.end;if(b.start<=e&&f<=b.end&&this._annotationModel){var d=l.AnnotationType.ANNOTATION_TASK;if(b.name&&0===b.name.indexOf("comment")){var k=[],h=a.getLineAtOffset(b.contentStart),
h=a.getLineStart(h);this._stylerAdapter.parse(a.getText(h,b.end),h,b.contentStart-h,b,k,!0);for(h=0;h<k.length;h++)"meta.annotation.task.todo"===k[h].style&&(f<=k[h].start&&k[h].end<=e)&&c.push(l.AnnotationType.createAnnotation(d,k[h].start,k[h].end,a.getText(k[h].start,k[h].end)))}b.getBlocks().forEach(function(b){this._computeTasks(b,a,c,f,e)}.bind(this))}},_createFoldingAnnotation:function(b,a,c,f){var e=a.getLineAtOffset(c),d=a.getLineAtOffset(f);return e===d||e+1===d&&a.getLineStart(d)===a.getLineEnd(d)?
null:new (l.AnnotationType.getType(l.AnnotationType.ANNOTATION_FOLDING))(c,f,b)},_findBlock:function(b,a){var c=b.getBlocks();if(!c.length)return b;var f=m(c,a,!0);return f<c.length&&c[f].start<=a&&a<c[f].end?this._findBlock(c[f],a):b},_findBrackets:function(b,a,c,f,e,d){for(var k=[],h=[],l=e,p=c.getBlocks(),r=m(p,e,!0);r<p.length&&!(p[r].start>=d);r++){var z=p[r].start,y=p[r].end;if(l<z){var B=b.getLineAtOffset(l),B=b.getLineStart(B);this._stylerAdapter.parse(f.substring(B-e,z-e),B,l-B,c,h);h.forEach(function(b){b.style&&
(0===b.style.indexOf(a.beginName)?k.push(b.start+1):0===b.style.indexOf(a.endName)&&k.push(-(b.start+1)))});h=[]}l=y}l<d&&(B=b.getLineAtOffset(l),B=b.getLineStart(B),this._stylerAdapter.parse(f.substring(B-e,d-e),B,l-B,c,h),h.forEach(function(b){b.style&&(0===b.style.indexOf(a.beginName)?k.push(b.start+1):0===b.style.indexOf(a.endName)&&k.push(-(b.start+1)))}));return k},_findMatchingBracket:function(b,a,c){var f=b.getLineAtOffset(c),e=b.getLineEnd(f),d=b.getText(c,e),d=this._stylerAdapter.getBracketMatch(a,
d);if(!d)return-1;for(var k=b.getLine(f),h=b.getLineStart(f),e=this._findBrackets(b,d,a,k,h,e),m=0;m<e.length;m++)if(k=0<=e[m]?1:-1,e[m]*k-1===c){c=1;if(d.atStart){for(m++;m<e.length;m++)if(k=0<=e[m]?1:-1,c+=k,0===c)return e[m]*k-1;f+=1;for(m=b.getLineCount();f<m;){k=b.getLine(f);h=b.getLineStart(f);e=b.getLineEnd(f);e=this._findBrackets(b,d,a,k,h,e);for(h=0;h<e.length;h++)if(k=0<=e[h]?1:-1,c+=k,0===c)return e[h]*k-1;f++}}else{for(m--;0<=m;m--)if(k=0<=e[m]?1:-1,c+=k,0===c)return e[m]*k-1;for(f-=1;0<=
f;){k=b.getLine(f);h=b.getLineStart(f);e=b.getLineEnd(f);e=this._findBrackets(b,d,a,k,h,e);for(m=e.length-1;0<=m;m--)if(k=0<=e[m]?1:-1,c+=k,0===c)return e[m]*k-1;f--}}break}return-1},_getLineStyle:function(b){if(this._highlightCaretLine){var a=this._view,c=a.getModel(),f=!1;if(!a.getSelections().some(function(a){return a.start===a.end?(f=f||c.getLineAtOffset(a.start)===b,!1):!0})&&f)return this._caretLineStyle}return null},_getStyles:function(b,a,c,f,e){var d=f+c.length,k=[],h=f+e;e=b.getBlocks();
for(var l=m(e,h,!0);l<e.length&&!(e[l].start>=d);l++){var p=e[l].start,r=e[l].end;if(h<p){var z=a.getLineAtOffset(h),z=a.getLineStart(z);this._stylerAdapter.parse(c.substring(z-f,p-f),z,h-z,b,k)}var y=Math.max(h,p);y===p&&(p=this._stylerAdapter.getBlockStartStyle(e[l],c.substring(y-f),y,k))&&(y+=p.length);var p=Math.min(d,r),B=[];p===r&&(h=c.substring(p-h-(e[l].end-e[l].contentEnd)),(h=this._stylerAdapter.getBlockEndStyle(e[l],h,p,B))&&(p-=h.length));var z=a.getLineAtOffset(y),z=a.getLineStart(z),
h=this._getStyles(e[l],a,c.substring(z-f,p-f),z,y-z),C=this._stylerAdapter.getBlockContentStyleName(e[l]);if(C){var q=y;h.forEach(function(a){a.start-q&&k.push({start:q,end:a.start,style:C});a.mergeable&&(a.style+=","+C);k.push(a);q=a.end});p-q&&k.push({start:q,end:p,style:C})}else k=k.concat(h);k=k.concat(B);h=r}h<d&&(z=a.getLineAtOffset(h),z=a.getLineStart(z),this._stylerAdapter.parse(c.substring(z-f,d-f),z,h-z,b,k));return k},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},
_onLineStyle:function(b){b.textView===this._view&&(b.style=this._getLineStyle(b.lineIndex));var a=b.lineStart,c=b.textView.getModel();if(c.getBaseModel)var a=c.mapOffset(a),f=c.getBaseModel();b.ranges=this._getStyles(this._rootBlock,f||c,b.lineText,a,0);for(a=b.ranges.length-1;0<=a;a--){var e=b.ranges[a];if(e.style){if(e.style={styleClass:e.style.replace(/\./g," ")},f){var d=e.end-e.start;e.start=c.mapOffset(e.start,!0);e.end=e.start+d}}else b.ranges.splice(a,1)}this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,
b.ranges,b.lineText,b.lineStart),this._spliceStyles(this._tabPattern,b.ranges,b.lineText,b.lineStart))},_onModelChanged:function(b){var a=b.start,c=b.removedCharCount;b=b.addedCharCount-c;var f=this._view.getModel(),e=f.getBaseModel?f.getBaseModel():f,c=a+c,d=e.getCharCount(),k=e.getLineStart(e.getLineAtOffset(a)),h=this._findBlock(this._rootBlock,a),p,r,y,z,D,B,C;do{y=h.parent;if(!p&&y){if(0>b&&h.end-a<=-b){h=y;continue}D=e.getText(h.start,Math.min(d,h.end+b+1));if(!this._stylerAdapter.verifyBlock(e,
D,h,b)){h=y;continue}}r=h.getBlocks();var q=r.length,x=m(r,k,!0),w=m(r,c,!1,x-1,q);p=!1;if(x&&r.length&&r[x-1].end===a){D=e.getText(r[x-1].start,Math.min(d,a+1));var E=this.computeBlocks(e,D,h,r[x-1].start,null,null,null);E.length&&E[0].end!==r[x-1].end&&(x--,p=!0)}x<q&&r[x].start<=k&&(k<r[x].end||p)?(C=r[x].start,C>a&&(C+=b)):x===q&&0<q&&h.end-b===r[q-1].end?(C=r[--x].start,C>a&&(C+=b)):C=Math.max(k,h.contentStart);B=w<q?r[w].end:h.contentEnd;a<=B&&(B+=b);B=Math.min(B,d-1);D=e.getText(C,B+1);E=this.computeBlocks(e,
D,h,C,null,null,null);if(w<q){if(E.length&&E[E.length-1].end===B&&E[E.length-1].typeId===r[w].typeId)break;if(E.length&&this._stylerAdapter.blockSpansBeyondEnd(E[E.length-1])){w++;for(var K=E[E.length-1].getBlocks(),K=(K.length?K[K.length-1]:E[E.length-1]).typeId;w<q;){if(r[w].typeId===K){var O=r[w].end+b,O=Math.min(O,d-1);D=e.getText(C,O+1);D=this.computeBlocks(e,D,h,C,null,null,null);if(D.length&&D[D.length-1].end===O){B=O;E=D;break}}w++}if(w<q)break}}else if(!E.length||E[E.length-1].end<=h.contentEnd+
b)break;if(!y){B=d;w=q;D=e.getText(C,B);E=this.computeBlocks(e,D,h,C,null,null,null);break}h=y;z=!0}while(1);this._rootBlock.adjustBounds(a,b);w=Math.min(w+1,q);z||(z=w-x!==E.length);if(!z)for(q=0;q<E.length;q++)if(p=r[x+q],d=E[q],p.start!==d.start||p.end!==d.end||p.typeId!==d.typeId){z=!0;break}!r.length&&!E.length?(p=[h],this.dispatchEvent({type:"BlocksChanged",oldBlocks:[h],newBlocks:p}),h=p[0]):this.dispatchEvent({type:"BlocksChanged",oldBlocks:r.slice(x,w),newBlocks:E});x=[x,w-x].concat(E);Array.prototype.splice.apply(r,
x);z&&(r=C,z=B,f!==e&&(r=f.mapOffset(r,!0),z=f.mapOffset(z,!0)),this._view.redrawRange(r,z));if(this._annotationModel){var H=[],I=[],G=[];r=this._annotationModel.getAnnotations(C,B);z=this._foldingEnabled&&e!==f;for(x=h.parent||h;r.hasNext();)if(w=r.next(),z&&w.type===l.AnnotationType.ANNOTATION_FOLDING){G.push(w);for(p=this._findBlock(x,w.start);p;){var M=this._stylerAdapter.getBlockFoldBounds(p,e);if(w.start===M.start&&w.end===M.end)break;p=p.parent}p&&w.start===M.start&&w.end===M.end?(E=w.start,
p=w.end,E>a&&(E-=b),p>a&&(p-=b),E<=a&&(a<p&&E<=c&&c<p)&&(E=e.getLineAtOffset(w.start),p=e.getLineAtOffset(w.end),E!==p?w.expanded||w.expand():H.push(w))):(H.push(w),w.expand())}else w.type===l.AnnotationType.ANNOTATION_TASK&&h.start<=w.start&&w.end<=h.end&&H.push(w);z&&x.getBlocks().forEach(function(a){this._updateFolding(a,e,f,G,I,C,B)}.bind(this));this._detectTasks&&this._computeTasks(h,e,I,C,B);this._annotationProviders.forEach(function(a){var b=[],c=[];a(this._annotationModel,e,h,C,B,b,c);H=H.concat(b);
I=I.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(H,I)}},_onMouseDown:function(b){if(2===b.clickCount){var a=this._view.getModel(),c=this._view.getOffsetAtLocation(b.x,b.y);if(0<c){var f=c-1,e=a;a.getBaseModel&&(f=a.mapOffset(f),e=a.getBaseModel());var d=this._findBlock(this._rootBlock,f),f=this._findMatchingBracket(e,d,f);-1!==f&&(b.preventDefault(),b=f,a.getBaseModel&&(b=a.mapOffset(b,!0)),c>b&&(c--,b++),this._view.setSelection(b,c))}}},_onSelection:function(b){var a=Array.isArray(b.oldValue)?
b.oldValue:[b.oldValue];b=Array.isArray(b.newValue)?b.newValue:[b.newValue];var c=this._view,f=c.getModel(),e;if(this._highlightCaretLine){var d=function(a){var b={};return a.some(function(a){if(a.isEmpty())b[f.getLineAtOffset(a.start).toString()]=!0;else return!0;return!1})?{}:b},a=d(a),d=d(b),k=function(a,b){for(var d in a)b[d]||(e=d>>0,c.redrawLines(e,e+1))};k(a,d);k(d,a)}if(this._annotationModel){var a=this._bracketAnnotations,h,m;if(1===b.length&&b[0].isEmpty()&&0<(m=b[0].getCaret()))m-=1,f.getBaseModel&&
(m=f.mapOffset(m),f=f.getBaseModel()),b=this._findBlock(this._rootBlock,m),b=this._findMatchingBracket(f,b,m),-1!==b&&(h=[l.AnnotationType.createAnnotation(l.AnnotationType.ANNOTATION_MATCHING_BRACKET,b,b+1),l.AnnotationType.createAnnotation(l.AnnotationType.ANNOTATION_CURRENT_BRACKET,m,m+1)]);this._bracketAnnotations=h;this._annotationModel.replaceAnnotations(a,h)}},_spliceStyles:function(b,a,c,f){for(var e=b.regex,d=e.lastIndex=0,k=e.exec(c);k;){for(k=f+k.index;d<a.length&&!(k<a[d].end);)d++;var h=
{start:k,end:k+1,style:JSON.parse(JSON.stringify(b.style))};if(d<a.length&&a[d].start<=k){var m={start:k+1,end:a[d].end,style:a[d].style};a[d].end=k;a.splice(d+1,0,m);a.splice(d+1,0,h);d+=2;h.style.styleClass+=" "+a[d].style.styleClass}else a.splice(d,0,h),d++;k=e.exec(c)}},_updateFolding:function(b,a,c,f,e,d,k){d=d||b.start;k=k||b.end;var h=this._stylerAdapter.getBlockFoldBounds(b,a);if(!b.doNotFold&&h.start<=k&&d<=h.end){var l=m(f,h.start,!0);l<f.length&&f[l].start===h.start&&f[l].end===h.end||
(h=this._createFoldingAnnotation(c,a,h.start,h.end))&&e.push(h);b.getBlocks().forEach(function(b){this._updateFolding(b,a,c,f,e,d,k)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}};r.EventTarget.addMixin(k.prototype);return{TextStyler:k,Block:c,createPatternBasedAdapter:function(b,a,c){return new h(b,
a,c)}}});y("orion/editor/textMateStyler",["orion/regex"],function(l){function r(e){var c;if(e instanceof Array){c=Array(e.length);for(var b=0;b<e.length;b++)c[b]=r(e[b])}else for(b in c={},e)if(Object.prototype.hasOwnProperty.call(e,b)){var k=e[b];c[b]="object"===typeof k&&null!==k?r(k):k}return c}function p(e,c,b){this.initialize(e);this.grammar=r(c);this.externalGrammars=b?r(b):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var h={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(e){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(e){return"\x3d"===e[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(e){return"atomic group"}}],toRegExp:function(e){function c(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var b="",k;e=h.processGlobalFlag("x",e,function(b){for(var a="",c=!1,f=b.length,e=0;e<f;){var d=b.charAt(e);if(!c&&"#"===d)for(;e<f&&"\r"!==d&&"\n"!==d;)d=b.charAt(++e);
else if(!c&&/\s/.test(d))for(;e<f&&/\s/.test(d);)d=b.charAt(++e);else"\\"===d?(a+=d,/\s/.test(b.charAt(e+1))||(a+=b.charAt(e+1),e+=1)):("["===d?c=!0:"]"===d&&(c=!1),a+=d),e+=1}return a});e=h.processGlobalFlag("i",e,function(c){b+="i";return c});for(k=0;k<this.unsupported.length;k++){var m;(m=this.unsupported[k].regex.exec(e))&&c(this.unsupported[k].func(m),m)}return RegExp(e,b)},processGlobalFlag:function(e,c,b){var k="(?"+e+")";e="(?"+e+":";if(c.substring(0,k.length)===k)return b(c.substring(k.length));
if(c.substring(0,e.length)===e){for(var k=0,h=c.length,g=-1,a=0;a<h&&-1===g;a++)switch(c.charAt(a)){case "\\":a++;break;case "(":k++;break;case ")":k--,0===k&&(g=a)}k=g;if(k<c.length-1)throw Error("Only a "+e+") group that encloses the entire regex is supported in: "+c);return b(c.substring(e.length,k))}return c},hasBackReference:function(e){return/\\\d+/.test(e.source)},getSubstitutedRegex:function(e,c,b){b="undefined"===typeof b?!0:!1;e=e.source.split(/(\\\d+)/g);for(var k=[],h=0;h<e.length;h++){var g=
e[h],a=/\\(\d+)/.exec(g);a?(g=c[a[1]]||"",k.push(b?l.escape(g):g)):k.push(g)}return RegExp(k.join(""))},groupify:function(e,c){for(var b=e.source,k=b.length,h=[],g=0,a=[],l=1,f=1,n=[],d={},p={},s=0;s<k;s++){var r=h[h.length-1],A=b.charAt(s);switch(A){case "(":4===r&&(h.pop(),n.push(")"),a[a.length-1].end=s);var y=s+2<k?b.charAt(s+1)+""+b.charAt(s+2):null;if("?:"===y||"?\x3d"===y||"?!"===y){var z;"?:"===y?z=1:(z=3,g++);h.push(z);a.push({start:s,end:-1,type:z});n.push(A);n.push(y);s+=y.length}else h.push(2),
a.push({start:s,end:-1,type:2,oldNum:l,num:f}),n.push(A),0===g&&(p[f]=null),d[l]=f,l++,f++;break;case ")":r=h.pop();3===r&&g--;a[a.length-1].end=s;n.push(A);break;case "*":case "+":case "?":case "}":var D=A,B=b.charAt(s-1),y=s-1;if("}"===A){for(z=s-1;"{"!==b.charAt(z)&&0<=z;z--);B=b.charAt(z-1);y=z-1;D=b.substring(z,s+1)}z=a[a.length-1];if(")"===B&&(2===z.type||4===z.type)){n.splice(z.start,0,"(");n.push(D);n.push(")");A={start:z.start,end:n.length-1,type:4,num:z.num};for(B=0;B<a.length;B++)if(r=
a[B],(2===r.type||4===r.type)&&r.start>=z.start&&r.end<=y)r.start+=1,r.end+=1,r.num+=1,2===r.type&&(d[r.oldNum]=r.num);a.push(A);f++;break}default:"|"!==A&&(2!==r&&4!==r)&&0===g&&(h.push(4),a.push({start:s,end:-1,type:4,num:f}),n.push("("),p[f]=null,f++),n.push(A),"\\"===A&&(A=b.charAt(s+1),n.push(A),s+=1)}}for(;h.length;)h.pop(),n.push(")");b=RegExp(n.join(""));k={};c=c||d;for(var C in c)c.hasOwnProperty(C)&&(k[C]="\\"+c[C]);b=this.getSubstitutedRegex(b,k,!1);return[b,d,p]},complexCaptures:function(e){if(!e)return!1;
for(var c in e)if(e.hasOwnProperty(c)&&"0"!==c)return!0;return!1}};p.prototype={initialize:function(e){this.textView=e;this.textView.stylerOptions=this;var c=this;this._listener={onModelChanged:function(b){c.onModelChanged(b)},onDestroy:function(b){c.onDestroy(b)},onLineStyle:function(b){c.onLineStyle(b)},onStorage:function(b){c.onStorage(b)}};e.addEventListener("ModelChanged",this._listener.onModelChanged);e.addEventListener("Destroy",this._listener.onDestroy);e.addEventListener("LineStyle",this._listener.onLineStyle);
e.redrawLines()},onDestroy:function(e){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(e){for(e=[e];0!==e.length;){var c=e.pop();if(!c._resolvedRule||!c._typedRule)if(c._resolvedRule=
this._resolve(c),c._typedRule=this._createTypedRule(c),this.addStyles(c.name),this.addStyles(c.contentName),this.addStylesForCaptures(c.captures),this.addStylesForCaptures(c.beginCaptures),this.addStylesForCaptures(c.endCaptures),c._resolvedRule!==c&&e.push(c._resolvedRule),c.patterns)for(var b=0;b<c.patterns.length;b++)e.push(c.patterns[b])}},addStyles:function(e){if(e&&!this._styles[e]){this._styles[e]=[];for(var c=e.split("."),b=0;b<c.length;b++)this._styles[e].push(c.slice(0,b+1).join("-"))}},
addStylesForCaptures:function(e){for(var c in e)e.hasOwnProperty(c)&&this.addStyles(e[c].name)},ContainerRule:function(){function e(c){this.rule=c;this.subrules=c.patterns}e.prototype.valueOf=function(){return"aa"};return e}(),BeginEndRule:function(){function e(c){this.rule=c;this.beginRegex=h.toRegExp(c.begin);this.endRegex=h.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=h.hasBackReference(this.endRegex);var b=h.complexCaptures(c.captures);c=h.complexCaptures(c.beginCaptures)||
h.complexCaptures(c.endCaptures);if(this.isComplex=b||c)b=h.groupify(this.beginRegex),this.beginRegex=b[0],this.beginOld2New=b[1],this.beginConsuming=b[2],b=h.groupify(this.endRegex,this.beginOld2New),this.endRegex=b[0],this.endOld2New=b[1],this.endConsuming=b[2]}e.prototype.valueOf=function(){return this.beginRegex};return e}(),MatchRule:function(){function e(c){this.rule=c;this.matchRegex=h.toRegExp(c.match);if(this.isComplex=h.complexCaptures(c.captures))c=h.groupify(this.matchRegex),this.matchRegex=
c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}e.prototype.valueOf=function(){return this.matchRegex};return e}(),_createTypedRule:function(e){return e.match?new this.MatchRule(e):e.begin?new this.BeginEndRule(e):new this.ContainerRule(e)},_resolve:function(e){var c=e;if(e.include){if(e.begin||e.end||e.match)throw Error('Unexpected regex pattern in "include" rule '+e.include);e=e.include;if("#"===e.charAt(0)){if(c=this.grammar.repository&&this.grammar.repository[e.substring(1)],!c)throw Error("Couldn't find included rule "+
e+" in grammar repository");}else if("$self"===e)c=this.grammar;else{if("$base"===e)throw Error('Include "$base" is not supported');c=this._allGrammars[e];if(!c)for(var b=0;b<this.externalGrammars.length;b++){var h=this.externalGrammars[b];if(h.scopeName===e){this.preprocess(h);c=this._allGrammars[e]=h;break}}}}return c},ContainerNode:function(){function e(c,b){this.parent=c;this.rule=b;this.children=[];this.end=this.start=null}e.prototype.addChild=function(c){this.children.push(c)};e.prototype.valueOf=
function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||"")+(c.comment||"")+"}"};return e}(),BeginEndNode:function(){function e(c,b,e){this.parent=c;this.rule=b;this.children=[];this.setStart(e);this.endMatch=this.end=null;this.endRegexSubstituted=b.endRegexHasBackRef?h.getSubstitutedRegex(b.endRegex,e):null}e.prototype.addChild=function(c){this.children.push(c)};e.prototype.getIndexInParent=function(c){return this.parent?this.parent.children.indexOf(this):-1};e.prototype.setStart=
function(c){this.start=c.index;this.beginMatch=c};e.prototype.setEnd=function(c){c&&"object"===typeof c?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};e.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};e.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};e.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return e}(),push:function(e,c){if(c)for(var b=c.length;0<
b;)e.push(c[--b])},exec:function(e,c,b){if(c=e.exec(c))c.index+=b;e.lastIndex=0;return c},afterMatch:function(e){return e.index+e[0].length},getEndMatch:function(e,c,b){if(e instanceof this.BeginEndNode){var h=e.rule;e=e.endRegexSubstituted||h.endRegex;return!e?null:this.exec(e,c,b)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(e){var c=e.addedCharCount,
b=e.removedCharCount;e=e.start;if(this._tree){var h=this.textView.getModel(),m=h.getCharCount(),h=h.getLineEnd(h.getLineAtOffset(e)-1),g=this.getFirstDamaged(h,h),h=-1===h?0:h,c=g?this.parse(g,!0,h,e,c,b):m;this.textView.redrawRange(h,c)}else this.initialParse()},getFirstDamaged:function(e,c){if(0>e)return this._tree;for(var b=[this._tree],h=null;b.length;){var m=b.pop();if(!m.parent||this.isDamaged(m,e,c)){m instanceof this.BeginEndNode&&(h=m);for(var g=0;g<m.children.length;g++)b.push(m.children[g])}}return h||
this._tree},isDamaged:function(e,c,b){return e.start<=b&&e.end>c},parse:function(e,c,b,h,m,g){var a=this.textView.getModel(),l=a.getLineStart(a.getLineCount()-1),f=a.getCharCount(),n=this.getInitialExpected(e,b),d=-1;c&&(e.repaired=!0,e.endNeedsUpdate=!0,d=(d=e.children[e.children.length-1])?a.getLineEnd(a.getLineAtOffset(d.end+(m-g))):-1,h=a.getLineEnd(a.getLineAtOffset(h+g)),d=Math.max(d,h));d=-1===d?f:d;h=n;for(var p=e,s=!1,r=b,A=-1;p&&(!c||r<d);){var y=this.getNextMatch(a,p,r);y||(r=r>=l?f:a.getLineStart(a.getLineAtOffset(r)+
1));var z=y&&y.match,D=y&&y.rule,B=y&&y.isEnd;if(y&&y.isSub)r=this.afterMatch(z),D instanceof this.BeginEndRule&&(s=!0,c&&D===h.rule&&p===h.parent?(p=h,p.setStart(z),p.repaired=!0,p.endNeedsUpdate=!0,h=this.getNextExpected(h,"begin")):(c&&(this.prune(p,h),c=!1),z=new this.BeginEndNode(p,D,z),p.addChild(z),p=z));else if(B||r===f)p instanceof this.BeginEndNode&&(z?(s=!0,A=Math.max(A,p.end),p.setEnd(z),r=this.afterMatch(z),c&&p===h&&p.parent===h.parent?(p.repaired=!0,delete p.endNeedsUpdate,h=this.getNextExpected(h,
"end")):c&&(this.prune(p,h),c=!1)):(p.setEnd(f),delete p.endNeedsUpdate)),p=p.parent;c&&(r>=d&&!s)&&(this.prune(e,n),c=!1)}this.removeUnrepairedChildren(e,c,b);this.cleanup(c,e,b,d,f,m,g);return c?Math.max(A,r):r},removeUnrepairedChildren:function(e,c,b){if(c){c=e.children;for(var h=-1,m=0;m<c.length;m++){var g=c[m];if(!g.repaired&&this.isDamaged(g,b,Number.MAX_VALUE)){h=m;break}}-1!==h&&(e.children.length=h)}},cleanup:function(e,c,b,h,m,g,a){if(e){e=g-a;m=this.getIntersecting(h-e+1,m);c=this.getIntersecting(b,
h);for(b=0;b<m.length;b++)h=m[b],!h.repaired&&h instanceof this.BeginEndNode&&(h.shiftEnd(e),h.shiftStart(e));for(b=0;b<c.length;b++)h=c[b],h.repaired&&h.endNeedsUpdate&&h.shiftEnd(e),delete h.endNeedsUpdate,delete h.repaired}else{c=this.getIntersecting(b,h);for(b=0;b<c.length;b++)delete c[b].repaired}},getNextMatch:function(e,c,b,h){var m=e.getLineAtOffset(b),m=e.getLineEnd(m),g=e.getText(b,m),a=[],l=[];e=[];m=[];for(this.push(a,c.rule.subrules);a.length;){var f=a.length?a.pop():null,f=f&&f._resolvedRule._typedRule;
if(f instanceof this.ContainerRule&&-1===l.indexOf(f))l.push(f),this.push(a,f.subrules);else if(!f||!h||f.matchRegex){var n=f&&this.exec(f.matchRegex||f.beginRegex,g,b);n&&(e.push(n),m.push(f))}}a=Number.MAX_VALUE;l=-1;for(f=0;f<e.length;f++)n=e[f],n.index<a&&(a=n.index,l=f);if(!h&&(b=this.getEndMatch(c,g,b)))if(h=c.rule.applyEndPatternLast,-1===l||b.index<a||!h&&b.index===a)return{isEnd:!0,rule:c.rule,match:b};return-1===l?null:{isSub:!0,rule:m[l],match:e[l]}},getInitialExpected:function(e,c){var b,
h;if(e===this._tree)for(b=0;b<e.children.length;b++){if(h=e.children[b],h.start>=c)return h}else if(e instanceof this.BeginEndNode&&e.endMatch){var m=e.endMatch.index;for(b=0;b<e.children.length&&!(h=e.children[b],h.start>=c);b++);if(h&&h.start<m)return h}return e},getNextExpected:function(e,c){if("begin"===c){var b=e.children[0];return b?b:e}if("end"===c&&(b=e.parent)){var h=b.children[b.children.indexOf(e)+1];return h?h:b}return null},prune:function(e,c){c.parent===e?e.children.length=c.getIndexInParent():
e instanceof this.BeginEndNode&&(e.endMatch=null,e.end=null);e.parent&&(e.parent.children.length=e.getIndexInParent()+1)},onLineStyle:function(e){this._tree||this.initialParse();var c=e.lineStart,b=this.textView.getModel(),h=b.getLineEnd(e.lineIndex),m=b.getLineEnd(b.getLineAtOffset(c)-1),m=this.getFirstDamaged(m,m),c=this.getLineScope(b,m,c,h);e.ranges=this.toStyleRanges(c);e.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(e,c,b,h){for(var m=b,g=this.getInitialExpected(c,
b),a=[],l=[];c&&m<h;){var f=this.getNextMatch(e,c,m);if(!f)break;var n=f&&f.match,d=f&&f.rule,p=f&&f.isSub,f=f&&f.isEnd;n.index!==m&&l.push({start:m,end:n.index,node:c});p?(m=this.afterMatch(n),d instanceof this.BeginEndRule?(this.addBeginScope(a,n,d),c=g,g=this.getNextExpected(g,"begin")):this.addMatchScope(a,n,d)):f&&(m=this.afterMatch(n),this.addEndScope(a,n,d),g=this.getNextExpected(g,"end"),c=c.parent)}m<h&&l.push({start:m,end:h,node:c});e=this.getInheritedLineScope(l,b,h);return a.concat(e)},
getInheritedLineScope:function(e,c,b){c=[];for(b=0;b<e.length;b++)for(var h=e[b],l=h.node;l;){var g=l.rule.rule,a=g.name;if(g=g.contentName||a){this.addScopeRange(c,h.start,h.end,g);break}l=l.parent}return c},addBeginScope:function(e,c,b){var h=b.rule;this.addCapturesScope(e,c,h.beginCaptures||h.captures,b.isComplex,b.beginOld2New,b.beginConsuming)},addEndScope:function(e,c,b){var h=b.rule;this.addCapturesScope(e,c,h.endCaptures||h.captures,b.isComplex,b.endOld2New,b.endConsuming)},addMatchScope:function(e,
c,b){var h=b.rule,l=h.name;(h=h.captures)?this.addCapturesScope(e,c,h,b.isComplex,b.matchOld2New,b.matchConsuming):this.addScope(e,c,l)},addScope:function(e,c,b){b&&e.push({start:c.index,end:this.afterMatch(c),scope:b})},addScopeRange:function(e,c,b,h){h&&e.push({start:c,end:b,scope:h})},addCapturesScope:function(e,c,b,h,l,g){if(b)if(h){h={1:0};for(var a=0,p=1;void 0!==c[p];p++)void 0!==g[p]&&(a+=c[p].length),void 0!==c[p+1]&&(h[p+1]=a);g=c.index;for(a=1;b[a];a++){var p=b[a].name,f=l[a],n=g+h[f];
"undefined"!==typeof c[f]&&this.addScopeRange(e,n,n+c[f].length,p)}}else this.addScope(e,c,b[0]&&b[0].name)},getIntersecting:function(e,c){for(var b=[],h=this._tree?[this._tree]:[];h.length;){var l=h.pop(),g=!1;l instanceof this.ContainerNode?g=!0:this.isDamaged(l,e,c)&&(g=!0,b.push(l));if(g)for(var g=l.children.length,a=0;a<g;a++)h.push(l.children[a])}return b.reverse()},toStyleRanges:function(e){for(var c=[],b=0;b<e.length;b++){var h=e[b],l=this._styles[h.scope];if(!l)throw Error("styles not found for "+
h.scope);l=l.join(" ");c.push({start:h.start,end:h.end,style:{styleClass:l}})}return c}};return{RegexUtil:h,TextMateStyler:p}});y("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(l,r){function p(b){return-1!==b.getProperty("objectClass").indexOf(e)&&"highlighter"===b.getProperty("type")}function h(b,c,e){this.initialize(b,c,e);this.lineStyles=[]}var e="orion.edit.highlighter",c=e+" service must be an event emitter";r.AnnotationType.registerType("orion.annotation.highlightError",
{title:l.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});h.prototype={initialize:function(b,c,h){this.textView=b;this.serviceRegistry=c;this.annotationModel=h;this.services=[];var g=this;this.listener={onModelChanging:function(a){g.onModelChanging(a)},onModelChanged:function(a){g.onModelChanged(a)},onDestroy:function(a){g.onDestroy(a)},onLineStyle:function(a){g.onLineStyle(a)},onStyleReady:function(a){g.onStyleReady(a)},
onServiceAdded:function(a){g.onServiceAdded(a.serviceReference,g.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){g.onServiceRemoved(a.serviceReference,g.serviceRegistry.getService(a.serviceReference))}};b.addEventListener("ModelChanging",this.listener.onModelChanging);b.addEventListener("ModelChanged",this.listener.onModelChanged);b.addEventListener("Destroy",this.listener.onDestroy);b.addEventListener("LineStyle",this.listener.onLineStyle);c.addEventListener("registered",
this.listener.onServiceAdded);c.addEventListener("unregistering",this.listener.onServiceRemoved);b=c.getServiceReferences(e);for(h=0;h<b.length;h++){var a=b[h];p(a)&&this.addServiceListener(c.getService(a))}},onDestroy:function(b){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),
this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var b=0;b<this.services.length;b++)this.removeServiceListener(this.services[b]);this.services=null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(b){this.startLine=
this.textView.getModel().getLineAtOffset(b.start)},onModelChanged:function(b){var c=this.startLine;(b.addedLineCount||b.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[c,b.removedLineCount].concat(this._getEmptyStyle(b.addedLineCount)))},onStyleReady:function(b){var c=b.lineStyles||b.style;b=Number.MAX_VALUE;var e=-1,g=this.textView.getModel(),a;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(this.lineStyles[a]=c[a],b=Math.min(b,a),e=Math.max(e,a));b=Math.max(b,0);e=Math.min(e,
g.getLineCount());if(c=this.annotationModel){for(var h=c.getAnnotations(g.getLineStart(b),g.getLineEnd(e)),f=[];h.hasNext();){var l=h.next();"orion.annotation.highlightError"===l.type&&f.push(l)}h=[];for(l=b;l<=e;l++){a=l;var d=this.lineStyles[a],d=d&&d.errors;a=g.getLineStart(a);if(d)for(var p=0;p<d.length;p++){var s=d[p];h.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",s.start+a,s.end+a))}}c.replaceAnnotations(f,h)}this.textView.redrawLines(b,e+1)},onLineStyle:function(b){var c=
this.lineStyles[b.lineIndex];if(c)if(c.ranges){for(var c=c.ranges,e=b.lineStart,g=c.length,a=[],h=0;h<g;h++){var f=c[h];a.push({start:f.start+e,end:f.end+e,style:f.style})}b.ranges=a}else c.style&&(b.style=c.style)},_getEmptyStyle:function(b){for(var c=[],e=0;e<b;e++)c.push(null);return c},setContentType:function(b){this.contentType=b;if(this.services)for(b=0;b<this.services.length;b++){var c=this.services[b];if(c.setContentType){var e=this.serviceRegistry.getService("orion.page.progress");e?e.progress(c.setContentType(this.contentType),
"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}},onServiceAdded:function(b,c){p(b)&&this.addServiceListener(c)},onServiceRemoved:function(b,c){-1!==this.services.indexOf(c)&&this.removeServiceListener(c)},addServiceListener:function(b){if("function"===typeof b.addEventListener){if(b.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(b),b.setContentType&&this.contentType){var e=
this.serviceRegistry.getService("orion.page.progress");e?e.progress(b.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):b.setContentType(this.contentType)}}else"undefined"!==typeof console&&console.log(Error(c))},removeServiceListener:function(b){"function"===typeof b.removeEventListener?(b.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),b=this.services.indexOf(b),-1!==b&&this.services.splice(b,1)):
"undefined"!==typeof console&&console.log(Error(c))}};return h});y("orion/highlight",["examples/editor/textStyler","orion/editor/textStyler","orion/editor/textMateStyler","orion/editor/AsyncStyler","orion/Deferred"],function(l,r,p,h,e){function c(b,c,a,t,f,n,d){function u(b,d){var f=b.getProperty("contentType")||b.getProperty("contentTypes"),h=b.getProperty("fileTypes");return f?e.when(c.isSomeExtensionOf(a,f)).then(function(a){return a?b:null}):d&&h&&-1!==h.indexOf(d)?(f=new e,f.resolve(b),f):null}
function s(a){var b=null;switch(a&&a.id){case "application/javascript":case "application/json":b=new l.TextStyler(t,"js",f);break;case "text/x-java-source":b=new l.TextStyler(t,"java",f);break;case "text/css":b=new l.TextStyler(t,"css",f)}return b}if(!k){var v=s(a);if(v)return n=new e,n.resolve(v),n}k&&!this.orionGrammars&&(this.orionGrammars={});v=n&&n.split(".").pop().toLowerCase();n=b.getServiceReferences("orion.edit.highlighter");for(var A=[],y=[],z=0;z<n.length;z++){var D=n[z],B=D.getProperty("type");
"grammar"===B||!k&&"undefined"===typeof B?A.push(D.getProperty("grammar")):"highlighter"!==B&&(B=D.getProperty("id"))&&!this.orionGrammars[B]&&(this.orionGrammars[B]={id:B,contentTypes:D.getProperty("contentTypes"),patterns:D.getProperty("patterns"),repository:D.getProperty("repository")});(D=u(D,v))&&y.push(D)}return e.all(y,function(a){return{_error:a}}).then(function(c){for(var e,g=c.length-1;0<=g;g--){var l=c[g];if(l&&!l._error&&(d||"highlighter"!==l.getProperty("type"))){e=l;break}}var n;if(e)if(c=
e.getProperty("type"),"highlighter"===c)n=new h(t,b,f),n.setContentType(a);else if("grammar"===c||!k&&"undefined"===typeof c)e=e.getProperty("grammar"),n=new p.TextMateStyler(t,e,A);else{if(k){n=[];for(var s in this.orionGrammars)n.push(this.orionGrammars[s]);e=new r.createPatternBasedAdapter(n,e.getProperty("id"),a.id);n=new r.TextStyler(t,f,e)}}else if(k&&(!a||"text/x-markdown"!==a.id))e=new r.createPatternBasedAdapter([],""),n=new r.TextStyler(t,f,e);return n})}function b(b,c){this.serviceRegistry=
b;this.contentTypeService=c;this.styler=null}var k=1;b.prototype={setup:function(b,e,a,h,f){f="undefined"===typeof f?!0:f;this.styler&&(this.styler.destroy&&this.styler.destroy(),this.styler=null);var k=this;return c(this.serviceRegistry,this.contentTypeService?this.contentTypeService:this.serviceRegistry.getService("orion.core.contentTypeRegistry"),b,e,a,h,f).then(function(a){return k.styler=a})},getStyler:function(){return this.styler}};return{createStyler:c,SyntaxHighlighter:b}});y("orion/markOccurrences",
["orion/Deferred"],function(l){function r(l,h,e){this.registry=l;this.inputManager=h;this.editor=e}r.prototype={setOccurrencesVisible:function(l){this.occurrencesVisible!==l&&((this.occurrencesVisible=l)||this.editor.showOccurrences([]))},findOccurrences:function(){function p(b,c,e){function a(a,b,c){a=b.getProperty("contentType");return h.isSomeExtensionOf(c,a).then(function(a){return a?b:null})}for(var h=b.getService("orion.core.contentTypeRegistry"),f=b.getServiceReferences("orion.edit.occurrences"),
n=[],d=0;d<f.length;d++){var p=f[d],r=p.getProperty("pattern");p.getProperty("contentType")?n.push(a(b,p,c)):r&&RegExp(r).test(e)&&(r=new l,r.resolve(p),n.push(r))}return l.all(n,function(a){return{_error:a}}).then(function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&!d._error&&b.push(d)}return b})}var h,e=this,c=e.registry.getService("orion.edit.occurrences"),b=function(b){h&&window.clearTimeout(h);e.occurrencesVisible&&(h=window.setTimeout(function(){h=null;var b=e.editor,g=b.getSelections();
1<g.length?e.editor.showOccurrences([]):(g={selection:g[0],contentType:e.inputManager.getContentType().id},c.computeOccurrences(b.getEditorContext(),g).then(function(a){e.editor.showOccurrences(a)}))},500))};e.inputManager.addEventListener("InputChanged",function(c){var l=e.editor.getTextView();l&&(l.removeEventListener("Selection",b),p(e.registry,c.contentType,c.title).then(function(c){!c||0===c.length?h&&window.clearTimeout(h):l.addEventListener("Selection",b)}))})}};return{MarkOccurrences:r}});
y("orion/syntaxchecker",["orion/Deferred","orion/edit/editorContext","orion/i18nUtil"],function(l,r,p){function h(e,c,b){function h(a,b){var c=a.getProperty("contentType");return m.isSomeExtensionOf(b,c).then(function(b){return b?a:null})}var m=e.getService("orion.core.contentTypeRegistry");e=e.getServiceReferences("orion.edit.validator");for(var g=[],a=0;a<e.length;a++){var p=e[a],f=p.getProperty("pattern");p.getProperty("contentType")?g.push(h(p,c)):f&&RegExp(f).test(b)&&(f=new l,f.resolve(p),g.push(f))}return l.all(g,
function(a){return{_error:a}}).then(function(a){for(var b=[],c=0;c<a.length;c++){var f=a[c];f&&!f._error&&b.push(f)}return b})}return{SyntaxChecker:function(){function e(b,c){this.registry=b;this.textModel=c}function c(b,c,e){b=Math.max(b,c);return b=Math.min(b,e)}function b(b){b=b||{};b=b.problems||b.errors||b;return Array.isArray(b)?b:[]}e.prototype={checkSyntax:function(c,e,g,a,p){if(!c||g)return(new l).resolve([]);if(!g){var f=this.registry,n=this;return h(f,c,e).then(function(d){var g=f.getService("orion.page.progress");
d=d.map(function(d){d=f.getService(d);var h;d.computeProblems?(h={contentType:c.id,title:e},h=d.computeProblems(p?p:r.getEditorContext(f),h)):d.checkSyntax&&(h=d.checkSyntax(e,a));return g.progress(h,"Validating "+e).then(b)});return l.all(d,function(a){return{_error:a}}).then(function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d._error||(n._fixup(d),b=b.concat(d))}return(new l).resolve(b)})})}},setTextModel:function(b){this.textModel=b},_fixup:function(b){for(var e=this.textModel,g=0;g<b.length;g++){var a=
b[g];a.description=a.description||a.reason;a.severity=a.severity||"error";a.start="number"===typeof a.start?a.start:a.character;if("number"===typeof a.line){var h=e.getLine(a.line-1,!1).length;a.start=c(a.start,1,h);a.end="number"===typeof a.end?a.end:-1;a.end=c(a.end,a.start+1,h+1)}else if(h=e.getCharCount(),a.start=c(a.start,0,h),a.end="number"===typeof a.end?a.end:-1,a.end=c(a.end,a.start,h),a.end===h&&1<e.getLineCount()&&h===e.getLineStart(e.getLineCount()-1)){var f=e.getLineCount()-2,h=e.getLineStart(f),
f=e.getLineEnd(f);h===f?a.start=a.end=f:(a.start=f-1,a.end=f)}}}};return e}(),getValidators:h}});y("orion/liveEditSession",["orion/Deferred"],function(l){function r(c){return c instanceof Error?c:Error(c)}function p(c,b){this.registry=c;this.editor=b}var h,e=[];p.prototype={start:function(c,b){function k(a,b){function c(a,b){var d=a.getProperty("contentType");return e.isSomeExtensionOf(b,d).then(function(b){return b?a:null})}for(var e=a.getService("orion.core.contentTypeRegistry"),d=a.getServiceReferences("orion.edit.live"),
g=[],h=0;h<d.length;h++){var k=d[h];k.getProperty("contentType")&&g.push(c(k,b))}return l.all(g,r).then(function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&!(d instanceof Error)&&b.push(d)}return b})}if(h!==b&&(e&&e.forEach(function(a){a.endEdit(h)}),e=[],h=b,c)){var m=this.editor,g=this.registry;k(g,c).then(function(a){a=a.map(function(a){a=g.getService(a);if(a.startEdit){var f={contentType:c.id,title:b};e.push(a);var h=m.getEditorContext();return a.startEdit(h,f)}});l.all(a,r)})}}};return p});
y("orion/problems",["orion/EventTarget"],function(l){function r(p,h){this._serviceRegistry=p;l.attach(this);this._serviceRegistration=p.registerService(h||"orion.core.marker",this)}r.prototype={_setProblems:function(l){this.problems=l;this.dispatchEvent({type:"problemsChanged",problems:l})}};r.prototype.constructor=r;return{ProblemService:r}});y("orion/blamer",["orion/extensionCommands","orion/PageLinks","orion/URITemplate"],function(l,r,p){function h(e,c,b){this.serviceRegistry=e;this.inputManager=
c;this.editor=b}h.prototype={getBlamer:function(){for(var e=this.inputManager.getFileMetadata(),c=this.serviceRegistry.getServiceReferences("orion.edit.blamer"),b=0;b<c.length;b++){var h=c[b],m={};m.validationProperties=h.getProperty("validationProperties");m.forceSingleItem=!0;m=l._makeValidator(m,this.serviceRegistry);if(m.validationFunction.bind(m)(e))return this.serviceRegistry.getService(h)}return null},isVisible:function(){return!!this.getBlamer()},doBlame:function(){var e=this.getBlamer();
if(e){var c=function(b){for(var c=r.getOrionHome(),e=0;e<b.length;e++){var a=b[e],h=new p(a.CommitLink),f={};f.OrionHome=c;a.CommitLink=h.expand(f)}this.editor.showBlame(b)}.bind(this),b={metadata:this.inputManager.getFileMetadata()};e.computeBlame(this.editor.getEditorContext(),b).then(c)}}};return{Blamer:h}});y("orion/compare/diffParser",[],function(){var l=l||{};l.DiffParser=function(){function l(h,e){this._lineDelimiter=h?h:p?"\r\n":"\n";this._diffLineDelimiter=e?e:this._lineDelimiter;this._DEBUG=
!1}var p=-1!==window.navigator.platform.indexOf("Win");l.prototype={_init:function(){this._oFileContents=[];this._diffContents=[];this._oBlocks=[];this._nBlocks=[];this._hunkRanges=[];this._lastToken=" ";this._deltaMap=[];this._nFileContents=[];this._nNewLineAtEnd=this._oNewLineAtEnd=!0;this._diffContentIndex=1},getOriginalBlocks:function(){return this._oBlocks},getNewBlocks:function(){return this._nBlocks},setLineDelim:function(h){this._diffLineDelimiter=this._lineDelimiter=h},getDiffArray:function(){return{array:this._diffContents,
index:this._diffContentIndex}},parse:function(h,e,c,b){this._init();if(""===e)return{outPutFile:h,mapper:[]};this._oFileContents=""===h?[]:h.split(this._lineDelimiter);this._diffContents=e.split(this._diffLineDelimiter);e=this._diffContents.length;this._hunkRanges=[];for(var k=0;k<e;k++){var l=this._parseHunkRange(k);l&&this._hunkRanges.push(l)}if(0===this._hunkRanges.length)return{outPutFile:h,mapper:[]};this._DEBUG&&(console.log("***Diff contents: \n"),this._diffContents.forEach(function(b){console.log(b)}),
console.log("***Hunk ranges: \n"),console.log(JSON.stringify(this._hunkRanges)));for(h=0;h<this._hunkRanges.length;h++)this._parseHunkBlock(h);this._DEBUG&&(console.log("***Original Hunk range blocks: \n"),console.log(JSON.stringify(this._oBlocks)),console.log("***New Hunk range blocks: \n"),console.log(JSON.stringify(this._nBlocks)));this._buildMap(c);this._DEBUG&&(console.log("***New Line at end of file(original): \n"),console.log(JSON.stringify(this._oNewLineAtEnd)),console.log("***New Line at end of file(new): \n"),
console.log(JSON.stringify(this._nNewLineAtEnd)),console.log("***Mapper: \n"),this._logMap(),console.log("***Total line number in original file: "+this._oFileContents.length));b||this._buildNewFile();return{outPutFile:this._nFileContents.join(this._diffLineDelimiter),mapper:this._deltaMap}},_logMap:function(){for(var h=0;h<this._deltaMap.length;h++)if(console.log(JSON.stringify(this._deltaMap[h])),0<this._deltaMap[h][2]){console.log("    **Diff content on change/add: \n");for(var e=0;e<this._deltaMap[h][0];e++)console.log("    "+
this._diffContents[this._deltaMap[h][2]+e-1])}},_logNewFile:function(){for(var h=0;h<this._nFileContents.length;h++)console.log(this._nFileContents[h])},_createBlock:function(h,e,c,b){b===c&&" "===h||(c=[c,b-c,"s"],"-"===h?c[2]="r":"+"===h?c[2]="a":"c"===h&&(c[2]="c"),e.push(c))},_createMinusBlock:function(h,e,c,b){var k=this._oBlocks.length;0===k||h!==this._oBlocks[k-1][0]?(this._oBlocks.push([0===h?1:h,c,b]),this._nBlocks.push([e,0,-2])):(this._oBlocks[k-1][1]+=c,this._oBlocks[k-1][2]=b)},_createPlusBlock:function(h,
e,c,b){var k=this._nBlocks.length;0===k||e!==this._nBlocks[k-1][0]?(this._oBlocks.push([0===h?1:h,0]),this._nBlocks.push([e,c,b])):(this._nBlocks[k-1][1]+=c,this._nBlocks[k-1][2]=b)},_parseHunkBlock:function(h){for(var e=" ",c=this._hunkRanges[h][0]+1,b=h===this._hunkRanges.length-1?this._diffContents.length:this._hunkRanges[h+1][0],k=0,l=0,g=this._hunkRanges[h][1],a=this._hunkRanges[h][3],p=c,f=c,n=c;n<b;n++)if(0!==this._diffContents[n].length){var d=this._diffContents[n][0];if("\\"===d&&("\\ No newline at end of file"===
this._diffContents[n].substring(0,this._diffContents[n].length-1)||"\\ No newline at end of file"===this._diffContents[n]))"-"===e?this._oNewLineAtEnd=!1:" "===e?this._oNewLineAtEnd=this._nNewLineAtEnd=!1:this._nNewLineAtEnd=!1,n>c&&"\r"===this._diffContents[n-1][this._diffContents[n-1].length-1]&&(this._diffContents[n-1]=this._diffContents[n-1].substring(0,this._diffContents[n-1].length-1));else{switch(d){case "-":case "+":case " ":break;default:continue}if(e!==d){"+"===d&&(p=n);"-"===d&&(f=n);switch(e){case " ":g=
this._hunkRanges[h][1]+k;a=this._hunkRanges[h][3]+l;break;case "-":this._createMinusBlock(g,a,this._hunkRanges[h][1]+k-g,f);break;case "+":this._createPlusBlock(g,a,this._hunkRanges[h][3]+l-a,p)}e=d}switch(d){case "-":k++;break;case "+":l++;break;case " ":k++,l++}}}switch(e){case "-":this._createMinusBlock(g,a,this._hunkRanges[h][1]+k-g,f);break;case "+":this._createPlusBlock(g,a,this._hunkRanges[h][3]+l-a,p)}},_detectConflictes:function(h,e){if(0>h)return!1;for(var c=h+e,b=h;b<c;b++){var k=this._diffContents[b];
if(-1<k.indexOf("\x3c\x3c\x3c\x3c\x3c")||-1<k.indexOf("\x3e\x3e\x3e\x3e\x3e"))return!0}return!1},_buildMap:function(h){var e=this._oBlocks.length,c=this._oFileContents.length,b=0,k;k=1;for(var l=0;l<e;l++)k=this._oBlocks[l][0]-k,0<k&&(this._deltaMap.push([k,k,0]),b+=k),h&&this._detectConflictes(this._nBlocks[l][2],this._nBlocks[l][1])?this._deltaMap.push([this._nBlocks[l][1],this._oBlocks[l][1],this._nBlocks[l][2]+1,1]):this._deltaMap.push([this._nBlocks[l][1],this._oBlocks[l][1],this._nBlocks[l][2]+
1]),b+=this._oBlocks[l][1],k=this._oBlocks[l][0]+this._oBlocks[l][1];0<c-k&&(this._deltaMap.push([c-k+1,c-k+1,0]),b+=c-k+1);b<c&&(k=c-b,h=this._deltaMap[this._deltaMap.length-1],0===h[2]?(h[0]+=k,h[1]+=k):-1===h[2]?this._deltaMap.push([k,k,0]):this._nNewLineAtEnd===this._oNewLineAtEnd?this._deltaMap.push([k,k,0]):(this._nNewLineAtEnd&&(h[0]+=k),this._oNewLineAtEnd&&(h[1]+=k)))},_buildNewFile:function(){var h=1,e=!1,c=this._deltaMap.length,b,k;for(b=0;b<c;b++){e=!1;if(0===this._deltaMap[b][2]){for(k=
0;k<this._deltaMap[b][0];k++)this._nFileContents.push(this._oFileContents[h+k-1]);e=!0}else if(0<this._deltaMap[b][2])for(k=0;k<this._deltaMap[b][0];k++)this._nFileContents.push(this._diffContents[this._deltaMap[b][2]+k-1].substring(1));h+=this._deltaMap[b][1]}this._nNewLineAtEnd&&!e&&this._nFileContents.push("")},_converHRangeBody:function(h,e){if(h){var c=parseInt(h,10);e.push(0<=c?c:1)}else e.push(1)},_parseHunkRange:function(h){var e=this._diffContents[h],c=/^@@\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/,
b=/^@@\s*-([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*\+([\+|\-]*[\d]+)\s*,*\s*([\d]*)\s*@@+/.exec(e),k=null;if(b&&5===b.length)k=[h],this._converHRangeBody(b[1],k),this._converHRangeBody(b[2],k),this._converHRangeBody(b[3],k),this._converHRangeBody(b[4],k);else if((b=c.exec(e))&&5===b.length)k=[h],this._converHRangeBody(b[3],k),this._converHRangeBody(b[4],k),this._converHRangeBody(b[1],k),this._converHRangeBody(b[2],k);return k}};return l}();return l});y("orion/differ",["orion/extensionCommands","orion/compare/diffParser"],
function(l,r){function p(h,e,c){this._serviceRegistry=h;this._inputManager=e;this._editor=c;this._enabled=!1;this.init()}p.prototype={init:function(){var h=this;this._changeListener=function(){h._enabled&&(h.occurrenceTimer&&window.clearTimeout(h.occurrenceTimer),h.occurrenceTimer=window.setTimeout(function(){h.occurrenceTimer=null;h.doDiff()},500))};this._inputManager.addEventListener("InputChanged",function(){var e=h._editor.getTextView();e&&e.removeEventListener("ModelChanged",h._changeListener);
(h.service=h.getDiffer())&&e&&e.addEventListener("ModelChanged",h._changeListener)})},isVisible:function(){return!!this.getDiffer()},getDiffer:function(){for(var h=this._inputManager.getFileMetadata(),e=this._serviceRegistry.getServiceReferences("orion.edit.diff"),c=0;c<e.length;c++){var b=e[c],k={};k.validationProperties=b.getProperty("validationProperties");k.forceSingleItem=!0;k=l._makeValidator(k,this._serviceRegistry);if(k.validationFunction.bind(k)(h))return this._serviceRegistry.getService(b)}return null},
showAnnotations:function(h){var e=this,c=new r.DiffParser,b={metadata:this._inputManager.getFileMetadata()};h.computeDiff(this._editor.getEditorContext(),b).then(function(b){c.setLineDelim("\n");c.parse("",b);b=c.getOriginalBlocks();var h=c.getNewBlocks(),g=c.getDiffArray();b=e.getDiffRanges(b,h,g);e._enabled&&e._editor.showDiffAnnotations(b)})},getDiffRanges:function(h,e){for(var c=[],b=0;b<e.length;b++){var k=e[b][0],l=h[b][1],g=e[b][1];0===g?c.push({lineStart:k-1,lineEnd:k,type:"deleted"}):0===
l?c.push({lineStart:k-1,lineEnd:k+g-1,type:"added"}):c.push({lineStart:k-1,lineEnd:k+g-1,type:"modified"})}return c},toggleEnabled:function(){this.setEnabled(!this.isEnabled())},setEnabled:function(h){this._enabled=h;this.doDiff()},isEnabled:function(){return this._enabled},doDiff:function(){if(this._enabled){if(this.service){var h=this;this._inputManager.save().then(function(){h.showAnnotations(h.service)})}}else this._editor.showDiffAnnotations([])}};p.prototype.constructor=p;return{Differ:p}});
y("orion/webui/contextmenu",["orion/webui/littlelib","orion/webui/dropdown","orion/objects"],function(l,r,p){function h(c){c.skipTriggerEventListeners=!0;e.call(this,c);this._initialize()}var e=r.Dropdown;h.prototype=Object.create(e.prototype);h.prototype.constructor=h;p.mixin(h.prototype,{_initialize:function(){this._dropdownNode.dropdown||(this._dropdownNode.dropdown=this);this._boundcontextmenuEventHandler=this._contextmenuEventHandler.bind(this);this._boundContextMenuCloser=this._contextMenuCloser.bind(this);
this._triggerNode.addEventListener("contextmenu",this._boundcontextmenuEventHandler,!0);window.addEventListener("contextmenu",this._boundContextMenuCloser,!1)},_contextMenuCloser:function(c){this.close(c)},_contextmenuEventHandler:function(c){this.open(c)?l.stop(c):this.close()}});h.prototype.open=function(c){this._triggerNode.addEventListener("click",this._boundContextMenuCloser,!1);return e.prototype.open.call(this,c)};h.prototype.close=function(c){this._triggerNode.removeEventListener("click",
this._boundContextMenuCloser,!1);return e.prototype.close.call(this,c)};h.prototype._positionDropdown=function(c){if(c){var b=c.clientX;c=c.clientY;this._dropdownNode.style.position="fixed";this._dropdownNode.style.left=b+"px";this._dropdownNode.style.top=c+"px";var h=l.bounds(this._dropdownNode),m=h.width,h=h.height,g=l.bounds(document.body),m=b+m-(g.left+g.width);0<m&&(this._dropdownNode.style.left=Math.floor(b-m)+"px");b=c+h-(g.top+g.height);0<b&&(this._dropdownNode.style.top=Math.floor(c-b)+"px")}else e.prototype._positionDropdown.call(this)};
h.prototype.destroy=function(){this._triggerNode.removeEventListener("contextmenu",this._boundcontextmenuEventHandler,!0);this._triggerNode.removeEventListener("click",this._boundContextMenuCloser,!1);window.removeEventListener("contextmenu",this._boundContextMenuCloser,!1);this._dropdownNode.dropdown=null;e.prototype.destroy.call(this)};return{ContextMenu:h}});y("orion/editorView","i18n!orion/edit/nls/messages orion/editor/editor orion/editor/eventTarget orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/editorFeatures orion/hover orion/editor/contentAssist orion/editor/emacs orion/editor/vi orion/editorPreferences orion/widgets/themes/ThemePreferences orion/widgets/themes/editor/ThemeData orion/widgets/settings/EditorSettings orion/searchAndReplace/textSearcher orion/editorCommands orion/globalCommands orion/edit/dispatcher orion/edit/editorContext orion/edit/typedefs orion/highlight orion/markOccurrences orion/syntaxchecker orion/liveEditSession orion/problems orion/blamer orion/differ orion/keyBinding orion/util orion/Deferred orion/webui/contextmenu orion/objects".split(" "),
function(l,r,p,h,e,c,b,k,m,g,a,t,f,n,d,u,s,v,y,F,z,D,B,C,q,x,w,E,K,O,H,I,G){function M(a){this._parent=a.parent;"string"===typeof this._parent&&(this._parent=document.getElementById(a.parent));this.id=a.id||"";this.activateContext=a.activateContext;this.renderToolbars=a.renderToolbars;this.serviceRegistry=a.serviceRegistry;this.contentTypeRegistry=a.contentTypeRegistry;this.commandRegistry=a.commandRegistry;this.progress=a.progress;this.statusService=a.statusService;this.editorCommands=a.editorCommands;
this.fileClient=a.fileService;this.inputManager=a.inputManager;this.preferences=a.preferences;this.readonly=a.readonly;this.searcher=a.searcher;this.statusReporter=a.statusReporter;this.model=a.model;this.undoStack=a.undoStack;this.problemsServiceID=a.problemsServiceID||"orion.core.marker";this.editContextServiceID=a.editContextServiceID||"orion.edit.context";this.syntaxHighlighter=new D.SyntaxHighlighter(this.serviceRegistry);this.typeDefRegistry=new z(this.serviceRegistry);(a=v.getKeyAssist?v.getKeyAssist():
null)&&a.addProvider(this.editorCommands);var b=v.getMainSplitter?v.getMainSplitter():null;b&&b.splitter.addEventListener("resize",function(a){this.editor&&a.node===b.main&&this.editor.resize()}.bind(this));v.getGlobalEventTarget&&v.getGlobalEventTarget().addEventListener("toggleTrim",function(){this.editor&&this.editor.resize()}.bind(this));this.settings={};this._init()}var Q=y.Dispatcher;M.prototype={updateKeyMode:function(b,c){this.emacs&&c.removeKeyMode(this.emacs);this.vi&&c.removeKeyMode(this.vi);
"Emacs"===b.keyBindings?(this.emacs||(this.emacs=new g.EmacsMode(c)),c.addKeyMode(this.emacs)):"vi"===b.keyBindings&&(this.vi||(this.vi=new a.VIMode(c,this.statusReporter)),c.addKeyMode(this.vi))},setContents:function(a,b){var c=this.contentTypeRegistry.getContentType(b),d="txt";c&&(c.extension&&0<c.extension.length)&&(d=c.extension[0]);var e="/__embed/"+this.id+"/foo."+d;return(e===this.lastFileLocation||!this.lastFileLocation?(new H).resolve():this.fileClient.deleteFile(this.lastFileLocation)).then(function(){return this.fileClient.write(e,
a).then(function(){this.lastFileLocation=e;this.inputManager.setInput(e)}.bind(this))}.bind(this))},getParent:function(){return this._parent},getSettings:function(){return this.settings},setParent:function(a){this._parent=a},updateSourceCodeActions:function(a,b){b&&(b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),
b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation))},updateViewOptions:function(a){var b=0;a.showMargin&&(b=a.marginOffset,"number"!==typeof b&&(b=a.marginOffset=parseInt(b,10)));var c=0;a.wordWrap&&(c=b);return{readonly:this.readonly||this.inputManager.getReadOnly(),tabSize:a.tabSize||4,expandTab:a.expandTab,wrapMode:a.wordWrap,wrapOffset:c,marginOffset:b,scrollAnimation:a.scrollAnimation?a.scrollAnimationTimeout:0}},updateSettings:function(a){this.settings=
a;var b=this.editor,c=this.inputManager;c.setAutoLoadEnabled(a.autoLoad);c.setAutoSaveTimeout(a.autoSave?a.autoSaveTimeout:-1);c.setSaveDiffsEnabled(a.saveDiffs);this.differ.setEnabled(this.settings.diffService);this.updateStyler(a);var d=b.getTextView();d&&(this.updateKeyMode(a,d),d.setOptions(this.updateViewOptions(a)));this.updateSourceCodeActions(a,b.getSourceCodeActions());b.setAnnotationRulerVisible(a.annotationRuler);b.setLineNumberRulerVisible(a.lineNumberRuler);b.setFoldingRulerVisible(a.foldingRuler);
b.setOverviewRulerVisible(a.overviewRuler);b.setZoomRulerVisible(a.zoomRuler);this.renderToolbars&&this.renderToolbars(c.getFileMetadata());this.markOccurrences.setOccurrencesVisible(a.showOccurrences);b.getContentAssist()&&b.getContentAssist().setAutoTriggerEnabled(a.contentAssistAutoTrigger);this.dispatchEvent({type:"Settings",newSettings:this.settings})},updateStyler:function(a){var b=this.syntaxHighlighter.getStyler();b&&b.setWhitespacesVisible&&b.setWhitespacesVisible(a.showWhitespaces,!0)},
recordSession:function(){var a=this.editor,b=a.getTextView(),c=this.inputManager;if(b&&c&&(c=c.getFileMetadata())){var d=sessionStorage.editorViewSection?JSON.parse(sessionStorage.editorViewSection):{},a=a.getSelections().map(function(a){return a.getOrientedSelection()});d[c.Location]={ETag:c.ETag,topIndex:b.getTopIndex(),selections:a};sessionStorage.editorViewSection=JSON.stringify(d)}},loadSession:function(a){var b=this.editor,c=b.getTextView(),d=this.inputManager;if(c&&d&&(d=d.getFileMetadata())){var e=
(sessionStorage.editorViewSection?JSON.parse(sessionStorage.editorViewSection):{})[d.Location];e&&e.ETag===d.ETag&&(a.session={apply:function(){b.setSelections(e.selections);c.setTopIndex(e.topIndex)}})}},_init:function(){this.preferences&&(this.editorCommands.editorPreferences=this.editorPreferences=this.editorCommands.editorPreferences||new t.EditorPreferences(this.preferences),this.editorPreferences.addEventListener("Changed",function(a){(a=a.preferences)?this.updateSettings(a):this.editorPreferences.getPrefs(this.updateSettings.bind(this))}.bind(this)),
this.editorCommands.themePreferences=this.themePreferences=this.editorCommands.themePreferences||new f.ThemePreferences(this.preferences,new n.ThemeData),this.themePreferences.apply());var a=this,g=this.commandRegistry,p=this.serviceRegistry,v=this.activateContext,y=this.inputManager,z=this.progress,A=this.contentTypeRegistry,D=this.editorCommands,I=function(b,c,d){var e=y.getContentType(),f=b.getTitle();b=p.getServiceReferences("orion.edit.contentAssist").concat(p.getServiceReferences("orion.edit.contentassist"));
(d=d&&d.providers)||(d=b.map(function(a){var b=a.getProperty("contentType"),c=a.getProperty("pattern");if(b&&A.isSomeExtensionOf(e,b)||c&&RegExp(c).test(f)){var b=p.getService(a),c=a.getProperty("service.id").toString(),d=a.getProperty("charTriggers");a=a.getProperty("excludedStyles");d&&(d=RegExp(d));a&&(a=RegExp(a));return{provider:b,id:c,charTriggers:d,excludedStyles:a}}return null}).filter(function(a){return!!a}));var g={};Object.keys(F).forEach(function(b){"function"===typeof F[b]&&(g[b]=F[b].bind(null,
p,a.editContextServiceID))});c.setEditorContextProvider(g);c.setProviders(d);c.setAutoTriggerEnabled(a.settings.contentAssistAutoTrigger);c.setProgress(z);c.setStyleAccessor(a.getStyleAccessor())},H=this.readonly?null:{createContentAssistMode:function(a){var b=new m.ContentAssist(a.getTextView());b.addEventListener("Activating",I.bind(null,a,b));var c=new m.ContentAssistWidget(b,"contentassist"),c=new m.ContentAssistMode(b,c);b.setMode(c);I(a,b);b.initialize();return c}},J=this.editor=new r.Editor({textViewFactory:function(){var b=
a.updateViewOptions(a.settings);G.mixin(b,{parent:a._parent,model:new c.ProjectionTextModel(a.model||new e.TextModel),wrappable:!0});return new h.TextView(b)},undoStackFactory:a.undoStack?{createUndoStack:function(b){a.undoStack.setView(b.getTextView());return a.undoStack}}:new b.UndoFactory,textDNDFactory:new b.TextDNDFactory,annotationFactory:new b.AnnotationFactory,foldingRulerFactory:new b.FoldingRulerFactory,zoomRulerFactory:new b.ZoomRulerFactory,lineNumberRulerFactory:new b.LineNumberRulerFactory,
hoverFactory:new k.HoverFactory(p,y,g),contentAssistFactory:H,keyBindingFactory:function(c,d,e,f){d=a.textSearcher=u.TextSearcher?new u.TextSearcher(c,p,g,e):null;e=(new b.KeyBindingsFactory).createKeyBindings(c,e,f,d);a.updateSourceCodeActions(a.settings,e.sourceCodeActions);D.overwriteKeyBindings(c);var h=c.getTextView();if(c=g.findCommand("orion.keyAssist"))h.setKeyBinding(new K.KeyStroke(191,!1,!0,!O.isMac,O.isMac),c.id),h.setAction(c.id,c.callback,c);h.setAction("toggleWrapMode",function(){h.invokeAction("toggleWrapMode",
!0);var b=h.getOptions("wrapMode");a.settings.wordWrap=b;a.editorPreferences&&a.editorPreferences.setPrefs(a.settings);return!0});h.setKeyBinding(new K.KeyStroke("z",!0,!1,!0),"toggleZoomRuler");h.setAction("toggleZoomRuler",function(){if(!a.settings.zoomRulerVisible)return!1;a.settings.zoomRuler=!a.settings.zoomRuler;a.editorPreferences&&a.editorPreferences.setPrefs(a.settings);return!0},{name:l.toggleZoomRuler});a.vi=a.emacs=null;a.updateKeyMode(a.settings,h);return e},statusReporter:this.statusReporter,
domNode:this._parent});J.id="orion.editor";J.processParameters=function(a){for(var b=["start","end","line","offset","length"],c=0;c<b.length;c++){var d=b[c];a[d]&&(a[d]=parseInt(a[d],10))}return this.showSelection(a.start,a.end,a.line,a.offset,a.length)};J.getEditorContext=function(){return F.getEditorContext(p,a.editContextServiceID)};this.dispatcher=new Q(this.serviceRegistry,this.contentTypeRegistry,J,y);this.themePreferences&&this.editorPreferences&&(this.localSettings=d?new d({local:!0,editor:J,
themePreferences:this.themePreferences,preferences:this.editorPreferences}):null);var M=new q(p,J),H=function(){a.recordSession()};y.addEventListener("InputChanging",H);window.addEventListener("beforeunload",H);y.addEventListener("InputChanged",function(b){a.loadSession(b);var c=J.getTextView();if(c){if(M.start(y.getContentType(),b.title),c.setOptions(this.updateViewOptions(this.settings)),this.syntaxHighlighter.setup(b.contentType,J.getTextView(),J.getAnnotationModel(),b.title,!0).then(function(){this.updateStyler(this.settings);
J.getContentAssist()&&I(J,J.getContentAssist())}.bind(this)),c.onInputChanged)c.onInputChanged({type:b.type})}else M.start()}.bind(this));y.addEventListener("Saving",function(b){a.settings.trimTrailingWhiteSpace&&J.getTextView().invokeAction("trimTrailingWhitespaces");var c=J.getTextView();if(c&&c.onSaving)c.onSaving({type:b.type})});this.blamer=new w.Blamer(p,y,J);this.differ=new E.Differ(p,y,J);this.problemService=new x.ProblemService(p,this.problemsServiceID);(H=p.getService(this.problemsServiceID))&&
H.addEventListener("problemsChanged",function(a){J.showProblems(a.problems)});H=this.markOccurrences=new B.MarkOccurrences(p,y,J);H.setOccurrencesVisible(this.settings.occurrencesVisible);H.findOccurrences();var R=new C.SyntaxChecker(p,J.getModel());J.addEventListener("InputChanged",function(b){R.setTextModel(J.getModel());R.checkSyntax(y.getContentType(),b.title,b.message,b.contents,J.getEditorContext()).then(function(b){p.getService(a.problemsServiceID)._setProblems(b)});y.getReadOnly()&&J.reportStatus(l.readonly,
"error")});var N=Object.create(null);"getCaretOffset setCaretOffset getSelection setSelection getSelections setSelections getText setText getLineAtOffset getLineStart isDirty markClean".split(" ").forEach(function(a){N[a]=J[a].bind(J)});N.showMarkers=function(b){p.getService(a.problemsServiceID)._setProblems(b)};N.enterLinkedMode=function(a){J.getLinkedMode().enterLinkedMode(a)};N.openEditor=function(a,b){v.openEditor(a,b)};N.getFileMetadata=function(){return a.dispatcher.getServiceFileObject()};
N.setStatus=s.handleStatusMessage.bind(null,p);p.registerService(this.editContextServiceID,N,null)},create:function(){this.editor.install();this.editorPreferences&&this.editorPreferences.getPrefs(this.updateSettings.bind(this));this._createContextMenu()},destroy:function(){this.editor.uninstall()},getStyleAccessor:function(){var a=null,b=this.syntaxHighlighter.getStyler();b&&b.getStyleAccessor&&(a=b.getStyleAccessor());return a},_createContextMenu:function(){this._editorContextMenuNode=document.createElement("ul");
this._editorContextMenuNode.className="dropdownMenu";this._editorContextMenuNode.setAttribute("role","menu");this._parent.parentNode.appendChild(this._editorContextMenuNode);var a=this.editor.getTextView(),a=new I.ContextMenu({dropdown:this._editorContextMenuNode,triggerNode:a._clientDiv}),b=function(a){var b=a.event;if(b.target){a=this.editor.getTextView();for(var b=a.convert({x:b.clientX,y:b.clientY},"page","document"),b=a.getOffsetAtLocation(b.x,b.y),c=!1,d=a.getSelections(),e=0;e<d.length;e++){var f=
d[e];if(f.start<=b&&f.end>=b){c=!0;break}}c||a.setCaretOffset(b);this.commandRegistry.destroy(this._editorContextMenuNode);this.commandRegistry.renderCommands("editorContextMenuActions",this._editorContextMenuNode,null,this,"menu")}}.bind(this);a.addEventListener("triggered",b)}};p.EventTarget.addMixin(M.prototype);return{EditorView:M}});y("embeddedEditor/helper/editorSetup","orion/editor/textModel orion/editor/undoStack orion/commandRegistry orion/inputManager orion/fileClient orion/contentTypes orion/editorView orion/editorCommands orion/objects".split(" "),
function(l,r,p,h,e,c,b,k,m){function g(a){this._serviceRegistry=a.serviceRegistry;this._pluginRegistry=a.pluginRegistry;this._commandRegistry=new p.CommandRegistry({});this._fileClient=new e.FileClient(this._serviceRegistry);this._contentTypeRegistry=new c.ContentTypeRegistry(this._serviceRegistry);this._editorCommands=new k.EditorCommandFactory({serviceRegistry:this._serviceRegistry,commandRegistry:this._commandRegistry,fileClient:this._fileClient,toolbarId:"_orion_hidden_actions",navToolbarId:"_orion_hidden_actions"});
this._progressService={progress:function(a,b,c){return a},showWhile:function(a,b,c){return a}};this._serviceRegistry.registerService("orion.page.progress",this._progressService)}m.mixin(g.prototype,{destroy:function(){},createInputManager:function(){var a=this._inputManager=new h.InputManager({serviceRegistry:this._serviceRegistry,fileClient:this._fileClient,progressService:this._progressService,selection:this.selection,contentTypeRegistry:this._contentTypeRegistry});a.addEventListener("InputChanged",
function(a){a.editor=this.editorView.editor;this.pageActionsScope="_orion_hidden_actions";this._commandRegistry.destroy(this.pageActionsScope);this._commandRegistry.renderCommands(this.pageActionsScope,this.pageActionsScope,a.metadata,a.editor,"tool")}.bind(this));a.addEventListener("InputChanging",function(a){a.editor=this.editorView.editor}.bind(this))},defaultOptions:function(a){var b=new l.TextModel,c=(0).toString(),e=Object.create(null);e.openEditor=function(a,b){this.editorView.editor.setSelection(b.start,
b.end)}.bind(this);return{activateContext:e,id:c,parent:a,model:b,undoStack:new r.UndoStack(b,500),serviceRegistry:this._serviceRegistry,pluginRegistry:this._pluginRegistry,commandRegistry:this._commandRegistry,contentTypeRegistry:this._contentTypeRegistry,editorCommands:this._editorCommands,progressService:this._progressService,inputManager:this._inputManager,fileService:this._fileClient,problemsServiceID:"orion.core.marker"+c,editContextServiceID:"orion.edit.context"+c,editModelContextServiceID:"orion.edit.model.context"+
c,readonly:!1}},createEditor:function(a){return this._editorCommands.createCommands().then(function(){this._editorCommands.registerCommands();this.createInputManager();this.editorView=new b.EditorView(this.defaultOptions(a.parent));this.editorView.create();this._inputManager.editor=this.editorView.editor;this._inputManager.setAutoSaveTimeout(300);this._editorCommands.inputManager=this._inputManager;a.contentType&&a.contents&&this.editorView.setContents(a.contents,a.contentType);return this.editorView}.bind(this))}});
return{EditorSetupHelper:g}});y("embeddedEditor/builder/embeddedEditor",["embeddedEditor/helper/bootstrap","embeddedEditor/helper/editorSetup","orion/objects"],function(l,r,p){function h(){}p.mixin(h.prototype,{create:function(e){return l.startup().then(function(c){return(new r.EditorSetupHelper({serviceRegistry:c.serviceRegistry,pluginRegistry:c.pluginRegistry})).createEditor(e)})}});return h});return S("embeddedEditor/builder/embeddedEditor")});